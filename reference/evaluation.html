<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Evaluation of simulations results — evaluation • medfate</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluation of simulations results — evaluation"><meta property="og:description" content="Functions to compare model predictions against observed values."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.8.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/emf-creaf/medfate/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Evaluation of simulations results</h1>
    
    <div class="hidden name"><code>evaluation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Functions to compare model predictions against observed values.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">evaluation_table</span><span class="op">(</span><span class="va">out</span>, <span class="va">measuredData</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, cohort <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                 temporalResolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="fu">evaluation_stats</span><span class="op">(</span><span class="va">out</span>, <span class="va">measuredData</span>, type<span class="op">=</span><span class="st">"SWC"</span>, cohort <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                 temporalResolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="fu">evaluation_plot</span><span class="op">(</span><span class="va">out</span>, <span class="va">measuredData</span>, type<span class="op">=</span><span class="st">"SWC"</span>, cohort <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                temporalResolution <span class="op">=</span> <span class="st">"day"</span>, </span>
<span>                plotType <span class="op">=</span> <span class="st">"dynamics"</span><span class="op">)</span></span>
<span><span class="fu">evaluation_metric</span><span class="op">(</span><span class="va">out</span>, <span class="va">measuredData</span>, type<span class="op">=</span><span class="st">"SWC"</span>, cohort<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>                  temporalResolution <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>                  metric <span class="op">=</span> <span class="st">"loglikelihood"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>out</dt>
<dd><p>An object of class <code><a href="spwb.html">spwb</a></code>, <code><a href="growth.html">growth</a></code> or <code><a href="spwb.html">pwb</a></code>.</p></dd>

  <dt>measuredData</dt>
<dd><p>A data frame with observed/measured values. Dates should be in row names, whereas columns should be named according to the type of output to be evaluated (see details).</p></dd>

  <dt>type</dt>
<dd><p>A string with the kind of model output to be evaluated. Accepted values are <code>"SWC"</code> (soil moisture content), <code>"REW"</code> relative extractable water, <code>"ETR"</code> (total evapotranspiration), <code>"SE+TR"</code> (modelled soil evaporation + transpiration against observed total evapotranspiration), <code>"E"</code> (transpiration per leaf area), <code>"LFMC"</code> (Live fuel moisture content), <code>"WP"</code> (plant water potentials), <code>"BAI"</code> (basal area increment), <code>"DI"</code> (diameter increment), <code>"DBH"</code> (diameter at breast height) or <code>"Height"</code> (plant height).</p></dd>

  <dt>cohort</dt>
<dd><p>A string of the cohort to be compared (e.g. "T1_68"). If <code>NULL</code> results for the first cohort will be evaluated.</p></dd>

  <dt>temporalResolution</dt>
<dd><p>A string to indicate the temporal resolution of the model evaluation, which can be "day", "week", "month" or "year". Observed and modelled values are aggregated temporally (using either means or sums) before comparison.</p></dd>

  <dt>plotType</dt>
<dd><p>Plot type to draw, either <code>"dynamics"</code> or <code>"scatter"</code>.</p></dd>

  <dt>metric</dt>
<dd><p>An evaluation metric:</p><ul><li><p><code>"MAE"</code>: Mean absolute error.</p></li>
<li><p><code>"MAE.rel"</code>: Mean absolute error in relative terms.</p></li>
<li><p><code>"r"</code>: Pearson's linear correlation coefficient.</p></li>
<li><p><code>"NSE"</code>: Nash-Sutcliffe model efficiency coefficient.</p></li>
<li><p><code>"NSE.abs"</code>: Modified Nash-Sutcliffe model efficiency coefficient (L1 norm) (Legates &amp; McCabe 1999).</p></li>
<li><p><code>"loglikelihood"</code>: Logarithm of the likelihood of observing the data given the model predictions, assuming independent Gaussian errors.</p></li>
</ul><p></p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Users should provide the appropriate columns in <code>measuredData</code>, depending on the type of output to be evaluated:</p><ul><li><p><code>"SWC" or "REW"</code>: A column named <code>"SWC"</code> should be present, containing soil moisture content in percent volume. When <code>type="REW"</code>, observed values are divided by the 90% quantile, which is assumed to be the moisture content at field capacity.</p></li>
<li><p><code>"ETR"</code> or <code>"SE+TR"</code>: A column named <code>"ETR"</code> should be present, containing stand's evapotranspiration in mm/day (or mm/week, mm/month, etc, depending on the temporal resolution). If <code>type="ETR"</code> observed values will be compared against modelled evapotranspiration (i.e. sum of transpiration, soil evaporation and interception loss), whereas if <code>type= "SE+TR"</code> observed values will be compared against the sum of transpiration and soil evaporation only.</p></li>
<li><p><code>"E"</code>: For each plant cohort whose transpiration is to be evaluated, a column starting with <code>"E_"</code> and continuing with a cohort name (e.g. <code>"E_T1_68"</code>) with transpiration in L/m2/day on a leaf area basis (or L/m2/week, L/m2/month, etc, depending on the temporal resolution).</p></li>
<li><p><code>"LFMC"</code>: For each plant cohort whose transpiration is to be evaluated, a column starting with <code>"FCM_"</code> and continuing with a cohort name (e.g. <code>"FMC_T1_68"</code>) with fuel moisture content as percent of dry weight.</p></li>
<li><p><code>"WP"</code>: For each plant cohort whose transpiration is to be evaluated, two columns, one starting with <code>"PD_"</code> (for pre-dawn) and the other with <code>"MD_"</code> (for midday), and continuing with a cohort name (e.g. <code>"PD_T1_68"</code>). They should contain leaf water potential values in MPa. These are compared against sunlit water potentials.</p></li>
<li><p><code>"BAI"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"BAI_"</code> and continuing with a cohort name (e.g. <code>"BAI_T1_68"</code>) with basal area increment in cm2/day, cm2/week, cm2/month or cm2/year, depending on the temporal resolution.</p></li>
<li><p><code>"DI"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"DI_"</code> and continuing with a cohort name (e.g. <code>"DI_T1_68"</code>) with basal area increment in cm/day, cm/week, cm/month or cm/year, depending on the temporal resolution.</p></li>
<li><p><code>"DBH"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"DBH_"</code> and continuing with a cohort name (e.g. <code>"DBH_T1_68"</code>) with DBH values in cm.</p></li>
<li><p><code>"Height"</code>: For each plant cohort whose growth is to be evaluated, a column starting with <code>"Height_"</code> and continuing with a cohort name (e.g. <code>"Height_T1_68"</code>) with Height values in cm.</p></li>
</ul><p>Additional columns may exist with the standard error of measured quantities. These should be named as the referred quantity, followed by <code>"_err"</code> (e.g. <code>"PD_T1_68_err"</code>), and are used to draw confidence intervals around observations.</p>   
<p>Row names in <code>measuredData</code> indicate the date of measurement (in the case of days). If measurements refer to months or years, row names should also be in a "year-month-day" format, although with "01" for days and/or months (e.g. "2001-02-01" for february 2001, or "2001-01-01" for year 2001).</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<ul><li><p>Function <code>evaluation_table</code> returns a data frame with dates, observed and predicted values.</p></li>
<li><p>Function <code>evaluation_stats</code> returns evaluation statistics (a vector or a data frame depending on <code>type</code>):
    </p><ul><li><p><code>Bias</code>: Mean deviation (positive values correspond to model overestimations).</p></li>
<li><p><code>Bias.rel</code>: Bias in relative terms (%).</p></li>
<li><p><code>MAE</code>: Mean absolute error.</p></li>
<li><p><code>MAE.rel</code>: Mean absolute error in relative terms (%).</p></li>
<li><p><code>r</code>: Pearson's linear correlation coefficient.</p></li>
<li><p><code>NSE</code>: Nash-Sutcliffe model efficiency coefficient.</p></li>
<li><p><code>NSE.abs</code>: Modified Nash-Sutcliffe model efficiency coefficient (L1 norm) (Legates &amp; McCabe 1999).</p></li>
</ul></li>
<li><p>Function <code>evaluation_plot</code> returns a ggplot object.</p></li>
<li><p>Function <code>evaluation_metric</code> returns a scalar with the desired metric.</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Miquel De Cáceres Ainsa, CREAF</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Legates, D.R., McCabe, G.J., 1999. Evaluating the use of “goodness-of-fit” measures in hydrologic and hydroclimatic model validation. Water Resour. Res. 35, 233–241.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="spwb.html">spwb</a></code>, <code><a href="growth.html">growth</a></code>, <code><a href="optimization.html">optimization</a></code>, <code><a href="exampleobs.html">exampleobs</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Load example daily meteorological data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Load example plot plant data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleforestMED</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Default species parameterization</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SpParamsMED</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Initialize soil with default soil params (4 layers)</span></span></span>
<span class="r-in"><span><span class="va">examplesoil</span> <span class="op">=</span> <span class="fu"><a href="soil.html">soil</a></span><span class="op">(</span><span class="fu"><a href="defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Initialize control parameters</span></span></span>
<span class="r-in"><span><span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="st">"Granier"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Initialize input</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="modelInput.html">forest2spwbInput</a></span><span class="op">(</span><span class="va">exampleforestMED</span>,<span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, <span class="va">control</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Call simulation function</span></span></span>
<span class="r-in"><span><span class="va">S1</span><span class="op">&lt;-</span><span class="fu"><a href="spwb.html">spwb</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial soil water content (mm): 291.257</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial snowpack content (mm): 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performing daily simulations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [Year 2001]:....................................</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Final soil water content (mm): 272.993</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Final snowpack content (mm): 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Change in soil water content (mm): -18.264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Soil water balance result (mm): -18.264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Change in snowpack water content (mm): 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Snowpack water balance result (mm): 7.10543e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Water balance components:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Precipitation (mm) 513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Rain (mm) 462 Snow (mm) 51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Interception (mm) 96 Net rainfall (mm) 366</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Infiltration (mm) 408 Runoff (mm) 9 Deep drainage (mm) 123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Soil evaporation (mm) 25 Transpiration (mm) 278</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Plant extraction from soil (mm) 278  Plant water balance (mm) -0 Hydraulic redistribution (mm) 6</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Load observed data (in this case the same simulation results with some added error)  </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleobs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Evaluation statistics for soil water content</span></span></span>
<span class="r-in"><span><span class="fu">evaluation_stats</span><span class="op">(</span><span class="va">S1</span>, <span class="va">exampleobs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             n          Bias      Bias.rel           MAE       MAE.rel </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 365.000000000  -0.002465962  -0.890217990   0.005316782   1.919370293 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             r           NSE       NSE.abs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.967054210   0.917216274   0.697529782 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#NSE only</span></span></span>
<span class="r-in"><span><span class="fu">evaluation_metric</span><span class="op">(</span><span class="va">S1</span>, <span class="va">exampleobs</span>, metric<span class="op">=</span><span class="st">"NSE"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9172163</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Comparison of temporal dynamics</span></span></span>
<span class="r-in"><span><span class="fu">evaluation_plot</span><span class="op">(</span><span class="va">S1</span>, <span class="va">exampleobs</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="evaluation-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Loglikelihood value</span></span></span>
<span class="r-in"><span><span class="fu">evaluation_metric</span><span class="op">(</span><span class="va">S1</span>, <span class="va">exampleobs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1026.114</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Miquel De Cáceres, Shengli Huang, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>


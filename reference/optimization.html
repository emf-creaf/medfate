<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Multiple model runs and function factories for optimization routines — optimization • medfate</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple model runs and function factories for optimization routines — optimization"><meta name="description" content="Function factories to generate functions to be used in model calibration, uncertainty or sensitivity analysis."><meta property="og:description" content="Function factories to generate functions to be used in model calibration, uncertainty or sensitivity analysis."><meta property="og:image" content="https://emf-creaf.github.io/medfate/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">medfate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/intro/PackageOverview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../articles/intro/UnderstandingInputs.html">Understanding model inputs</a></li>
    <li><a class="dropdown-item" href="../articles/intro/PreparingInputs.html">Preparing model inputs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Running simulations</h6></li>
    <li><a class="dropdown-item" href="../articles/runmodels/BasicWaterBalance.html">Basic water balance</a></li>
    <li><a class="dropdown-item" href="../articles/runmodels/AdvancedWaterEnergyBalance.html">Advanced water and energy balance</a></li>
    <li><a class="dropdown-item" href="../articles/runmodels/ForestGrowth.html">Forest growth</a></li>
    <li><a class="dropdown-item" href="../articles/runmodels/ForestDynamics.html">Forest dynamics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/medfate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multiple model runs and function factories for optimization routines</h1>
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/R/optimization.R" class="external-link"><code>R/optimization.R</code></a></small>
      <div class="d-none name"><code>optimization.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function factories to generate functions to be used in model calibration, uncertainty or sensitivity analysis.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">multiple_runs</span><span class="op">(</span></span>
<span>  <span class="va">parMatrix</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">meteo</span>,</span>
<span>  <span class="va">latitude</span>,</span>
<span>  elevation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  slope <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  aspect <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  summary_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">optimization_function</span><span class="op">(</span></span>
<span>  <span class="va">parNames</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">meteo</span>,</span>
<span>  <span class="va">latitude</span>,</span>
<span>  elevation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  slope <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  aspect <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">summary_function</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">optimization_evaluation_function</span><span class="op">(</span></span>
<span>  <span class="va">parNames</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">meteo</span>,</span>
<span>  <span class="va">latitude</span>,</span>
<span>  elevation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  slope <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  aspect <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">measuredData</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"SWC"</span>,</span>
<span>  cohorts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  temporalResolution <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"loglikelihood"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">optimization_multicohort_function</span><span class="op">(</span></span>
<span>  <span class="va">cohortParNames</span>,</span>
<span>  <span class="va">cohortNames</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">meteo</span>,</span>
<span>  <span class="va">latitude</span>,</span>
<span>  otherParNames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  elevation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  slope <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  aspect <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">summary_function</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">optimization_evaluation_multicohort_function</span><span class="op">(</span></span>
<span>  <span class="va">cohortParNames</span>,</span>
<span>  <span class="va">cohortNames</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">meteo</span>,</span>
<span>  <span class="va">latitude</span>,</span>
<span>  otherParNames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  elevation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  slope <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  aspect <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">measuredData</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"SWC"</span>,</span>
<span>  cohorts <span class="op">=</span> <span class="va">cohortNames</span>,</span>
<span>  temporalResolution <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"loglikelihood"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-parmatrix">parMatrix<a class="anchor" aria-label="anchor" href="#arg-parmatrix"></a></dt>
<dd><p>A matrix of parameter values with runs in rows and parameters in columns. Column names should follow parameter modification naming rules (see examples and naming rules in <code><a href="modifyParams.html">modifyInputParams</a></code>).</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object of class <code><a href="modelInput.html">spwbInput</a></code> or <code><a href="modelInput.html">growthInput</a></code>.</p></dd>


<dt id="arg-meteo-latitude-elevation-slope-aspect">meteo, latitude, elevation, slope, aspect<a class="anchor" aria-label="anchor" href="#arg-meteo-latitude-elevation-slope-aspect"></a></dt>
<dd><p>Additional parameters to simulation functions <code><a href="spwb.html">spwb</a></code> or <code><a href="growth.html">growth</a></code>.</p></dd>


<dt id="arg-summary-function">summary_function<a class="anchor" aria-label="anchor" href="#arg-summary-function"></a></dt>
<dd><p>A function whose input is the result of <code><a href="spwb.html">spwb</a></code> or <code><a href="growth.html">growth</a></code>. The function must return a numeric scalar in the case of <code>optimization_function</code>, but is not restricted in the case of <code>multiple_runs</code>.</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>A list of additional arguments of <code>optimization_function</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A flag to indicate extra console output.</p></dd>


<dt id="arg-parnames">parNames<a class="anchor" aria-label="anchor" href="#arg-parnames"></a></dt>
<dd><p>A string vector of parameter names (see examples and naming rules in <code><a href="modifyParams.html">modifyInputParams</a></code>).</p></dd>


<dt id="arg-measureddata">measuredData<a class="anchor" aria-label="anchor" href="#arg-measureddata"></a></dt>
<dd><p>A data frame with observed/measured values. Dates should be in row names, whereas columns should be named according to the type of output to be evaluated (see details).</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>A string with the kind of model output to be evaluated. Accepted values are <code>"SWC"</code> (soil moisture content), <code>"REW"</code> relative extractable water, <code>"ETR"</code> (total evapotranspiration), <code>"E"</code> (transpiration per leaf area), <code>"LFMC"</code> (live fuel moisture content) and <code>"WP"</code> (plant water potentials).</p></dd>


<dt id="arg-cohorts">cohorts<a class="anchor" aria-label="anchor" href="#arg-cohorts"></a></dt>
<dd><p>A string or a vector of strings with the cohorts to be compared (e.g. "T1_68"). If several cohort names are provided, the function <code>optimization_cohorts_function</code> evaluates the performance for each one and provides the mean value. If <code>NULL</code> results for the first cohort will be evaluated.</p></dd>


<dt id="arg-temporalresolution">temporalResolution<a class="anchor" aria-label="anchor" href="#arg-temporalresolution"></a></dt>
<dd><p>A string to indicate the temporal resolution of the model evaluation, which can be "day", "week", "month" or "year". Observed and modelled values are aggregated temporally (using either means or sums) before comparison.</p></dd>


<dt id="arg-metric">metric<a class="anchor" aria-label="anchor" href="#arg-metric"></a></dt>
<dd><p>An evaluation metric (see <code><a href="evaluation.html">evaluation_metric</a></code>).</p></dd>


<dt id="arg-cohortparnames">cohortParNames<a class="anchor" aria-label="anchor" href="#arg-cohortparnames"></a></dt>
<dd><p>A string vector of vegetation parameter names for cohorts (e.g. 'Z95' or 'psiExtract').</p></dd>


<dt id="arg-cohortnames">cohortNames<a class="anchor" aria-label="anchor" href="#arg-cohortnames"></a></dt>
<dd><p>A string vector of cohort names. All cohorts will be given the same parameter values for each parameter in 'cohortParNames'.</p></dd>


<dt id="arg-otherparnames">otherParNames<a class="anchor" aria-label="anchor" href="#arg-otherparnames"></a></dt>
<dd><p>A string vector of parameter names (see examples and naming rules in <code><a href="modifyParams.html">modifyInputParams</a></code>) for non-vegetation parameters (i.e. control parameters and soil parameters).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Function <code>multiple_runs</code> returns a list, whose elements are either the result of calling simulation models
or the result of calling <code>summary_function</code> afterwards.</p>
<p>Function <code>optimization_function</code> returns a function whose parameters are parameter values
and whose return is a prediction scalar (e.g. total transpiration).</p>
<p>Function <code>optimization_evaluation_function</code> returns a function whose parameters are parameter values
and whose return is an evaluation metric (e.g. loglikelihood of the data observations given model predictions).
If evaluation data contains information for different cohorts (e.g. plant water potentials or transpiration rates)
then the evaluation is performed for each cohort and the metrics are averaged.</p>
<p>Function <code>optimization_multicohorts_function</code> returns a function whose parameters are parameter values
and whose return is a prediction scalar (e.g. total transpiration). The difference with <code>optimization_function</code>
is that multiple cohorts are set to the same parameter values.</p>
<p>Function <code>optimization_evaluation_multicohort_function</code> returns a function whose parameters are parameter values
and whose return is an evaluation metric (e.g. loglikelihood of the data observations given model predictions).
If evaluation data contains information for different cohorts (e.g. plant water potentials or transpiration rates)
then the evaluation is performed for each cohort and the metrics are averaged. The difference with <code>optimization_evaluation_function</code>
is that multiple cohorts are set to the same parameter values.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See <code><a href="evaluation.html">evaluation</a></code> for details regarding how to specify measured data.</p>
<p>Functions produced by these function factories should be useful for sensitivity analyses using package 'sensitivity'.</p>
<p>Parameter naming (i.e. <code>parNames</code>) should follow the rules specified in section details of <code><a href="modifyParams.html">modifyInputParams</a></code>.
The exception to the naming rules applies when multiple cohorts are to be modified to the same values with functions
<code>optimization_multicohort_function</code> and <code>optimization_evaluation_multicohort_function</code>.
Then, only a vector of parameter names is supplied for <code>cohortParNames</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="evaluation.html">evaluation_metric</a></code>, <code><a href="modifyParams.html">modifyInputParams</a></code>, <code><a href="spwb.html">spwb</a></code>, <code><a href="growth.html">growth</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Miquel De Cáceres Ainsa, CREAF</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">#Load example daily meteorological data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Load example plot plant data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleforest</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Default species parameterization</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SpParamsMED</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Define soil with default soil params (4 layers)</span></span></span>
<span class="r-in"><span><span class="va">examplesoil</span> <span class="op">&lt;-</span> <span class="fu"><a href="defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Initialize control parameters</span></span></span>
<span class="r-in"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="st">"Granier"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Initialize input</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="modelInput.html">spwbInput</a></span><span class="op">(</span><span class="va">exampleforest</span>,<span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, <span class="va">control</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cohort name for Pinus halepensis</span></span></span>
<span class="r-in"><span><span class="va">PH_coh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T1_"</span>, <span class="va">SpParamsMED</span><span class="op">$</span><span class="va">SpIndex</span><span class="op">[</span><span class="va">SpParamsMED</span><span class="op">$</span><span class="va">Name</span><span class="op">==</span><span class="st">"Pinus halepensis"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">PH_coh</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "T1_148"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Parameter names of interest</span></span></span>
<span class="r-in"><span><span class="va">parNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PH_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PH_coh</span>,<span class="st">"/Z95"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Specify parameter matrix</span></span></span>
<span class="r-in"><span><span class="va">parMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">300</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">parMatrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">parNames</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Define a summary function as the total transpiration over the simulated period</span></span></span>
<span class="r-in"><span><span class="va">sf</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">$</span><span class="va">Transpiration</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Perform two runs and evaluate the summary function</span></span></span>
<span class="r-in"><span><span class="fu">multiple_runs</span><span class="op">(</span><span class="va">parMatrix</span>, </span></span>
<span class="r-in"><span>              <span class="va">x1</span>, <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">42</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>              summary_function <span class="op">=</span> <span class="va">sf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Parameter values = [200, 500] f = 249.12839057893</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Parameter values = [300, 1000] f = 249.60196207274</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 249.1284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 249.602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Load observed data (in this case the same simulation results with some added error)  </span></span></span>
<span class="r-in"><span><span class="co"># Generate a prediction function for total transpiration over the simulated period</span></span></span>
<span class="r-in"><span><span class="co"># as a function of parameters "Z50" and "Z95" for Pinus halepensis cohort </span></span></span>
<span class="r-in"><span><span class="va">of</span><span class="op">&lt;-</span><span class="fu">optimization_function</span><span class="op">(</span>parNames <span class="op">=</span> <span class="va">parNames</span>,</span></span>
<span class="r-in"><span>                          x <span class="op">=</span> <span class="va">x1</span>,</span></span>
<span class="r-in"><span>                          meteo <span class="op">=</span> <span class="va">examplemeteo</span>, </span></span>
<span class="r-in"><span>                          latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                          summary_function <span class="op">=</span> <span class="va">sf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate for the values of the parameter matrix</span></span></span>
<span class="r-in"><span><span class="fu">of</span><span class="op">(</span><span class="va">parMatrix</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 249.2256</span>
<span class="r-in"><span><span class="fu">of</span><span class="op">(</span><span class="va">parMatrix</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 249.2256 249.6995</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate a loglikelihood function for soil water content</span></span></span>
<span class="r-in"><span><span class="co"># as a function of parameters "Z50" and "Z95" for Pinus halepensis cohort </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleobs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">oef</span><span class="op">&lt;-</span><span class="fu">optimization_evaluation_function</span><span class="op">(</span>parNames <span class="op">=</span> <span class="va">parNames</span>,</span></span>
<span class="r-in"><span>                                      x <span class="op">=</span> <span class="va">x1</span>,</span></span>
<span class="r-in"><span>                                      meteo <span class="op">=</span> <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                                      measuredData <span class="op">=</span> <span class="va">exampleobs</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, </span></span>
<span class="r-in"><span>                                      metric <span class="op">=</span> <span class="st">"loglikelihood"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Loglikelihood for the values of the parameter matrix</span></span></span>
<span class="r-in"><span><span class="fu">oef</span><span class="op">(</span><span class="va">parMatrix</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 998.2922</span>
<span class="r-in"><span><span class="fu">oef</span><span class="op">(</span><span class="va">parMatrix</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 998.2922 982.5650</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Víctor Granda, Antoine Cabon, Arsène Druel, Julien Ruffault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>


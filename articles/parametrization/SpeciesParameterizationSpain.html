<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Species parameterization for Spain • medfate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Species parameterization for Spain">
<meta property="og:description" content="medfate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/medfate/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Species parameterization for Spain</h1>
                        <h4 data-toc-skip class="author">Miquel De Cáceres</h4>
            
            <h4 data-toc-skip class="date">2022-03-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/vignettes/parametrization/SpeciesParameterizationSpain.Rmd" class="external-link"><code>vignettes/parametrization/SpeciesParameterizationSpain.Rmd</code></a></small>
      <div class="hidden name"><code>SpeciesParameterizationSpain.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes the procedures used to obtain the species parameter data table <code>SpParamsMED</code> included in package <strong>medfate</strong>. The taxon entities chosen are intended to cover most of the woody plant taxa in Spain, as they are reported in the Spanish National Forest Inventory surveys (<em>Inventario Forestal Nacional</em> or IFN). In addition, a list of <code>forest</code> objects is also created for each of three IFN surveys, where species codification follows <code>SpParamsMED</code>.</p>
<p>The vignette is not self-contained, in the sense that it cannot be reproduced without access to data sets that are not included. Nevertheless, it is intended to serve as example of species parameterization for other regions.</p>
<div class="section level3">
<h3 id="required-packages">Required packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>Installed version of <strong>medfate</strong> should be <strong>ver 2.3</strong> or higher.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"medfate"</span><span class="op">)</span></code></pre></div>
<p>If the version at CRAN is older, the package should be installed from GitHub via <code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"emf-creaf/medfate"</span><span class="op">)</span></code></pre></div>
<p>Package <strong>medfateutils</strong> is important for the species parameterization process, as it includes several functions that facilitate parsing data sources into parameter values. Package <strong>medfateutils</strong> is installed only from GitHub:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"emf-creaf/medfateutils"</span><span class="op">)</span></code></pre></div>
<p>Package <strong>medfuels</strong> is also needed because it includes allometric coefficients for Mediterranean shrub species. As before, package <strong>medfuels</strong> is installed only from GitHub:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"spif-ctfc/medfuels"</span><span class="op">)</span></code></pre></div>
<p>Finally, we need <strong>IFNread</strong> is also needed in this vignette to perform some operations on IFN data. As before, package <strong>IFNread</strong> is installed only from GitHub:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"emf-creaf/IFNread"</span><span class="op">)</span></code></pre></div>
<p>Once we have <strong>medfate</strong>, <strong>medfateutils</strong>, <strong>medfuels</strong> and <strong>IFNread</strong>, we load them and other common packages that we will employ in this vignette:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/medfate/" class="external-link">medfate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">medfateutils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">medfuels</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">IFNread</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="target-parameters">Target parameters<a class="anchor" aria-label="anchor" href="#target-parameters"></a>
</h3>
<p>The set of species parameters needed to run the models included in <strong>medfate</strong> are described in a dataframe called <code>SpParamsDefinition</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SpParamsDefinition"</span><span class="op">)</span>
<span class="va">SpParamsDefinition</span><span class="op">$</span><span class="va">ParameterName</span></code></pre></div>
<pre><code><span class="co">##   [1] "Name"                  "IFNcodes"              "SpIndex"              </span>
<span class="co">##   [4] "Genus"                 "Order"                 "Family"               </span>
<span class="co">##   [7] "Group"                 "GrowthForm"            "LifeForm"             </span>
<span class="co">##  [10] "LeafShape"             "LeafSize"              "PhenologyType"        </span>
<span class="co">##  [13] "Hmed"                  "Hmax"                  "Z50"                  </span>
<span class="co">##  [16] "Z95"                   "fHDmin"                "fHDmax"               </span>
<span class="co">##  [19] "a_ash"                 "b_ash"                 "a_bsh"                </span>
<span class="co">##  [22] "b_bsh"                 "a_btsh"                "b_btsh"               </span>
<span class="co">##  [25] "cr"                    "a_fbt"                 "b_fbt"                </span>
<span class="co">##  [28] "c_fbt"                 "d_fbt"                 "a_cr"                 </span>
<span class="co">##  [31] "b_1cr"                 "b_2cr"                 "b_3cr"                </span>
<span class="co">##  [34] "c_1cr"                 "c_2cr"                 "a_cw"                 </span>
<span class="co">##  [37] "b_cw"                  "LeafDuration"          "t0gdd"                </span>
<span class="co">##  [40] "Sgdd"                  "Tbgdd"                 "Ssen"                 </span>
<span class="co">##  [43] "Phsen"                 "Tbsen"                 "xsen"                 </span>
<span class="co">##  [46] "ysen"                  "SLA"                   "LeafDensity"          </span>
<span class="co">##  [49] "WoodDensity"           "FineRootDensity"       "conduit2sapwood"      </span>
<span class="co">##  [52] "r635"                  "pDead"                 "Al2As"                </span>
<span class="co">##  [55] "Ar2Al"                 "LeafWidth"             "SRL"                  </span>
<span class="co">##  [58] "RLD"                   "maxFMC"                "minFMC"               </span>
<span class="co">##  [61] "LeafPI0"               "LeafEPS"               "LeafAF"               </span>
<span class="co">##  [64] "StemPI0"               "StemEPS"               "StemAF"               </span>
<span class="co">##  [67] "SAV"                   "HeatContent"           "LigninPercent"        </span>
<span class="co">##  [70] "gammaSWR"              "alphaSWR"              "kPAR"                 </span>
<span class="co">##  [73] "g"                     "Tmax_LAI"              "Tmax_LAIsq"           </span>
<span class="co">##  [76] "Psi_Extract"           "Psi_Critic"            "WUE"                  </span>
<span class="co">##  [79] "WUE_decay"             "Gswmin"                "Gswmax"               </span>
<span class="co">##  [82] "VCleaf_kmax"           "VCleaf_c"              "VCleaf_d"             </span>
<span class="co">##  [85] "Kmax_stemxylem"        "VCstem_c"              "VCstem_d"             </span>
<span class="co">##  [88] "Kmax_rootxylem"        "VCroot_c"              "VCroot_d"             </span>
<span class="co">##  [91] "Vmax298"               "Jmax298"               "Nleaf"                </span>
<span class="co">##  [94] "Nsapwood"              "Nfineroot"             "WoodC"                </span>
<span class="co">##  [97] "RERleaf"               "RERsapwood"            "RERfineroot"          </span>
<span class="co">## [100] "CCleaf"                "CCsapwood"             "CCfineroot"           </span>
<span class="co">## [103] "RGRleafmax"            "RGRsapwoodmax"         "RGRfinerootmax"       </span>
<span class="co">## [106] "SRsapwood"             "SRfineroot"            "RSSG"                 </span>
<span class="co">## [109] "MortalityBaselineRate" "SeedProductionHeight"  "RecrTreeDBH"          </span>
<span class="co">## [112] "RecrTreeHeight"        "RecrShrubHeight"       "RecrTreeDensity"      </span>
<span class="co">## [115] "RecrShrubCover"        "RecrZ50"               "RecrZ95"              </span>
<span class="co">## [118] "MinTempRecr"           "MinMoistureRecr"       "MinFPARRecr"</span></code></pre>
<p>It is obvious that such a sheer number of parameters cannot be searched for manually, even for a small number of target species. Hence, it is important to draw values from allometric and plant trait data bases. Not all model parameters have their counterpart in publicly-available databases, and even when using data bases it is unlikely that one will find appropriate parameter values for all species. To help with this situation, <strong>medfate</strong> has <em>inbuilt imputation procedures</em> to estimate missing values for many parameters before starting model simulations. However, imputed parameter estimates will normally be worse than estimates coming from data bases. Hence, we should put a strong effort in finding source parameter data before relying on inbuilt imputation.</p>
</div>
<div class="section level3">
<h3 id="steps-to-build-a-species-parameter-table">Steps to build a species parameter table<a class="anchor" aria-label="anchor" href="#steps-to-build-a-species-parameter-table"></a>
</h3>
<p>The following sections describe different steps that we used to obtain the species parameter table <code>SpParamsMED</code> for simulations with <strong>medfate</strong>, which can be grouped into five main tasks:</p>
<ol style="list-style-type: decimal">
<li>Initialize the parameter table with target taxonomic entities.</li>
<li>Draw species parameters from forest inventory (IFN in our case) data.</li>
<li>Populate tree and shrub allometric coefficients from suitable allometric databases.</li>
<li>Populate plant functional traits from available data bases</li>
<li>Populate recruitment limits using bioclimatic data, forest inventory data and previous parameter estimates.</li>
</ol>
</div>
<div class="section level3">
<h3 id="source-data-paths">Source data paths<a class="anchor" aria-label="anchor" href="#source-data-paths"></a>
</h3>
<p>Befores starting, we define file paths (in my computer) to access source data for parameter filling. Source data includes forest inventory (i.e. IFN) data as well as plant trait and allometric data bases:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN_path</span> <span class="op">=</span> <span class="st">"/home/miquel/OneDrive/Datasets/IFN/"</span>
<span class="va">DB_path</span> <span class="op">=</span> <span class="st">"/home/miquel/OneDrive/Professional/MedfateWorks/MedfateSpeciesParametrization/"</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="initialize-species-parameter-table-for-ifn">Initialize species parameter table for IFN<a class="anchor" aria-label="anchor" href="#initialize-species-parameter-table-for-ifn"></a>
</h2>
<p>The first task is to define the target entities that will be considered functionally distinct in <strong>medfate</strong> simulations. There is no <em>a priori</em> need to limit such entities to biological taxa, nor to particular taxonomic ranks. Nevertheless, in this vignette we will define taxonomic entities either at the <strong>species</strong> or <strong>genus</strong> levels.</p>
<div class="section level3">
<h3 id="load-ifn-taxon-codes">Load IFN taxon codes<a class="anchor" aria-label="anchor" href="#load-ifn-taxon-codes"></a>
</h3>
<p>Model simulations will normally entail a lower biological resolution of target entities than used in forest inventory data, because the finer the biological resolution the large the number of missing parameter values. Therefore, it will be usual to consider together entities that are treated as distinct in the forest inventory.</p>
<p>In our case, we begin by loading shrub and tree species codes used in the second, third, and fourth editions of IFN, i.e. IFN2, IFN3 and IFN4:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN23_species_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Sources/SpeciesCodesIFN23.txt"</span><span class="op">)</span>, 
                             sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span>
<span class="va">IFN23_species_data</span><span class="op">&lt;-</span><span class="va">IFN23_species_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>
<span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span>

<span class="va">IFN4_shrub_species_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Sources/shrubcodesifn4.txt"</span><span class="op">)</span>, 
                             sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span>
<span class="va">IFN4_shrub_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">IFN4_shrub_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span>
<span class="va">IFN4_tree_species_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Sources/treecodesifn4.txt"</span><span class="op">)</span>, 
                                    sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span>
<span class="va">IFN4_tree_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">IFN4_tree_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span>
<span class="va">IFN4_tree_species_data</span><span class="op">&lt;-</span><span class="va">IFN4_tree_species_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Merge the two code data sets by adding to the codes of IFN2-3 those species codes that were new in IFN4:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newShrubs</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">(</span><span class="va">IFN4_shrub_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span>
<span class="va">newTrees</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">(</span><span class="va">IFN4_tree_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span>
<span class="va">IFN_species_data</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">IFN23_species_data</span>, 
                              <span class="va">IFN4_shrub_species_data</span><span class="op">[</span><span class="va">newShrubs</span>, <span class="op">]</span>, 
                              <span class="va">IFN4_tree_species_data</span><span class="op">[</span><span class="va">newTrees</span>,<span class="op">]</span><span class="op">)</span>
<span class="va">IFN_species_data</span> <span class="op">&lt;-</span> <span class="va">IFN_species_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<p>Check uniqueness of codes:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p>The final table of species names and codes has 469 rows and looks like:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   IFNCODE               IFNNAME</span>
<span class="co">## 1       1 Heberdenia bahamensis</span>
<span class="co">## 2       2    Amelanchier ovalis</span>
<span class="co">## 3       3        Frangula alnus</span>
<span class="co">## 4       4     Rhamnus alaternus</span>
<span class="co">## 5       5    Euonymus europaeus</span>
<span class="co">## 6       6       Myrtus communis</span></code></pre>
<p>So far, we used the word <em>species</em> for IFN biological entities, but in fact not all IFN entities are binomial species. In some cases, subspecies are recorded, while in others identification is at genus level or even uses non-scientific names. Hence, the set of entities needs to be revised and we illustrate the process in the following two sections.</p>
</div>
<div class="section level3">
<h3 id="define-ifn-codes-to-exclude">Define IFN codes to exclude<a class="anchor" aria-label="anchor" href="#define-ifn-codes-to-exclude"></a>
</h3>
<p>We need to manually define a set of entities (IFN codes) to be excluded because they have low taxonomic information, refer to habitat descriptions or to undesired growth forms (e.g. vines):</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">codesOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"19"</span>, <span class="co"># Otras coniferas </span>
              <span class="st">"10"</span>, <span class="co"># Sin asignar</span>
              <span class="st">"20"</span>, <span class="co"># Pinos</span>
              <span class="st">"29"</span>, <span class="co"># Otros pinos</span>
              <span class="st">"30"</span>,  <span class="co">#Mezcla de coniferas</span>
              <span class="st">"40"</span>, <span class="co">#Quercus</span>
              <span class="st">"49"</span>, <span class="co">#Otros quercus</span>
              <span class="st">"50"</span>, <span class="co">#Mezcla de &lt;e1&gt;rboles de ribera</span>
              <span class="st">"59"</span>, <span class="co">#Otros &lt;e1&gt;rboles rip&lt;ed&gt;colas</span>
              <span class="st">"70"</span>, <span class="co">#Mezcla de frondosas de gran porte</span>
              <span class="st">"80"</span>, <span class="co">#Laurisilva</span>
              <span class="st">"89"</span>, <span class="co">#Otras laurisilvas</span>
              <span class="st">"90"</span>, <span class="co">#Mezcla de peque&lt;f1&gt;as frondosas</span>
              <span class="st">"99"</span>, <span class="co">#Otras frondosas</span>
              <span class="st">"1500"</span>, <span class="co"># Cultivo en mosaico</span>
              <span class="st">"8000"</span>, <span class="co"># Matorral en mosaico</span>
              <span class="st">"9000"</span>, <span class="co">#Herbazal en mosaico</span>
              <span class="st">"3400"</span>, <span class="co">#Prado en mosaico</span>
              <span class="st">"3500"</span>, <span class="co">#Pastizal-Matorral en mosaico</span>
              <span class="st">"103"</span>, <span class="co">#Otras papilionoideas altas</span>
              <span class="st">"104"</span> <span class="co">#Otras papilionoideas bajas</span>
              <span class="op">)</span></code></pre></div>
<p>We remove taxa from the IFN taxonomic definition data frame:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN_species_data</span> <span class="op">&lt;-</span> <span class="va">IFN_species_data</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">codesOut</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<p>so that we are left with 448 taxa.</p>
</div>
<div class="section level3">
<h3 id="define-taxonomic-entities-to-merge-into-groups">Define taxonomic entities to merge into groups<a class="anchor" aria-label="anchor" href="#define-taxonomic-entities-to-merge-into-groups"></a>
</h3>
<p>As mentioned above, simulations will normally require defining groups of entities to be treated together in <strong>medfate</strong>. In our case, we need to define some genus-level groups because the forest inventory records do not always have identifications at species-level resolution:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genus_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acacia spp.:7/207/307"</span>,
                 <span class="st">"Adenocarpus spp.:1163/2163/2103/3163/10103"</span>,
                 <span class="st">"Anagyris spp.:175/1175"</span>,
                 <span class="st">"Atriplex spp.:133"</span>,
                 <span class="st">"Artemisia spp.:126/159/1159/3159"</span>,
                 <span class="st">"Asparagus spp.:138/1138/2138"</span>,
                 <span class="st">"Astragalus spp.:6104"</span>,
                 <span class="st">"Betula spp.:73/273/373"</span>,
                 <span class="st">"Bupleurum spp.:124/1124/2124/4124"</span>,
                 <span class="st">"Calicotome spp.:2104/2105/9072/3104"</span>,
                 <span class="st">"Cedrus spp.:17/217/317/917"</span>,
                 <span class="st">"Corema spp.:172/1172"</span>,
                 <span class="st">"Chamaerops humilis:369/3690"</span>,
                 <span class="st">"Clematis spp.:132/1132/2132"</span>,
                 <span class="st">"Crataegus spp.:15/215/315/415/515"</span>,
                 <span class="st">"Coronilla spp.:152/1152/3152/5104"</span>,
                 <span class="st">"Cotoneaster spp.:118"</span>,
                 <span class="st">"Cupressus spp.:36/236/336/436/936"</span>,
                 <span class="st">"Daphne spp.:110/1110/2110/3110"</span>,
                 <span class="st">"Dorycnium spp.:154/7104/1154"</span>,
                 <span class="st">"Echium spp..:161"</span>,
                 <span class="st">"Ephedra spp.:173/1173"</span>,
                 <span class="st">"Erinacea spp.:1104/1166"</span>,
                 <span class="st">"Eucalyptus spp.:60/61/62/63/64/264/364/464"</span>,
                 <span class="st">"Euphorbia spp.:162/1162/2162/3162"</span>,
                 <span class="st">"Fraxinus spp.:55/255/355/455/955"</span>,
                 <span class="st">"Genista spp.:177/1177/155/1155/1255/1355/1455/1555/1755/1156/1655/2155/2156/3155/4155/6155/7155/8155/9075/9155/10155/11155/12155/13155/14155"</span>,
                 <span class="st">"Genistella spp.:9104"</span>,
                 <span class="st">"Halimium spp.:117/1117/2117/3117/4117/5117/6117"</span>,
                 <span class="st">"Helianthemum spp.:142"</span>,
                 <span class="st">"Helichrysum spp.:128/1128/2128"</span>,
                 <span class="st">"Larix spp.:35/235/335/435"</span>,
                 <span class="st">"Lavandula spp.:109/1109/2109/3109/4109"</span>,
                 <span class="st">"Lonicera spp.:144/1144/2144/3144/4144/5144/9012"</span>,
                 <span class="st">"Ilex spp.:65/82/282"</span>,
                 <span class="st">"Juglans spp.:75/275/975"</span>,
                 <span class="st">"Laurus spp.:94/294"</span>,
                 <span class="st">"Maytenus spp.:158/1158"</span>,
                 <span class="st">"Morus spp.:399/499/599"</span>,
                 <span class="st">"Ononis spp.:156/8104"</span>,
                 <span class="st">"Osyris spp.:135/1135/2135"</span>,
                 <span class="st">"Platanus spp.:79/279"</span>,
                 <span class="st">"Populus spp.:51/52/58/258"</span>,
                 <span class="st">"Phlomis spp.:171/1171/2171"</span>,
                 <span class="st">"Phoenix spp.:69/269/469"</span>,
                 <span class="st">"Prunus spp.:95/295/395/495/595/1095/1195/2950/148"</span>,
                 <span class="st">"Pyrus spp.:16"</span>,
                 <span class="st">"Retama spp.:4103/1165/2165"</span>,
                 <span class="st">"Rhamnus spp.:4/122/1122/2122/3122/4122/389/5122/6122"</span>,
                 <span class="st">"Rhododendron spp.:108/1108/2108"</span>,
                 <span class="st">"Ribes spp.:131/1131/2131"</span>,
                 <span class="st">"Rosa spp.:119"</span>,
                 <span class="st">"Rubus spp.:121/1121/2121/3121"</span>,
                 <span class="st">"Ruscus spp.:130/1130"</span>,
                 <span class="st">"Salix spp.:57/257/357/457/557/657/757/857/858/957"</span>,
                 <span class="st">"Sambucus spp.:97/197/297/997/2970"</span>,
                 <span class="st">"Santolina spp.:127/1127/2127"</span>,
                 <span class="st">"Sorbus spp.:78/278/378/478/578/678/778"</span>,
                 <span class="st">"Spartium spp.:3103/9103"</span>,
                 <span class="st">"Spiraea spp.:134/1134"</span>,
                 <span class="st">"Tamarix spp.:53/253"</span>,
                 <span class="st">"Teline spp.:165/9077/9078/9202/9914"</span>,
                 <span class="st">"Teucrium spp.:179/1179"</span>,
                 <span class="st">"Tilia spp.:77/277/377"</span>,
                 <span class="st">"Thymelaea spp.:151"</span>,
                 <span class="st">"Thuja spp.:319"</span>,
                 <span class="st">"Thymus spp.:129/1129/2129/3129/4129/5129"</span>,
                 <span class="st">"Ulex spp.:157/176/1103/6103/1164/3164"</span>, <span class="co">#Merges Stauracanthus</span>
                 <span class="st">"Ulmus spp.:56/256/356/456/956"</span>,
                 <span class="st">"Vaccinium spp.:137/1137"</span>,
                 <span class="st">"Vella spp.:170/1170"</span>,
                 <span class="st">"Viburnum spp.:115/1115/4115/3115/2115"</span>
                 <span class="op">)</span></code></pre></div>
<p>Groups were manually defined as strings where ‘:’ was used to separate the group name from the set of codes forming the group, which were separated using ‘/.’ We also define groups of taxa at species level, where different synonyms are merged, different codes have been used for the same species, or to merge sub-specific records:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assimilated_species</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acer campestre:76/776/976"</span>,
                       <span class="st">"Amelanchier ovalis:2/200"</span>,
                       <span class="st">"Buxus sempervirens:91/291/2910/9071/9100"</span>,
                       <span class="st">"Cistus albidus:101/3101"</span>,
                       <span class="st">"Cistus psilosepalus:2111/11101"</span>,
                       <span class="st">"Cornus sanguinea:9/900"</span>,
                       <span class="st">"Cytisus fontanesii:9074"</span>,
                       <span class="st">"Cytisus scoparius:4104/1167/5103/8103"</span>,
                       <span class="st">"Cytisus commutatus:9011/9201/9481"</span>,
                       <span class="st">"Cytisus oromediterraneus:5155/4167"</span>,
                       <span class="st">"Erica scoparia:283/6102"</span>,
                       <span class="st">"Erica arborea:83/102/1102"</span>,
                       <span class="st">"Euonymus europaeus:5/500"</span>,
                       <span class="st">"Frangula alnus:3/300"</span>,
                       <span class="st">"Juniperus communis:37/937/3700"</span>,
                       <span class="st">"Juniperus phoenicea:39/238/239/1139"</span>,
                       <span class="st">"Medicago arborea:145/9076"</span>,
                       <span class="st">"Myrtus communis:6/600"</span>,
                       <span class="st">"Myrica faya:81/281"</span>,
                       <span class="st">"Pistacia terebinthus:93/9300"</span>,
                       <span class="st">"Quercus ilex:45/245"</span>,
                       <span class="st">"Quercus faginea:44/344"</span>,
                       <span class="st">"Quercus suber:46/646/746/846/946"</span>,
                       <span class="st">"Salvia rosmarinus:114/1114"</span><span class="op">)</span> </code></pre></div>
<p>We now build a data frame with group names and codes, by merging the information of these two groups of taxa. We also separate group names from the set of codes defining the group into columns of a data frame:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">groups_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Groups"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">genus_level</span>,
                                     <span class="va">assimilated_species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">separate</span><span class="op">(</span><span class="st">"Groups"</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group_names"</span>, <span class="st">"group_codes"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">":"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">groups_df</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        group_names               group_codes</span>
<span class="co">## 1      Acacia spp.                 7/207/307</span>
<span class="co">## 2 Adenocarpus spp. 1163/2163/2103/3163/10103</span>
<span class="co">## 3    Anagyris spp.                  175/1175</span>
<span class="co">## 4    Atriplex spp.                       133</span>
<span class="co">## 5   Artemisia spp.         126/159/1159/3159</span>
<span class="co">## 6   Asparagus spp.             138/1138/2138</span></code></pre>
</div>
<div class="section level3">
<h3 id="initialize-species-parameter-table">Initialize species parameter table<a class="anchor" aria-label="anchor" href="#initialize-species-parameter-table"></a>
</h3>
<p>Once we have IFN species names and codes, as well as the definition of the IFN biological entities to merge, we can call function <code><a href="https://rdrr.io/pkg/medfateutils/man/initSpParams.html" class="external-link">initSpParams()</a></code> from package <strong>medfateutils</strong>. This function also takes the data frame <code>SpParamsDefinition</code> as argument, from which it takes the set of parameter names to be filled:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/initSpParams.html" class="external-link">initSpParams</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span>, <span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNNAME</span>,
                        <span class="va">SpParamsDefinition</span>,
                        <span class="va">groups_df</span><span class="op">$</span><span class="va">group_codes</span>, <span class="va">groups_df</span><span class="op">$</span><span class="va">group_names</span>,
                        fill_taxonomic <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Option <code>fill_taxonomic</code> tells function <code><a href="https://rdrr.io/pkg/medfateutils/man/initSpParams.html" class="external-link">initSpParams()</a></code> to use package <strong>taxize</strong> to find taxonomic classification of the species/genus entities. This provides very useful information for parameterization, but makes the process of initialization a bit slower.</p>
<p>The result of calling <code><a href="https://rdrr.io/pkg/medfateutils/man/initSpParams.html" class="external-link">initSpParams()</a></code> is a data frame with <code>nrow(SpParams)</code> rows corresponding to target entities and columns corresponding to the parameters defined in <code>SpParamsDefinition</code>. Most parameters are missing, obviously, but <code><a href="https://rdrr.io/pkg/medfateutils/man/initSpParams.html" class="external-link">initSpParams()</a></code> already filled taxonomic data:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                  Name   IFNcodes SpIndex  Genus      Order      Family</span>
<span class="co">## 1          Abies alba         31       0  Abies    Pinales    Pinaceae</span>
<span class="co">## 2       Abies pinsapo         32       1  Abies    Pinales    Pinaceae</span>
<span class="co">## 3         Acacia spp.  7/207/307       2 Acacia    Fabales    Fabaceae</span>
<span class="co">## 4      Acer campestre 76/776/976       3   Acer Sapindales Sapindaceae</span>
<span class="co">## 5 Acer monspessulanum        276       4   Acer Sapindales Sapindaceae</span>
<span class="co">## 6        Acer negundo        376       5   Acer Sapindales Sapindaceae</span>
<span class="co">##        Group</span>
<span class="co">## 1 Gymnosperm</span>
<span class="co">## 2 Gymnosperm</span>
<span class="co">## 3 Angiosperm</span>
<span class="co">## 4 Angiosperm</span>
<span class="co">## 5 Angiosperm</span>
<span class="co">## 6 Angiosperm</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="parameters-drawn-from-ifn-data">Parameters drawn from IFN data<a class="anchor" aria-label="anchor" href="#parameters-drawn-from-ifn-data"></a>
</h2>
<p>Some plant size parameters, such as maximum height or minimum/maximum values of the height-to-diameter ratio, can be derived from forest inventory data. In addition, it is important that medfate’s parameter <code>GrowthForm</code> (either “Tree,” “Tree/Shrub” or “Shrub”) matches the treatment given in forest inventory surveys. Diameters are normally measured in “Tree” entities, whereas shrubs are often measured using cover indices, and some species may be recorded in either way. Thus, the <code>GrowthForm</code> parameter should also be derived from forest inventory.</p>
<div class="section level3">
<h3 id="load-ifn-plot-data">Load IFN plot data<a class="anchor" aria-label="anchor" href="#load-ifn-plot-data"></a>
</h3>
<p>We first load IFN tree and shrub data corresponding to the three surveys (tree data is in two different tables in the case of IFN2):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shrubDataIFN2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN2/Rdata/shrubDataIFN2_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">shrubDataIFN2</span><span class="op">$</span><span class="va">ID</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">shrubDataIFN2</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span>
<span class="va">shrubDataIFN3</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/shrubDataIFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">shrubDataIFN4</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN4/Rdata/shrubDataIFN4_Spain.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="va">piesMayoresDataIFN2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN2/Rdata/piesMayoresDataIFN2_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">piesMenoresDataIFN2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN2/Rdata/piesMenoresDataIFN2_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">piesMenoresDataIFN2</span><span class="op">$</span><span class="va">ID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">piesMenoresDataIFN2</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span>
<span class="va">piesMenoresDataIFN2</span><span class="op">$</span><span class="va">Species</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">piesMenoresDataIFN2</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="va">treeDataIFN2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">piesMayoresDataIFN2</span>, <span class="va">piesMenoresDataIFN2</span><span class="op">)</span> <span class="co"># Add pies menores</span>

<span class="va">treeDataIFN3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/treeDataIFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">treeDataIFN3</span> <span class="op">=</span> <span class="va">treeDataIFN3</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">treeDataIFN3</span><span class="op">$</span><span class="va">OIF3</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"888"</span>,<span class="st">"999"</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># remove dead trees</span>
<span class="va">regDataIFN3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/regDataIFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">regTreeDataIFN3</span> <span class="op">=</span> <span class="fu">IFNread</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IFNread/man/readRegenera.html" class="external-link">extractRegTreeData</a></span><span class="op">(</span><span class="va">regDataIFN3</span>, subsetVars<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">treeDataIFN3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">treeDataIFN3</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>,<span class="st">"DBH"</span>,<span class="st">"H"</span>,<span class="st">"N"</span><span class="op">)</span><span class="op">]</span>,
                     <span class="va">regTreeDataIFN3</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>,<span class="st">"DBH"</span>,<span class="st">"H"</span>,<span class="st">"N"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">treeDataIFN4</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN4/Rdata/treeDataIFN4_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">treeDataIFN4</span> <span class="op">=</span> <span class="va">treeDataIFN4</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">treeDataIFN4</span><span class="op">$</span><span class="va">OIF4</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"888"</span>,<span class="st">"999"</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># remove dead trees</span>
<span class="va">regDataIFN4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN4/Rdata/regDataIFN4_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">regTreeDataIFN4</span> <span class="op">=</span> <span class="fu">IFNread</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IFNread/man/readRegenera.html" class="external-link">extractRegTreeData</a></span><span class="op">(</span><span class="va">regDataIFN4</span>, subsetVars<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">treeDataIFN4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">treeDataIFN4</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>,<span class="st">"DBH"</span>,<span class="st">"H"</span>,<span class="st">"N"</span><span class="op">)</span><span class="op">]</span>,
                     <span class="va">regTreeDataIFN4</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>,<span class="st">"DBH"</span>,<span class="st">"H"</span>,<span class="st">"N"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="merge-ifn-data">Merge IFN data<a class="anchor" aria-label="anchor" href="#merge-ifn-data"></a>
</h3>
<p>We merge the data sets into two tables, one for shrubs and the other for trees, taking only columns <code>ID</code> (plot identification), <code>Species</code> (code), <code>H</code> (height) and <code>DBH</code> (for trees).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shrubDataIFN</span> <span class="op">&lt;-</span><span class="fu">bind_rows</span><span class="op">(</span><span class="va">shrubDataIFN2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">]</span>,
                         <span class="va">shrubDataIFN3</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">]</span>,
                         <span class="va">shrubDataIFN4</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="va">treeDataIFN</span> <span class="op">&lt;-</span><span class="fu">bind_rows</span><span class="op">(</span><span class="va">treeDataIFN2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>, <span class="st">"H"</span>, <span class="st">"DBH"</span><span class="op">)</span><span class="op">]</span>,
                        <span class="va">treeDataIFN3</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>, <span class="st">"H"</span>, <span class="st">"DBH"</span><span class="op">)</span><span class="op">]</span>,
                        <span class="va">treeDataIFN4</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Species"</span>, <span class="st">"H"</span>, <span class="st">"DBH"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="growth-form">Growth form<a class="anchor" aria-label="anchor" href="#growth-form"></a>
</h3>
<p>To tell <strong>medfate</strong> which target entities are shrubs, trees (or both, since some species occur in both tree and shrub tables), we can simply take the species code vectors:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shrub_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">shrubDataIFN</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="va">tree_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">treeDataIFN</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: NAs introduced by coercion</span></code></pre>
<p>Before populating parameter <code>GrowthForm</code>, we can check how many species appear both as trees and shrubs:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">shrub_codes</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tree_codes</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 21</span></code></pre>
<p>We can populate column <code>GrowthForm</code> of the species parameter table by calling function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateGrowthForm()</a></code> of package <strong>medfateutils</strong>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateGrowthForm</a></span><span class="op">(</span><span class="va">SpParams</span>, 
                              <span class="va">tree_codes</span>, <span class="va">shrub_codes</span>,
                              fill_fromGenus <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  Tree: 72 shrub: 106 tree/shrub: 27 not found: 12</span></code></pre>
<pre><code><span class="co">##  Tree input codes not in SpParams: 99,90,29,59,89,19,49,492,977,40,20,350,195</span></code></pre>
<pre><code><span class="co">##  Shrub input codes not in SpParams: 103,104,224,222,192,100,99,10,199,229,402,302,0,3124,2152,6161,3106,1013,1100,502,1148,1015,1315,1010,3105,2149,405,1536,9262,9264,4156,9284,9282,2164,400,8010,8005,8007,1709,1706,1704,1707,1710,1708,2509,2507,2502,2506,2505,9006</span></code></pre>
<pre><code><span class="co">## Species 'Cistus creticus' assigned growth form 'Shrub'</span></code></pre>
<pre><code><span class="co">## Species 'Cistus libanotis' assigned growth form 'Shrub'</span></code></pre>
<pre><code><span class="co">## Species 'Cytisus baeticus' assigned growth form 'Shrub'</span></code></pre>
<pre><code><span class="co">## Species 'Cytisus commutatus' assigned growth form 'Shrub'</span></code></pre>
<pre><code><span class="co">## Species 'Cytisus fontanesii' assigned growth form 'Shrub'</span></code></pre>
<pre><code><span class="co">## Species 'Cytisus malacifitanus' assigned growth form 'Shrub'</span></code></pre>
<pre><code><span class="co">## Species 'Cytisus tribracteolatus' assigned growth form 'Shrub'</span></code></pre>
<p>Some codes (particularly, those excluded above) may not be recognized according to the target entity definition of <code>SpParams</code> and are ignored. The option <code>fill_fromGenus = TRUE</code> was used to tell function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateGrowthForm()</a></code> to impute growth form of species with missing value from the growth form of other species of the same genus, if homogeneous. Some species may still have missing growth form after the imputation process. We identify them:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">missingGrowthFormSpecies</span> <span class="op">=</span> <span class="va">SpParams</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">missingGrowthFormSpecies</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Dittrichia viscosa"    "Periploca laevigata"   "Quercus lusitanica"   </span>
<span class="co">## [4] "Sideroxylon mirmulans" "Withania frutescens"</span></code></pre>
<p>and manually set the growth form for them:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">missingTrees</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"Dracaena drago"</span>, <span class="st">"Pleiomeris canariensis"</span>, <span class="st">"Quercus lusitanica"</span>,
                 <span class="st">"Sideroxylon mirmulans"</span><span class="op">)</span> 
<span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">missingTrees</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Tree"</span>
<span class="va">missingShrubs</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"Dittrichia viscosa"</span>, <span class="st">"Periploca laevigata"</span>, <span class="st">"Withania frutescens"</span><span class="op">)</span> 
<span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">missingShrubs</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Shrub"</span></code></pre></div>
<p>We can inspect how many species were deemed “Tree,” “Shrub” or “Tree/Shrub.”</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##      Shrub       Tree Tree/Shrub </span>
<span class="co">##        116         74         27</span></code></pre>
</div>
<div class="section level3">
<h3 id="maximummedian-height">Maximum/median height<a class="anchor" aria-label="anchor" href="#maximummedian-height"></a>
</h3>
<p>Maximum and median heights for each target entity can be obtained from observed height distributions. Thus, we define species identity and height (in cm) vectors from tree/shrub data:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treeDataIFN</span><span class="op">$</span><span class="va">Species</span>, <span class="va">shrubDataIFN</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="va">height_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treeDataIFN</span><span class="op">$</span><span class="va">H</span>, <span class="va">shrubDataIFN</span><span class="op">$</span><span class="va">H</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span> <span class="co"># m to cm</span></code></pre></div>
<p>and then call function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateHeightParams()</a></code> to populate parameters <code>Hmax</code> and <code>Hmed</code>, corresponding to maximum and median heights.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateHeightParams</a></span><span class="op">(</span><span class="va">SpParams</span>,
                                 <span class="va">species_codes</span>, <span class="va">height_values</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 135217 species/height missing values removed from input.</span></code></pre>
<pre><code><span class="co">## 109 zero height values removed from input.</span></code></pre>
<pre><code><span class="co">## Warning in translateIFNSpeciesCodes(species_codes, SpParams$IFNcodes): NAs</span>
<span class="co">## introduced by coercion</span></code></pre>
<pre><code><span class="co">## 12 missing Hmed/Hmax values (out of 217) after populating with input data.</span></code></pre>
<p>By default, maximum height is defined as the 99% quantile of the height distribution, whereas median height corresponds to the 50% quantile.</p>
<p>Parameters <code>Hmax</code> and <code>Hmed</code> are strict, meaning that medfate does not have inbuilt imputation procedures for them, so we must complete their columns in the parameter table. We can inspect the missing values for each growth form:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">)</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        </span>
<span class="co">##         Shrub Tree Tree/Shrub</span>
<span class="co">##   FALSE   106   72         27</span>
<span class="co">##   TRUE     10    2          0</span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">)</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        </span>
<span class="co">##         Shrub Tree Tree/Shrub</span>
<span class="co">##   FALSE   106   72         27</span>
<span class="co">##   TRUE     10    2          0</span></code></pre>
<p>and then use the species with known values for each growth from to impute species averages:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The final distribution of <code>Hmax</code> (cm) by growth form is:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmax</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span>, <span class="va">summary</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Shrub</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##    20.0   150.0   200.0   212.2   250.0   742.0 </span>
<span class="co">## </span>
<span class="co">## $Tree</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##      80    1354    2060    2089    2630    3750 </span>
<span class="co">## </span>
<span class="co">## $`Tree/Shrub`</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##     170     500     950    1184    1760    4100</span></code></pre>
<p>and that of <code>Hmed</code> (cm) by growth form is:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Hmed</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span>, <span class="va">summary</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Shrub</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##   10.00   40.00   70.00   71.21  100.00  200.00 </span>
<span class="co">## </span>
<span class="co">## $Tree</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##    80.0   512.5   790.0   878.0  1200.0  2120.0 </span>
<span class="co">## </span>
<span class="co">## $`Tree/Shrub`</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##    80.0   100.0   150.0   359.4   550.0  1850.0</span></code></pre>
</div>
<div class="section level3">
<h3 id="diameterheight-ratio">Diameter/height ratio<a class="anchor" aria-label="anchor" href="#diameterheight-ratio"></a>
</h3>
<p>Minimum and maximum diameter/height ratios are used in <strong>medfate</strong> to translate diameter growth into height growth. We first assemble three data vectors needed to populate these parameters (heights and diameters in cm):</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_species_codes</span> <span class="op">&lt;-</span> <span class="va">treeDataIFN</span><span class="op">$</span><span class="va">Species</span>
<span class="va">tree_height_values</span> <span class="op">&lt;-</span> <span class="va">treeDataIFN</span><span class="op">$</span><span class="va">H</span><span class="op">*</span><span class="fl">100</span> <span class="co"># m to cm</span>
<span class="va">tree_diameter_values</span> <span class="op">&lt;-</span> <span class="va">treeDataIFN</span><span class="op">$</span><span class="va">DBH</span></code></pre></div>
<p>and then call function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateTreeDiameterHeightParams()</a></code> from package <strong>medfateutils</strong>:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tree_diameter_values</span> <span class="op">&gt;</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">tree_diameter_values</span><span class="op">&lt;</span><span class="fl">7.5</span> 
        <span class="op">&amp;</span> <span class="va">tree_height_values</span> <span class="op">&gt;</span><span class="fl">130</span> <span class="op">&amp;</span> <span class="va">tree_height_values</span> <span class="op">&lt;</span> <span class="fl">2000</span><span class="op">)</span>
<span class="va">sel</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sel</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">FALSE</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateSpParamsFromInventory.html" class="external-link">populateTreeDiameterHeightParams</a></span><span class="op">(</span><span class="va">SpParams</span>,
                                             <span class="va">tree_species_codes</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>, 
                                             <span class="va">tree_height_values</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>,
                                             <span class="va">tree_diameter_values</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>, 
                                             quantile_fHDmax <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 6 missing fHDmin/fHDmax values (out of 101 tree species) after populating with input data.</span></code></pre>
<p>This function fills parameters <code>fHDmin</code> and <code>fHDmax</code>, corresponding to the minimum and maximum values of the height-to-diameter ratio. The 5% and 95% quantile values are used for these parameters, respectively, by default.</p>
<p>Missing values may occur after imputation:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmin</span><span class="op">)</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        </span>
<span class="co">##         Shrub Tree Tree/Shrub</span>
<span class="co">##   FALSE     0   69         26</span>
<span class="co">##   TRUE    116    5          1</span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmax</span><span class="op">)</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        </span>
<span class="co">##         Shrub Tree Tree/Shrub</span>
<span class="co">##   FALSE     0   69         26</span>
<span class="co">##   TRUE    116    5          1</span></code></pre>
<p>Since <code>fHDmin</code> and <code>fHDmax</code> are strict parameters, we use shrub and tree averages to fill the remaining cases:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmax</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmax</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmin</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">fHDmin</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The final distributions of <code>fHDmax</code> and <code>fHDmin</code> are:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span> ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fHDmax"</span>, <span class="st">"fHDmin"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      fHDmax          fHDmin      </span>
<span class="co">##  Min.   : 90.0   Min.   : 37.00  </span>
<span class="co">##  1st Qu.:108.0   1st Qu.: 40.00  </span>
<span class="co">##  Median :129.0   Median : 50.00  </span>
<span class="co">##  Mean   :129.4   Mean   : 53.96  </span>
<span class="co">##  3rd Qu.:148.0   3rd Qu.: 60.00  </span>
<span class="co">##  Max.   :202.0   Max.   :150.00</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="allometric-coefficients">Allometric coefficients<a class="anchor" aria-label="anchor" href="#allometric-coefficients"></a>
</h2>
<p>Allometric equations are used in <strong>medfate</strong> to provide initial estimates of foliar biomass and leaf area of plant cohorts, which are key variables in simulations of forest functioning.</p>
<div class="section level3">
<h3 id="shrub-allometric-equations">Shrub allometric equations<a class="anchor" aria-label="anchor" href="#shrub-allometric-equations"></a>
</h3>
<p>Shrub allometric equations in <strong>medfate</strong> are of the form <span class="math inline">\(y = a\cdot x ^b\)</span>, with <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> being allometric coefficients. We will draw shrub allometric coefficient from data included in package <strong>medfuels</strong>. First, we begin by loading from this package a data set that describes the shrub type for a number of Mediterranean species. Shrub types in <strong>medfuels</strong> are a combination of Raunkiaer life form and resprouting strategy. Whenever species level coefficients will be missing, we will impute allometric coefficients according to the shrub type specified in <strong>medfuels</strong>.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"species_groups"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">species_groups</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                  name  Genus        Species Subsp      author shrub type</span>
<span class="co">## 1          Abies alba  Abies           alba  &lt;NA&gt;       Mill.         MP</span>
<span class="co">## 2   Acacia farnesiana Acacia     farnesiana  &lt;NA&gt; (L.) Willd.         MP</span>
<span class="co">## 3      Acer campestre   Acer      campestre  &lt;NA&gt;          L.         MP</span>
<span class="co">## 4 Acer monspessulanum   Acer monspessulanum  &lt;NA&gt;          L.         MP</span>
<span class="co">## 5        Acer negundo   Acer        negundo  &lt;NA&gt;          L.         MP</span>
<span class="co">## 6         Acer opalus   Acer         opalus  &lt;NA&gt;       Mill.         MP</span></code></pre>
<p>Here we manually correct the name and authority of some synonyms:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Rosmarinus officinalis"</span>,<span class="st">"Genus"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"Salvia"</span>
<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Rosmarinus officinalis"</span>,<span class="st">"Species"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"rosmarinus"</span>
<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Rosmarinus officinalis"</span>,<span class="st">"author"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"Schleid."</span>
<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Rosmarinus officinalis"</span>,<span class="st">"name"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"Salvia rosmarinus"</span>

<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Lithospermum fruticosum"</span>,<span class="st">"Genus"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"Lithodora"</span>
<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Lithospermum fruticosum"</span>,<span class="st">"Species"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"fruticosa"</span>
<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Lithospermum fruticosum"</span>,<span class="st">"author"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"(L.) Griseb."</span>
<span class="va">species_groups</span><span class="op">[</span><span class="va">species_groups</span><span class="op">$</span><span class="va">name</span><span class="op">==</span><span class="st">"Lithospermum fruticosum"</span>,<span class="st">"name"</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"Lithodora fruticosa"</span></code></pre></div>
<p>We will first populate allometric coefficients <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> for the relationship between height and projected area. Allometric coefficients are in the following tables for species:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sp_params_area"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sp_params_area</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                              minH maxH            a        b gamma_disp</span>
<span class="co">## Arbutus unedo           90.000000  500 6.283998e-01 1.880442  0.1594922</span>
<span class="co">## Arctostaphylos uva-ursi  7.666667   16 1.154919e+02 1.569399  0.5396529</span>
<span class="co">## Buxus sempervirens      24.000000  510 9.734499e-01 1.807175  0.3316027</span>
<span class="co">## Cistus albidus          27.000000  170 6.034537e-01 1.906005  0.2332449</span>
<span class="co">## Cistus laurifolius      40.000000  170 2.738292e-04 3.574434  0.8550142</span>
<span class="co">## Cistus monspeliensis    40.000000  168 6.996899e-02 2.364163  0.9066119</span>
<span class="co">##                                 R2</span>
<span class="co">## Arbutus unedo           0.72787509</span>
<span class="co">## Arctostaphylos uva-ursi 0.03446717</span>
<span class="co">## Buxus sempervirens      0.80308030</span>
<span class="co">## Cistus albidus          0.46454158</span>
<span class="co">## Cistus laurifolius      0.52647368</span>
<span class="co">## Cistus monspeliensis    0.25220391</span></code></pre>
<p>and for shrub types:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"group_params_area"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">group_params_area</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     minH maxH          a        b gamma_disp        R2</span>
<span class="co">## Ch    11  135 24.5887659 1.166177  0.7793030 0.5407145</span>
<span class="co">## MP    16  510  5.8457525 1.494416  1.9963546 0.3641660</span>
<span class="co">## NPF   16  390  1.9168225 1.692854  0.8382893 0.5264243</span>
<span class="co">## NPR   12  280  3.6933876 1.684477  1.1908252 0.2582100</span>
<span class="co">## NPS   18  195  0.1375519 2.283623  0.6547104 0.4777715</span>
<span class="co">## NP    12  390  1.0082888 1.869964  1.1923015 0.4241801</span></code></pre>
<p>We are now ready to use function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateShrubAllometriesFromMedfuels()</a></code> from package <strong>medfateutils</strong>:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateShrubAllometriesFromMedfuels</a></span><span class="op">(</span><span class="va">SpParams</span>, 
                                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a_ash"</span> <span class="op">=</span> <span class="st">"a"</span>,<span class="st">"b_ash"</span> <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,
                                             <span class="va">sp_params_area</span>, 
                                             <span class="va">group_params_area</span>, 
                                             <span class="va">species_groups</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'a_ash' has 17 missing trait values (11.9 % of shrubs) after populating with input data.</span></code></pre>
<pre><code><span class="co">## 'b_ash' has 17 missing trait values (11.9 % of shrubs) after populating with input data.</span></code></pre>
<p>We can do the same for the relationship between shrub volume and biomass of fine fuels:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sp_params_fine"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"group_params_fine"</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateShrubAllometriesFromMedfuels</a></span><span class="op">(</span><span class="va">SpParams</span>, 
                                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a_bsh"</span> <span class="op">=</span> <span class="st">"a"</span>,<span class="st">"b_bsh"</span> <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,
                                             <span class="va">sp_params_fine</span>, 
                                             <span class="va">group_params_fine</span>, 
                                             <span class="va">species_groups</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'a_bsh' has 17 missing trait values (11.9 % of shrubs) after populating with input data.</span></code></pre>
<pre><code><span class="co">## 'b_bsh' has 17 missing trait values (11.9 % of shrubs) after populating with input data.</span></code></pre>
<p>and for the relationship between shrub volume and total biomass:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sp_params_total"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"group_params_total"</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateShrubAllometriesFromMedfuels</a></span><span class="op">(</span><span class="va">SpParams</span>, 
                                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a_btsh"</span> <span class="op">=</span> <span class="st">"a"</span>,<span class="st">"b_btsh"</span> <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,
                                             <span class="va">sp_params_total</span>, 
                                             <span class="va">group_params_total</span>, 
                                             <span class="va">species_groups</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'a_btsh' has 17 missing trait values (11.9 % of shrubs) after populating with input data.</span></code></pre>
<pre><code><span class="co">## 'b_btsh' has 17 missing trait values (11.9 % of shrubs) after populating with input data.</span></code></pre>
</div>
<div class="section level3">
<h3 id="shrub-crown-ratio-and-fraction-of-dead-material">Shrub crown ratio and fraction of dead material<a class="anchor" aria-label="anchor" href="#shrub-crown-ratio-and-fraction-of-dead-material"></a>
</h3>
<p>Although values not included in <strong>medfuels</strong>, we can use the same strategy to populate the fraction of dead material (<code>pDead</code> or <span class="math inline">\(P_{dead}\)</span>) and the crown ratio (<code>cr</code>) for shrubs from a trait database. First we load the data frame:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shrub_pdead_cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"AllometryDatabases/ShrubAllometries/Shrub_Pdead_CR.txt"</span><span class="op">)</span>, 
                             sep<span class="op">=</span><span class="st">"\t"</span>, dec<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">Name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Genus"</span>, <span class="st">"Species"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">" "</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unite</span><span class="op">(</span><span class="st">"Name"</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Genus"</span>, <span class="st">"Species"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">" "</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: Expected 2 pieces. Additional pieces discarded in 26 rows [1, 2, 3, 4,</span>
<span class="co">## 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</span></code></pre>
<pre><code><span class="co">## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 6 rows [28, 29,</span>
<span class="co">## 30, 31, 32, 33].</span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shrub_data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cr <span class="op">=</span> <span class="va">shrub_pdead_cr</span><span class="op">$</span><span class="va">CR.mean</span>,
                       pDead <span class="op">=</span> <span class="va">shrub_pdead_cr</span><span class="op">$</span><span class="va">Pdead.mean</span>,
                       row.names <span class="op">=</span> <span class="va">shrub_pdead_cr</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>
<span class="va">shrub_data</span></code></pre></div>
<pre><code><span class="co">##                                    cr       pDead</span>
<span class="co">## Arbutus unedo               0.7339058 0.018494232</span>
<span class="co">## Arctostaphylos uva-ursi     1.0000000 0.023333333</span>
<span class="co">## Buxus sempervirens          0.8662708 0.005992095</span>
<span class="co">## Cistus albidus              0.6184939 0.074359228</span>
<span class="co">## Cistus laurifolius          0.7593714 0.067326043</span>
<span class="co">## Cistus monspeliensis        0.6855493 0.022440078</span>
<span class="co">## Cistus salviifolius         0.6894033 0.052122299</span>
<span class="co">## Cytisus oromediterraneus    1.0000000          NA</span>
<span class="co">## Cytisus scoparius           0.6653998 0.000000000</span>
<span class="co">## Cytisophyllum sessilifolium 0.4900602 0.000000000</span>
<span class="co">## Erica arborea               0.6954551 0.042631022</span>
<span class="co">## Erica multiflora            0.5738137 0.069654328</span>
<span class="co">## Erica scoparia              0.6846741 0.076279648</span>
<span class="co">## Genista scorpius            0.6477187          NA</span>
<span class="co">## Lavandula stoechas          0.6055558 0.051301667</span>
<span class="co">## Ligustrum vulgare           0.7470863 0.006618840</span>
<span class="co">## Phillyrea latifolia                NA          NA</span>
<span class="co">## Pistacia lentiscus          0.5561571          NA</span>
<span class="co">## Quercus coccifera           0.8032817          NA</span>
<span class="co">## Quercus ilex                       NA          NA</span>
<span class="co">## Rosa canina                        NA          NA</span>
<span class="co">## Rosmarinus officinalis      0.7111922          NA</span>
<span class="co">## Spartium junceum            0.5988686 0.112755122</span>
<span class="co">## Thymus vulgaris             1.0000000          NA</span>
<span class="co">## Ulex parviflorus            0.4196456          NA</span>
<span class="co">## Viburnum lantana            0.7467853 0.000000000</span>
<span class="co">## Viburnum tinus              0.5601560 0.044541738</span>
<span class="co">## Ch                          0.8075882 0.051301667</span>
<span class="co">## MP                          0.7185810 0.017105050</span>
<span class="co">## NPF                         0.5974499 0.043182606</span>
<span class="co">## NPR                         0.8358759 0.076279648</span>
<span class="co">## NPS                         0.6701570 0.053689663</span>
<span class="co">## NP                          0.6629622 0.050990585</span></code></pre>
<p>We then split the data frame into a table for species and a table for shrub types, and call function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateShrubAllometriesFromMedfuels()</a></code>:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sp_params_allom</span> <span class="op">=</span> <span class="va">shrub_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">27</span>,, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
<span class="va">group_params_allom</span> <span class="op">=</span> <span class="va">shrub_data</span><span class="op">[</span><span class="fl">28</span><span class="op">:</span><span class="fl">33</span>,, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateShrubAllometriesFromMedfuels</a></span><span class="op">(</span><span class="va">SpParams</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"cr"</span> <span class="op">=</span> <span class="st">"cr"</span>, <span class="st">"pDead"</span> <span class="op">=</span> <span class="st">"pDead"</span><span class="op">)</span>,
                        <span class="va">sp_params_allom</span>, 
                        <span class="va">group_params_allom</span>, 
                        <span class="va">species_groups</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'cr' has 18 missing trait values (12.6 % of shrubs) after populating with input data.</span></code></pre>
<pre><code><span class="co">## 'pDead' has 21 missing trait values (14.7 % of shrubs) after populating with input data.</span></code></pre>
</div>
<div class="section level3">
<h3 id="tree-allometries">Tree allometries<a class="anchor" aria-label="anchor" href="#tree-allometries"></a>
</h3>
<p>Tree allometric models for foliar biomass were calibrated from field data obtained in IEFC, a forest inventory conducted in Catalonia (<em>Inventari Ecològic i Forestal de Catalunya</em>) more or less during the same years as the Spanish IFN3. We begin by loading the table containing regression coefficients:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_models</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"AllometryDatabases/TreeAllometries/TreeAllometries.xlsx"</span><span class="op">)</span>, sheet<span class="op">=</span> <span class="st">"Tree_FB_models"</span>, rowNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fb_models</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                         a_fbt    b_fbt      c_fbt d_fbt        r2</span>
<span class="co">## Abies alba        0.123113793 1.452404  0.0000000     0 0.7250768</span>
<span class="co">## Acer campestre    0.008176993 1.719401  0.0000000     0 0.5422297</span>
<span class="co">## Alnus glutinosa   0.016393734 1.468776  0.0000000     0 0.6231077</span>
<span class="co">## Betula pendula    0.026024811 1.308614  0.0000000     0 0.5808289</span>
<span class="co">## Castanea sativa   0.110916829 1.281197 -0.0410213     0 0.6139703</span>
<span class="co">## Ceratonia siliqua 0.118639640 1.625880  0.0000000     0 0.7320000</span>
<span class="co">##                                    pval   n Units                Source</span>
<span class="co">## Abies alba        1.64603045774079E-051 179 kg/cm       Calculated IEFC</span>
<span class="co">## Acer campestre     0.000749610982297402  17 kg/cm       Calculated IEFC</span>
<span class="co">## Alnus glutinosa   1.74773081491028E-008  35 kg/cm       Calculated IEFC</span>
<span class="co">## Betula pendula    1.35096743240011E-028 144 kg/cm       Calculated IEFC</span>
<span class="co">## Castanea sativa   6.99458867332654E-018  86 kg/cm       Calculated IEFC</span>
<span class="co">## Ceratonia siliqua                     -   - kg/cm Montero et al. (2005)</span></code></pre>
<p>And we simply use function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateTreeAllometries()</a></code> from package <strong>medfateutils</strong> to copy the coefficients onto <code>SpParams</code>:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateTreeAllometries</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">fb_models</span>, <span class="st">"foliarbiomass"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Assignments species: 24 genus: 17 family: 0 order:0 group: 0</span></code></pre>
<pre><code><span class="co">## 60 missing allometry coefficients (out of 101 tree species) after populating with input data.</span></code></pre>
<p>Note that some assignments for species not present in the source table were done using allometric coefficients that had been defined in the source table at the genus level.</p>
<p>Crown width and crown ratio coefficients were obtained from the literature and are loaded here:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cr_models</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"AllometryDatabases/TreeAllometries/TreeAllometries.xlsx"</span><span class="op">)</span>, 
                                 sheet<span class="op">=</span> <span class="st">"Tree_CR_models"</span>, rowNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cr_models</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                     a_cr     b_1cr     b_2cr        b_3cr     c_1cr    c_2cr</span>
<span class="co">## Abies alba       2.36476 -0.763000 -0.022850  0.000074049 -0.010180 -0.27004</span>
<span class="co">## Fagus sylvatica  3.85373 -0.743000 -0.024680  0.000135686  0.000000 -0.38434</span>
<span class="co">## Pinus nigra      2.26205  0.000000 -0.019340  0.000000000 -0.013730 -0.44909</span>
<span class="co">## Pinus sylvestris 1.50576 -0.706481 -0.078039  0.000182000 -0.007262  0.00000</span>
<span class="co">## Quercus          1.98539 -0.552000 -0.013860 -0.000110736 -0.006850 -0.20101</span>
<span class="co">## Abies            2.36476 -0.763000 -0.022850  0.000074049 -0.010180 -0.27004</span>
<span class="co">##                                       Source</span>
<span class="co">## Abies alba       Hasenauer &amp; Monserud (1996)</span>
<span class="co">## Fagus sylvatica  Hasenauer &amp; Monserud (1996)</span>
<span class="co">## Pinus nigra      Hasenauer &amp; Monserud (1996)</span>
<span class="co">## Pinus sylvestris     Dominguez et al. (2006)</span>
<span class="co">## Quercus          Hasenauer &amp; Monserud (1996)</span>
<span class="co">## Abies                             Abies alba</span></code></pre>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cw_models</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"AllometryDatabases/TreeAllometries/TreeAllometries.xlsx"</span><span class="op">)</span>, 
                                 sheet<span class="op">=</span> <span class="st">"Tree_CW_models"</span>, rowNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cw_models</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                       a_cw   b_cw                           Source</span>
<span class="co">## Abies alba       1.0963648 0.5380    Hasenauer (1997) - Abies alba</span>
<span class="co">## Acer             1.5189207 0.5285     Hasenauer (1997) - Acer spp.</span>
<span class="co">## Castanea sativa  1.3065630 0.5856             Condés &amp; Sterba 2005</span>
<span class="co">## Fagus sylvatica  0.8386180 0.7347             Condés &amp; Sterba 2005</span>
<span class="co">## Fraxinus         1.1951838 0.5665 Hasenauer (1997) - Fraxinus spp.</span>
<span class="co">## Pinus halepensis 0.6415296 0.7310             Condés &amp; Sterba 2005</span></code></pre>
<p>We use the same function to populate the corresponding columns in <code>SpParams</code>:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateTreeAllometries</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">cr_models</span>, <span class="st">"crownratio"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Assignments species: 4 genus: 11 family: 0 order:0 group: 0</span></code></pre>
<pre><code><span class="co">## 86 missing allometry coefficients (out of 101 tree species) after populating with input data.</span></code></pre>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateAllometries.html" class="external-link">populateTreeAllometries</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">cw_models</span>, <span class="st">"crownwidth"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Assignments species: 11 genus: 18 family: 0 order:0 group: 0</span></code></pre>
<pre><code><span class="co">## 72 missing allometry coefficients (out of 101 tree species) after populating with input data.</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="parameters-drawn-from-plant-trait-databases">Parameters drawn from plant trait databases<a class="anchor" aria-label="anchor" href="#parameters-drawn-from-plant-trait-databases"></a>
</h2>
<p>Although we used specific functions to map most of the parameters so far, package <strong>medfateutils</strong> offers a generic function, called <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code>, to help mapping plant traits from data bases into model parameters. In this section we will extensively use this function to fill a large number of parameters from TRY <span class="citation">(Kattge et al. 2011)</span> and other plant trait data bases available to us.</p>
<div class="section level3">
<h3 id="trait-mapping-from-try">Trait mapping from TRY<a class="anchor" aria-label="anchor" href="#trait-mapping-from-try"></a>
</h3>
<p>The TRY database <span class="citation">(Kattge et al. 2011)</span> is a primary source for plant traits. We created a list of TRY trait definitions that could be mapped to <strong>medfate</strong> parameters. The following table shows the mapping:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_mapping</span> <span class="op">=</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TraitCorrespondence.xlsx"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">TRY_mapping</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TRY_mapping</span><span class="op">$</span><span class="va">Used</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">TRY_mapping</span><span class="op">$</span><span class="va">Used</span><span class="op">==</span><span class="st">"YES"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>, 
             row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="11%">
<col width="82%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">ParameterName</th>
<th align="left">TRYtrait</th>
<th align="right">TraitID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">LeafSize</td>
<td align="left">Leaf area (in case of compound leaves: leaf, petiole included)</td>
<td align="right">3110</td>
</tr>
<tr class="even">
<td align="left">LeafShape</td>
<td align="left">Leaf type</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="left">LifeForm</td>
<td align="left">Life form</td>
<td align="right">343</td>
</tr>
<tr class="even">
<td align="left">PhenologyType</td>
<td align="left">Leaf phenology type</td>
<td align="right">37</td>
</tr>
<tr class="odd">
<td align="left">Z95</td>
<td align="left">Rooting depth</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">LeafDuration</td>
<td align="left">Leaf lifespan (longevity)</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">SLA</td>
<td align="left">Leaf area per leaf dry mass (specific leaf area)</td>
<td align="right">3117</td>
</tr>
<tr class="even">
<td align="left">LeafDensity</td>
<td align="left">Leaf density (leaf tissue density, leaf dry mass per leaf volume)</td>
<td align="right">48</td>
</tr>
<tr class="odd">
<td align="left">WoodDensity</td>
<td align="left">Wood density (stem dry mass per stem fresh volume)</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Al2As</td>
<td align="left">Stem sapwood cross-sectional area per supported leaf surface area (Huber value)</td>
<td align="right">171</td>
</tr>
<tr class="odd">
<td align="left">LeafWidth</td>
<td align="left">Leaf width</td>
<td align="right">145</td>
</tr>
<tr class="even">
<td align="left">SRL</td>
<td align="left">Fine root length per fine root dry mass (specific fine root length, SRL)</td>
<td align="right">614</td>
</tr>
<tr class="odd">
<td align="left">LeafPI0</td>
<td align="left">Leaf water &amp; osmotic potential: leaf osmotic potential at full turgor</td>
<td align="right">188</td>
</tr>
<tr class="even">
<td align="left">LeafEPS</td>
<td align="left">Leaf elastic modulus</td>
<td align="right">190</td>
</tr>
<tr class="odd">
<td align="left">LigninPercent</td>
<td align="left">Leaf lignin content per leaf dry mass</td>
<td align="right">87</td>
</tr>
<tr class="even">
<td align="left">WUE</td>
<td align="left">Leaf photosynthesis rate per leaf transpiration (photosynthetic WUE)</td>
<td align="right">134</td>
</tr>
<tr class="odd">
<td align="left">VCleaf_kmax</td>
<td align="left">Leaf hydraulic conductance</td>
<td align="right">748</td>
</tr>
<tr class="even">
<td align="left">VCstem_c</td>
<td align="left">Xylem hydraulic vulnerability, xylem cavitation vulnerability, embolism vulnerability, (P20, P50, P8</td>
<td align="right">719</td>
</tr>
<tr class="odd">
<td align="left">VCstem_d</td>
<td align="left">Xylem hydraulic vulnerability, xylem cavitation vulnerability, embolism vulnerability, (P20, P50, P8</td>
<td align="right">719</td>
</tr>
<tr class="even">
<td align="left">Nleaf</td>
<td align="left">Leaf nitrogen (N) content per leaf dry mass</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">Nsapwood</td>
<td align="left">Wood nitrogen (N) content per wood dry mass</td>
<td align="right">1229</td>
</tr>
<tr class="even">
<td align="left">Nfineroot</td>
<td align="left">Fine root nitrogen (N) content per fine root dry mass</td>
<td align="right">475</td>
</tr>
<tr class="odd">
<td align="left">Vmax298</td>
<td align="left">Leaf photosynthesis carboxylation capacity (Vcmax) per leaf area (Farquhar model)</td>
<td align="right">186</td>
</tr>
<tr class="even">
<td align="left">Jmax298</td>
<td align="left">Leaf photosynthesis electron transport capacity (Jmax) per leaf area (Farquhar model)</td>
<td align="right">269</td>
</tr>
<tr class="odd">
<td align="left">WoodC</td>
<td align="left">Stem carbon (C) content per stem dry mass</td>
<td align="right">407</td>
</tr>
<tr class="even">
<td align="left">RERleaf</td>
<td align="left">Leaf respiration rate in the dark per leaf dry mass</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">RERsapwood</td>
<td align="left">Stem respiration rate per stem dry mass</td>
<td align="right">519</td>
</tr>
</tbody>
</table>
<p>We then queried TRY for public data regarding the list of TraitIDs and split the result into one database for each trait, using the TRY TraitID as file name. Data for these plant traits will be progressively loaded as required in the following subsections.</p>
</div>
<div class="section level3">
<h3 id="additional-trait-databases">Additional trait databases<a class="anchor" aria-label="anchor" href="#additional-trait-databases"></a>
</h3>
<p>Additional plant trait databases can be used for parameter estimation. We begin by loading several trait data bases, that drawn from literature publications or assembled by ourselves. One of them is HydraTRY <span class="citation">(Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>, which contains hydraulic plant traits:</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_hydratry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/HydraTRY/HydraTRY.xlsx"</span><span class="op">)</span>
<span class="va">hydratry</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">fn_hydratry</span>, rowNames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </code></pre></div>
<p>Plant hydraulic traits can also be found in <span class="citation">Martin-StPaul, Delzon, and Cochard (2017)</span>:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_martin_stpaul</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/MartinStPaul_et_al_2017/DataBase.xlsx"</span><span class="op">)</span>
<span class="va">martin_stpaul</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">fn_martin_stpaul</span>, sheet<span class="op">=</span><span class="st">"ALL"</span><span class="op">)</span>
<span class="va">martin_stpaul</span><span class="op">&lt;-</span><span class="va">martin_stpaul</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"P50"</span>, <span class="st">"P12"</span>, <span class="st">"Ptlp"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>and <span class="citation">Choat et al. (2012)</span>:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_choat</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/Choat_et_al_2012/nature11688-s2.xls"</span><span class="op">)</span>
<span class="va">choat</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_choat</span><span class="op">)</span>
<span class="va">choat</span> <span class="op">&lt;-</span><span class="va">choat</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"P50"</span>, <span class="st">"P88"</span><span class="op">)</span><span class="op">]</span> <span class="co"># Remove unit row</span></code></pre></div>
<p><span class="citation">Bartlett, Scoffoni, and Sack (2012)</span> provides values for leaf pressure-volume curves:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_bartlett</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/Bartlett_et_al_2012/Bartlett_2012_ELE_data.xlsx"</span><span class="op">)</span>
<span class="va">bartlett</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">fn_bartlett</span>, rowNames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </code></pre></div>
<p><span class="citation">Duursma et al. (2018)</span> is a good source of minimum stomatal conductance:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_duursma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/Duursma_et_al_2018/gmindatabase.csv"</span><span class="op">)</span>
<span class="va">duursma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="va">fn_duursma</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span></code></pre></div>
<p>whereas <span class="citation">Hoshika et al. (2018)</span> provides maximum stomatal conductance values:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_hoshika</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/Hoshika_et_al_2018/Hoshika_et_al_2018.xlsx"</span><span class="op">)</span>
<span class="va">hoshika</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">fn_hoshika</span><span class="op">)</span> 
<span class="va">hoshika</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="fu">str_replace</span><span class="op">(</span>string <span class="op">=</span> <span class="va">hoshika</span><span class="op">$</span><span class="va">Species</span>,pattern <span class="op">=</span> <span class="st">"_"</span>, replacement <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></code></pre></div>
<p>BROT2 database <span class="citation">(Tavşanoǧlu and Pausas 2018)</span> is particularly useful for Mediterranean plants, containing many anatomical, phenological and morphological traits:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_brot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/BROT2/BROT2_dat.csv"</span><span class="op">)</span>
<span class="va">brot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="va">fn_brot2</span><span class="op">)</span></code></pre></div>
<p>Another source of data is the Global wood density database <span class="citation">(Zanne et al. 2009)</span>:</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_gwdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/GlobalWoodDensityDatabase/GlobalWoodDensityDatabase.xls"</span><span class="op">)</span>
<span class="va">gwdd</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_gwdd</span>, sheet<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>and <span class="citation">Yebra et al. (2019)</span> provides estimates of fine fuel moisture content for a large number of species worldwide:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_yebra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/LFMC_Yebra_et_al_2019/Globe-LFMC-v2.xlsx"</span><span class="op">)</span>
<span class="va">fmc_yebra</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">fn_yebra</span>, sheet<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Finally, <span class="citation">Morris et al. (2016)</span> provides fractions of parenchymatic tissue within sapwood:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_morris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, 
                       <span class="st">"TraitDatabases/Morris_et_al_2016/nph13737-sup-0002-tables1.xlsx"</span><span class="op">)</span>
<span class="va">morris</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">fn_morris</span>, sheet<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>We complemented the formed data bases with our own compilation of plant traits, including leaf phenology:</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_pheno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/LeafPhenology/LeafPhenology.xlsx"</span><span class="op">)</span>
<span class="va">budburst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_pheno</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">senescence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_pheno</span>, sheet<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>flammability traits:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_flam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/FuelAttributes/FuelAttributes.xlsx"</span><span class="op">)</span>
<span class="va">flam</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_flam</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>the ratio of leaf dry mass to fine fuel dry mass:</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_ffr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/FineFuelRatio/FineFuelRatio.xlsx"</span><span class="op">)</span>
<span class="va">ffr</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_ffr</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>minimum/maximum fuel moisture contents:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_fmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/FMC/FMC.xlsx"</span><span class="op">)</span>
<span class="va">fmc_field</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_fmc</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">fmc_bib</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_fmc</span>, sheet<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>and construction costs:</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn_lcc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/ConstructionCosts/LeafConstructionCosts.xlsx"</span><span class="op">)</span>
<span class="va">lcc_data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_lcc</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">fn_scc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/ConstructionCosts/SapwoodConstructionCosts.xlsx"</span><span class="op">)</span>
<span class="va">scc_data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_scc</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">fn_fcc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/ConstructionCosts/FineRootConstructionCosts.xlsx"</span><span class="op">)</span>
<span class="va">fcc_data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">fn_fcc</span>, sheet<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plantleaf-classification">Plant/leaf classification<a class="anchor" aria-label="anchor" href="#plantleaf-classification"></a>
</h3>
<p>Plant and leaf classification parameters (i.e. plant life form, leaf phenology, leaf size class, leaf form) are strict in <strong>medfate</strong>, meaning they need to be provided for all target entities.</p>
<div class="section level4">
<h4 id="life-form">Life form<a class="anchor" aria-label="anchor" href="#life-form"></a>
</h4>
<p>A large number of life form records can be found in TRY. We load TRY life form data (TraitID = 343) first:</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_life_form</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_343.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Since life form descriptions in TRY are not standardized, we standardize life form values into six categories:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ch"</span>, <span class="st">"CH"</span>, <span class="st">"Cha"</span>, <span class="st">"chamaephyte"</span>, <span class="st">"Chamaephytes"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Chamaephyte"</span>
<span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cryptophytes"</span>, <span class="st">"cryptophyte"</span>,
                               <span class="st">"G"</span>, <span class="st">"geophyte"</span>, <span class="st">"Geophytes"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Cryptophyte"</span>
<span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ep"</span>, <span class="st">"epiphyte"</span>,<span class="st">"Epiphytes"</span>, <span class="st">"liana"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Epiphyte"</span>
<span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"hemicryptophyte"</span>, <span class="st">"Hemicryptophytes"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Hemicryptophyte"</span>
<span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hydrophyte"</span>, <span class="st">"Hydrophytes"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Hydrophyte"</span>
<span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mega- meso- and micro- phanerophyte"</span>,
                               <span class="st">"Phanerophyte (mega-,meso-, nano-)"</span>,
                               <span class="st">"Mega-, meso- and microphanerophyte"</span>,
                               <span class="st">"megaphanerophyte"</span>, <span class="st">"Megaphanerophyte"</span>,
                               <span class="st">"Micro-phanerophytes"</span>, <span class="st">"Nanophanerophyt"</span>,
                               <span class="st">"nanophanerophyte"</span>, <span class="st">"Nanophanerophyte"</span>,
                               <span class="st">"phanerophyte"</span>, <span class="st">"Phanerophytes"</span>, <span class="st">"shrub"</span>, <span class="st">"tree"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Phanerophyte"</span>
<span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"therophyte"</span>, <span class="st">"Therophyte (annual land plant)"</span>, <span class="st">"Therophytes"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Therophyte"</span></code></pre></div>
<p>And we exclude a number of records by focusing on these categories:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_life_form</span><span class="op">&lt;-</span><span class="va">TRY_life_form</span><span class="op">[</span><span class="va">TRY_life_form</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Chamaephyte"</span>, <span class="st">"Cryptophyte"</span>,
                                                               <span class="st">"Epiphyte"</span>, <span class="st">"Hemicryptophyte"</span>, <span class="st">"Hydrophyte"</span>,
                                                               <span class="st">"Phanerophyte"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>We can now call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> to parse TRY values:</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_life_form</span>,
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LifeForm"</span> <span class="op">=</span> <span class="st">"OrigValueStr"</span><span class="op">)</span>,
                           character_traits <span class="op">=</span> <span class="cn">TRUE</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [OrigValueStr -&gt; LifeForm] species: 81 conspecific: 115 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 21 missing trait values (9.7 %) after populating with input data.</span></code></pre>
<p>Check which species have missing values:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">LifeForm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"LifeForm"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##                         Name LifeForm</span>
<span class="co">## 14  Ampelodesmos mauritanica     &lt;NA&gt;</span>
<span class="co">## 15             Anagyris spp.     &lt;NA&gt;</span>
<span class="co">## 18      Apollonias barbujana     &lt;NA&gt;</span>
<span class="co">## 21   Arctostaphylos uva-ursi     &lt;NA&gt;</span>
<span class="co">## 55               Corema spp.     &lt;NA&gt;</span>
<span class="co">## 103          Genistella spp.     &lt;NA&gt;</span>
<span class="co">## 104    Gleditsia triacanthos     &lt;NA&gt;</span>
<span class="co">## 106            Halimium spp.     &lt;NA&gt;</span>
<span class="co">## 107    Heberdenia bahamensis     &lt;NA&gt;</span>
<span class="co">## 126           Lithodora spp.     &lt;NA&gt;</span>
<span class="co">## 139   Paliurus spina-christi     &lt;NA&gt;</span>
<span class="co">## 144             Phlomis spp.     &lt;NA&gt;</span>
<span class="co">## 146         Picconia excelsa     &lt;NA&gt;</span>
<span class="co">## 160   Pleiomeris canariensis     &lt;NA&gt;</span>
<span class="co">## 177              Retama spp.     &lt;NA&gt;</span>
<span class="co">## 192     Securinega tinctoria     &lt;NA&gt;</span>
<span class="co">## 193           Sideritis spp.     &lt;NA&gt;</span>
<span class="co">## 202              Teline spp.     &lt;NA&gt;</span>
<span class="co">## 212               Vella spp.     &lt;NA&gt;</span>
<span class="co">## 214          Visnea mocanera     &lt;NA&gt;</span>
<span class="co">## 217           Zizyphus lotus     &lt;NA&gt;</span></code></pre>
<p>Since <code>LifeForm</code> is a strict parameter, we need to fill missing values manually:</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">LifeForm</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Arctostaphylos uva-ursi"</span>, <span class="st">"Corema spp."</span>, <span class="st">"Genistella spp."</span>, 
                                       <span class="st">"Halimium spp."</span>, <span class="st">"Lithodora spp."</span>, <span class="st">"Phlomis spp."</span>,
                                       <span class="st">"Sideritis spp."</span>, <span class="st">"Vella spp."</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Chamaephyte"</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">LifeForm</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ampelodesmos mauritanica"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Hemicryptophyte"</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">LifeForm</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Anagyris spp."</span>, <span class="st">"Apollonias barbujana"</span>, <span class="st">"Gleditsia triacanthos"</span>,
                                       <span class="st">"Heberdenia bahamensis"</span>, <span class="st">"Picconia excelsa"</span>, <span class="st">"Pleiomeris canariensis"</span>,
                                       <span class="st">"Paliurus spina-christi"</span>, <span class="st">"Retama spp."</span>, <span class="st">"Securinega tinctoria"</span>,
                                       <span class="st">"Teline spp."</span>,
                                       <span class="st">"Visnea mocanera"</span>, <span class="st">"Zizyphus lotus"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Phanerophyte"</span></code></pre></div>
<p>Show the number of taxa for each life form in the species parameter table is:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">LifeForm</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##     Chamaephyte     Cryptophyte Hemicryptophyte    Phanerophyte </span>
<span class="co">##              47               1              16             153</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-shape">Leaf shape<a class="anchor" aria-label="anchor" href="#leaf-shape"></a>
</h4>
<p>A large number of leaf shape records can be found in TRY (its name in the data base is “Leaf type”). We begin by loading TRY leaf form data (TraitID = 43):</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_leaf_shape</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_43.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Since leaf shape descriptions in TRY are not standardized, we standardize leaf shape values into five categories:</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"broadleaved"</span>, <span class="st">"broad-leaved"</span>, <span class="st">"B"</span>, <span class="st">"broadleaf"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Broad"</span>
<span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"needleleaved"</span>, <span class="st">"needle-leaved"</span>,<span class="st">"needle"</span>,<span class="st">"needle-leaf"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Needle"</span>
<span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scale-shaped"</span>, <span class="st">"scale"</span>, <span class="st">"scale-like"</span>, <span class="st">"scale-leaf"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Scale"</span>
<span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"narrowleaved"</span>, <span class="st">"linear"</span>, <span class="st">"Cylindrical"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Linear"</span>
<span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"photosynthetic stem"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Spines"</span>
<span class="va">TRY_leaf_shape</span><span class="op">&lt;-</span><span class="va">TRY_leaf_shape</span><span class="op">[</span><span class="va">TRY_leaf_shape</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                                 <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Broad"</span>, <span class="st">"Needle"</span>, <span class="st">"Scale"</span>, <span class="st">"Linear"</span>, <span class="st">"Spines"</span><span class="op">)</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"OrigValueStr"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_leaf_shape</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafShape"</span><span class="op">)</span></code></pre></div>
<p>Leaf shape data is also available from database BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span>. We also standardize BROT2 leaf shape values into the same five categories:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_LeafShape</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafShape"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
                              <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span>, <span class="fl">2</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"Needle-like"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Needle"</span>
<span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafShape</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"Scale-like"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Scale"</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_LeafShape</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafShape"</span><span class="op">)</span></code></pre></div>
<p>Finally, we merge the two source data sets and call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> to parse leaf shape values:</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LeafShape_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">brot2_LeafShape</span>,
                       <span class="va">TRY_leaf_shape</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">LeafShape_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafShape"</span> <span class="op">=</span> <span class="st">"LeafShape"</span><span class="op">)</span>,
                           character_traits <span class="op">=</span> <span class="cn">TRUE</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LeafShape -&gt; LeafShape] species: 127 conspecific: 88 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 2 missing trait values (0.9 %) after populating with input data.</span></code></pre>
<p>Show which species have missing values:</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">LeafShape</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"LeafShape"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##                       Name LeafShape</span>
<span class="co">## 103        Genistella spp.      &lt;NA&gt;</span>
<span class="co">## 203 Tetraclinis articulata      &lt;NA&gt;</span></code></pre>
<p>and, like before, we need to fill missing values manually:</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">LeafShape</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Genistella spp."</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Broad"</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">LeafShape</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tetraclinis articulata"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Scale"</span></code></pre></div>
<p>The final number of taxa for each leaf shape in the species parameter table is:</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">LeafShape</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##  Broad Linear Needle  Scale </span>
<span class="co">##    185      1     26      5</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-size">Leaf size<a class="anchor" aria-label="anchor" href="#leaf-size"></a>
</h4>
<p>Parameter <code>LeafSize</code> of <strong>medfate</strong> is categorical, and describes the size of leaves as “Small,” “Medium” or “Large.” TRY includes a trait called “Leaf area,” that contains leaf area in mm2. We load TRY leaf area data using:</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_leaf_area</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_3110.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_leaf_area</span> <span class="op">&lt;-</span> <span class="va">TRY_leaf_area</span><span class="op">[</span><span class="va">TRY_leaf_area</span><span class="op">$</span><span class="va">ErrorRisk</span> <span class="op">&lt;</span> <span class="fl">4</span>,<span class="op">]</span></code></pre></div>
<p>and classify TRY leaf area values into th`e three leaf size categories:</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_leaf_area</span><span class="op">$</span><span class="va">LeafSize</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_leaf_area</span><span class="op">$</span><span class="va">StdValue</span><span class="op">)</span>, 
                             breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">225</span>, <span class="fl">2025</span>,<span class="fl">100000</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Small"</span>, <span class="st">"Medium"</span>, <span class="st">"Large"</span><span class="op">)</span><span class="op">)</span> 
<span class="va">TRY_LeafSize</span><span class="op">&lt;-</span><span class="va">TRY_leaf_area</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"LeafSize"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_LeafSize</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Species"</span></code></pre></div>
<p>Database BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span> contains both leaf area measurements and categorical leaf size data. We thus split BROT2 data into leaf area values and leaf size strings:</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_LeafArea</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafArea"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Trait"</span>, <span class="st">"Data"</span>, <span class="st">"Units"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_LeafSize</span> <span class="op">&lt;-</span> <span class="va">brot2_LeafArea</span><span class="op">[</span><span class="va">brot2_LeafArea</span><span class="op">$</span><span class="va">Units</span><span class="op">==</span><span class="st">"[5]"</span>,<span class="op">]</span>
<span class="va">brot2_LeafArea</span> <span class="op">&lt;-</span> <span class="va">brot2_LeafArea</span><span class="op">[</span><span class="va">brot2_LeafArea</span><span class="op">$</span><span class="va">Units</span><span class="op">==</span><span class="st">"mm2"</span>,<span class="op">]</span></code></pre></div>
<p>We then reclassify BROT2 leaf size data into three categories</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"very small"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"small"</span>
<span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"very large"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"large"</span>
<span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
                              <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">brot2_LeafSize</span><span class="op">$</span><span class="va">Data</span>, <span class="fl">2</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">brot2_LeafSize</span> <span class="op">&lt;-</span> <span class="va">brot2_LeafSize</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_LeafSize</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafSize"</span><span class="op">)</span></code></pre></div>
<p>and classify BRO2 leaf area values into three categories, as we did with TRY values:</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_LeafArea</span><span class="op">$</span><span class="va">LeafSize</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">brot2_LeafArea</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>, 
                              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">225</span>, <span class="fl">2025</span>,<span class="fl">100000</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Small"</span>, <span class="st">"Medium"</span>, <span class="st">"Large"</span><span class="op">)</span><span class="op">)</span> 
<span class="va">brot2_LeafArea</span> <span class="op">&lt;-</span> <span class="va">brot2_LeafArea</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"LeafSize"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_LeafArea</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Species"</span></code></pre></div>
<p>We can now merge the three source data tables and call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> to parse leaf size values:</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LeafSize_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">brot2_LeafSize</span>,
                      <span class="va">brot2_LeafArea</span>,
                      <span class="va">TRY_LeafSize</span><span class="op">)</span>

<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">LeafSize_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafSize"</span> <span class="op">=</span> <span class="st">"LeafSize"</span><span class="op">)</span>,
                           character_traits <span class="op">=</span> <span class="cn">TRUE</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LeafSize -&gt; LeafSize] species: 80 conspecific: 108 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 29 missing trait values (13.4 %) after populating with input data.</span></code></pre>
<p>Show species with missing values:</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">LeafSize</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"LeafSize"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##                            Name LeafSize</span>
<span class="co">## 10             Adenocarpus spp.     &lt;NA&gt;</span>
<span class="co">## 14     Ampelodesmos mauritanica     &lt;NA&gt;</span>
<span class="co">## 15                Anagyris spp.     &lt;NA&gt;</span>
<span class="co">## 18         Apollonias barbujana     &lt;NA&gt;</span>
<span class="co">## 34                  Cedrus spp.     &lt;NA&gt;</span>
<span class="co">## 37     Chamaecyparis lawsoniana     &lt;NA&gt;</span>
<span class="co">## 40   Chamaespartium tridentatum     &lt;NA&gt;</span>
<span class="co">## 56          Coriaria myrtifolia     &lt;NA&gt;</span>
<span class="co">## 63  Cytisophyllum sessilifolium     &lt;NA&gt;</span>
<span class="co">## 77          Daboecia cantabrica     &lt;NA&gt;</span>
<span class="co">## 81               Dracaena drago     &lt;NA&gt;</span>
<span class="co">## 94                Erinacea spp.     &lt;NA&gt;</span>
<span class="co">## 103             Genistella spp.     &lt;NA&gt;</span>
<span class="co">## 104       Gleditsia triacanthos     &lt;NA&gt;</span>
<span class="co">## 107       Heberdenia bahamensis     &lt;NA&gt;</span>
<span class="co">## 120          Kleinia neriifolia     &lt;NA&gt;</span>
<span class="co">## 139      Paliurus spina-christi     &lt;NA&gt;</span>
<span class="co">## 146            Picconia excelsa     &lt;NA&gt;</span>
<span class="co">## 160      Pleiomeris canariensis     &lt;NA&gt;</span>
<span class="co">## 163       Pseudotsuga menziesii     &lt;NA&gt;</span>
<span class="co">## 179           Rhododendron spp.     &lt;NA&gt;</span>
<span class="co">## 192        Securinega tinctoria     &lt;NA&gt;</span>
<span class="co">## 196            Sophora japonica     &lt;NA&gt;</span>
<span class="co">## 198               Spartium spp.     &lt;NA&gt;</span>
<span class="co">## 202                 Teline spp.     &lt;NA&gt;</span>
<span class="co">## 205                  Thuja spp.     &lt;NA&gt;</span>
<span class="co">## 212                  Vella spp.     &lt;NA&gt;</span>
<span class="co">## 214             Visnea mocanera     &lt;NA&gt;</span>
<span class="co">## 217              Zizyphus lotus     &lt;NA&gt;</span></code></pre>
<p>As before, we need to fill missing values manually:</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">LeafSize</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Apollonias barbujana"</span>,
                                       <span class="st">"Ampelodesmos mauritanica"</span>,
                                       <span class="st">"Dracaena drago"</span>, <span class="st">"Heberdenia bahamensis"</span>,
                                       <span class="st">"Picconia excelsa"</span>, <span class="st">"Pleiomeris canariensis"</span>,
                                       <span class="st">"Visnea mocanera"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Large"</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">LeafSize</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Anagyris spp."</span>,<span class="st">"Coriaria myrtifolia"</span>, 
                                       <span class="st">"Gleditsia triacanthos"</span>, <span class="st">"Securinega tinctoria"</span>,
                                       <span class="st">"Kleinia neriifolia"</span>, <span class="st">"Rhododendron spp."</span>,
                                       <span class="st">"Sophora japonica"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Medium"</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">LeafSize</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Adenocarpus spp."</span>, 
                                       <span class="st">"Cedrus spp."</span>,
                                       <span class="st">"Chamaecyparis lawsoniana"</span>,
                                       <span class="st">"Chamaespartium tridentatum"</span>,
                                       <span class="st">"Cytisophyllum sessilifolium"</span>,
                                       <span class="st">"Daboecia cantabrica"</span>,
                                       <span class="st">"Erinacea spp."</span>, <span class="st">"Genistella spp."</span>,
                                       <span class="st">"Paliurus spina-christi"</span>, <span class="st">"Pseudotsuga menziesii"</span>,
                                       <span class="st">"Spartium spp."</span>, <span class="st">"Teline spp."</span>,  <span class="st">"Thuja spp."</span>, <span class="st">"Vella spp."</span>,
                                       <span class="st">"Zizyphus lotus"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Small"</span></code></pre></div>
<p>The final number of taxa for each leaf size in the species parameter table is:</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">LeafSize</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##  Large Medium  Small </span>
<span class="co">##     53     75     89</span></code></pre>
</div>
<div class="section level4">
<h4 id="phenology-type">Phenology type<a class="anchor" aria-label="anchor" href="#phenology-type"></a>
</h4>
<p>A large number of leaf phenology type records can be found in TRY (TraitID 37). We load TRY leaf phenology type data first:</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_phenology</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_37.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As with several previous parameters, leaf phenology type strings need to be standardized. Five phenology categories are used in <strong>medfate</strong>, four of which can be mapped with TRY strings:</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"evergreen"</span>, <span class="st">"E"</span>, <span class="st">"EV"</span>, <span class="st">"always summer green"</span>,
                               <span class="st">"Evergreen broad-leaved"</span>, <span class="st">"Evergreen scale-like"</span>,
                               <span class="st">"Evergreen needle-leaved"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"oneflush-evergreen"</span>
<span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deciduous"</span>, <span class="st">"D"</span>, <span class="st">"Deciduous broad-leaved"</span>, <span class="st">"Deciduous"</span>,
                               <span class="st">"Nonevergreen"</span>, <span class="st">"winter deciduous"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"winter-deciduous"</span>
<span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"semi-deciduous"</span>,
                               <span class="st">"semi-evergreen"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"winter-semideciduous"</span>
<span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"drought semi-deciduous"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"drought-semideciduous"</span>
<span class="va">TRY_phenology</span><span class="op">&lt;-</span><span class="va">TRY_phenology</span><span class="op">[</span><span class="va">TRY_phenology</span><span class="op">$</span><span class="va">OrigValueStr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressive-evergreen"</span>,
                                                               <span class="st">"oneflush-evergreen"</span>, 
                                                               <span class="st">"winter-semideciduous"</span>,
                                                               <span class="st">"winter-deciduous"</span>,
                                                               <span class="st">"drought-semideciduous"</span><span class="op">)</span><span class="op">]</span>
<span class="va">TRY_phenology</span><span class="op">&lt;-</span><span class="va">TRY_phenology</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"OrigValueStr"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_phenology</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="st">"LeafPhenology"</span><span class="op">)</span></code></pre></div>
<p>Leaf phenology types are also available in BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span>, so we select them and map the existing values into <strong>medfate</strong> categories:</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_LeafPhenology</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafPhenology"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"drought semi-deciduous"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"drought-semideciduous"</span>
<span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"evergreen"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"oneflush-evergreen"</span>
<span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"winter deciduous"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"winter-deciduous"</span>
<span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">[</span><span class="va">brot2_LeafPhenology</span><span class="op">$</span><span class="va">Data</span><span class="op">==</span><span class="st">"winter semi-deciduous"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"winter-semideciduous"</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_LeafPhenology</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="st">"LeafPhenology"</span><span class="op">)</span></code></pre></div>
<p>We can now merge the two source data sets and call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> to parse leaf phenology types:</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LeafPhenology_data</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">brot2_LeafPhenology</span>,
                          <span class="va">TRY_phenology</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">LeafPhenology_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PhenologyType"</span> <span class="op">=</span> <span class="st">"LeafPhenology"</span><span class="op">)</span>,
                           character_traits <span class="op">=</span> <span class="cn">TRUE</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LeafPhenology -&gt; PhenologyType] species: 119 conspecific: 94 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 4 missing trait values (1.8 %) after populating with input data.</span></code></pre>
<p>We show which target entities have missing values after imputation:</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">PhenologyType</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"PhenologyType"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##                       Name PhenologyType</span>
<span class="co">## 103        Genistella spp.          &lt;NA&gt;</span>
<span class="co">## 160 Pleiomeris canariensis          &lt;NA&gt;</span>
<span class="co">## 192   Securinega tinctoria          &lt;NA&gt;</span>
<span class="co">## 212             Vella spp.          &lt;NA&gt;</span></code></pre>
<p>And since leaf phenology type is a strict parameter, we need to manually fill missing values :</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">PhenologyType</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vella spp."</span>, <span class="st">"Genistella spp."</span>, <span class="st">"Securinega tinctoria"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"winter-deciduous"</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">PhenologyType</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pleiomeris canariensis"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"oneflush-evergreen"</span></code></pre></div>
<p>The final number of taxa for each phenology type in the species parameter table are:</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">PhenologyType</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## drought-semideciduous    oneflush-evergreen      winter-deciduous </span>
<span class="co">##                     4                   124                    89</span></code></pre>
<p>A notable problem observed is that there are no winter-semideciduous species, as they are frequently recorded simply as winter-deciduous.</p>
</div>
</div>
<div class="section level3">
<h3 id="plant-size">Plant size<a class="anchor" aria-label="anchor" href="#plant-size"></a>
</h3>
<p>We already populated some plant size parameters from forest inventory data. Here we draw values for parameters that are not normally measured in forest inventory data (for obvious reasons), such as maximum rooting depth.</p>
<div class="section level4">
<h4 id="maximum-rooting-depth">Maximum rooting depth<a class="anchor" aria-label="anchor" href="#maximum-rooting-depth"></a>
</h4>
<p>TRY trait ‘Rooting depth’ (ID 6) contains measurements of rooting depth for multiple species. We first load this dataset:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Z95</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_6.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We filter those entries that we consider correspond to maximum rooting depths, which we will map to parameter <code>Z95</code> (depth corresponding to 95% of fine roots):</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Z95</span> <span class="op">&lt;-</span><span class="va">TRY_Z95</span><span class="op">[</span><span class="va">TRY_Z95</span><span class="op">$</span><span class="va">OriglName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Max Rooting Depth (m)"</span>,
                                           <span class="st">"Rooting depth"</span>,
                                           <span class="st">"Rooting depth (m)"</span>,
                                           <span class="st">"Rooting depth_max"</span>,
                                           <span class="st">"RootDepth"</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">TRY_Z95</span> <span class="op">&lt;-</span> <span class="va">TRY_Z95</span><span class="op">[</span><span class="va">TRY_Z95</span><span class="op">$</span><span class="va">ErrorRisk</span> <span class="op">&lt;</span> <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_Z95</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Z95"</span><span class="op">)</span></code></pre></div>
<p>Rooting depth values are also available from BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span> (some of these records are also in TRY). As before, we assume values to correspond to parameter <code>Z95</code>.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_Z95</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RootDepth"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_Z95</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">brot2_Z95</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_Z95</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Z95"</span><span class="op">)</span></code></pre></div>
<p>We then merge the two data sets, trim rooting values to lie within the interval [15 cm, 10 m] and call the populating function, while transforming units from m to mm:</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Z95_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">TRY_Z95</span>,
                 <span class="va">brot2_Z95</span><span class="op">)</span>
<span class="va">Z95_data</span><span class="op">$</span><span class="va">Z95</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">Z95_data</span><span class="op">$</span><span class="va">Z95</span>, <span class="fl">0.15</span><span class="op">)</span> <span class="co"># Minimum of 15 cm depth</span>
<span class="va">Z95_data</span><span class="op">$</span><span class="va">Z95</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">Z95_data</span><span class="op">$</span><span class="va">Z95</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Maximum of 10 m depth</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">Z95_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z95"</span> <span class="op">=</span> <span class="st">"Z95"</span><span class="op">)</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z95"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Z95 -&gt; Z95] species: 46 conspecific: 117 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 54 missing trait values (24.9 %) after populating with input data.</span></code></pre>
<p>Show species with missing values, grouped by growth form:</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">)</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        </span>
<span class="co">##         Shrub Tree Tree/Shrub</span>
<span class="co">##   FALSE    88   58         17</span>
<span class="co">##   TRUE     28   16         10</span></code></pre>
<p>Since <code>Z95</code> is a strict parameter, we fill missing values with growth form averages:</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Z95</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The distribution of <span class="math inline">\(Z95\)</span> values for shrub species and non-shrub species can be shown using:</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">==</span> <span class="st">"Shrub"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z95"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##   150.0   399.2   689.5   812.1   812.0  4510.0</span></code></pre>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span><span class="va">SpParams</span><span class="op">$</span><span class="va">GrowthForm</span> <span class="op">!=</span> <span class="st">"Shrub"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z95"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##     150    1367    2353    2353    2870    7500</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="leaf-phenology">Leaf phenology<a class="anchor" aria-label="anchor" href="#leaf-phenology"></a>
</h3>
<div class="section level4">
<h4 id="budburst-and-senescence">Budburst and senescence<a class="anchor" aria-label="anchor" href="#budburst-and-senescence"></a>
</h4>
<p>Most parameters regulating leaf phenological phases (i.e. bud dormancy, budburst, senescence, bud formation, …) require calibration exercises using observed weather data and phenological records.</p>
<p>We compiled a data base with published leaf budburst models <span class="citation">(Vitasse et al. 2011; Asse et al. 2020)</span>:</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">budburst</span></code></pre></div>
<pre><code><span class="co">##                Species      PhenologyType t0gdd Tbgdd  Sgdd   N Accepted</span>
<span class="co">## 1           Abies alba oneflush-evergreen  72.9  1.08 455.4  14        Y</span>
<span class="co">## 2  Acer pseudoplatanus   winter-deciduous  82.6  3.22 199.3  16        Y</span>
<span class="co">## 3       Betula pendula   winter-deciduous   1.0  4.90  72.0 146        Y</span>
<span class="co">## 4     Corylus avellana   winter-deciduous   1.0  7.12  21.0 128        Y</span>
<span class="co">## 5      Fagus sylvatica   winter-deciduous  98.4  0.00 201.9  30        Y</span>
<span class="co">## 6   Fraxinus excelsior   winter-deciduous  30.5  0.00 562.3  18        N</span>
<span class="co">## 7   Fraxinus excelsior   winter-deciduous   1.0  5.68 121.0 149        Y</span>
<span class="co">## 8      Ilex aquifolium oneflush-evergreen  79.7  0.00 539.4  18        Y</span>
<span class="co">## 9        Larix decidua   winter-deciduous   1.0  9.60   3.0 159        Y</span>
<span class="co">## 10         Picea abies oneflush-evergreen   1.0  2.96 290.0 112        Y</span>
<span class="co">## 11     Quercus petraea   winter-deciduous  54.5  4.34 240.7  42        Y</span>
<span class="co">##                    Ref</span>
<span class="co">## 1  Vitasse et al. 2011</span>
<span class="co">## 2  Vitasse et al. 2011</span>
<span class="co">## 3     Asse et al. 2020</span>
<span class="co">## 4     Asse et al. 2020</span>
<span class="co">## 5  Vitasse et al. 2011</span>
<span class="co">## 6  Vitasse et al. 2011</span>
<span class="co">## 7     Asse et al. 2020</span>
<span class="co">## 8  Vitasse et al. 2011</span>
<span class="co">## 9     Asse et al. 2020</span>
<span class="co">## 10    Asse et al. 2020</span>
<span class="co">## 11 Vitasse et al. 2011</span></code></pre>
<p>and leaf senescence models <span class="citation">(Delpierre et al. 2009; Vitasse et al. 2011)</span>:</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">senescence</span></code></pre></div>
<pre><code><span class="co">##               Species Phsen Tbsen xsen ysen    Ssen   N Accepted</span>
<span class="co">## 1 Acer pseudoplatanus  11.0  10.0    1    0     1.2  16        Y</span>
<span class="co">## 2     Fagus sylvatica  14.5  32.2    1    2  1206.0  30        N</span>
<span class="co">## 3     Fagus sylvatica  12.5  25.0    2    2  5160.0  79        Y</span>
<span class="co">## 4     Quercus petraea  12.5  28.5    2    2 10178.0 106        Y</span>
<span class="co">## 5     Quercus petraea  12.8  27.5    2    0 11913.0  42        N</span>
<span class="co">##                     Ref</span>
<span class="co">## 1   Vitasse et al. 2011</span>
<span class="co">## 2   Vitasse et al. 2011</span>
<span class="co">## 3 Delpierre et al. 2009</span>
<span class="co">## 4 Delpierre et al. 2009</span>
<span class="co">## 5   Vitasse et al. 2011</span></code></pre>
<p>Note that some species are repeated. Since we cannot average model parameters, due to parameter correlation, in cases of more than one model by species we selected the one based on a larger sample size (table column <code>N</code>), and codified the result in a table column called <code>Accepted</code>. We use the leaf budburst model data base to populate leaf phenology parameters:</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">budburst</span><span class="op">[</span><span class="va">budburst</span><span class="op">$</span><span class="va">Accepted</span><span class="op">==</span><span class="st">"Y"</span>,<span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t0gdd"</span> <span class="op">=</span> <span class="st">"t0gdd"</span>,
                                             <span class="st">"Tbgdd"</span> <span class="op">=</span> <span class="st">"Tbgdd"</span>,
                                             <span class="st">"Sgdd"</span> <span class="op">=</span> <span class="st">"Sgdd"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span>,
                           erase_previous <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [t0gdd -&gt; t0gdd] species: 6 conspecific: 21 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 190 missing trait values (87.6 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [Tbgdd -&gt; Tbgdd] species: 6 conspecific: 21 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 190 missing trait values (87.6 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [Sgdd -&gt; Sgdd] species: 6 conspecific: 21 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 190 missing trait values (87.6 %) after populating with input data.</span></code></pre>
<p>Similarly, we use the senescence model database to fill the parameters regulating leaf senescence:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">senescence</span><span class="op">[</span><span class="va">senescence</span><span class="op">$</span><span class="va">Accepted</span><span class="op">==</span><span class="st">"Y"</span>,<span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phsen"</span> <span class="op">=</span> <span class="st">"Phsen"</span>,
                                             <span class="st">"Tbsen"</span> <span class="op">=</span> <span class="st">"Tbsen"</span>,
                                             <span class="st">"Ssen"</span> <span class="op">=</span> <span class="st">"Ssen"</span>,
                                             <span class="st">"xsen"</span> <span class="op">=</span> <span class="st">"xsen"</span>,
                                             <span class="st">"ysen"</span> <span class="op">=</span> <span class="st">"ysen"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span>,
                           erase_previous <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Phsen -&gt; Phsen] species: 3 conspecific: 16 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 198 missing trait values (91.2 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [Tbsen -&gt; Tbsen] species: 3 conspecific: 16 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 198 missing trait values (91.2 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [Ssen -&gt; Ssen] species: 3 conspecific: 16 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 198 missing trait values (91.2 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [xsen -&gt; xsen] species: 3 conspecific: 16 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 198 missing trait values (91.2 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [ysen -&gt; ysen] species: 3 conspecific: 16 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 198 missing trait values (91.2 %) after populating with input data.</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-duration">Leaf duration<a class="anchor" aria-label="anchor" href="#leaf-duration"></a>
</h4>
<p>Leaf lifespan is available from TRY for many species (TraitID 12). We load records for this trait, which is already standardized into month units:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_LeafDuration</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_12.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_LeafDuration</span> <span class="op">&lt;-</span> <span class="va">TRY_LeafDuration</span><span class="op">[</span><span class="va">TRY_LeafDuration</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_LeafDuration</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafDuration"</span><span class="op">)</span></code></pre></div>
<p>Leaf lifespan is also available from BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span>, also in number of months:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">)</span><span class="op">==</span><span class="st">"LL"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"LeafDuration"</span>
<span class="va">brot2_LeafDuration</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafLifespan"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_LeafDuration</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">brot2_LeafDuration</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_LeafDuration</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafDuration"</span><span class="op">)</span></code></pre></div>
<p>We then merge the two data sources and call function <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> to map leaf lifespan to parameter <code>LeafDuration</code> (<span class="math inline">\(LD\)</span>), and we specify a transformation of units from months to years:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LeafDuration_data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="st">"LeafDuration"</span><span class="op">)</span><span class="op">]</span>,
                         <span class="va">TRY_LeafDuration</span>,
                         <span class="va">brot2_LeafDuration</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">LeafDuration_data</span>, 
                                trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafDuration"</span> <span class="op">=</span> <span class="st">"LeafDuration"</span><span class="op">)</span>,
                                scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafDuration"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fl">12</span><span class="op">}</span><span class="op">)</span>,
                                taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LeafDuration -&gt; LeafDuration] species: 62 conspecific: 101 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 54 missing trait values (24.9 %) after populating with input data.</span></code></pre>
<p>In this case, and the following ones, the trait is not strict, so that we do not need to manually fill missing values.</p>
</div>
</div>
<div class="section level3">
<h3 id="morphology-and-anatomy">Morphology and anatomy<a class="anchor" aria-label="anchor" href="#morphology-and-anatomy"></a>
</h3>
<p>In this subsection we map several plant morphological and anatomical traits into model parameters. All such traits in <strong>medfate</strong> are imputable, so that missing values do not need to be handled here.</p>
<div class="section level4">
<h4 id="specific-leaf-area">Specific leaf area<a class="anchor" aria-label="anchor" href="#specific-leaf-area"></a>
</h4>
<p>Specific leaf area (<span class="math inline">\(SLA\)</span>), in mm2/mg or m2/kg, is available from several databases. We load records from TRY (TraitID = 3117), which are already standardized:</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_SLA</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_3117.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_SLA</span> <span class="op">&lt;-</span> <span class="va">TRY_SLA</span><span class="op">[</span><span class="va">TRY_SLA</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_SLA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"SLA"</span><span class="op">)</span></code></pre></div>
<p>We also select SLA records from BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span>, already in the same units as TRY.</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_SLA</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLA"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_SLA</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">brot2_SLA</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_SLA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"SLA"</span><span class="op">)</span></code></pre></div>
<p>And we merge these two sources with SLA values coming from database HydraTRY <span class="citation">(Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>. The whole set is used to call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> and populate <span class="math inline">\(SLA\)</span> parameter values without any transformation:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SLA_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="st">"SLA"</span><span class="op">)</span><span class="op">]</span>,
                 <span class="va">TRY_SLA</span>,
                 <span class="va">brot2_SLA</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">SLA_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"SLA"</span> <span class="op">=</span> <span class="st">"SLA"</span><span class="op">)</span> ,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [SLA -&gt; SLA] species: 102 conspecific: 102 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 13 missing trait values (6 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLA"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##   2.419   7.060  11.035  12.298  16.559  31.165      13</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-density">Leaf density<a class="anchor" aria-label="anchor" href="#leaf-density"></a>
</h4>
<p>Leaf density (leaf dry mass per leaf volume, in <span class="math inline">\(g \cdot cm^{-3}\)</span>) is available in TRY (TraitID = 48). Since we do not have other data sources we directly use this data set to populate parameter <code>LeafDensity</code> (<span class="math inline">\(LD\)</span>):</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_LeafDensity</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_48.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_LeafDensity</span><span class="op">&lt;-</span> <span class="va">TRY_LeafDensity</span><span class="op">[</span><span class="va">TRY_LeafDensity</span><span class="op">$</span><span class="va">ErrorRisk</span> <span class="op">&lt;</span> <span class="fl">3</span>,, drop<span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> 
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_LeafDensity</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafDensity"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; LeafDensity] species: 57 conspecific: 92 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 68 missing trait values (31.3 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafDensity"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##  0.1048  0.2640  0.3668  0.3658  0.4408  0.7961      68</span></code></pre>
</div>
<div class="section level4">
<h4 id="wood-density">Wood density<a class="anchor" aria-label="anchor" href="#wood-density"></a>
</h4>
<p>Wood density (stem dry mass per fresh stem volume, in <span class="math inline">\(g \cdot cm^{-3}\)</span>) is available in TRY (TraitID = 4):</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_WoodDensity</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_4.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_WoodDensity</span> <span class="op">&lt;-</span> <span class="va">TRY_WoodDensity</span><span class="op">[</span><span class="va">TRY_WoodDensity</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_WoodDensity</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"WoodDensity"</span><span class="op">)</span></code></pre></div>
<p>Wood density records are also available from the ‘Global Wood Density Database’ <span class="citation">(Zanne et al. 2009)</span>:</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gwdd_WoodDensity</span><span class="op">&lt;-</span><span class="va">gwdd</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Binomial"</span>, <span class="st">"Wood density (g/cm^3), oven dry mass/fresh volume"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gwdd_WoodDensity</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"WoodDensity"</span><span class="op">)</span></code></pre></div>
<p>Wood density is also part of HydraTRY database <span class="citation">(Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">)</span><span class="op">==</span><span class="st">"WD"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"WoodDensity"</span></code></pre></div>
<p>and we can also find wood density estimates in BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span>:</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_WoodDensity</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StemDensity"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Data"</span><span class="op">)</span><span class="op">)</span>
<span class="va">brot2_WoodDensity</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">brot2_WoodDensity</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">brot2_WoodDensity</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"WoodDensity"</span><span class="op">)</span></code></pre></div>
<p>We merge all these four sources and call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code>:</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">WoodDensity_data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="st">"WoodDensity"</span><span class="op">)</span><span class="op">]</span>,
                        <span class="va">TRY_WoodDensity</span>,
                        <span class="va">brot2_WoodDensity</span>,
                        <span class="va">gwdd_WoodDensity</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">WoodDensity_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WoodDensity"</span> <span class="op">=</span> <span class="st">"WoodDensity"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [WoodDensity -&gt; WoodDensity] species: 81 conspecific: 103 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 33 missing trait values (15.2 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WoodDensity"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##  0.1832  0.4694  0.5775  0.5588  0.6500  0.9786      33</span></code></pre>
</div>
<div class="section level4">
<h4 id="fine-fuel-ratio">Fine fuel ratio<a class="anchor" aria-label="anchor" href="#fine-fuel-ratio"></a>
</h4>
<p>The fine fuel ratio, i.e. the ratio between dry mass of leaves and the dry mass of leaves and branchlets (&lt; 6.35 mm), is a parameter that is harder to get from trait data bases. Here we use our own compilation of values to populate parameter <code>r635</code> (<span class="math inline">\(r_{6.35}\)</span>):</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ffr</span><span class="op">)</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r635"</span> <span class="op">=</span> <span class="st">"r635"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [r635 -&gt; r635] species: 30 conspecific: 63 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 124 missing trait values (57.1 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r635"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##   1.258   1.869   2.475   2.583   2.743   5.674     124</span></code></pre>
</div>
<div class="section level4">
<h4 id="fraction-of-dead-material">Fraction of dead material<a class="anchor" aria-label="anchor" href="#fraction-of-dead-material"></a>
</h4>
<p>The fraction of standing dead biomass (<span class="math inline">\(P_{dead}\)</span>) was already populated for shrubs in the section devoted to allometries, although several target entities still have missing values:</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">pDead</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## FALSE  TRUE </span>
<span class="co">##   122    95</span></code></pre>
<p>We tried to reduce some of these missing values with data from BROT2 <span class="citation">(Tavşanoǧlu and Pausas 2018)</span>. We first select “DeadFuel” records from this data base:</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brot2_DF</span> <span class="op">&lt;-</span> <span class="va">brot2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Trait</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DeadFuel"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Trait"</span>, <span class="st">"Data"</span>, <span class="st">"Units"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Units</span><span class="op">==</span><span class="st">"%"</span><span class="op">)</span>
<span class="va">brot2_DF</span><span class="op">$</span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">brot2_DF</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span></code></pre></div>
<p>and populate the species parameter table, while transforming percentages into the [0-1] interval:</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">brot2_DF</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pDead"</span> <span class="op">=</span> <span class="st">"Data"</span><span class="op">)</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pDead"</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fl">100</span><span class="op">}</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Taxon"</span>,
                           erase_previous <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Data -&gt; pDead] species: 6 conspecific: 21 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 68 missing trait values (31.3 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pDead"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">## 0.00000 0.02244 0.05099 0.05178 0.05369 0.60500      68</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-area-to-sapwood-area-ratio">Leaf area to sapwood area ratio<a class="anchor" aria-label="anchor" href="#leaf-area-to-sapwood-area-ratio"></a>
</h4>
<p>The leaf area to sapwood area ratio <code>Al2As</code> is also known as the inverse of the Huber value. This trait can be found in the TRY database (TraitID = 171):</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Al2As</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_171.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Since either <code>Al2As</code> or the Huber value may have been recorded, we need to carefully inspect what was actually measured, and which measurement units were used:</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"Huber value"</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"Huber value"</span><span class="op">]</span><span class="op">)</span>
<span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"leaf.area.per.sapwood.area"</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"leaf.area.per.sapwood.area"</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span>
<span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"Sapwood: leaf area ratio"</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">10000</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"Sapwood: leaf area ratio"</span><span class="op">]</span><span class="op">)</span>
<span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"The ratio of leaf area attached per unit sapwood cross-section area (m2 cm-2)"</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">10000</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"The ratio of leaf area attached per unit sapwood cross-section area (m2 cm-2)"</span><span class="op">]</span><span class="op">)</span>
<span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"values at base of living crown, m2/cm2"</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">10000</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"values at base of living crown, m2/cm2"</span><span class="op">]</span><span class="op">)</span>
<span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">StdValue</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"values at breast height, m2/cm2"</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">10000</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">OriglName</span><span class="op">==</span><span class="st">"values at breast height, m2/cm2"</span><span class="op">]</span><span class="op">)</span>
<span class="va">TRY_Al2As</span> <span class="op">&lt;-</span> <span class="va">TRY_Al2As</span><span class="op">[</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">ErrorRisk</span> <span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Al2As"</span><span class="op">)</span></code></pre></div>
<p>We use a summary of the data to check the range of values and median ones, which should make sense according to our knowledge of this variable:</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">TRY_Al2As</span><span class="op">$</span><span class="va">Al2As</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##     638    2926    6390    7194    9035   23795</span></code></pre>
<p>Huber values are also available from HydraTRY <span class="citation">(Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>, so we transform them into <code>Al2As</code>:</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hydratry_Al2As</span> <span class="op">&lt;-</span><span class="va">hydratry</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="st">"Hv"</span><span class="op">)</span><span class="op">]</span>
<span class="va">hydratry_Al2As</span><span class="op">$</span><span class="va">Hv</span><span class="op">&lt;-</span> <span class="fl">10000</span><span class="op">/</span><span class="va">hydratry_Al2As</span><span class="op">$</span><span class="va">Hv</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry_Al2As</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Al2As"</span><span class="op">)</span></code></pre></div>
<p>Now we are ready to merge the two datasets and perform the population of the species parameter table:</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Hv_data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">TRY_Al2As</span>,
               <span class="va">hydratry_Al2As</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">Hv_data</span>,
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Al2As"</span> <span class="op">=</span> <span class="st">"Al2As"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Al2As -&gt; Al2As] species: 24 conspecific: 79 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 114 missing trait values (52.5 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Al2As"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##   570.1  2045.0  3186.6  4459.4  5129.5 23795.0     114</span></code></pre>
</div>
<div class="section level4">
<h4 id="fraction-of-conduits-within-sapwood">Fraction of conduits within sapwood<a class="anchor" aria-label="anchor" href="#fraction-of-conduits-within-sapwood"></a>
</h4>
<p>We used the database of <span class="citation">Morris et al. (2016)</span> as primary source to populate the fraction of sapwood corresponding to tracheids or vessels (the remaining being axial or radial parenchyma):</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">morris</span><span class="op">[</span><span class="va">morris</span><span class="op">$</span><span class="va">Organ</span><span class="op">==</span><span class="st">"stem"</span>,<span class="op">]</span>,
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"conduit2sapwood"</span> <span class="op">=</span> <span class="st">"Radial.and.Axial.Parenchyma.(%)"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species.name"</span>,
                           scalar_functions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"conduit2sapwood"</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Radial.and.Axial.Parenchyma.(%) -&gt; conduit2sapwood] species: 17 conspecific: 56 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 144 missing trait values (66.4 %) after populating with input data.</span></code></pre>
<p>Note that we had to transform the values in the data base, which refer to the percentage of radial/axial parenchymatic tissue. The distribution of parameter values is:</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"conduit2sapwood"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##  0.4858  0.6899  0.8274  0.7953  0.9236  0.9451     144</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-width">Leaf width<a class="anchor" aria-label="anchor" href="#leaf-width"></a>
</h4>
<p>Leaf width (<span class="math inline">\(LW\)</span> in cm) records can be obtained from TRY (TraitID = 145), so we directly use this data source to populate the trait without transformation:</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_LW</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_145.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_LW</span><span class="op">[</span><span class="va">TRY_LW</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>,<span class="op">]</span>,
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafWidth"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; LeafWidth] species: 51 conspecific: 109 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 57 missing trait values (26.3 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafWidth"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##  0.0500  0.3394  1.6223  2.9173  4.5000 17.1538      57</span></code></pre>
</div>
<div class="section level4">
<h4 id="specific-root-length">Specific root length<a class="anchor" aria-label="anchor" href="#specific-root-length"></a>
</h4>
<p>Finally, specific fine root length (<span class="math inline">\(SRL\)</span>) is the fine root length per fine root dry mass and can also be retrieved from TRY (TraitID = 614):</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_SRL</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_614.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_SRL</span><span class="op">[</span><span class="va">TRY_SRL</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>,<span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SRL"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; SRL] species: 8 conspecific: 54 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 155 missing trait values (71.4 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SRL"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##   522.1  1497.0  3621.2  4327.7  4398.8 32534.1     155</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="tissue-moisture">Tissue moisture<a class="anchor" aria-label="anchor" href="#tissue-moisture"></a>
</h3>
<p>Plant tissue moisture parameters in <strong>medfate</strong> include those specifying maximum/minimum moisture content in leaves/branchlets as well as parameters describing the pressure-volume curve of leaves and stem tissues.</p>
<div class="section level4">
<h4 id="minimummaximum-fuel-moisture-content">Minimum/maximum fuel moisture content<a class="anchor" aria-label="anchor" href="#minimummaximum-fuel-moisture-content"></a>
</h4>
<p>Fuel moisture content is usually defined as the mass of water per dry mass of fuel tissue. We used the database of <span class="citation">Yebra et al. (2019)</span> as primary source of fuel moisture content. We first update the name of some species in the data base:</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fmc_yebra</span><span class="op">$</span><span class="va">Species.collected</span><span class="op">[</span><span class="va">fmc_yebra</span><span class="op">$</span><span class="va">Species.collected</span><span class="op">==</span><span class="st">"Rosmarinus officinalis"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Salvia officinalis"</span></code></pre></div>
<p>and call <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> to determine parameters <code>minFMC</code> (<span class="math inline">\(FMC_{min}\)</span>) and <code>maxFMC</code> (<span class="math inline">\(FMC_{max}\)</span>) using the 5% and 95% lowest quantile values, respectively:</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">fmc_yebra</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"minFMC"</span> <span class="op">=</span> <span class="st">"LFMC.value"</span><span class="op">)</span>,
                           summary_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>,probs<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,
                           summary_params <span class="op">=</span> <span class="cn">NULL</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species.collected"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LFMC.value -&gt; minFMC] species: 34 conspecific: 81 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 102 missing trait values (47 %) after populating with input data.</span></code></pre>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">fmc_yebra</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"maxFMC"</span> <span class="op">=</span> <span class="st">"LFMC.value"</span><span class="op">)</span>,
                           summary_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>,probs<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,
                           summary_params <span class="op">=</span> <span class="cn">NULL</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species.collected"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LFMC.value -&gt; maxFMC] species: 34 conspecific: 81 genus: 0 family: 0 order: 0 group: 0</span>
<span class="co">## 102 missing trait values (47 %) after populating with input data.</span></code></pre>
<p>We now complement these values with additional data assembled by ourselves, from publications or field work:</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">FMC_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">fmc_field</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species name"</span>, <span class="st">"MinFMC_DW"</span>, <span class="st">"MaxFMC_DW"</span><span class="op">)</span><span class="op">]</span>,
                  <span class="va">fmc_bib</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species name"</span>, <span class="st">"MinFMC_DW"</span>, <span class="st">"MaxFMC_DW"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">FMC_data</span><span class="op">$</span><span class="va">`Species name`</span><span class="op">[</span><span class="va">FMC_data</span><span class="op">$</span><span class="va">`Species name`</span><span class="op">==</span><span class="st">"Rosmarinus officinalis"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Salvia officinalis"</span></code></pre></div>
<p>Note that the call to <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> includes <code>erase_previous = FALSE</code> to avoid overwriting values on those estimated from <span class="citation">Yebra et al. (2019)</span>:</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">FMC_data</span><span class="op">)</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"minFMC"</span> <span class="op">=</span> <span class="st">"MinFMC_DW"</span>,
                                             <span class="st">"maxFMC"</span> <span class="op">=</span> <span class="st">"MaxFMC_DW"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species name"</span>, erase_previous <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [MinFMC_DW -&gt; minFMC] species: 9 conspecific: 8 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 85 missing trait values (39.2 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [MaxFMC_DW -&gt; maxFMC] species: 9 conspecific: 8 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 85 missing trait values (39.2 %) after populating with input data.</span></code></pre>
<p>The distribution of <span class="math inline">\(FMC_{min}\)</span> and <span class="math inline">\(FMC_{max}\)</span> parameter values is:</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"minFMC"</span>, <span class="st">"maxFMC"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      minFMC           maxFMC     </span>
<span class="co">##  Min.   :  8.15   Min.   : 68.0  </span>
<span class="co">##  1st Qu.: 56.08   1st Qu.:122.8  </span>
<span class="co">##  Median : 73.89   Median :151.1  </span>
<span class="co">##  Mean   : 72.96   Mean   :164.0  </span>
<span class="co">##  3rd Qu.: 82.93   3rd Qu.:184.1  </span>
<span class="co">##  Max.   :204.32   Max.   :460.7  </span>
<span class="co">##  NA's   :85       NA's   :85</span></code></pre>
</div>
<div class="section level4">
<h4 id="leaf-pressure-volume-curve">Leaf pressure-volume curve<a class="anchor" aria-label="anchor" href="#leaf-pressure-volume-curve"></a>
</h4>
<p>Leaf osmotic potential at full turgor (<code>LeafPI0</code> or <span class="math inline">\(\pi_{0,leaf}\)</span>) and leaf elastic modulus (<code>LeafEPS</code> or <span class="math inline">\(\epsilon_{leaf}\)</span>) describe leaf pressure-volume curves. These traits can be obtained from TRY <span class="citation">(Kattge et al. 2011)</span> and <span class="citation">Bartlett, Scoffoni, and Sack (2012)</span>. We begin by changing the column names of this second database:</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bartlett</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bartlett</span><span class="op">)</span><span class="op">==</span><span class="st">"πo.(MPa)"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"LeafPI0"</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bartlett</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bartlett</span><span class="op">)</span><span class="op">==</span><span class="st">"ε.(MPa)"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"LeafEPS"</span></code></pre></div>
<p>we then load TRY data for <span class="math inline">\(\pi_{0,leaf}\)</span> (TraitID = 188):</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_LeafPI0</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_188.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_LeafPI0</span> <span class="op">&lt;-</span> <span class="va">TRY_LeafPI0</span><span class="op">[</span><span class="va">TRY_LeafPI0</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_LeafPI0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafPI0"</span><span class="op">)</span>
<span class="va">TRY_LeafPI0</span><span class="op">$</span><span class="va">LeafPI0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">TRY_LeafPI0</span><span class="op">$</span><span class="va">LeafPI0</span> </code></pre></div>
<p>and TRY data for <span class="math inline">\(\epsilon_{leaf}\)</span> (TraitID = 190):</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_LeafEPS</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_190.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_LeafEPS</span><span class="op">$</span><span class="va">StdValue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_LeafEPS</span><span class="op">$</span><span class="va">OrigValueStr</span><span class="op">)</span> 
<span class="va">TRY_LeafEPS</span> <span class="op">&lt;-</span> <span class="va">TRY_LeafEPS</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_LeafEPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafEPS"</span><span class="op">)</span></code></pre></div>
<p>We then fill <span class="math inline">\(\pi_{0,leaf}\)</span> with the TRY and <span class="citation">Bartlett, Scoffoni, and Sack (2012)</span> data sources merged:</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LeafPI0_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">TRY_LeafPI0</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafPI0"</span><span class="op">)</span><span class="op">]</span>,
                     <span class="va">bartlett</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafPI0"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">LeafPI0_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafPI0"</span> <span class="op">=</span> <span class="st">"LeafPI0"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LeafPI0 -&gt; LeafPI0] species: 16 conspecific: 60 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 141 missing trait values (65 %) after populating with input data.</span></code></pre>
<p>And we do the same for <span class="math inline">\(\epsilon_{leaf}\)</span>:</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LeafEPS_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">TRY_LeafEPS</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafEPS"</span><span class="op">)</span><span class="op">]</span>,
                     <span class="va">bartlett</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"LeafEPS"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">LeafEPS_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafEPS"</span> <span class="op">=</span> <span class="st">"LeafEPS"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [LeafEPS -&gt; LeafEPS] species: 15 conspecific: 55 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 147 missing trait values (67.7 %) after populating with input data.</span></code></pre>
<p>Finally, we use <span class="citation">Bartlett, Scoffoni, and Sack (2012)</span> to provide suitable values for the fraction of apoplastic tissue (<code>LeafAF</code> or <span class="math inline">\(f_{apo,leaf}\)</span>):</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">bartlett</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafAF"</span> <span class="op">=</span> <span class="st">"af"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [af -&gt; LeafAF] species: 12 conspecific: 25 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 180 missing trait values (82.9 %) after populating with input data.</span></code></pre>
<p>The statistical distributions of the three parameters is summarized below:</p>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LeafPI0"</span>, <span class="st">"LeafEPS"</span>, <span class="st">"LeafAF"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     LeafPI0          LeafEPS           LeafAF      </span>
<span class="co">##  Min.   :-2.740   Min.   : 3.417   Min.   :0.0800  </span>
<span class="co">##  1st Qu.:-1.912   1st Qu.: 5.920   1st Qu.:0.1340  </span>
<span class="co">##  Median :-1.591   Median : 8.919   Median :0.2189  </span>
<span class="co">##  Mean   :-1.543   Mean   :11.646   Mean   :0.2316  </span>
<span class="co">##  3rd Qu.:-1.250   3rd Qu.:15.053   3rd Qu.:0.3525  </span>
<span class="co">##  Max.   :-0.720   Max.   :48.750   Max.   :0.4000  </span>
<span class="co">##  NA's   :141      NA's   :147      NA's   :180</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="fuel-flammability">Fuel flammability<a class="anchor" aria-label="anchor" href="#fuel-flammability"></a>
</h3>
<p>Fuel flammability properties are needed to predict potential fire behavior on forest stands on the basis of its composition and structure.</p>
<div class="section level4">
<h4 id="heat-content-and-surface-area-to-volume-ratio">Heat content and surface area to volume ratio<a class="anchor" aria-label="anchor" href="#heat-content-and-surface-area-to-volume-ratio"></a>
</h4>
<p>We compiled in a database bibliographic values of calorific heat value (<span class="math inline">\(h\)</span>, in <span class="math inline">\(J \cdot kg^{-1}\)</span>) and the surface area to volume ratio (<span class="math inline">\(\sigma\)</span>, in <span class="math inline">\(m^2 \cdot m^{-3}\)</span>) for different Mediterranean plant species. We use this data set to populate the corresponding <strong>medfate</strong> parameters:</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">flam</span><span class="op">)</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HeatContent"</span> <span class="op">=</span> <span class="st">"High calorific value [J/kg]"</span>,
                                             <span class="st">"SAV"</span> <span class="op">=</span> <span class="st">"SurfaceAreaVolume[m2/m3]"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species name"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [High calorific value [J/kg] -&gt; HeatContent] species: 28 conspecific: 56 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 133 missing trait values (61.3 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [SurfaceAreaVolume[m2/m3] -&gt; SAV] species: 20 conspecific: 43 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 154 missing trait values (71 %) after populating with input data.</span></code></pre>
<p>The statistical distributions of the two parameters is summarized below:</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HeatContent"</span>, <span class="st">"SAV"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   HeatContent         SAV       </span>
<span class="co">##  Min.   :18700   Min.   : 1120  </span>
<span class="co">##  1st Qu.:19779   1st Qu.: 4073  </span>
<span class="co">##  Median :20466   Median : 4630  </span>
<span class="co">##  Mean   :20868   Mean   : 5097  </span>
<span class="co">##  3rd Qu.:21400   3rd Qu.: 6860  </span>
<span class="co">##  Max.   :24600   Max.   :10200  </span>
<span class="co">##  NA's   :133     NA's   :154</span></code></pre>
</div>
<div class="section level4">
<h4 id="lignin-content">Lignin content<a class="anchor" aria-label="anchor" href="#lignin-content"></a>
</h4>
<p>The lignin content per dry mass of leaves is included in TRY (TraitID = 87) with standardized units mg/g. To parse this trait into <code>LigninPercent</code> (<span class="math inline">\(LI\)</span>) we simply divide values by 10.</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Lignin</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"TraitDatabases/TRY/TRY_traits/TRY_87.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_Lignin</span><span class="op">[</span><span class="va">TRY_Lignin</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>,<span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LigninPercent"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LigninPercent"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fl">10</span><span class="op">}</span><span class="op">)</span>, <span class="co">#mg/g to % </span>
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; LigninPercent] species: 2 conspecific: 46 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 169 missing trait values (77.9 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LigninPercent"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##   6.032  12.590  16.153  19.003  25.809  28.975     169</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="transpirationphotosynthesis-graniers-model">Transpiration/photosynthesis (Granier’s model)<a class="anchor" aria-label="anchor" href="#transpirationphotosynthesis-graniers-model"></a>
</h3>
<p>The three following subsections provide suitable values for parameters regulating transpiration and photosynthesis under the Granier transpiration model.</p>
<div class="section level4">
<h4 id="water-potential-determining-stomatal-closure">Water potential determining stomatal closure<a class="anchor" aria-label="anchor" href="#water-potential-determining-stomatal-closure"></a>
</h4>
<p>Parameter <span class="math inline">\(\Psi_{extract}\)</span> (<code>Psi_Extract</code>) is the water potential at which transpiration is 50% of its maximum, for a given species. We decided to populate values for this parameter using the water potential corresponding to turgor loss point (<span class="math inline">\(\Psi_{tlp}\)</span>), which is available in <span class="citation">Bartlett, Scoffoni, and Sack (2012)</span> and HydraTRY <span class="citation">(Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>:</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bartlett</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bartlett</span><span class="op">)</span><span class="op">==</span><span class="st">"πtlp.(MPa)"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Ptlp"</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydratry</span><span class="op">)</span><span class="op">==</span><span class="st">"PItlp"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Ptlp"</span></code></pre></div>
<p>However, we did not take <span class="math inline">\(\Psi_{tlp}\)</span> directly as a value for <span class="math inline">\(\Psi_{extract}\)</span> but assumed that <span class="math inline">\(\Psi_{tlp}\)</span> corresponded to 5% of maximum transpiration. Using <span class="math inline">\(\Psi_{tlp}\)</span> and the equation that relates <span class="math inline">\(\Psi_{extract}\)</span> with relative whole plant transpiration <span class="math inline">\(\Psi_{extract}\)</span> is <span class="math inline">\(\Psi_{extract} = \left[ln(0.5)/ln(0.05)\right]^{(1/r)} \cdot \Psi_{tlp}\)</span>, where <span class="math inline">\(r = 3\)</span>. The mapping is done by calling <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> on a merged dataset:</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Ptlp_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">martin_stpaul</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Ptlp"</span><span class="op">)</span><span class="op">]</span>,
                  <span class="va">hydratry</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Ptlp"</span><span class="op">)</span><span class="op">]</span>,
                  <span class="va">bartlett</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Ptlp"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">Ptlp_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Psi_Extract"</span> <span class="op">=</span> <span class="st">"Ptlp"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Psi_Extract"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Ptlp -&gt; Psi_Extract] species: 38 conspecific: 60 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 119 missing trait values (54.8 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Psi_Extract"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">## -2.6091 -1.8310 -1.4086 -1.5011 -1.2084 -0.6262     119</span></code></pre>
</div>
<div class="section level4">
<h4 id="critical-water-potential">Critical water potential<a class="anchor" aria-label="anchor" href="#critical-water-potential"></a>
</h4>
<p>Parameter <span class="math inline">\(\Psi_{critic}\)</span> (<code>Psi_Critic</code>) is the water potential corresponding to 50% of loss of hydraulic conductance in the stem, also known as <span class="math inline">\(\Psi_{50}\)</span>. This trait can be found in three data bases <span class="citation">(Martin-StPaul, Delzon, and Cochard 2017; Choat et al. 2012; Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>:</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">P50_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">martin_stpaul</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"P50"</span><span class="op">)</span><span class="op">]</span>,
                 <span class="va">choat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"P50"</span><span class="op">)</span><span class="op">]</span>,
                 <span class="va">hydratry</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"P50"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">P50_data</span><span class="op">$</span><span class="va">P50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">P50_data</span><span class="op">$</span><span class="va">P50</span><span class="op">)</span></code></pre></div>
<p>TRY also contains data from xylem vulnerability curves, which mostly overlaps other data sources, but from which we can perhaps obtain additional <span class="math inline">\(\Psi_{50}\)</span> records <span class="citation">(Pausas et al. 2016; Manzoni et al. 2013)</span>:</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_VC</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_719.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">VC_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Reference P50"</span>,
            <span class="st">"Xylem water potential at which 50% of conductivity is lost (P50)"</span>,
            <span class="st">"Stem P50"</span><span class="op">)</span>
<span class="va">TRY_P50</span> <span class="op">&lt;-</span> <span class="va">TRY_VC</span><span class="op">[</span><span class="va">TRY_VC</span><span class="op">$</span><span class="va">DataName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">VC_str</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"OrigValueStr"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRY_P50</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"P50"</span><span class="op">)</span></code></pre></div>
<p>We convert string <span class="math inline">\(\Psi_{50}\)</span> records to numeric values and change the sign of positive values:</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: NAs introduced by coercion</span></code></pre>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_P50</span> <span class="op">&lt;-</span> <span class="va">TRY_P50</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span><span class="op">[</span><span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span><span class="op">[</span><span class="va">TRY_P50</span><span class="op">$</span><span class="va">P50</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span></code></pre></div>
<p>And we can now merge TRY data with the other sources:</p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">P50_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">P50_data</span>, <span class="va">TRY_P50</span><span class="op">)</span></code></pre></div>
<p>The mapping is done by calling <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code> on a merged dataset:</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">P50_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Psi_Critic"</span> <span class="op">=</span> <span class="st">"P50"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [P50 -&gt; Psi_Critic] species: 62 conspecific: 85 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 70 missing trait values (32.3 %) after populating with input data.</span></code></pre>
<p>We want to ensure that <span class="math inline">\(\Psi_{critic} \leq \Psi_{extract}\)</span> by using:</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span><span class="op">$</span><span class="va">Psi_Critic</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">$</span><span class="va">Psi_Critic</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">Psi_Extract</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Psi_Critic"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's </span>
<span class="co">## -10.2174  -5.1166  -3.4276  -3.8453  -2.4627  -0.4269       66</span></code></pre>
</div>
<div class="section level4">
<h4 id="water-use-efficiency">Water use efficiency<a class="anchor" aria-label="anchor" href="#water-use-efficiency"></a>
</h4>
<p>Water use efficiency (<span class="math inline">\(WUE\)</span>) is the leaf transpiration rate per photosynthesis rate. We can draw values of the water use efficiency from TRY (TraitID = 134), after filtering out extreme values:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_WUE</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_134.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_WUE</span> <span class="op">&lt;-</span> <span class="va">TRY_WUE</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">StdValue</span> <span class="op">&lt;</span> <span class="fl">40</span>, <span class="va">ErrorRisk</span> <span class="op">&lt;</span><span class="fl">3</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_WUE</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WUE"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span>,
                           summary_function <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; WUE] species: 7 conspecific: 34 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 176 missing trait values (81.1 %) after populating with input data.</span></code></pre>
<p>In this case we took the maximum value for each species, to better fit the model parameter definition. Note, in addition, that TRY data corresponds to <strong>net</strong> photosynthesis over transpiration, whereas the model parameter is defined as <strong>gross</strong> photosynthesis over transpiration, which means that a correction should be applied. The distribution of parameter values is:</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WUE"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##   1.721   3.198   3.290   4.205   3.955  24.820     176</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="transpirationphotosynthesis-sperrys-model">Transpiration/photosynthesis (Sperry’s model)<a class="anchor" aria-label="anchor" href="#transpirationphotosynthesis-sperrys-model"></a>
</h3>
<p>Simulations with the Sperry’s transpiration model require many species-specific parameters, several of them unavailable in plant trait data bases. Here we make an effort to provide suitable values for some of them, particularly stem hydraulic efficiency and vulnerability. Others are estimated in <strong>medfate</strong> via inbuilt imputation or scaling procedures, as described in medfate’s reference book.</p>
<div class="section level4">
<h4 id="minimummaximum-stomatal-conductance">Minimum/maximum stomatal conductance<a class="anchor" aria-label="anchor" href="#minimummaximum-stomatal-conductance"></a>
</h4>
<p>Minimum and maximum values of leaf conductance to water vapor (<span class="math inline">\(G_{swmin}\)</span> and <span class="math inline">\(G_{swmax}\)</span>) can be drawn from databases of <span class="citation">Duursma et al. (2018)</span> and <span class="citation">Hoshika et al. (2018)</span>, respectively. We first populate <span class="math inline">\(G_{swmin}\)</span> using data from <span class="citation">Duursma et al. (2018)</span>, while changing the units from <span class="math inline">\(mmol\cdot s^{-1} \cdot m^{-2}\)</span> to <span class="math inline">\(mol\cdot s^{-1} \cdot m^{-2}\)</span>:</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">duursma</span><span class="op">$</span><span class="va">gmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">duursma</span><span class="op">$</span><span class="va">gmin</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">duursma</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Gswmin"</span> <span class="op">=</span> <span class="st">"gmin"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"species"</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Gswmin"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fl">1000</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">## Mapping [gmin -&gt; Gswmin] species: 18 conspecific: 50 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 149 missing trait values (68.7 %) after populating with input data.</span></code></pre>
<p>We then populate <span class="math inline">\(G_{swmax}\)</span> using data from <span class="citation">Hoshika et al. (2018)</span> without any change in units:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">hoshika</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Gswmax"</span> <span class="op">=</span> <span class="st">"gmax.(mol.m-2.s-1)"</span><span class="op">)</span> ,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [gmax.(mol.m-2.s-1) -&gt; Gswmax] species: 17 conspecific: 34 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 166 missing trait values (76.5 %) after populating with input data.</span></code></pre>
<p>The statistical distributions of the two parameters is summarized below:</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gswmin"</span>, <span class="st">"Gswmax"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      Gswmin            Gswmax      </span>
<span class="co">##  Min.   :0.00034   Min.   :0.0480  </span>
<span class="co">##  1st Qu.:0.00302   1st Qu.:0.1941  </span>
<span class="co">##  Median :0.00394   Median :0.2427  </span>
<span class="co">##  Mean   :0.00486   Mean   :0.2823  </span>
<span class="co">##  3rd Qu.:0.00600   3rd Qu.:0.3375  </span>
<span class="co">##  Max.   :0.01392   Max.   :0.8000  </span>
<span class="co">##  NA's   :149       NA's   :166</span></code></pre>
</div>
<div class="section level4">
<h4 id="stem-maximum-hydraulic-conductivity">Stem maximum hydraulic conductivity<a class="anchor" aria-label="anchor" href="#stem-maximum-hydraulic-conductivity"></a>
</h4>
<p>Stem maximum hydraulic conductivity (<span class="math inline">\(K_{stem, max, ref}\)</span>) is an important parameter used in <strong>medfate</strong> to estimate stem maximum conductance, which defines plant hydraulic efficiency. Here we populate some values from HydraTRY <span class="citation">(Mencuccini et al. 2019; Sanchez‐Martinez et al. 2020)</span>:</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">hydratry</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kmax_stemxylem"</span> <span class="op">=</span> <span class="st">"Ks"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [Ks -&gt; Kmax_stemxylem] species: 34 conspecific: 76 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 107 missing trait values (49.3 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kmax_stemxylem"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##  0.0722  0.3350  0.5380  1.4260  1.6930 15.6400     107</span></code></pre>
</div>
<div class="section level4">
<h4 id="stem-hydraulic-vulnerability">Stem hydraulic vulnerability<a class="anchor" aria-label="anchor" href="#stem-hydraulic-vulnerability"></a>
</h4>
<p>Stem hydraulic vulnerability is described in <strong>medfate</strong> using Weibull-type curves, which are described using two parameters. Trait databases normally report vulnerability using water potential corresponding to different levels of conductance loss, i.e. <span class="math inline">\(\Psi_{12}\)</span>, <span class="math inline">\(\Psi_{50}\)</span>, <span class="math inline">\(\Psi_{88}\)</span>, etc. Here we first estimate Weibull coefficients from <span class="citation">Martin-StPaul, Delzon, and Cochard (2017)</span> data on <span class="math inline">\(\Psi_{12}\)</span>, <span class="math inline">\(\Psi_{50}\)</span>:</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">martin_stpaul</span><span class="op">$</span><span class="va">VCstem_c</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">martin_stpaul</span><span class="op">$</span><span class="va">VCstem_d</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">martin_stpaul</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">martin_stpaul</span><span class="op">$</span><span class="va">P50</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">martin_stpaul</span><span class="op">$</span><span class="va">P12</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">weib</span> <span class="op">=</span> <span class="fu"><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_psi2Weibull</a></span><span class="op">(</span>psi50 <span class="op">=</span> <span class="va">martin_stpaul</span><span class="op">$</span><span class="va">P50</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                                  psi12 <span class="op">=</span> <span class="va">martin_stpaul</span><span class="op">$</span><span class="va">P12</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
    <span class="va">martin_stpaul</span><span class="op">$</span><span class="va">VCstem_c</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">weib</span><span class="op">[[</span><span class="st">"c"</span><span class="op">]</span><span class="op">]</span>
    <span class="va">martin_stpaul</span><span class="op">$</span><span class="va">VCstem_d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">weib</span><span class="op">[[</span><span class="st">"d"</span><span class="op">]</span><span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>and we do something similar from <span class="citation">Choat et al. (2012)</span> data on <span class="math inline">\(\Psi_{50}\)</span>, <span class="math inline">\(\Psi_{88}\)</span>:</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">choat</span><span class="op">$</span><span class="va">P50</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">choat</span><span class="op">$</span><span class="va">P50</span><span class="op">)</span>
<span class="va">choat</span><span class="op">$</span><span class="va">P88</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">choat</span><span class="op">$</span><span class="va">P88</span><span class="op">)</span>
<span class="va">choat</span><span class="op">$</span><span class="va">VCstem_c</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">choat</span><span class="op">$</span><span class="va">VCstem_d</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">choat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">choat</span><span class="op">$</span><span class="va">P50</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">choat</span><span class="op">$</span><span class="va">P88</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">weib</span> <span class="op">=</span> <span class="fu"><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_psi2Weibull</a></span><span class="op">(</span>psi50 <span class="op">=</span> <span class="va">choat</span><span class="op">$</span><span class="va">P50</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                                  psi88 <span class="op">=</span> <span class="va">choat</span><span class="op">$</span><span class="va">P88</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
    <span class="va">choat</span><span class="op">$</span><span class="va">VCstem_c</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">weib</span><span class="op">[[</span><span class="st">"c"</span><span class="op">]</span><span class="op">]</span>
    <span class="va">choat</span><span class="op">$</span><span class="va">VCstem_d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">weib</span><span class="op">[[</span><span class="st">"d"</span><span class="op">]</span><span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>We then merge the two data sets and populate Weibull coefficients using <code><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits()</a></code>:</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VC_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">martin_stpaul</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"VCstem_c"</span>, <span class="st">"VCstem_d"</span><span class="op">)</span><span class="op">]</span>,
                <span class="va">choat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"VCstem_c"</span>, <span class="st">"VCstem_d"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">VC_data</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"VCstem_c"</span> <span class="op">=</span> <span class="st">"VCstem_c"</span>,
                                                <span class="st">"VCstem_d"</span> <span class="op">=</span> <span class="st">"VCstem_d"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [VCstem_c -&gt; VCstem_c] species: 51 conspecific: 76 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 90 missing trait values (41.5 %) after populating with input data.</span></code></pre>
<pre><code><span class="co">## Mapping [VCstem_d -&gt; VCstem_d] species: 51 conspecific: 76 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 90 missing trait values (41.5 %) after populating with input data.</span></code></pre>
<p>The statistical distributions of the stem vulnerability parameters is summarized below:</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VCstem_c"</span>, <span class="st">"VCstem_d"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     VCstem_c          VCstem_d       </span>
<span class="co">##  Min.   : 0.7318   Min.   :-11.3043  </span>
<span class="co">##  1st Qu.: 3.2806   1st Qu.: -6.6971  </span>
<span class="co">##  Median : 6.1031   Median : -4.1265  </span>
<span class="co">##  Mean   : 6.1744   Mean   : -5.0821  </span>
<span class="co">##  3rd Qu.: 8.0219   3rd Qu.: -3.6800  </span>
<span class="co">##  Max.   :19.4287   Max.   : -0.6767  </span>
<span class="co">##  NA's   :90        NA's   :90</span></code></pre>
</div>
<div class="section level4">
<h4 id="photosynthetic-capacity">Photosynthetic capacity<a class="anchor" aria-label="anchor" href="#photosynthetic-capacity"></a>
</h4>
<p>TRY offers <span class="math inline">\(V_{max}\)</span> values (TraitID = 186), which we take as estimates for <strong>medfate</strong>’s <span class="math inline">\(V_{max298}\)</span> the maximum Rubisco carboxilation rate at 25 degrees Celsius:</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Vmax298</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_186.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_Vmax298</span><span class="op">[</span><span class="va">TRY_Vmax298</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vmax298"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; Vmax298] species: 23 conspecific: 87 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 107 missing trait values (49.3 %) after populating with input data.</span></code></pre>
<p>The same happens with TRY’s <span class="math inline">\(J_{max}\)</span> values (TraitID = 269), which we take as estimates for <strong>medfate</strong>’s <span class="math inline">\(J_{max298}\)</span> the maximum electron transport rate at 25 degrees Celsius:</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Jmax298</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_269.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_Jmax298</span><span class="op">[</span><span class="va">TRY_Jmax298</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Jmax298"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; Jmax298] species: 20 conspecific: 70 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 127 missing trait values (58.5 %) after populating with input data.</span></code></pre>
<p>The statistical distributions of the two parameters is summarized below:</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vmax298"</span>, <span class="st">"Jmax298"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     Vmax298           Jmax298      </span>
<span class="co">##  Min.   :  9.755   Min.   : 44.00  </span>
<span class="co">##  1st Qu.: 37.023   1st Qu.: 77.54  </span>
<span class="co">##  Median : 55.010   Median :105.24  </span>
<span class="co">##  Mean   : 56.508   Mean   :110.15  </span>
<span class="co">##  3rd Qu.: 66.433   3rd Qu.:140.34  </span>
<span class="co">##  Max.   :123.460   Max.   :199.37  </span>
<span class="co">##  NA's   :107       NA's   :127</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="carbon-balance-and-growth">Carbon balance and growth<a class="anchor" aria-label="anchor" href="#carbon-balance-and-growth"></a>
</h3>
<p>Carbon balance and growth simulations require many parameters some of which are hard to measure experimentally.</p>
<div class="section level4">
<h4 id="maintenance-respiration-rates">Maintenance respiration rates<a class="anchor" aria-label="anchor" href="#maintenance-respiration-rates"></a>
</h4>
<p>Baseline maintenance respiration rates for each tissue (leaf, sapwood and fine roots) are species-specific parameters in the model. Here we first leaf dark respiration rates per leaf mass values from TRY (TraitID = 41):</p>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_RERleaf</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_41.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_RERleaf</span> <span class="op">&lt;-</span> <span class="va">TRY_RERleaf</span><span class="op">[</span><span class="va">TRY_RERleaf</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>We now call the population function, while transforming units of micro mol C g-1 s-1 to g gluc g-1 d-1:</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_RERleaf</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RERleaf"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RERleaf"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fl">24.0</span><span class="op">*</span><span class="fl">3600.0</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">6.0</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1e-6</span><span class="op">)</span><span class="op">*</span><span class="fl">180.156</span><span class="op">}</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; RERleaf] species: 16 conspecific: 60 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 141 missing trait values (65 %) after populating with input data.</span></code></pre>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RERleaf"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">## 0.00664 0.01475 0.02670 0.02955 0.03701 0.07585     141</span></code></pre>
<p>Sapwood respiration is much harder to measure and database values are not retrieved at present.</p>
</div>
<div class="section level4">
<h4 id="nitrogen-content-of-tissues">Nitrogen content of tissues<a class="anchor" aria-label="anchor" href="#nitrogen-content-of-tissues"></a>
</h4>
<p>The model allows estimating leaf and fine root respiration rates from nitrogen concentration. Hence it is useful to draw this latter parameter from trait databases. Sapwood respiration rates are given a default value when missing, but we also draw sapwood N concentrations. Here we first extract nitrogen concentration per leaf mass values from TRY (TraitID = 14):</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Nleaf</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_14.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_Nleaf</span> <span class="op">&lt;-</span> <span class="va">TRY_Nleaf</span><span class="op">[</span><span class="va">TRY_Nleaf</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>We now call the population function:</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_Nleaf</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nleaf"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; Nleaf] species: 94 conspecific: 100 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 23 missing trait values (10.6 %) after populating with input data.</span></code></pre>
<p>And we do the same for sapwood and fine roots (TraitIDs = 1229 and 475, respectively):</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_Nsapwood</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_1229.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_Nfineroot</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_475.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">TRY_Nsapwood</span> <span class="op">&lt;-</span> <span class="va">TRY_Nsapwood</span><span class="op">[</span><span class="va">TRY_Nsapwood</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="va">TRY_Nfineroot</span> <span class="op">&lt;-</span> <span class="va">TRY_Nfineroot</span><span class="op">[</span><span class="va">TRY_Nfineroot</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AccSpeciesName"</span>, <span class="st">"StdValue"</span><span class="op">)</span><span class="op">]</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_Nsapwood</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nsapwood"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; Nsapwood] species: 5 conspecific: 33 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 179 missing trait values (82.5 %) after populating with input data.</span></code></pre>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_Nfineroot</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nfineroot"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; Nfineroot] species: 15 conspecific: 79 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 123 missing trait values (56.7 %) after populating with input data.</span></code></pre>
<p>The statistical distributions of the three parameters is summarized below:</p>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nleaf"</span>, <span class="st">"Nsapwood"</span> ,<span class="st">"Nfineroot"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      Nleaf           Nsapwood        Nfineroot     </span>
<span class="co">##  Min.   : 6.491   Min.   : 0.450   Min.   : 4.750  </span>
<span class="co">##  1st Qu.:13.994   1st Qu.: 1.435   1st Qu.: 9.736  </span>
<span class="co">##  Median :19.351   Median : 3.482   Median :12.131  </span>
<span class="co">##  Mean   :20.103   Mean   : 3.852   Mean   :12.334  </span>
<span class="co">##  3rd Qu.:24.034   3rd Qu.: 5.662   3rd Qu.:13.720  </span>
<span class="co">##  Max.   :50.900   Max.   :12.534   Max.   :25.860  </span>
<span class="co">##  NA's   :23       NA's   :179      NA's   :123</span></code></pre>
</div>
<div class="section level4">
<h4 id="wood-carbon-content">Wood carbon content<a class="anchor" aria-label="anchor" href="#wood-carbon-content"></a>
</h4>
<p>Stem carbon content per stem dry mass is given by TRY (TraitID = 407) and can be easily mapped, after transforming units from mg/g to g/g:</p>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TRY_WoodC</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>,<span class="st">"TraitDatabases/TRY/TRY_traits/TRY_407.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="va">TRY_WoodC</span><span class="op">[</span><span class="va">TRY_WoodC</span><span class="op">$</span><span class="va">ErrorRisk</span><span class="op">&lt;</span><span class="fl">3</span>,<span class="op">]</span>, 
                           trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WoodC"</span> <span class="op">=</span> <span class="st">"StdValue"</span><span class="op">)</span>,
                           scalar_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WoodC"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fl">1000</span><span class="op">}</span><span class="op">)</span>, 
                           taxon_column <span class="op">=</span> <span class="st">"AccSpeciesName"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [StdValue -&gt; WoodC] species: 25 conspecific: 61 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 131 missing trait values (60.4 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WoodC"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">##  0.4150  0.4749  0.4838  0.4851  0.5029  0.5233     131</span></code></pre>
</div>
<div class="section level4">
<h4 id="construction-costs">Construction costs<a class="anchor" aria-label="anchor" href="#construction-costs"></a>
</h4>
<p>Tissue construction costs are parsed from our own trait compilation from different sources:</p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">lcc_data</span><span class="op">)</span>, 
                            trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCleaf"</span> <span class="op">=</span> <span class="st">"CC (g glu g−1)"</span><span class="op">)</span>,
                            taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [CC (g glu g−1) -&gt; CCleaf] species: 50 conspecific: 67 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 100 missing trait values (46.1 %) after populating with input data.</span></code></pre>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">scc_data</span><span class="op">)</span>, 
                            trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCsapwood"</span> <span class="op">=</span> <span class="st">"CC (g glu g−1)"</span><span class="op">)</span>,
                            taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [CC (g glu g−1) -&gt; CCsapwood] species: 0 conspecific: 14 genus: 0 family: 0 order: 0 group: 0</span></code></pre>
<pre><code><span class="co">## 203 missing trait values (93.5 %) after populating with input data.</span></code></pre>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">SpParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/populateTraits.html" class="external-link">populateTraits</a></span><span class="op">(</span><span class="va">SpParams</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fcc_data</span><span class="op">)</span>, 
                            trait_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCfineroot"</span> <span class="op">=</span> <span class="st">"CC (g glu g−1)"</span><span class="op">)</span>,
                            taxon_column <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Mapping [CC (g glu g−1) -&gt; CCfineroot] species: 0 conspecific: 14 genus: 0 family: 0 order: 0 group: 0</span>
<span class="co">## 203 missing trait values (93.5 %) after populating with input data.</span></code></pre>
<p>The distribution of parameter values is:</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCleaf"</span>, <span class="st">"CCsapwood"</span>, <span class="st">"CCfineroot"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      CCleaf        CCsapwood       CCfineroot   </span>
<span class="co">##  Min.   :1.223   Min.   :1.370   Min.   :1.250  </span>
<span class="co">##  1st Qu.:1.478   1st Qu.:1.370   1st Qu.:1.250  </span>
<span class="co">##  Median :1.528   Median :1.470   Median :1.300  </span>
<span class="co">##  Mean   :1.553   Mean   :1.427   Mean   :1.279  </span>
<span class="co">##  3rd Qu.:1.601   3rd Qu.:1.470   3rd Qu.:1.300  </span>
<span class="co">##  Max.   :1.819   Max.   :1.470   Max.   :1.300  </span>
<span class="co">##  NA's   :100     NA's   :203     NA's   :203</span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="initialize-forest-plot-lists-for-spain">Initialize forest plot lists for Spain<a class="anchor" aria-label="anchor" href="#initialize-forest-plot-lists-for-spain"></a>
</h2>
<p>If we have a species parameter table with taxonomic information, growth forms and species maximum rooting depths (<code>Z95</code>), we are ready to create lists of <code>forest</code> objects from forest plot data. Here we will use function <code><a href="https://rdrr.io/pkg/medfateutils/man/IFN2forest.html" class="external-link">IFN2forestlist()</a></code> from package <strong>medfateutils</strong>, which has been designed to parse data from the Spanish National Forest Inventory. In section <em>Parameters drawn from IFN data</em> we loaded shrub and tree data from the three forest inventory surveys: IFN2, IFN3 and IFN4. Here we use this information to create forest lists:</p>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN2_forestlist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/IFN2forest.html" class="external-link">IFN2forestlist</a></span><span class="op">(</span><span class="va">treeDataIFN2</span>, <span class="va">shrubDataIFN2</span>, <span class="va">SpParams</span>, 
                                 setDefaults <span class="op">=</span> <span class="cn">TRUE</span>, filterWrongRecords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">IFN2_forestlist</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN2/Rdata/forestlist_IFN2_Spain.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Some of the shrub/tree records may not be parsed if they have not been included in the species definition of <code>SpParams</code>. The number of plots parsed is:</p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">IFN2_forestlist</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 84375</span></code></pre>
<p>And here is the first element as an example:</p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN2_forestlist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## $ID</span>
<span class="co">## [1] "100001"</span>
<span class="co">## </span>
<span class="co">## $patchsize</span>
<span class="co">## [1] 10000</span>
<span class="co">## </span>
<span class="co">## $treeData</span>
<span class="co">## [1] Species N       DBH     Height  Z50     Z95     OIF2   </span>
<span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span>
<span class="co">## </span>
<span class="co">## $shrubData</span>
<span class="co">##   Species Cover Height       Z50  Z95</span>
<span class="co">## 1      83    18     50 346.14164 2000</span>
<span class="co">## 2      40    18     50  47.19721  150</span>
<span class="co">## </span>
<span class="co">## $herbCover</span>
<span class="co">## [1] NA</span>
<span class="co">## </span>
<span class="co">## $herbHeight</span>
<span class="co">## [1] NA</span>
<span class="co">## </span>
<span class="co">## attr(,"class")</span>
<span class="co">## [1] "forest" "list"</span></code></pre>
<p>We can repeat the same operation for IFN3:</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN3_forestlist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/IFN2forest.html" class="external-link">IFN2forestlist</a></span><span class="op">(</span><span class="va">treeDataIFN3</span>, <span class="va">shrubDataIFN3</span>, <span class="va">SpParams</span>, 
                                 setDefaults <span class="op">=</span> <span class="cn">TRUE</span>, filterWrongRecords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">IFN3_forestlist</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/forestlist_IFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Again, some of the shrub/tree records may not be parsed if they have not been included in the species definition of <code>SpParams</code>. The number of plots parsed is now:</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">IFN3_forestlist</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 85858</span></code></pre>
<p>Finally, we repeat the operation for IFN4:</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IFN4_forestlist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/IFN2forest.html" class="external-link">IFN2forestlist</a></span><span class="op">(</span><span class="va">treeDataIFN4</span>, <span class="va">shrubDataIFN4</span>, <span class="va">SpParams</span>, 
                                 setDefaults <span class="op">=</span> <span class="cn">TRUE</span>, filterWrongRecords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">IFN4_forestlist</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN4/Rdata/forestlist_IFN4_Spain.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The number of plots parsed is lower than the previous two, as IFN4 is not yet completed for all Spanish provinces:</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">IFN4_forestlist</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 43050</span></code></pre>
</div>
<div class="section level2">
<h2 id="recruitment-parameters">Recruitment parameters<a class="anchor" aria-label="anchor" href="#recruitment-parameters"></a>
</h2>
<p>This section describes the parametrization of bioclimatic recruitment thresholds for the forest dynamics model <code><a href="../../reference/fordyn.html">fordyn()</a></code> included in <code>medfate</code>. Specifically, we aim to find suitable values for parameters:</p>
<ul>
<li>
<code>MinTempRecr</code>: Minimum average temperature of the coldest month necessary for recruiting.</li>
<li>
<code>MinMoistureRecr</code>: Minimum moisture index (annual precipitation over annual ETP) necessary for recruiting.</li>
<li>
<code>MinFPARRecr</code>: Minimum fraction of PAR (in %) reaching the ground necessary for recruiting.</li>
</ul>
<p>To find suitable values for these parameters that set the recruitment requirements we will first determine bioclimatic and light conditions in IFN3 plots and then we will calculate the 1% quantile from the observed distribution of each target species.</p>
<div class="section level3">
<h3 id="bioclimatic-and-ground-par-conditions-of-ifn3-plots">Bioclimatic and ground PAR conditions of IFN3 plots<a class="anchor" aria-label="anchor" href="#bioclimatic-and-ground-par-conditions-of-ifn3-plots"></a>
</h3>
<div class="section level4">
<h4 id="mean-temperature-of-the-coldest-month-and-moisture-index">Mean temperature of the coldest month and moisture index<a class="anchor" aria-label="anchor" href="#mean-temperature-of-the-coldest-month-and-moisture-index"></a>
</h4>
<p>Load yearly weather data (from Santander’s Group) between 1981 and 2015, for all IFN plots in Spain:</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pr_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"IFNbioclimatic/Sources/pr_year.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pet_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"IFNbioclimatic/Sources/pet_year.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmin_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DB_path</span>, <span class="st">"IFNbioclimatic/Sources/tmin_year.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>These are objects of class <code>SpatialPointsDataFrame</code>:</p>
<ul>
<li>
<code>tmin_year</code> contains the mean temperature of the coldest month for each year and plot.</li>
<li>
<code>pr_year</code> contains the annual precipitation for each year and plot.</li>
<li>
<code>pet_year</code> contains the annual potential evapotranspiration for each year and plot.</li>
</ul>
<p>We calculate interannual means for tmin and the annual moisture index, for the period 1995-2005 that includes IFN3 (around 2000):</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yearStrings</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1995-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2005-01-01"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"year"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pet_year</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">pet_year</span><span class="op">@</span><span class="va">data</span><span class="op">&lt;</span><span class="fl">100</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">ppet_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">pr_year</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>,<span class="va">yearStrings</span><span class="op">]</span><span class="op">/</span><span class="va">pet_year</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>,<span class="va">yearStrings</span><span class="op">]</span>, 
                      na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">tmin_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">tmin_year</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>,<span class="va">yearStrings</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bioclimIFN34</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ppet_mean</span>, <span class="va">tmin_mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bioclimIFN34</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    ppet_mean        tmin_mean     </span>
<span class="co">##  Min.   :0.1542   Min.   :-6.640  </span>
<span class="co">##  1st Qu.:0.4582   1st Qu.: 2.627  </span>
<span class="co">##  Median :0.6109   Median : 4.463  </span>
<span class="co">##  Mean   :0.8033   Mean   :   Inf  </span>
<span class="co">##  3rd Qu.:1.0027   3rd Qu.: 6.904  </span>
<span class="co">##  Max.   :8.0428   Max.   :   Inf  </span>
<span class="co">##  NA's   :282</span></code></pre>
</div>
<div class="section level4">
<h4 id="percentage-of-par-reaching-the-ground">Percentage of PAR reaching the ground<a class="anchor" aria-label="anchor" href="#percentage-of-par-reaching-the-ground"></a>
</h4>
<p>To calculate the percentage of PAR reaching the ground we need forest plot data as well as suitable parameters for leaf area estimation and light extinction. Hence, this part of the parameterization process requires other parameters to be estimated first. In addition, we will make use of <strong>medfate</strong> functions to estimate PAR extinction, which require <code>forest</code> objects. Hence we need forest inventory data in the form of a list of <code>forest</code> objects (see function <code>IFN2forestlist</code> from package <strong>medfateutils</strong>). Assuming we have converted IFN3 data into this form, we load the list of <code>forest</code> objects corresponding to IFN3 plots in Spain:</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/forestlist_IFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We then calculate percentage of PAR reaching the ground using <code>medfate</code> function <code><a href="../../reference/VerticalProfiles.html">vprofile_PARExtinction()</a></code>:</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_groundIFN3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">forest_list</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_groundIFN3</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">forest_list</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">forest_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">f</span> <span class="op">=</span> <span class="va">forest_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">f</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">f</span><span class="op">$</span><span class="va">shrubData</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># remove small trees and shrubs</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">f</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="va">f</span><span class="op">$</span><span class="va">treeData</span> <span class="op">=</span> <span class="va">f</span><span class="op">$</span><span class="va">treeData</span><span class="op">[</span><span class="va">f</span><span class="op">$</span><span class="va">treeData</span><span class="op">$</span><span class="va">DBH</span><span class="op">&gt;</span><span class="fl">5</span>,, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">f</span><span class="op">$</span><span class="va">shrubData</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="va">f</span><span class="op">$</span><span class="va">shrubData</span> <span class="op">=</span> <span class="va">f</span><span class="op">$</span><span class="va">shrubData</span><span class="op">[</span><span class="va">f</span><span class="op">$</span><span class="va">shrubData</span><span class="op">$</span><span class="va">Height</span><span class="op">&gt;</span><span class="fl">50</span>,, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
    <span class="va">par_groundIFN3</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../../reference/light.html">light_PARground</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">SpParams</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">par_groundIFN3</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">100</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Some plots could have missing <code>par_groundIFN3</code> values, which could be the result of missing parameter values in <code>SpParams</code>:</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">par_groundIFN3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## FALSE </span>
<span class="co">## 85858</span></code></pre>
<p>Subset plots with PAR data:</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_groundIFN3</span> <span class="op">&lt;-</span> <span class="va">par_groundIFN3</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">par_groundIFN3</span><span class="op">)</span><span class="op">]</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="subset-of-plots-with-available-information">Subset of plots with available information<a class="anchor" aria-label="anchor" href="#subset-of-plots-with-available-information"></a>
</h4>
<p>Define vectors of plot IDs for which there is information about bioclimatic and light conditions:</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotBioclim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">bioclimIFN34</span><span class="op">)</span>
<span class="va">plotPAR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_groundIFN3</span><span class="op">)</span></code></pre></div>
<p>Since we took Spain for bioclimatic limits, there are n = 81152 plots with bioclimatic information and n = 85858 plots with PAR information.</p>
</div>
</div>
<div class="section level3">
<h3 id="characterizing-distribution-of-bioclimatic-variables-for-ifn-species">Characterizing distribution of bioclimatic variables for IFN species<a class="anchor" aria-label="anchor" href="#characterizing-distribution-of-bioclimatic-variables-for-ifn-species"></a>
</h3>
<div class="section level4">
<h4 id="load-and-filter-ifn3-data">Load and filter IFN3 data<a class="anchor" aria-label="anchor" href="#load-and-filter-ifn3-data"></a>
</h4>
<p>We begin by loading IFN3 data tables (regeneration data, tree data and shrub data):</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/regDataIFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tree</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/treeDataIFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">shrub</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Products/IFN3/Rdata/shrubDataIFN3_Spain.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We filter the three datasets according to available plot bioclimatic information:</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regFiltBioclim</span> <span class="op">&lt;-</span> <span class="va">reg</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">plotBioclim</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</span></code></pre>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treeFiltBioclim</span> <span class="op">&lt;-</span> <span class="va">tree</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">plotBioclim</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">shrubFiltBioclim</span> <span class="op">&lt;-</span> <span class="va">shrub</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">plotBioclim</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>We do the same for PAR information:</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regFiltPAR</span> <span class="op">&lt;-</span> <span class="va">reg</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">plotPAR</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</span></code></pre>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treeFiltPAR</span> <span class="op">&lt;-</span> <span class="va">tree</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">plotPAR</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">shrubFiltPAR</span> <span class="op">&lt;-</span> <span class="va">shrub</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">plotPAR</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="target-species">Target species<a class="anchor" aria-label="anchor" href="#target-species"></a>
</h4>
<p>Determine the IFN species to be characterized, by finding unique species codes:</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spUnique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">regFiltBioclim</span><span class="op">$</span><span class="va">Species</span>, 
                          <span class="va">treeFiltBioclim</span><span class="op">$</span><span class="va">Species</span>, 
                          <span class="va">shrubFiltBioclim</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>There are 338 species to be characterized. Note that we used the full set of IFN species codes and not the entities in <code>SpParams</code>. This is because we want to characterize the bioclimatic limits of the original species.</p>
<p>Translate IFN species codes to medfate species codes (some species are considered together in <code>medfate</code>):</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Species_medfate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/medfateutils/man/translateIFNSpeciesCodes.html" class="external-link">translateIFNSpeciesCodes</a></span><span class="op">(</span><span class="va">spUnique</span>, <span class="va">SpParams</span><span class="op">$</span><span class="va">IFNcodes</span><span class="op">)</span></code></pre></div>
<p>Some IFN species do not have counterparts in <code>SpParams</code>, as these were discarded when defining the set of target species:</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Species_medfate</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## FALSE  TRUE </span>
<span class="co">##   311    27</span></code></pre>
</div>
<div class="section level4">
<h4 id="quantile-tables">Quantile tables<a class="anchor" aria-label="anchor" href="#quantile-tables"></a>
</h4>
<p>Define quantile probabilities (1%, 5% and 10%):</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">probs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p>We now create quantile output tables, including a column <code>n</code> with the number of plots on which quantiles are based:</p>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_ppet</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="va">spUnique</span>, 
                   Species_medfate <span class="op">=</span> <span class="va">Species_medfate</span>,
                   q1 <span class="op">=</span> <span class="cn">NA</span>,
                   q5 <span class="op">=</span> <span class="cn">NA</span>, 
                   q10 <span class="op">=</span> <span class="cn">NA</span>,
                   n <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
<span class="va">q_tmin</span><span class="op">&lt;-</span><span class="va">q_ppet</span>
<span class="va">q_par</span> <span class="op">&lt;-</span> <span class="va">q_ppet</span></code></pre></div>
<p>We fill quantile output for minimum temperature and moisture index. This is done by finding (for each species), the set of plots where the species is present (either as adult, regeneration or shrub) and subseting the bioclimatic information corresponding to this set of plots. Quantiles are estimated from this set, as long as it contains more than 1 plot. The number of plots in the set is also stored:</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spUnique</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sp</span> <span class="op">=</span> <span class="va">spUnique</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">ids_reg_bioclim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">regFiltBioclim</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">regFiltBioclim</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="va">sp</span><span class="op">]</span><span class="op">)</span>
  <span class="va">ids_tree_bioclim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">treeFiltBioclim</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">treeFiltBioclim</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="va">sp</span><span class="op">]</span><span class="op">)</span>
  <span class="va">ids_shrub_bioclim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">shrubFiltBioclim</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">shrubFiltBioclim</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="va">sp</span><span class="op">]</span><span class="op">)</span>
  <span class="va">ids_bioclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ids_reg_bioclim</span>, <span class="va">ids_tree_bioclim</span>, <span class="va">ids_shrub_bioclim</span><span class="op">)</span><span class="op">)</span>
  <span class="va">q_ppet</span><span class="op">[</span><span class="va">i</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids_bioclim</span><span class="op">)</span>
  <span class="va">q_tmin</span><span class="op">[</span><span class="va">i</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids_bioclim</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids_bioclim</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">q_ppet</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bioclimIFN34</span><span class="op">[</span><span class="va">ids_bioclim</span>,<span class="st">"ppet_mean"</span><span class="op">]</span>,
                             probs<span class="op">=</span><span class="va">probs</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
    <span class="va">q_tmin</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bioclimIFN34</span><span class="op">[</span><span class="va">ids_bioclim</span>,<span class="st">"tmin_mean"</span><span class="op">]</span>,
                             probs<span class="op">=</span><span class="va">probs</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>The resulting quantile tables are for the temperature of the coldest month:</p>
<pre><code><span class="co">##   Species Species_medfate         q1         q5       q10    n</span>
<span class="co">## 1       1             106  1.4859176  1.6347199 1.8207229    3</span>
<span class="co">## 2       2              12 -1.7164300 -0.2871439 0.4430538 2846</span>
<span class="co">## 3       3              99  1.0733223  3.2005803 4.0815555 1739</span>
<span class="co">## 4       4             177  1.2757050  2.3571927 2.9337636 4339</span>
<span class="co">## 5       5              95  0.4207751  1.6887391 2.0408622   54</span>
<span class="co">## 6       6             132  5.2591580  6.4921866 7.2949333  691</span></code></pre>
<p>and for the moisture index:</p>
<pre><code><span class="co">##   Species Species_medfate        q1        q5       q10    n</span>
<span class="co">## 1       1             106 0.6710153 0.6869529 0.7068749    3</span>
<span class="co">## 2       2              12 0.3960533 0.4702111 0.5096829 2846</span>
<span class="co">## 3       3              99 0.5798634 0.8478652 0.9555154 1739</span>
<span class="co">## 4       4             177 0.2737405 0.3277678 0.3625350 4339</span>
<span class="co">## 5       5              95 0.4252543 0.5574783 0.5911608   54</span>
<span class="co">## 6       6             132 0.3132141 0.4302611 0.4747681  691</span></code></pre>
<p>We now fill quantile output for PAR limits in a similar way. Here we focus on regeneration and shrub data tables only, because the adults in the plot may have recruited long ago, when light conditions in the ground where quite different:</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spUnique</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sp</span> <span class="op">=</span> <span class="va">spUnique</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">ids_reg_par</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">regFiltPAR</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">regFiltPAR</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="va">sp</span><span class="op">]</span><span class="op">)</span>
  <span class="va">ids_shrub_par</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">shrubFiltPAR</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">shrubFiltPAR</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="va">sp</span><span class="op">]</span><span class="op">)</span>
  <span class="va">ids_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ids_reg_par</span>, <span class="va">ids_shrub_par</span><span class="op">)</span><span class="op">)</span>
  <span class="va">q_par</span><span class="op">[</span><span class="va">i</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids_par</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids_par</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">q_par</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">par_groundIFN3</span><span class="op">[</span><span class="va">ids_par</span><span class="op">]</span>, probs<span class="op">=</span><span class="va">probs</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>The resulting quantile table is:</p>
<pre><code><span class="co">##   Species Species_medfate         q1        q5        q10    n</span>
<span class="co">## 1       1             106 0.30678651 0.4687634  0.6712345    8</span>
<span class="co">## 2       2              12 4.02817802 9.4184453 14.7129241 3785</span>
<span class="co">## 3       3              99 0.08862862 0.6803608  1.4192495 2079</span>
<span class="co">## 4       4             177 1.18292143 5.4948951  9.5757817 5681</span>
<span class="co">## 5       5              95 0.38357872 0.6858321  1.3319851   95</span>
<span class="co">## 6       6             132 2.42395201 8.5078167 12.2133510  707</span></code></pre>
<p>Store quantile tables:</p>
</div>
</div>
<div class="section level3">
<h3 id="fill-medfate-parameters">Fill medfate parameters<a class="anchor" aria-label="anchor" href="#fill-medfate-parameters"></a>
</h3>
<p>For each species in medfate we find the corresponding IFN species in the quantile tables. If the relationship is univocal, 1% quantile value of the IFN species is stored. If there are more than one IFN species for the target medfate species, we keep the weighted average of 1% quantile values, using the number of plots as weights.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">SPtarget</span> <span class="op">=</span> <span class="va">SpParams</span><span class="op">$</span><span class="va">SpIndex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="co">#MinFPARRecr</span>
  <span class="va">r_sel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">q_par</span><span class="op">$</span><span class="va">Species_medfate</span><span class="op">==</span><span class="va">SPtarget</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_sel</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">SpParams</span><span class="op">$</span><span class="va">MinFPARRecr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">q_par</span><span class="op">$</span><span class="va">q1</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_sel</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">n</span> <span class="op">=</span> <span class="va">q_par</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
    <span class="va">q1</span> <span class="op">=</span> <span class="va">q_par</span><span class="op">$</span><span class="va">q1</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
    <span class="va">q1</span> <span class="op">=</span> <span class="va">q1</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>
    <span class="va">n</span> <span class="op">=</span> <span class="va">n</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>
    <span class="va">SpParams</span><span class="op">$</span><span class="va">MinFPARRecr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">q1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="co">#MinTempRecr</span>
  <span class="va">r_sel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">q_tmin</span><span class="op">$</span><span class="va">Species_medfate</span><span class="op">==</span><span class="va">SPtarget</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_sel</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">SpParams</span><span class="op">$</span><span class="va">MinTempRecr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">q_tmin</span><span class="op">$</span><span class="va">q1</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_sel</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">n</span> <span class="op">=</span> <span class="va">q_tmin</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
    <span class="va">q1</span> <span class="op">=</span> <span class="va">q_tmin</span><span class="op">$</span><span class="va">q1</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
    <span class="va">SpParams</span><span class="op">$</span><span class="va">MinTempRecr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">q1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="co">#MinMoistureRecr</span>
  <span class="va">r_sel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">q_ppet</span><span class="op">$</span><span class="va">Species_medfate</span><span class="op">==</span><span class="va">SPtarget</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_sel</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">SpParams</span><span class="op">$</span><span class="va">MinMoistureRecr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">q_ppet</span><span class="op">$</span><span class="va">q1</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_sel</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">n</span> <span class="op">=</span> <span class="va">q_ppet</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
    <span class="va">q1</span> <span class="op">=</span> <span class="va">q_ppet</span><span class="op">$</span><span class="va">q1</span><span class="op">[</span><span class="va">r_sel</span><span class="op">]</span>
    <span class="va">q1</span> <span class="op">=</span> <span class="va">q1</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">q1</span><span class="op">)</span><span class="op">]</span>
    <span class="va">n</span> <span class="op">=</span> <span class="va">n</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">q1</span><span class="op">)</span><span class="op">]</span>
    <span class="va">SpParams</span><span class="op">$</span><span class="va">MinMoistureRecr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">q1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<pre><code><span class="co">## Warning in n * q1: longer object length is not a multiple of shorter object</span>
<span class="co">## length</span>

<span class="co">## Warning in n * q1: longer object length is not a multiple of shorter object</span>
<span class="co">## length</span>

<span class="co">## Warning in n * q1: longer object length is not a multiple of shorter object</span>
<span class="co">## length</span>

<span class="co">## Warning in n * q1: longer object length is not a multiple of shorter object</span>
<span class="co">## length</span>

<span class="co">## Warning in n * q1: longer object length is not a multiple of shorter object</span>
<span class="co">## length</span>

<span class="co">## Warning in n * q1: longer object length is not a multiple of shorter object</span>
<span class="co">## length</span></code></pre>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SpParams</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MinFPARRecr"</span>,<span class="st">"MinTempRecr"</span>,<span class="st">"MinMoistureRecr"</span><span class="op">)</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   MinFPARRecr      MinTempRecr      MinMoistureRecr </span>
<span class="co">##  Min.   : 0.000   Min.   :-5.5634   Min.   :0.1790  </span>
<span class="co">##  1st Qu.: 0.260   1st Qu.:-0.4701   1st Qu.:0.2816  </span>
<span class="co">##  Median : 1.223   Median : 0.7369   Median :0.3545  </span>
<span class="co">##  Mean   : 3.374   Mean   : 1.1311   Mean   :0.3920  </span>
<span class="co">##  3rd Qu.: 4.412   3rd Qu.: 2.4577   3rd Qu.:0.4686  </span>
<span class="co">##  Max.   :45.636   Max.   : 9.9475   Max.   :1.0951  </span>
<span class="co">##  NA's   :42       NA's   :44        NA's   :44</span></code></pre>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Asse2020" class="csl-entry">
Asse, Daphné, Christophe F. Randin, Marc Bonhomme, Anne Delestrade, and Isabelle Chuine. 2020. <span>“<span class="nocase">Process-based models outcompete correlative models in projecting spring phenology of trees in a future warmer climate</span>.”</span> <em>Agricultural and Forest Meteorology</em> 285-286 (January): 107931. <a href="https://doi.org/10.1016/j.agrformet.2020.107931" class="external-link">https://doi.org/10.1016/j.agrformet.2020.107931</a>.
</div>
<div id="ref-Bartlett2012" class="csl-entry">
Bartlett, Megan K, Christine Scoffoni, and Lawren Sack. 2012. <span>“<span class="nocase">The determinants of leaf turgor loss point and prediction of drought tolerance of species and biomes: a global meta-analysis</span>.”</span> <em>Ecology Letters</em> 15 (5): 393–405. <a href="https://doi.org/10.1111/j.1461-0248.2012.01751.x" class="external-link">https://doi.org/10.1111/j.1461-0248.2012.01751.x</a>.
</div>
<div id="ref-Choat2012" class="csl-entry">
Choat, Brendan, Steven Jansen, Tim J Brodribb, Hervé Cochard, Sylvain Delzon, Radika Bhaskar, Sandra J Bucci, et al. 2012. <span>“<span class="nocase">Global convergence in the vulnerability of forests to drought</span>.”</span> <em>Nature</em> 491 (7426): 752–55. <a href="https://doi.org/10.1038/nature11688" class="external-link">https://doi.org/10.1038/nature11688</a>.
</div>
<div id="ref-Delpierre2009" class="csl-entry">
Delpierre, N., E. Dufrêne, K. Soudani, E. Ulrich, S. Cecchini, J. Boé, and C. François. 2009. <span>“<span class="nocase">Modelling interannual and spatial variability of leaf senescence for three deciduous tree species in France</span>.”</span> <em>Agricultural and Forest Meteorology</em> 149 (6-7): 938–48. <a href="https://doi.org/10.1016/j.agrformet.2008.11.014" class="external-link">https://doi.org/10.1016/j.agrformet.2008.11.014</a>.
</div>
<div id="ref-Duursma2018" class="csl-entry">
Duursma, Remko A., Christopher J. Blackman, Rosana Lopéz, Nicolas K. Martin-StPaul, Hervé Cochard, and Belinda E. Medlyn. 2018. <span>“<span class="nocase">On the minimum leaf conductance: its role in models of plant water use, and ecological and environmental controls</span>.”</span> <em>New Phytologist</em>, no. September. <a href="https://doi.org/10.1111/nph.15395" class="external-link">https://doi.org/10.1111/nph.15395</a>.
</div>
<div id="ref-Hoshika2018" class="csl-entry">
Hoshika, Yasutomo, Yutaka Osada, Alessandra de Marco, Josep Peñuelas, and Elena Paoletti. 2018. <span>“<span class="nocase">Global diurnal and nocturnal parameters of stomatal conductance in woody plants and major crops</span>.”</span> <em>Global Ecology and Biogeography</em> 27 (2): 257–75. <a href="https://doi.org/10.1111/geb.12681" class="external-link">https://doi.org/10.1111/geb.12681</a>.
</div>
<div id="ref-Kattge2011" class="csl-entry">
Kattge, J., S. Díaz, S. Lavorel, I. C. Prentice, P. Leadley, G. Bönisch, E. Garnier, et al. 2011. <span>“<span class="nocase">TRY - a global database of plant traits</span>.”</span> <em>Global Change Biology</em> 17 (9): 2905–35. <a href="https://doi.org/10.1111/j.1365-2486.2011.02451.x" class="external-link">https://doi.org/10.1111/j.1365-2486.2011.02451.x</a>.
</div>
<div id="ref-Manzoni2013" class="csl-entry">
Manzoni, Stefano, Giulia Vico, Amilcare Porporato, and Gabriel Katul. 2013. <span>“<span class="nocase">Biological constraints on water transport in the soil-plant-atmosphere system</span>.”</span> <em>Advances in Water Resources</em> 51: 292–304. <a href="https://doi.org/10.1016/j.advwatres.2012.03.016" class="external-link">https://doi.org/10.1016/j.advwatres.2012.03.016</a>.
</div>
<div id="ref-Martin-StPaul2017" class="csl-entry">
Martin-StPaul, Nicolas, Sylvain Delzon, and Hervé Cochard. 2017. <span>“<span class="nocase">Plant resistance to drought depends on timely stomatal closure</span>.”</span> <em>Ecology Letters</em> 20 (11): 1437–47. <a href="https://doi.org/10.1111/ele.12851" class="external-link">https://doi.org/10.1111/ele.12851</a>.
</div>
<div id="ref-Mencuccini2019" class="csl-entry">
Mencuccini, Maurizio, Teresa Rosas, Lucy Rowland, Brendan Choat, Hans Cornelissen, Steven Jansen, Koen Kramer, et al. 2019. <span>“<span class="nocase">Leaf economics and plant hydraulics drive leaf : wood area ratios</span>.”</span> <em>New Phytologist</em>. <a href="https://doi.org/10.1111/nph.15998" class="external-link">https://doi.org/10.1111/nph.15998</a>.
</div>
<div id="ref-Morris2016" class="csl-entry">
Morris, Hugh, Lenka Plavcová, Patrick Cvecko, Esther Fichtler, Mark A. F. Gillingham, Hugo I. Martínez-Cabrera, Daniel J. Mcglinn, et al. 2016. <span>“<span class="nocase">A global analysis of parenchyma tissue fractions in secondary xylem of seed plants</span>.”</span> <em>New Phytologist</em> 209 (4): 1553–65. <a href="https://doi.org/10.1111/nph.13737" class="external-link">https://doi.org/10.1111/nph.13737</a>.
</div>
<div id="ref-Pausas2016" class="csl-entry">
Pausas, Juli G., R. Brandon Pratt, Jon E. Keeley, Anna L. Jacobsen, Aaron R. Ramirez, Alberto Vilagrosa, Susana Paula, Iolana N. Kaneakua-Pia, and Stephen D. Davis. 2016. <span>“<span class="nocase">Towards understanding resprouting at the global scale</span>.”</span> <em>New Phytologist</em> 209 (3): 945–54. <a href="https://doi.org/10.1111/nph.13644" class="external-link">https://doi.org/10.1111/nph.13644</a>.
</div>
<div id="ref-SanchezMartinez2020" class="csl-entry">
Sanchez‐Martinez, Pablo, Jordi Martínez‐Vilalta, Kyle G. Dexter, Ricardo A. Segovia, and Maurizio Mencuccini. 2020. <span>“<span class="nocase">Adaptation and coordinated evolution of plant hydraulic traits</span>.”</span> Edited by Elsa Cleland. <em>Ecology Letters</em>, August, ele.13584. <a href="https://doi.org/10.1111/ele.13584" class="external-link">https://doi.org/10.1111/ele.13584</a>.
</div>
<div id="ref-Tavsanoglu2018" class="csl-entry">
Tavşanoǧlu, Çaǧatay, and Juli G. Pausas. 2018. <span>“<span class="nocase">A functional trait database for Mediterranean Basin plants</span>.”</span> <em>Scientific Data</em> 5: 1–18. <a href="https://doi.org/10.1038/sdata.2018.135" class="external-link">https://doi.org/10.1038/sdata.2018.135</a>.
</div>
<div id="ref-Vitasse2011" class="csl-entry">
Vitasse, Yann, Christophe François, Nicolas Delpierre, Eric Dufrêne, Antoine Kremer, Isabelle Chuine, and Sylvain Delzon. 2011. <span>“<span class="nocase">Assessing the effects of climate change on the phenology of European temperate trees</span>.”</span> <em>Agricultural and Forest Meteorology</em> 151 (7): 969–80. <a href="https://doi.org/10.1016/j.agrformet.2011.03.003" class="external-link">https://doi.org/10.1016/j.agrformet.2011.03.003</a>.
</div>
<div id="ref-Yebra2019" class="csl-entry">
Yebra, Marta, Gianluca Scortechini, Abdulbaset Badi, María Eugenia Beget, Matthias M. Boer, Ross Bradstock, Emilio Chuvieco, et al. 2019. <span>“<span class="nocase">Globe-LFMC, a global plant water status database for vegetation ecophysiology and wildfire applications</span>.”</span> <em>Scientific Data</em> 6 (1): 155. <a href="https://doi.org/10.1038/s41597-019-0164-9" class="external-link">https://doi.org/10.1038/s41597-019-0164-9</a>.
</div>
<div id="ref-Zanne2009" class="csl-entry">
Zanne, A. E., G. Lopez-Gonzalez, D. A. Coomes, J. Ilic, S. Jansen, S. L. Lewis, R. B. Miller, N. G. Swenson, M. C. Wiemann, and J. Chave. 2009. <span>“<span class="nocase">Global wood density database</span>.”</span> <a href="http://datadryad.org/handle/10255/dryad.235" class="external-link">http://datadryad.org/handle/10255/dryad.235</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Shengli Huang, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

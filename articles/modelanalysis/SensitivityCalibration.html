<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sensitivity analysis and calibration • medfate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Sensitivity analysis and calibration">
<meta property="og:description" content="medfate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/medfate/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sensitivity analysis and calibration</h1>
                        <h4 data-toc-skip class="author">Miquel De
Caceres</h4>
            
            <h4 data-toc-skip class="date">2024-05-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/vignettes/modelanalysis/SensitivityCalibration.Rmd" class="external-link"><code>vignettes/modelanalysis/SensitivityCalibration.Rmd</code></a></small>
      <div class="hidden name"><code>SensitivityCalibration.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about-this-vignette">About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h2>
<p>The present document shows how to conduct a sensitivity analyses and
calibration exercises on the simulation models included in package
<code>medfate</code>. The document is written assuming that the user is
familiarized with the basic water balance model (i.e. function
<code>spwb</code>). The aim of the exercises presented here are:</p>
<ol style="list-style-type: decimal">
<li>To determine which <code><a href="../../reference/spwb.html">spwb()</a></code> model parameters are more
influential in determining stand transpiration and plant drought
stress.</li>
<li>To determine which model parameters are more influential to
determine model fit to soil water content dynamics.</li>
<li>To reduce the uncertainty in parameters determining fine root
distribution, given an observed data set of soil water content
dynamics.</li>
</ol>
<p>As an example data set we will use here the same data sets provided
to illustrate simulation functions in <strong>medfate</strong>. We begin
by loading the package and the example forest data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/medfate/" class="external-link">medfate</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package 'medfate' [ver. 4.3.2]</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleforest</span><span class="op">)</span></span>
<span><span class="va">exampleforest</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##            Species   N   DBH Height Z50  Z95</span></span>
<span><span class="co">## 1 Pinus halepensis 168 37.55    800 100  600</span></span>
<span><span class="co">## 2     Quercus ilex 384 14.60    660 300 1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##             Species Cover Height Z50  Z95</span></span>
<span><span class="co">## 1 Quercus coccifera  3.75     80 200 1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 20</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $seedBank</span></span>
<span><span class="co">## [1] Species Percent</span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>We also load the species parameter table and the example weather
dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="preparing-model-inputs">Preparing model inputs<a class="anchor" aria-label="anchor" href="#preparing-model-inputs"></a>
</h2>
<p>We will focus on three species/cohorts of the example data set:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PH_coh</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T1_"</span>, <span class="va">SpParamsMED</span><span class="op">$</span><span class="va">SpIndex</span><span class="op">[</span><span class="va">SpParamsMED</span><span class="op">$</span><span class="va">Name</span><span class="op">==</span><span class="st">"Pinus halepensis"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">QI_coh</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T2_"</span>, <span class="va">SpParamsMED</span><span class="op">$</span><span class="va">SpIndex</span><span class="op">[</span><span class="va">SpParamsMED</span><span class="op">$</span><span class="va">Name</span><span class="op">==</span><span class="st">"Quercus ilex"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">QC_coh</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"S1_"</span>, <span class="va">SpParamsMED</span><span class="op">$</span><span class="va">SpIndex</span><span class="op">[</span><span class="va">SpParamsMED</span><span class="op">$</span><span class="va">Name</span><span class="op">==</span><span class="st">"Quercus coccifera"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The data set consists of a forest with two tree species (<em>Pinus
halepensis</em>/T1_148 and <em>Quercus ilex</em>/T2_168) and one shrub
species (<em>Quercus coccifera</em>/S1_165 or Kermes oak).</p>
<p>We first define a soil with four layers (default values of texture,
bulk density and rock content) and the species input parameters for
simulation function <code><a href="../../reference/spwb.html">spwb()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examplesoil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modelInput.html">spwbInput</a></span><span class="op">(</span><span class="va">exampleforest</span>,<span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, control <span class="op">=</span> <span class="fu"><a href="../../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Although it is not necessary, we make an initial call to the model
(<code><a href="../../reference/spwb.html">spwb()</a></code>) with the default parameter settings:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S1</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package 'meteoland' [ver. 2.2.1]</span></span></code></pre>
<pre><code><span><span class="co">## Initial plant water content (mm): 7.05859</span></span>
<span><span class="co">## Initial soil water content (mm): 290.875</span></span>
<span><span class="co">## Initial snowpack content (mm): 0</span></span>
<span><span class="co">## Performing daily simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  [Year 2001]:....................................</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Final plant water content (mm): 7.05925</span></span>
<span><span class="co">## Final soil water content (mm): 350.456</span></span>
<span><span class="co">## Final snowpack content (mm): 0</span></span>
<span><span class="co">## Change in plant water content (mm): 0.000654694</span></span>
<span><span class="co">## Plant water balance result (mm): 0.000654694</span></span>
<span><span class="co">## Change in soil water content (mm): 59.5809</span></span>
<span><span class="co">## Soil water balance result (mm): 59.5809</span></span>
<span><span class="co">## Change in snowpack water content (mm): 0</span></span>
<span><span class="co">## Snowpack water balance result (mm): -7.10543e-15</span></span>
<span><span class="co">## Water balance components:</span></span>
<span><span class="co">##   Precipitation (mm) 513 Rain (mm) 462 Snow (mm) 51</span></span>
<span><span class="co">##   Interception (mm) 92 Net rainfall (mm) 370</span></span>
<span><span class="co">##   Infiltration (mm) 391 Infiltration excess (mm) 30 Saturation excess (mm) 0 Capillarity rise (mm) 2</span></span>
<span><span class="co">##   Soil evaporation (mm) 11  Herbaceous transpiration (mm) 14 Woody plant transpiration (mm) 187</span></span>
<span><span class="co">##   Plant extraction from soil (mm) 187  Plant water balance (mm) 0 Hydraulic redistribution (mm) 2</span></span>
<span><span class="co">##   Runoff (mm) 30 Deep drainage (mm) 122</span></span></code></pre>
<p>Function <code><a href="../../reference/spwb.html">spwb()</a></code> will be implicitly called multiple times
in the sensitivity analyses and calibration analyses that we will
illustrate below.</p>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">Sensitivity analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<div class="section level3">
<h3 id="introduction-and-input-factors">Introduction and input factors<a class="anchor" aria-label="anchor" href="#introduction-and-input-factors"></a>
</h3>
<p>Model sensitivity analyses are used to investigate how variation in
the output of a numerical model can be attributed to variations of its
<em>input factors</em>. Input factors are elements that can be changed
before model execution and may affect its output. They can be model
parameters, initial values of state variables, boundary conditions or
the input forcing data (Pianosi et al. 2016).</p>
<p>According to Saltelli et al. (2016), there are three main purposes of
sensitivity analyses:</p>
<ul>
<li>
<em>Ranking</em> aims at generating the ranking of the input factors
according to their relative contribution to the output variability.</li>
<li>
<em>Screening</em> aims at identifying the input factors, if any,
which have a negligible influence on the output variability.</li>
<li>
<em>Mapping</em> aims at determining the region of the input
variability space that produces significant output values.</li>
</ul>
<p>Here we will mostly interested in ranking parameters according to
different objectives. We will take as input factors three plant traits
(leaf area index, fine root distribution and the water potential
corresponding to a reduction in plant conductance) in the three plant
cohorts (species), and two soil factors (the rock fragment content of
soil layer 1 and 2). In total, eleven model parameters will be studied.
The following shows the initial values for plant trait parameters:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span><span class="op">$</span><span class="va">above</span><span class="op">$</span><span class="va">LAI_live</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.84874773 0.70557382 0.03062604</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span><span class="op">$</span><span class="va">below</span><span class="op">$</span><span class="va">Z50</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100 300 200</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span><span class="op">$</span><span class="va">paramsTransp</span><span class="op">$</span><span class="va">Psi_Extract</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.8507809 -1.6598896 -2.1210726</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x1</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">rfc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 25 45</span></span></code></pre>
<p>In the following code we define a vector of parameter names (using
naming rules of function <code><a href="../../reference/modifyParams.html">modifyInputParams()</a></code>) as well as
the input variability space, defined by the minimum and maximum
parameter values:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Parameter names of interest</span></span>
<span><span class="va">parNames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PH_coh</span>,<span class="st">"/LAI_live"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QI_coh</span>,<span class="st">"/LAI_live"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QC_coh</span>,<span class="st">"/LAI_live"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PH_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QI_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QC_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PH_coh</span>,<span class="st">"/Psi_Extract"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QI_coh</span>,<span class="st">"/Psi_Extract"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QC_coh</span>,<span class="st">"/Psi_Extract"</span><span class="op">)</span>,</span>
<span>             <span class="st">"rfc@1"</span>, <span class="st">"rfc@2"</span><span class="op">)</span></span>
<span><span class="va">parNames</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "T1_148/LAI_live"    "T2_168/LAI_live"    "S1_165/LAI_live"   </span></span>
<span><span class="co">##  [4] "T1_148/Z50"         "T2_168/Z50"         "S1_165/Z50"        </span></span>
<span><span class="co">##  [7] "T1_148/Psi_Extract" "T2_168/Psi_Extract" "S1_165/Psi_Extract"</span></span>
<span><span class="co">## [10] "rfc@1"              "rfc@2"</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Parameter minimum and maximum values</span></span>
<span><span class="va">parMin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,</span>
<span>           <span class="fl">100</span>,<span class="fl">100</span>,<span class="fl">50</span>,</span>
<span>           <span class="op">-</span><span class="fl">5</span>,<span class="op">-</span><span class="fl">5</span>,<span class="op">-</span><span class="fl">5</span>,</span>
<span>           <span class="fl">25</span>,<span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">parMax</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,</span>
<span>           <span class="fl">500</span>,<span class="fl">500</span>,<span class="fl">300</span>,</span>
<span>           <span class="op">-</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span>,</span>
<span>           <span class="fl">75</span>,<span class="fl">75</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-output-functions">Model output functions<a class="anchor" aria-label="anchor" href="#model-output-functions"></a>
</h3>
<p>In sensitivity analyses, model output is summarized into a single
variable whose variation is to be analyzed. Pianosi et al. (2016)
distinguish two types of model output functions:</p>
<ul>
<li>
<em>objective functions</em> (also called loss or cost functions),
which are measures of model performance calculated by comparison of
modelled and observed variables.</li>
<li>
<em>prediction functions</em>, which are scalar values that are
provided to the model-user for their practical use, and that can be
computed even in the absence of observations.</li>
</ul>
<p>Here we will use examples of both kinds. First, we define a function
that, given a simulation result, calculates total transpiration (mm)
over the simulated period (one year):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf_transp</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">$</span><span class="va">Transpiration</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">sf_transp</span><span class="op">(</span><span class="va">S1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 186.8537</span></span></code></pre>
<p>Another prediction function can focus on plant drought stress. We
define a function that, given a simulation result, calculates the
average drought stress of plants (measured using the water stress index)
over the simulated period:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf_stress</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lai</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">spwbInput</span><span class="op">$</span><span class="va">above</span><span class="op">$</span><span class="va">LAI_live</span></span>
<span>  <span class="va">lai_p</span> <span class="op">&lt;-</span> <span class="va">lai</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lai</span><span class="op">)</span></span>
<span>  <span class="va">stress</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/droughtStress.html">droughtStress</a></span><span class="op">(</span><span class="va">x</span>, index<span class="op">=</span><span class="st">"WSI"</span>, draw <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">stress</span>,<span class="fl">2</span>, <span class="va">lai_p</span>, <span class="st">"*"</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">sf_stress</span><span class="op">(</span><span class="va">S1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2.261158</span></span></code></pre>
<p>Sensitivity analysis requires model output functions whose parameters
are the input factors to be studied. <span class="math display">\[\begin{equation}
y = g(\mathbf{x}) = g(x_1, x_2, \dots, x_n)
\end{equation}\]</span> where <span class="math inline">\(y\)</span> is
the output, <span class="math inline">\(g\)</span> is the output
function and <span class="math inline">\(\mathbf{x} = \{x_1, x_2, \dots,
x_n\}\)</span> is the vector of parameter input factors. Functions
<code>of_transp</code> and <code>of_stress</code> take simulation
results as input, not values of input factors. Instead, we need to
define functions that take soil and plant trait values as input, run the
soil plant water balance model and return the desired prediction or
performance statistic. These functions can be generated using the
function factory <code><a href="../../reference/optimization.html">optimization_function()</a></code>. The following
code defines one of such functions focusing on total transpiration:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of_transp</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/optimization.html">optimization_function</a></span><span class="op">(</span>parNames <span class="op">=</span> <span class="va">parNames</span>,</span>
<span>                                 x <span class="op">=</span> <span class="va">x1</span>,</span>
<span>                                 meteo <span class="op">=</span> <span class="va">examplemeteo</span>, </span>
<span>                                 latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                 summary_function <span class="op">=</span> <span class="va">sf_transp</span><span class="op">)</span></span></code></pre></div>
<p>Note that we provided all the data needed for simulations as input to
<code><a href="../../reference/optimization.html">optimization_function()</a></code>, as well as the names of the
parameters to study and the function <code>sf_transp</code>. The
resulting object <code>of_transp</code> is a function itself, which we
can call with parameter values (or sets of parameter values) as
input:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">of_transp</span><span class="op">(</span><span class="va">parMin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 38.88857</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">of_transp</span><span class="op">(</span><span class="va">parMax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 328.5823</span></span></code></pre>
<p>It is important to understand the steps that are done when we call
<code>of_transp()</code>:</p>
<ol style="list-style-type: decimal">
<li>The function <code>of_transp()</code> calls <code><a href="../../reference/spwb.html">spwb()</a></code>
using all the parameters specified in its construction (i.e. in the call
to the function factory), except for the input factors indicated in
<code>parNames</code>, which are specified as input at the time of
calling <code>of_transp()</code>.</li>
<li>The result of soil plant water balance is then passed to function
<code>sf_transp()</code> and the output of this last function is
returned as output of <code>of_transp()</code>.</li>
</ol>
<p>We can build a similar model output function, in this case focusing
on plant stress (note that the only difference in the call to the
factory is in the specification of <code>sf_stress</code> as summary
function, instead of <code>sf_transp</code>).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of_stress</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/optimization.html">optimization_function</a></span><span class="op">(</span>parNames <span class="op">=</span> <span class="va">parNames</span>,</span>
<span>                                 x <span class="op">=</span> <span class="va">x1</span>, </span>
<span>                                 meteo <span class="op">=</span> <span class="va">examplemeteo</span>, </span>
<span>                                 latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                 summary_function <span class="op">=</span> <span class="va">sf_stress</span><span class="op">)</span></span>
<span><span class="fu">of_stress</span><span class="op">(</span><span class="va">parMin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.187327</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">of_stress</span><span class="op">(</span><span class="va">parMax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 83.96911</span></span></code></pre>
<p>As mentioned above, another kind of output function can be the
evaluation of model performance. Here we will assume that performance in
terms of predictability of soil water content is desired; and use a data
set of ‘observed’ values (actually simulated values with gaussian error)
as reference:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleobs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">exampleobs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        dates       SWC       ETR   E_T1_148   E_T2_168 FMC_T1_148 FMC_T2_168</span></span>
<span><span class="co">## 1 2001-01-01 0.3226725 2.0878000 0.06767226 0.13037215   125.8863   93.07454</span></span>
<span><span class="co">## 2 2001-01-02 0.3075006 1.8600163 0.18000610 0.16555452   125.8842   93.07371</span></span>
<span><span class="co">## 3 2001-01-03 0.3084646 0.3046051 0.17749022 0.06893953   125.9102   93.08329</span></span>
<span><span class="co">## 4 2001-01-04 0.3296031 1.5591229 0.10159948 0.01531790   125.9053   93.08481</span></span>
<span><span class="co">## 5 2001-01-05 0.3242696 1.2159743 0.15278858 0.18279733   125.9459   93.09727</span></span>
<span><span class="co">## 6 2001-01-06 0.3564156 2.1784826 0.16661375 0.10051714   125.9148   93.08308</span></span>
<span><span class="co">##     BAI_T1_148 BAI_T2_168    DI_T1_148 DI_T2_168</span></span>
<span><span class="co">## 1 2.014482e-05          0 2.118615e-07         0</span></span>
<span><span class="co">## 2 1.198392e-09          0 3.763209e-11         0</span></span>
<span><span class="co">## 3 2.630563e-13          0 0.000000e+00         0</span></span>
<span><span class="co">## 4 2.697499e-11          0 7.446822e-13         0</span></span>
<span><span class="co">## 5 4.698752e-03          0 1.081387e-04         0</span></span>
<span><span class="co">## 6 1.995606e-03          0 3.292066e-05         0</span></span></code></pre>
<p>where soil water content dynamics is in column <code>SWC</code>. The
model fit to observed data can be measured using the Nash-Sutcliffe
coefficient, which we calculate for the initial run using function
<code><a href="../../reference/evaluation.html">evaluation_metric()</a></code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_metric</a></span><span class="op">(</span><span class="va">S1</span>, measuredData <span class="op">=</span> <span class="va">exampleobs</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, </span>
<span>                  metric <span class="op">=</span> <span class="st">"NSE"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.9113681</span></span></code></pre>
<p>A call to <code><a href="../../reference/evaluation.html">evaluation_metric()</a></code> provides the coefficient
given a model simulation result, but is not a model output function as
we defined above. Analogously to the measures of total transpiration and
average plant stress, we can use a function factory to define a model
output function that takes input factors as inputs, runs the model and
performs the evaluation:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of_eval</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/optimization.html">optimization_evaluation_function</a></span><span class="op">(</span>parNames <span class="op">=</span> <span class="va">parNames</span>,</span>
<span>                x <span class="op">=</span> <span class="va">x1</span>,</span>
<span>                meteo <span class="op">=</span> <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                measuredData <span class="op">=</span> <span class="va">exampleobs</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, </span>
<span>                metric <span class="op">=</span> <span class="st">"NSE"</span><span class="op">)</span></span></code></pre></div>
<p>Function <code>of_eval()</code> stores internally both the data
needed for conducting simulations and the data needed for evaluating
simulation results, so that we only need to provide values for the input
factors:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">of_eval</span><span class="op">(</span><span class="va">parMin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5101192</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">of_eval</span><span class="op">(</span><span class="va">parMax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -11.25711</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="global-sensitivity-analyses">Global sensitivity analyses<a class="anchor" aria-label="anchor" href="#global-sensitivity-analyses"></a>
</h3>
<p>Sensitivity analysis is either referred to as <em>local</em> or
<em>global</em>, depending on variation of input factors is studied with
respect to some initial parameter set (local) or the whole space of
input factors is taken into account (global). Here we will conduct
global sensitivity analyses using package <strong>sensitivity</strong>
(Ioss et al. 2020):</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Registered S3 method overwritten by 'sensitivity':</span></span>
<span><span class="co">##   method    from </span></span>
<span><span class="co">##   print.src dplyr</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'sensitivity'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:medfate':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     extract</span></span></code></pre>
<p>This package provides a suite of approaches to global sensitivity
analysis. Among them, we will follow the <em>Elementary Effect Test</em>
implemented in function <code><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris()</a></code>. We call this function to
analyze sensitivity of total transpiration simulated by
<code><a href="../../reference/spwb.html">spwb()</a></code> to input factors (500 runs are done, so be
patient):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_transp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris</a></span><span class="op">(</span><span class="va">of_transp</span>, <span class="va">parNames</span>, r <span class="op">=</span> <span class="fl">50</span>, </span>
<span>             design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"oat"</span>, levels <span class="op">=</span> <span class="fl">10</span>, grid.jump <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>             binf <span class="op">=</span> <span class="va">parMin</span>, bsup <span class="op">=</span> <span class="va">parMax</span>, scale<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Apart from indicating the sampling design to sample the input factor
space, the call to <code><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris()</a></code> includes the response model
function (in our case <code>of_transp</code>), the parameter names and
parameter value boundaries (i.e. <code>parMin</code> and
<code>parMax</code>).</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sa_transp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## morris(model = of_transp, factors = parNames, r = 50, design = list(type = "oat",     levels = 10, grid.jump = 3), binf = parMin, bsup = parMax,     scale = TRUE, verbose = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model runs: 600 </span></span>
<span><span class="co">##                             mu     mu.star      sigma</span></span>
<span><span class="co">## T1_148/LAI_live    153.6591445 162.6752000 84.4307909</span></span>
<span><span class="co">## T2_168/LAI_live     95.3652583 107.8969236 62.7946309</span></span>
<span><span class="co">## S1_165/LAI_live    146.7424176 152.7440550 72.7860722</span></span>
<span><span class="co">## T1_148/Z50          -3.1140109   4.9123925 10.9257630</span></span>
<span><span class="co">## T2_168/Z50          -1.0121568   2.3895855  8.0897898</span></span>
<span><span class="co">## S1_165/Z50           0.1440795   0.4817739  0.9125476</span></span>
<span><span class="co">## T1_148/Psi_Extract  -3.1010337   6.1051877 10.9368259</span></span>
<span><span class="co">## T2_168/Psi_Extract  -2.6449397   3.5882482  5.8285725</span></span>
<span><span class="co">## S1_165/Psi_Extract  -0.4657024   3.3910221  9.9270164</span></span>
<span><span class="co">## rfc@1              -10.0489723  10.0489723 17.5544947</span></span>
<span><span class="co">## rfc@2              -16.0083538  16.0112776 33.9905052</span></span></code></pre>
<p><code>mu.star</code> values inform about the mean of elementary
effects of each <span class="math inline">\(i\)</span> factor and can be
used to rank all the input factors, whereas <code>sigma</code> inform
about the degree of interaction of the <span class="math inline">\(i\)</span>-th factor with others. According to the
result of this sensitivity analysis, leaf area index
(<code>LAI_live</code>) parameters are the most relevant to determine
total transpiration, much more than fine root distribution
(<code>Z50</code>), the rock fragment content in the soil and the water
potentials corresponding to whole-plant conductance reduction
(i.e. <code>Psi_Extract</code>).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_transp</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-22-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can run the same sensitivity analysis but focusing on the input
factors relevant for predicted plant drought stress (i.e. using
<code>of_stress</code> as model output function):</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_stress</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris</a></span><span class="op">(</span><span class="va">of_stress</span>, <span class="va">parNames</span>, r <span class="op">=</span> <span class="fl">50</span>, </span>
<span>             design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"oat"</span>, levels <span class="op">=</span> <span class="fl">10</span>, grid.jump <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>             binf <span class="op">=</span> <span class="va">parMin</span>, bsup <span class="op">=</span> <span class="va">parMax</span>, scale<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sa_stress</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## morris(model = of_stress, factors = parNames, r = 50, design = list(type = "oat",     levels = 10, grid.jump = 3), binf = parMin, bsup = parMax,     scale = TRUE, verbose = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model runs: 600 </span></span>
<span><span class="co">##                            mu    mu.star     sigma</span></span>
<span><span class="co">## T1_148/LAI_live    39.3701732 40.6280153 43.012050</span></span>
<span><span class="co">## T2_168/LAI_live    24.2422700 24.2422700 28.709054</span></span>
<span><span class="co">## S1_165/LAI_live    34.2099445 34.2099445 37.462036</span></span>
<span><span class="co">## T1_148/Z50          1.7496071  3.5329408  8.654708</span></span>
<span><span class="co">## T2_168/Z50          0.2240808  1.5457806  3.052235</span></span>
<span><span class="co">## S1_165/Z50         -0.2410193  0.7326172  1.020798</span></span>
<span><span class="co">## T1_148/Psi_Extract -0.9947753  4.5214926 14.289468</span></span>
<span><span class="co">## T2_168/Psi_Extract -3.1169767  3.1169767  9.000830</span></span>
<span><span class="co">## S1_165/Psi_Extract -1.0580752  1.0580752  1.693242</span></span>
<span><span class="co">## rfc@1               8.2724188  8.2724188 11.264721</span></span>
<span><span class="co">## rfc@2               3.2186280 11.1825579 24.324838</span></span></code></pre>
<p>Again, LAI values parameters are the most relevant, but closely
followed by the water potentials corresponding to whole-plant
conductance reduction (i.e. <code>Psi_Extract</code>), which appear as
more relevant than parameters of fine root distribution
(<code>Z50</code>) and rock fragment content (<code>rfc</code>).</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_stress</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">300</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-26-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Finally, we can study the contribution of input factors to model
performance in terms of soil water content dynamics (i.e. using
<code>of_eval</code> as model output function):</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sa_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/morris.html" class="external-link">morris</a></span><span class="op">(</span><span class="va">of_eval</span>, <span class="va">parNames</span>, r <span class="op">=</span> <span class="fl">50</span>, </span>
<span>             design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"oat"</span>, levels <span class="op">=</span> <span class="fl">10</span>, grid.jump <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>             binf <span class="op">=</span> <span class="va">parMin</span>, bsup <span class="op">=</span> <span class="va">parMax</span>, scale<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sa_eval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## morris(model = of_eval, factors = parNames, r = 50, design = list(type = "oat",     levels = 10, grid.jump = 3), binf = parMin, bsup = parMax,     scale = TRUE, verbose = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model runs: 600 </span></span>
<span><span class="co">##                             mu    mu.star     sigma</span></span>
<span><span class="co">## T1_148/LAI_live    -12.8813849 12.8813849 6.7216712</span></span>
<span><span class="co">## T2_168/LAI_live     -7.1523876  7.2482813 4.3856065</span></span>
<span><span class="co">## S1_165/LAI_live    -10.3023170 10.3023170 5.9723072</span></span>
<span><span class="co">## T1_148/Z50           2.9462338  2.9655605 2.8234231</span></span>
<span><span class="co">## T2_168/Z50           0.7120910  0.7132248 0.4806898</span></span>
<span><span class="co">## S1_165/Z50           0.4317170  0.4401409 0.2578594</span></span>
<span><span class="co">## T1_148/Psi_Extract   0.2343639  0.3865185 0.7713386</span></span>
<span><span class="co">## T2_168/Psi_Extract   0.1737744  0.1996813 0.3235109</span></span>
<span><span class="co">## S1_165/Psi_Extract   0.1981883  0.2465299 0.5361140</span></span>
<span><span class="co">## rfc@1               -2.0935668  2.2512164 2.6786947</span></span>
<span><span class="co">## rfc@2               -1.3197193  1.6729610 1.9113855</span></span></code></pre>
<p>Contrary to the previous cases, the contribution of LAI parameters is
similar to that of parameters of fine root distribution
(<code>Z50</code>), which appear as more relevant than the water
potentials corresponding to whole-plant conductance reduction
(i.e. <code>Psi_Extract</code>).</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sa_eval</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-30-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h2>
<p>By model calibration we mean here the process of finding suitable
parameter values (or suitable parameter distributions) given a set of
observations. Hence, the idea is to optimize the correspondence between
model predictions and observations by changing model parameter
values.</p>
<div class="section level3">
<h3 id="defining-parameter-space-and-objective-function">Defining parameter space and objective function<a class="anchor" aria-label="anchor" href="#defining-parameter-space-and-objective-function"></a>
</h3>
<p>To simplify our analysis and avoid problems of parameter
identifiability, we focus here on the calibration of parameter
<code>Z50</code> of fine root distribution. Below we redefine vectors
<code>parNames</code>, <code>parMin</code>, and <code>parMax</code>; and
we specify a vector of initial values.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Parameter names of interest</span></span>
<span><span class="va">parNames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PH_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QI_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">QC_coh</span>,<span class="st">"/Z50"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Parameter minimum and maximum values</span></span>
<span><span class="va">parMin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">50</span>,<span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">parMax</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">500</span>,<span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">parIni</span> <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">below</span><span class="op">$</span><span class="va">Z50</span></span></code></pre></div>
<p>In order to run calibration analyses we need to define an objective
function. Many evaluation metrics could be used but it is common
practice to use <em>likelihood functions</em> . We can use the function
factory <code>optimization_evaluation_function</code> and the ‘observed’
data to this aim, but in this case we specify a log-likelihood with
Gaussian error as the evaluation metric for <code>of_eval()</code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of_eval</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/optimization.html">optimization_evaluation_function</a></span><span class="op">(</span>parNames <span class="op">=</span> <span class="va">parNames</span>,</span>
<span>                x <span class="op">=</span> <span class="va">x1</span>,</span>
<span>                meteo <span class="op">=</span> <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                measuredData <span class="op">=</span> <span class="va">exampleobs</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, </span>
<span>                metric <span class="op">=</span> <span class="st">"loglikelihood"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calibration-by-gradient-search">Calibration by gradient search<a class="anchor" aria-label="anchor" href="#calibration-by-gradient-search"></a>
</h3>
<p>Model calibration can be performed using a broad range of approaches.
Many of them - including simulated annealing, genetic algorithms,
gradient methods, etc. - focus on the maximization or minimization of
the objective function. To illustrate this common approach, we will use
function <code>optim</code> from package <strong>stats</strong>, which
provides several optimization methods. In particular we will use
“L-BFGS-B”, which is the “BFGS” quasi-Newton method published by
Broyden, Fletcher, Goldfarb and Shanno, modified by the inclusion of
minimum and maximum boundaries. By default, function <code>optim</code>
performs the minimization of the objective function (here
<code>of_eval</code>), but we can specify a negative value for control
parameter <code>fnscale</code> to turn the process into a maximization
of maximum likelihood:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt_cal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="va">parIni</span>, <span class="va">of_eval</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>                control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The calibration result is the following:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">opt_cal</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $par</span></span>
<span><span class="co">## [1] 305.8826 110.5760 187.2690</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $value</span></span>
<span><span class="co">## [1] 909.4165</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts</span></span>
<span><span class="co">## function gradient </span></span>
<span><span class="co">##       25       25 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $convergence</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $message</span></span>
<span><span class="co">## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"</span></span></code></pre>
<p>Note that the optimized parameters are relatively close to those of
<code>Z50</code> in the original <code>x1</code>.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">x1</span><span class="op">$</span><span class="va">below</span><span class="op">[</span>,<span class="st">"Z50"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, <span class="va">opt_cal</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Z50 opt_cal$par</span></span>
<span><span class="co">## T1_148 100    305.8826</span></span>
<span><span class="co">## T2_168 300    110.5760</span></span>
<span><span class="co">## S1_165 200    187.2690</span></span></code></pre>
<p>This occurs because these default values were used to generate the
‘observed’ data in <code>exampleobs</code>, which contains a small
amount of non-systematic error.</p>
</div>
<div class="section level3">
<h3 id="bayesian-calibration">Bayesian calibration<a class="anchor" aria-label="anchor" href="#bayesian-calibration"></a>
</h3>
<p>As an example of a more sophisticated model calibration, we will
conduct a Bayesian calibration analysis using package
<strong>BayesianTools</strong> (Hartig et al. 2019):</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/florianhartig/BayesianTools" class="external-link">BayesianTools</a></span><span class="op">)</span></span></code></pre></div>
<p>In a Bayesian analysis one evaluates how the uncertainty in model
parameters is changed (hopefully reduced) after observing some data,
because observed values do not have the same likelihood under all
regions of the parameter space. For a Bayesian analysis we need to
specify a (log)likelihood function and the prior distribution (i.e. the
initial uncertainty) of the input factors. The central object in the
<strong>BayesianTools</strong> package is the
<code>BayesianSetup</code>. This class, created by calls to
<code><a href="https://rdrr.io/pkg/BayesianTools/man/createBayesianSetup.html" class="external-link">createBayesianSetup()</a></code>, contains the information about the
model to be fit (likelihood), and the priors for model parameters. In
absence of previous data, we specify a uniform distribution between the
minimum and maximum values, which in the <strong>BayesianTools</strong>
package can be done using function
<code><a href="https://rdrr.io/pkg/BayesianTools/man/createUniformPrior.html" class="external-link">createUniformPrior()</a></code>:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BayesianTools/man/createUniformPrior.html" class="external-link">createUniformPrior</a></span><span class="op">(</span><span class="va">parMin</span>, <span class="va">parMax</span>, <span class="va">parIni</span><span class="op">)</span></span>
<span><span class="va">mcmc_setup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BayesianTools/man/createBayesianSetup.html" class="external-link">createBayesianSetup</a></span><span class="op">(</span>likelihood <span class="op">=</span> <span class="va">of_eval</span>, </span>
<span>                                  prior <span class="op">=</span> <span class="va">prior</span>, </span>
<span>                                  names <span class="op">=</span> <span class="va">parNames</span><span class="op">)</span></span></code></pre></div>
<p>Function <code><a href="https://rdrr.io/pkg/BayesianTools/man/createBayesianSetup.html" class="external-link">createBayesianSetup()</a></code> automatically creates the
posterior and various convenience functions for the Markov Chain Monte
Carlo (MCMC) samplers. The <code><a href="https://rdrr.io/pkg/BayesianTools/man/runMCMC.html" class="external-link">runMCMC()</a></code> function is the main
wrapper for all other implemented MCMC functions. Here we call it with
nine chains of 1000 iterations each.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BayesianTools/man/runMCMC.html" class="external-link">runMCMC</a></span><span class="op">(</span></span>
<span>  bayesianSetup <span class="op">=</span> <span class="va">mcmc_setup</span>, </span>
<span>  sampler <span class="op">=</span> <span class="st">"DEzs"</span>,</span>
<span>  settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>iterations <span class="op">=</span> <span class="fl">1000</span>, nrChains <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By default <code><a href="https://rdrr.io/pkg/BayesianTools/man/runMCMC.html" class="external-link">runMCMC()</a></code> uses parallel computation, but the
calibration process is nevertheless rather slow.</p>
<p>A summary function is provided to inspect convergence results and
correlation between parameters:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # # # # # # # # # # # # # # # # # # # # # # # # # </span></span>
<span><span class="co">## ## MCMC chain summary ## </span></span>
<span><span class="co">## # # # # # # # # # # # # # # # # # # # # # # # # # </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## # MCMC sampler:  DEzs </span></span>
<span><span class="co">## # Nr. Chains:  27 </span></span>
<span><span class="co">## # Iterations per chain:  334 </span></span>
<span><span class="co">## # Rejection rate:  0.751 </span></span>
<span><span class="co">## # Effective sample size:  673 </span></span>
<span><span class="co">## # Runtime:  2212.486  sec. </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## # Parameters</span></span>
<span><span class="co">##              psf     MAP    2.5%  median   97.5%</span></span>
<span><span class="co">## T1_148/Z50 1.037 306.754 101.883 245.343 345.003</span></span>
<span><span class="co">## T2_168/Z50 1.034 109.695  59.929 306.980 490.651</span></span>
<span><span class="co">## S1_165/Z50 1.036 179.784  57.204 182.498 294.762</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ## DIC:  -1816.525 </span></span>
<span><span class="co">## ## Convergence </span></span>
<span><span class="co">##  Gelman Rubin multivariate psrf:  1.077 </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## ## Correlations </span></span>
<span><span class="co">##            T1_148/Z50 T2_168/Z50 S1_165/Z50</span></span>
<span><span class="co">## T1_148/Z50      1.000     -0.801     -0.128</span></span>
<span><span class="co">## T2_168/Z50     -0.801      1.000      0.066</span></span>
<span><span class="co">## S1_165/Z50     -0.128      0.066      1.000</span></span></code></pre>
<p>According to the Gelman-Rubin diagnostic, the convergence can be
accepted because the multivariate potential scale reduction factor was ≤
1.1. We can plot the Markov Chains and the posterior density
distribution of parameters that they generate using:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-42-1.png" width="633.6">
We can also plot the marginal prior and posterior density distributions
for each parameter. In this case, we see a similar <code>Z50</code>
distribution for the two trees, which is more informative than the prior
distribution. In contrast, the posterior distribution of
<code>Z50</code> for the kermes oak remains as uncertain as the prior
one. This happens because the LAI value of kermes oak is low, so that it
has small influence on soil water dynamics regardless of its root
distribution.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BayesianTools/man/marginalPlot.html" class="external-link">marginalPlot</a></span><span class="op">(</span><span class="va">mcmc_out</span>, prior <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-43-1.png" width="633.6"></p>
<p>Plots can also be produced to display the correlation between
parameter values.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BayesianTools/man/correlationPlot.html" class="external-link">correlationPlot</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-44-1.png" width="633.6">
Here it can be observed the large correlation between <code>Z50</code>
of the two tree cohorts. Since their LAI values are similar, a similar
effect on soil water depletion can be obtained to some extent by
exchanging their fine root distribution.</p>
<p>Posterior model prediction distributions can be obtained if we take
samples from the Markov chains and use them to perform simulations (here
we use sample size of 100 but a larger value is preferred).</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BayesianTools/man/getSample.html" class="external-link">getSample</a></span><span class="op">(</span><span class="va">mcmc_out</span>, numSamples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      T1_148/Z50 T2_168/Z50 S1_165/Z50</span></span>
<span><span class="co">## [1,]   217.9150  478.40434  258.52315</span></span>
<span><span class="co">## [2,]   260.5909  213.55127  184.20214</span></span>
<span><span class="co">## [3,]   243.8444  244.94568  233.38867</span></span>
<span><span class="co">## [4,]   166.7885   73.53628  230.78928</span></span>
<span><span class="co">## [5,]   313.5510  258.36418  216.23578</span></span>
<span><span class="co">## [6,]   276.2950  276.41855   71.93304</span></span></code></pre>
<p>To this aim, <strong>medfate</strong> includes function
<code><a href="../../reference/optimization.html">multiple_runs()</a></code> that allows running a simulation model with
a matrix of parameter values. For example, the following code runs
<code><a href="../../reference/spwb.html">spwb()</a></code> with all combinations of fine root distribution
specified in <code>s</code>.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MS</span> <span class="op">=</span> <span class="fu"><a href="../../reference/optimization.html">multiple_runs</a></span><span class="op">(</span><span class="va">s</span>, x <span class="op">=</span> <span class="va">x1</span>, meteo <span class="op">=</span> <span class="va">examplemeteo</span>,</span>
<span>                   latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Function <code><a href="../../reference/optimization.html">multiple_runs()</a></code> determines the model to be
called inspecting the class of <code>x</code> (here <code>x1</code> is a
<code>spwbInput</code>). Once we have conducted the simulations we can
inspect the posterior distribution of several prediction variables, for
example total transpiration:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MS</span>, <span class="va">sf_transp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Posterior transpiration"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Total transpiration (mm)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-47-1.png" width="480"></p>
<p>or average plant drought stress:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MS</span>, <span class="va">sf_stress</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Average plant stress"</span>, main<span class="op">=</span><span class="st">"Posterior stress"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-48-1.png" width="480"></p>
<p>Finally, we can use object <code>prior</code> to generate another
sample under the prior parameter distribution, perform simulations:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_prior</span> <span class="op">=</span> <span class="va">prior</span><span class="op">$</span><span class="fu">sampler</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s_prior</span><span class="op">)</span><span class="op">&lt;-</span> <span class="va">parNames</span></span>
<span><span class="va">MS_prior</span> <span class="op">=</span> <span class="fu"><a href="../../reference/optimization.html">multiple_runs</a></span><span class="op">(</span><span class="va">s_prior</span>, x <span class="op">=</span> <span class="va">x1</span>, meteo <span class="op">=</span> <span class="va">examplemeteo</span>,</span>
<span>                         latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>and compare the prior prediction uncertainty with the posterior
prediction uncertainty for the same output variables:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MS_prior</span>, <span class="va">sf_transp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Transpiration"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Total transpiration (mm)"</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">200</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MS</span>, <span class="va">sf_transp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span>, <span class="st">"Posterior"</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-50-1.png" width="480"></p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MS_prior</span>, <span class="va">sf_stress</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Plant stress"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Average plant stress"</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MS</span>, <span class="va">sf_stress</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior"</span>, <span class="st">"Posterior"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SensitivityCalibration_files/figure-html/unnamed-chunk-51-1.png" width="480"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Pianosi, F., Beven, K., Freer, J., Hall, J.W., Rougier, J.,
Stephenson, D.B., Wagener, T., 2016. Sensitivity analysis of
environmental models: A systematic review with practical workflow.
Environ. Model. Softw. 79, 214–232. <a href="https://doi.org/10.1016/j.envsoft.2016.02.008" class="external-link uri">https://doi.org/10.1016/j.envsoft.2016.02.008</a>
</li>
<li>Bertrand Iooss, Sebastien Da Veiga, Alexandre Janon, Gilles Pujol,
with contributions from Baptiste Broto, Khalid Boumhaout, Thibault
Delage, Reda El Amri, Jana Fruth, Laurent Gilquin, Joseph Guillaume,
Loic Le Gratiet, Paul Lemaitre, Amandine Marrel, Anouar Meynaoui, Barry
L. Nelson, Filippo Monari, Roelof Oomen, Oldrich Rakovec, Bernardo
Ramos, Olivier Roustant, Eunhye Song, Jeremy Staum, Roman Sueur, Taieb
Touati and Frank Weber (2020). sensitivity: Global Sensitivity Analysis
of Model Outputs. R package version 1.23.1. <a href="https://CRAN.R-project.org/package=sensitivity" class="external-link uri">https://CRAN.R-project.org/package=sensitivity</a>
</li>
<li>Florian Hartig, Francesco Minunno and Stefan Paul (2019).
BayesianTools: General-Purpose MCMC and SMC Samplers and Tools for
Bayesian Statistics. R package version 0.1.7. <a href="https://CRAN.R-project.org/package=BayesianTools" class="external-link uri">https://CRAN.R-project.org/package=BayesianTools</a>
</li>
<li>Saltelli, A., Ratto, M., Andres, T., Campolongo, F., Cariboni, J.,
Gatelli, D., Saisana, M., Tarantola, S., 2008. Global Sensitivity
Analysis. The Primer. Wiley.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

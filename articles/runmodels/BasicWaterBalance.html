<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic water balance • medfate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Basic water balance">
<meta property="og:description" content="medfate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/medfate/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic water balance</h1>
                        <h4 data-toc-skip class="author">Miquel De
Caceres</h4>
            
            <h4 data-toc-skip class="date">2024-02-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/vignettes/runmodels/BasicWaterBalance.Rmd" class="external-link"><code>vignettes/runmodels/BasicWaterBalance.Rmd</code></a></small>
      <div class="hidden name"><code>BasicWaterBalance.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about-this-vignette">About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h2>
<p>The present document describes how to run the soil plant water
balance model described in De Cáceres et al. (2015) using package
<code>medfate</code>. The document illustrates how to prepare the
inputs, use the simulation functions and inspect the outputs. All the
details of the model design and formulation can be found at the <a href="https://emf-creaf.github.io/medfatebook/index.html" class="external-link">medfatebook</a>.
Because it introduces many basic features of simulations with package
<code>medfate</code>, this document should be read before addressing
advanced topics of water balance simulations or growth simulations.</p>
</div>
<div class="section level2">
<h2 id="preparing-model-inputs">Preparing model inputs<a class="anchor" aria-label="anchor" href="#preparing-model-inputs"></a>
</h2>
<p>Model inputs are explained in greater detail in vignettes <a href="https://emf-creaf.github.io/medfate/articles/intro/UnderstandingInputs.html" class="external-link"><em>Understanding
model inputs</em></a> and <a href="https://emf-creaf.github.io/medfate/articles/intro/PreparingInputs.html" class="external-link"><em>Preparing
model inputs</em></a>. Here we only review the different steps required
to run function <code><a href="../../reference/spwb.html">spwb()</a></code>.</p>
<div class="section level3">
<h3 id="soil-vegetation-meteorology-and-species-data">Soil, vegetation, meteorology and species data<a class="anchor" aria-label="anchor" href="#soil-vegetation-meteorology-and-species-data"></a>
</h3>
<p>Soil information needs to be entered as a <code>data frame</code>
with soil layers in rows and physical attributes in columns. Soil
physical attributes can be initialized to default values, for a given
number of layers, using function <code><a href="../../reference/defaultSoilParams.html">defaultSoilParams()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>The soil input for water balance simulation is actually a list of
class <code>soil</code> that is created using a function with the same
name:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examplesoil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></span></code></pre></div>
<p>As explained in the package overview, models included in
<code>medfate</code> were primarily designed to be ran on <strong>forest
inventory plots</strong>. Here we use the example object provided with
the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleforest</span><span class="op">)</span></span>
<span><span class="va">exampleforest</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##            Species   N   DBH Height Z50  Z95</span></span>
<span><span class="co">## 1 Pinus halepensis 168 37.55    800 100  600</span></span>
<span><span class="co">## 2     Quercus ilex 384 14.60    660 300 1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##             Species Cover Height Z50  Z95</span></span>
<span><span class="co">## 1 Quercus coccifera  3.75     80 200 1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 20</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $seedBank</span></span>
<span><span class="co">## [1] Species Percent</span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>Importantly, a data frame with daily weather for the period to be
simulated is required. Here we use the default data frame included with
the package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        dates MinTemperature MaxTemperature Precipitation MinRelativeHumidity</span></span>
<span><span class="co">## 1 2001-01-01     -0.5934215       6.287950      4.869109            65.15411</span></span>
<span><span class="co">## 2 2001-01-02     -2.3662458       4.569737      2.498292            57.43761</span></span>
<span><span class="co">## 3 2001-01-03     -3.8541036       2.661951      0.000000            58.77432</span></span>
<span><span class="co">## 4 2001-01-04     -1.8744860       3.097705      5.796973            66.84256</span></span>
<span><span class="co">## 5 2001-01-05      0.3288287       7.551532      1.884401            62.97656</span></span>
<span><span class="co">## 6 2001-01-06      0.5461322       7.186784     13.359801            74.25754</span></span>
<span><span class="co">##   MaxRelativeHumidity Radiation WindSpeed</span></span>
<span><span class="co">## 1           100.00000  12.89251  2.000000</span></span>
<span><span class="co">## 2            94.71780  13.03079  7.662544</span></span>
<span><span class="co">## 3            94.66823  16.90722  2.000000</span></span>
<span><span class="co">## 4            95.80950  11.07275  2.000000</span></span>
<span><span class="co">## 5           100.00000  13.45205  7.581347</span></span>
<span><span class="co">## 6           100.00000  12.84841  6.570501</span></span></code></pre>
<p>Finally, simulations in <code>medfate</code> require a data frame
with species parameter values, which we load using defaults for
Catalonia (NE Spain):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-control">Simulation control<a class="anchor" aria-label="anchor" href="#simulation-control"></a>
</h3>
<p>Apart from data inputs, the behaviour of simulation models can be
controlled using a set of global parameters. The default
parameterization is obtained using function
<code><a href="../../reference/defaultControl.html">defaultControl()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="st">"Granier"</span><span class="op">)</span></span></code></pre></div>
<p>Some parameters deserve explanation here:</p>
<ol style="list-style-type: decimal">
<li>Console output can be turned off by setting
<code>verbose = FALSE</code>.</li>
<li>The soil water retention curves can be switched between Saxton’s and
Van Genuchten’s using parameter <code>soilFunctions</code>.</li>
<li>The complexity of the soil water balance calculations will be very
different if we set <code>transpirationMode = "Sperry"</code> or
<code>transpirationMode = "Cochard"</code>, instead of
<code>transpirationMode = "Granier"</code>.</li>
</ol>
</div>
<div class="section level3">
<h3 id="water-balance-input-object">Water balance input object<a class="anchor" aria-label="anchor" href="#water-balance-input-object"></a>
</h3>
<p>A last object is needed before calling simulation functions, called
<code>spwbInput</code>. It consists in the compilation of aboveground
and belowground parameters and the specification of additional parameter
values for each plant cohort. This is done by calling function
<code><a href="../../reference/modelInput.html">spwbInput()</a></code>, but if one has a <code>forest</code> object,
the object can be generated more directly using function
<code><a href="../../reference/modelInput.html">forest2spwbInput()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modelInput.html">forest2spwbInput</a></span><span class="op">(</span><span class="va">exampleforest</span>, <span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, <span class="va">control</span><span class="op">)</span></span></code></pre></div>
<p>Different parameter variables will be drawn depending on the value of
<code>transpirationMode</code>. For the basic water balance model
(<code>transpirationMode = "Granier"</code>), relatively few parameters
are needed. All the input information for forest data and species
parameter values can be inspected by accessing the different elements of
this object, whose names are.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "control"             "soil"                "canopy"             </span></span>
<span><span class="co">##  [4] "herbLAI"             "herbLAImax"          "cohorts"            </span></span>
<span><span class="co">##  [7] "above"               "below"               "belowLayers"        </span></span>
<span><span class="co">## [10] "paramsPhenology"     "paramsAnatomy"       "paramsInterception" </span></span>
<span><span class="co">## [13] "paramsTranspiration" "paramsWaterStorage"  "internalPhenology"  </span></span>
<span><span class="co">## [16] "internalWater"       "internalFCCS"</span></span></code></pre>
<p>Finally, note that users can set cohort-specific parameters for soil
water balance (instead of using species-level values) by modifying
manually the parameter values in this object. Since some parameters may
be coordinated by design, however, it is better to use specific package
functions for this purpose.</p>
</div>
</div>
<div class="section level2">
<h2 id="executing-the-soil-water-balance-model">Executing the soil water balance model<a class="anchor" aria-label="anchor" href="#executing-the-soil-water-balance-model"></a>
</h2>
<div class="section level3">
<h3 id="water-balance-for-a-single-day">Water balance for a single day<a class="anchor" aria-label="anchor" href="#water-balance-for-a-single-day"></a>
</h3>
<p>Soil water balance simulations will normally span periods of several
months or years, but since the model operates at a daily temporal scale,
it is possible to perform soil water balance for one day only. This is
done using function <code><a href="../../reference/spwb_day.html">spwb_day()</a></code>. In the following code we
select day 100 from the meteorological input data and perform soil water
balance for that day only:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">date</span> <span class="op">&lt;-</span> <span class="va">examplemeteo</span><span class="op">$</span><span class="va">dates</span><span class="op">[</span><span class="va">d</span><span class="op">]</span></span>
<span><span class="va">meteovec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">[</span><span class="va">d</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sd1</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/spwb_day.html">spwb_day</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">date</span>, <span class="va">meteovec</span>,  </span>
<span>             latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, slope<span class="op">=</span> <span class="fl">0</span>, aspect <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package 'meteoland' [ver. 2.2.1]</span></span></code></pre>
<p>Function <code><a href="../../reference/spwb_day.html">spwb_day()</a></code> is most useful when working with the
complex transpiration model. This is why so many meteorological
variables are required. The output of <code><a href="../../reference/spwb_day.html">spwb_day()</a></code> is a list
with five elements:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "cohorts"      "topography"   "weather"      "WaterBalance" "Soil"        </span></span>
<span><span class="co">## [6] "Stand"        "Plants"</span></span></code></pre>
<ul>
<li>
<strong>cohorts</strong>: Table with the species code and species
name of each cohort.</li>
<li>
<strong>WaterBalance</strong>: Contains the soil water balance flows
(precipitation, infiltration, transpiration, …)</li>
<li>
<strong>Soil</strong>: Contains output values by soil layer
(i.e. water evaporated from each soil layer, water transpired from each
soil layer and the final soil water potential).</li>
<li>
<strong>Stand</strong>: A list with stand LAI (expanded and dead
leaves), canopy water retention capacity and the proportion of light
(SWR or PAR) reaching the ground.</li>
<li>
<strong>Plants</strong>: Contains output values by plant cohort
(i.e. LAI values, transpiration, water potential, drought stress index,
…).</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd1</span></span></code></pre></div>
<pre><code><span><span class="co">## $cohorts</span></span>
<span><span class="co">##         SP              Name</span></span>
<span><span class="co">## T1_148 148  Pinus halepensis</span></span>
<span><span class="co">## T2_168 168      Quercus ilex</span></span>
<span><span class="co">## S1_165 165 Quercus coccifera</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $topography</span></span>
<span><span class="co">## elevation     slope    aspect </span></span>
<span><span class="co">##       100         0         0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $weather</span></span>
<span><span class="co">##        tday        prec        tmin        tmax       rhmin       rhmax </span></span>
<span><span class="co">##   6.2323731   0.0000000   0.3881289  10.0320962  42.0207334  82.3036989 </span></span>
<span><span class="co">##         rad        wind        Catm        Patm         pet        rint </span></span>
<span><span class="co">##  28.7201692   3.3228840 386.0000000          NA   3.9023342   1.5000000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $WaterBalance</span></span>
<span><span class="co">##                     PET                    Rain                    Snow </span></span>
<span><span class="co">##             3.902334206             0.000000000             0.000000000 </span></span>
<span><span class="co">##                 NetRain                Snowmelt                   Runon </span></span>
<span><span class="co">##             0.000000000             0.000000000             0.000000000 </span></span>
<span><span class="co">##            Infiltration                  Runoff            DeepDrainage </span></span>
<span><span class="co">##             0.000000000             0.000000000             0.008440323 </span></span>
<span><span class="co">##         SoilEvaporation       HerbTranspiration         PlantExtraction </span></span>
<span><span class="co">##             0.500000000             0.048725420             0.668683872 </span></span>
<span><span class="co">##           Transpiration HydraulicRedistribution </span></span>
<span><span class="co">##             0.668683872             0.000000000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Soil</span></span>
<span><span class="co">##   HerbTranspiration HydraulicInput HydraulicOutput PlantExtraction         psi</span></span>
<span><span class="co">## 1       0.008571001              0      0.48671421      0.48671421 -0.03561662</span></span>
<span><span class="co">## 2       0.012000080              0      0.16122392      0.16122392 -0.03318488</span></span>
<span><span class="co">## 3       0.013576976              0      0.01660923      0.01660923 -0.03297589</span></span>
<span><span class="co">## 4       0.014577363              0      0.00413651      0.00413651 -0.03300932</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Stand</span></span>
<span><span class="co">##         LAI     LAIherb     LAIlive LAIexpanded     LAIdead          Cm </span></span>
<span><span class="co">##   1.7585845   0.1736369   1.5849476   1.5849476   0.0000000   1.3904846 </span></span>
<span><span class="co">##  LgroundPAR  LgroundSWR </span></span>
<span><span class="co">##  40.0075402  50.7329667 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Plants</span></span>
<span><span class="co">##               LAI    LAIlive     FPAR AbsorbedSWRFraction Extraction</span></span>
<span><span class="co">## T1_148 0.84874773 0.84874773 92.18285           35.076344 0.40874422</span></span>
<span><span class="co">## T2_168 0.70557382 0.70557382 72.36365           30.444383 0.23318589</span></span>
<span><span class="co">## S1_165 0.03062604 0.03062604 44.32407            2.366131 0.02675376</span></span>
<span><span class="co">##        Transpiration GrossPhotosynthesis PlantPsi         DDS   StemRWC</span></span>
<span><span class="co">## T1_148    0.40874422           2.7741548   -0.033 0.005808769 0.9998350</span></span>
<span><span class="co">## T2_168    0.23318589           2.1058696   -0.033 0.010612890 0.9997489</span></span>
<span><span class="co">## S1_165    0.02675376           0.1635903   -0.033 0.003088161 0.9983684</span></span>
<span><span class="co">##          LeafRWC      LFMC StemPLC     LeafPLC WaterBalance</span></span>
<span><span class="co">## T1_148 0.9979679 125.89003       0 0.003069557            0</span></span>
<span><span class="co">## T2_168 0.9986794  93.07448       0 0.000000000            0</span></span>
<span><span class="co">## S1_165 0.9987207  96.39176       0 0.000000000            0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "spwb_day" "list"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="water-balance-for-multiple-days">Water balance for multiple days<a class="anchor" aria-label="anchor" href="#water-balance-for-multiple-days"></a>
</h3>
<p>Most often, users will use function <code><a href="../../reference/spwb.html">spwb()</a></code> to run the
soil water balance model. This function requires the
<code>spwbInput</code> object and the meteorological data frame.
However, function <code><a href="../../reference/spwb_day.html">spwb_day()</a></code> by default modifies the state
variables of the input objects. In particular, the values of soil
moisture are now:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.9838922 0.9988208 1.0001543 0.9999404</span></span></code></pre>
<p>We simply reset state variables to their default values so that new
simulations are not affected by the end state of the previous
simulation:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/resetInputs.html">resetInputs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 1 1 1</span></span></code></pre>
<p>Now we are ready to call function <code><a href="../../reference/spwb.html">spwb()</a></code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Initial plant water content (mm): 7.05859</span></span>
<span><span class="co">## Initial soil water content (mm): 290.875</span></span>
<span><span class="co">## Initial snowpack content (mm): 0</span></span>
<span><span class="co">## Performing daily simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  [Year 2001]:....................................</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Final plant water content (mm): 7.05708</span></span>
<span><span class="co">## Final soil water content (mm): 322.866</span></span>
<span><span class="co">## Final snowpack content (mm): 0</span></span>
<span><span class="co">## Change in plant water content (mm): -0.00151384</span></span>
<span><span class="co">## Plant water balance result (mm): -0.00151384</span></span>
<span><span class="co">## Change in soil water content (mm): 31.9909</span></span>
<span><span class="co">## Soil water balance result (mm): 31.9406</span></span>
<span><span class="co">## Change in snowpack water content (mm): 0</span></span>
<span><span class="co">## Snowpack water balance result (mm): -7.10543e-15</span></span>
<span><span class="co">## Water balance components:</span></span>
<span><span class="co">##   Precipitation (mm) 513</span></span>
<span><span class="co">##   Rain (mm) 462 Snow (mm) 51</span></span>
<span><span class="co">##   Interception (mm) 92 Net rainfall (mm) 370</span></span>
<span><span class="co">##   Infiltration (mm) 325 Runoff (mm) 45 Deep drainage (mm) 127</span></span>
<span><span class="co">##   Soil evaporation (mm) 16  Herbaceous transpiration (mm) 14 Woody plant transpiration (mm) 187</span></span>
<span><span class="co">##   Plant extraction from soil (mm) 187  Plant water balance (mm) -0 Hydraulic redistribution (mm) 2</span></span></code></pre>
<p>Function <code><a href="../../reference/spwb.html">spwb()</a></code> returns an object of class with the same
name, actually a list:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "spwb" "list"</span></span></code></pre>
<p>If we inspect its elements, we realize that the output is arranged
differently than in <code><a href="../../reference/spwb_day.html">spwb_day()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "latitude"     "topography"   "weather"      "spwbInput"    "spwbOutput"  </span></span>
<span><span class="co">## [6] "WaterBalance" "Soil"         "Stand"        "Plants"</span></span></code></pre>
<p>In particular, element <code>spwbInput</code> contains a copy of the
input parameters that were used to run the model:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">spwbInput</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "control"             "soil"                "canopy"             </span></span>
<span><span class="co">##  [4] "herbLAI"             "herbLAImax"          "cohorts"            </span></span>
<span><span class="co">##  [7] "above"               "below"               "belowLayers"        </span></span>
<span><span class="co">## [10] "paramsPhenology"     "paramsAnatomy"       "paramsInterception" </span></span>
<span><span class="co">## [13] "paramsTranspiration" "paramsWaterStorage"  "internalPhenology"  </span></span>
<span><span class="co">## [16] "internalWater"       "internalFCCS"</span></span></code></pre>
<p>As before, <code>WaterBalance</code> contains water balance
components, but in this case in form of a data frame with days in
rows:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  PET Precipitation      Rain Snow    NetRain Snowmelt</span></span>
<span><span class="co">## 2001-01-01 0.8828475      4.869109  4.869109    0  3.4241795        0</span></span>
<span><span class="co">## 2001-01-02 1.6375337      2.498292  2.498292    0  1.0717469        0</span></span>
<span><span class="co">## 2001-01-03 1.3017026      0.000000  0.000000    0  0.0000000        0</span></span>
<span><span class="co">## 2001-01-04 0.5690790      5.796973  5.796973    0  4.3625616        0</span></span>
<span><span class="co">## 2001-01-05 1.6760567      1.884401  1.884401    0  0.7539027        0</span></span>
<span><span class="co">## 2001-01-06 1.2077028     13.359801 13.359801    0 11.7240275        0</span></span>
<span><span class="co">##            Infiltration Runoff DeepDrainage Evapotranspiration Interception</span></span>
<span><span class="co">## 2001-01-01    3.4241795      0  0.008464442          2.0551277     1.444929</span></span>
<span><span class="co">## 2001-01-02    1.0717469      0  0.008522595          1.7959855     1.426545</span></span>
<span><span class="co">## 2001-01-03    0.0000000      0  0.008594922          0.2975262     0.000000</span></span>
<span><span class="co">## 2001-01-04    4.3625616      0  0.008663866          1.6097210     1.434411</span></span>
<span><span class="co">## 2001-01-05    0.7539027      0  0.008736669          1.4664059     1.130499</span></span>
<span><span class="co">## 2001-01-06   11.7240275      0  0.008816975          1.8850428     1.635773</span></span>
<span><span class="co">##            SoilEvaporation HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01      0.44789475       0.011023432      0.15128020    0.15128020</span></span>
<span><span class="co">## 2001-01-02      0.06815427       0.020448134      0.28083835    0.28083835</span></span>
<span><span class="co">## 2001-01-03      0.05799418       0.016254749      0.22327725    0.22327725</span></span>
<span><span class="co">## 2001-01-04      0.07060554       0.007106159      0.09759798    0.09759798</span></span>
<span><span class="co">## 2001-01-05      0.02721406       0.020930945      0.28776211    0.28776211</span></span>
<span><span class="co">## 2001-01-06      0.02682805       0.015082070      0.20735952    0.20735952</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01             0.000000000</span></span>
<span><span class="co">## 2001-01-02             0.017897872</span></span>
<span><span class="co">## 2001-01-03             0.014690001</span></span>
<span><span class="co">## 2001-01-04             0.006765439</span></span>
<span><span class="co">## 2001-01-05             0.019714384</span></span>
<span><span class="co">## 2001-01-06             0.014541996</span></span></code></pre>
<p>Element <code>Plants</code> is in turn a list with several dataframes
with plant output variables, for example plant water potentials are
in:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">Plants</span><span class="op">$</span><span class="va">PlantPsi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 T1_148      T2_168      S1_165</span></span>
<span><span class="co">## 2001-01-01 -0.03300000 -0.03300000 -0.03300000</span></span>
<span><span class="co">## 2001-01-02 -0.02951758 -0.03050848 -0.03003168</span></span>
<span><span class="co">## 2001-01-03 -0.02890922 -0.03001067 -0.02948276</span></span>
<span><span class="co">## 2001-01-04 -0.02957884 -0.03039120 -0.03000394</span></span>
<span><span class="co">## 2001-01-05 -0.02487192 -0.02705731 -0.02602192</span></span>
<span><span class="co">## 2001-01-06 -0.02473400 -0.02685630 -0.02585353</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="inspecting-model-outputs">Inspecting model outputs<a class="anchor" aria-label="anchor" href="#inspecting-model-outputs"></a>
</h2>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<p>Package <code>medfate</code> provides a simple <code>plot</code>
function for objects of class <code>spwb</code>. It can be used to show
meteorological inputs, snow dynamics, and different components of the
water balance:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"PET_Precipitation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Snow"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-20-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Export"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-20-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Evapotranspiration"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Function <code>plot</code> is also allows displaying soil moisture
dynamics by layer, which can be done in four different ways (the first
two only imply a change in axis units):</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilTheta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilRWC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilPsi"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilVol"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-4.png" width="672" style="display: block; margin: auto;"></p>
<p>Finally, the same function can also be used to draw the dynamics of
plant variables by cohorts, such as transpiration, gross photosynthesis
or water potential:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"Transpiration"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"GrossPhotosynthesis"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"PlantPsi"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-3.png" width="672" style="display: block; margin: auto;"></p>
<p>Finally, one can interactively create plots using function
<code>shinyplot</code>, e.g.:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/shinyplot.html">shinyplot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-output">Extracting output<a class="anchor" aria-label="anchor" href="#extracting-output"></a>
</h3>
<p>Simulation outputs in form of lists have a nested structure that is
not easy to handle. Functions are provided to extract model outputs as
<code>data.frame</code> objects. The following code extracts daily
series of stand-level variables:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/extract.html">extract</a></span><span class="op">(</span><span class="va">S</span>, <span class="st">"forest"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         date       PET Precipitation      Rain Snow    NetRain Snowmelt</span></span>
<span><span class="co">## 1 2001-01-01 0.8828475      4.869109  4.869109    0  3.4241795        0</span></span>
<span><span class="co">## 2 2001-01-02 1.6375337      2.498292  2.498292    0  1.0717469        0</span></span>
<span><span class="co">## 3 2001-01-03 1.3017026      0.000000  0.000000    0  0.0000000        0</span></span>
<span><span class="co">## 4 2001-01-04 0.5690790      5.796973  5.796973    0  4.3625616        0</span></span>
<span><span class="co">## 5 2001-01-05 1.6760567      1.884401  1.884401    0  0.7539027        0</span></span>
<span><span class="co">## 6 2001-01-06 1.2077028     13.359801 13.359801    0 11.7240275        0</span></span>
<span><span class="co">##   Infiltration Runoff DeepDrainage Evapotranspiration Interception</span></span>
<span><span class="co">## 1    3.4241795      0  0.008464442          2.0551277     1.444929</span></span>
<span><span class="co">## 2    1.0717469      0  0.008522595          1.7959855     1.426545</span></span>
<span><span class="co">## 3    0.0000000      0  0.008594922          0.2975262     0.000000</span></span>
<span><span class="co">## 4    4.3625616      0  0.008663866          1.6097210     1.434411</span></span>
<span><span class="co">## 5    0.7539027      0  0.008736669          1.4664059     1.130499</span></span>
<span><span class="co">## 6   11.7240275      0  0.008816975          1.8850428     1.635773</span></span>
<span><span class="co">##   SoilEvaporation HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 1      0.44789475       0.011023432      0.15128020    0.15128020</span></span>
<span><span class="co">## 2      0.06815427       0.020448134      0.28083835    0.28083835</span></span>
<span><span class="co">## 3      0.05799418       0.016254749      0.22327725    0.22327725</span></span>
<span><span class="co">## 4      0.07060554       0.007106159      0.09759798    0.09759798</span></span>
<span><span class="co">## 5      0.02721406       0.020930945      0.28776211    0.28776211</span></span>
<span><span class="co">## 6      0.02682805       0.015082070      0.20735952    0.20735952</span></span>
<span><span class="co">##   HydraulicRedistribution      LAI   LAIherb  LAIlive LAIexpanded LAIdead</span></span>
<span><span class="co">## 1             0.000000000 1.758585 0.1736369 1.584948    1.584948       0</span></span>
<span><span class="co">## 2             0.017897872 1.758585 0.1736369 1.584948    1.584948       0</span></span>
<span><span class="co">## 3             0.014690001 1.758585 0.1736369 1.584948    1.584948       0</span></span>
<span><span class="co">## 4             0.006765439 1.758585 0.1736369 1.584948    1.584948       0</span></span>
<span><span class="co">## 5             0.019714384 1.758585 0.1736369 1.584948    1.584948       0</span></span>
<span><span class="co">## 6             0.014541996 1.758585 0.1736369 1.584948    1.584948       0</span></span>
<span><span class="co">##         Cm LgroundPAR LgroundSWR      W.1      W.2      W.3      W.4     ML.1</span></span>
<span><span class="co">## 1 1.390485   40.00754   50.73297 1.000000 1.000000 1.000000 1.000000 68.17381</span></span>
<span><span class="co">## 2 1.390485   40.00754   50.73297 1.026403 1.007792 1.001098 1.000442 69.97381</span></span>
<span><span class="co">## 3 1.390485   40.00754   50.73297 1.031191 1.010213 1.001917 1.001201 70.30021</span></span>
<span><span class="co">## 4 1.390485   40.00754   50.73297 1.025451 1.010337 1.002559 1.001927 69.90891</span></span>
<span><span class="co">## 5 1.390485   40.00754   50.73297 1.067175 1.020660 1.004008 1.002607 72.75342</span></span>
<span><span class="co">## 6 1.390485   40.00754   50.73297 1.068148 1.022820 1.004892 1.003397 72.81970</span></span>
<span><span class="co">##       ML.2     ML.3     ML.4    MLTot      WTD SWE PlantExt.1 PlantExt.2</span></span>
<span><span class="co">## 1 116.6530 75.74868 30.29947 290.8749 3961.453   0 0.11011216 0.03647462</span></span>
<span><span class="co">## 2 117.5620 75.83185 30.31287 293.6805 3947.729   0 0.23992016 0.05881606</span></span>
<span><span class="co">## 3 117.8443 75.89390 30.33588 294.3743 3946.579   0 0.19145132 0.04651593</span></span>
<span><span class="co">## 4 117.8588 75.94254 30.35785 294.0681 3889.977   0 0.08293675 0.02142667</span></span>
<span><span class="co">## 5 119.0630 76.05226 30.37846 298.2471 3879.263   0 0.25553799 0.05193850</span></span>
<span><span class="co">## 6 119.3150 76.11922 30.40241 298.6563 3730.611   0 0.18385494 0.03804657</span></span>
<span><span class="co">##     PlantExt.3    PlantExt.4 HydraulicInput.1 HydraulicInput.2 HydraulicInput.3</span></span>
<span><span class="co">## 1  0.003757603  0.0009358264                0                0      0.000000000</span></span>
<span><span class="co">## 2 -0.006235893 -0.0116619793                0                0      0.006235893</span></span>
<span><span class="co">## 3 -0.005254725 -0.0094352760                0                0      0.005254725</span></span>
<span><span class="co">## 4 -0.002424284 -0.0043411553                0                0      0.002424284</span></span>
<span><span class="co">## 5 -0.007609389 -0.0121049954                0                0      0.007609389</span></span>
<span><span class="co">## 6 -0.005637492 -0.0089045039                0                0      0.005637492</span></span>
<span><span class="co">##   HydraulicInput.4       psi.1       psi.2       psi.3       psi.4</span></span>
<span><span class="co">## 1      0.000000000 -0.02911359 -0.03180352 -0.03282877 -0.03293093</span></span>
<span><span class="co">## 2      0.011661979 -0.02845746 -0.03144058 -0.03270161 -0.03281269</span></span>
<span><span class="co">## 3      0.009435276 -0.02924575 -0.03142203 -0.03260225 -0.03270011</span></span>
<span><span class="co">## 4      0.004341155 -0.02394313 -0.02991958 -0.03237923 -0.03259489</span></span>
<span><span class="co">## 5      0.012104995 -0.02383056 -0.02961393 -0.03224385 -0.03247304</span></span>
<span><span class="co">## 6      0.008904504 -0.01302897 -0.02589535 -0.03179471 -0.03234676</span></span></code></pre>
<p>And a similar code can be used to daily series of cohort-level
variables:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/extract.html">extract</a></span><span class="op">(</span><span class="va">S</span>, <span class="st">"cohort"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         date cohort          species       LAI   LAIlive     FPAR</span></span>
<span><span class="co">## 1 2001-01-01 T1_148 Pinus halepensis 0.8487477 0.8487477 92.18285</span></span>
<span><span class="co">## 2 2001-01-02 T1_148 Pinus halepensis 0.8487477 0.8487477 92.18285</span></span>
<span><span class="co">## 3 2001-01-03 T1_148 Pinus halepensis 0.8487477 0.8487477 92.18285</span></span>
<span><span class="co">## 4 2001-01-04 T1_148 Pinus halepensis 0.8487477 0.8487477 92.18285</span></span>
<span><span class="co">## 5 2001-01-05 T1_148 Pinus halepensis 0.8487477 0.8487477 92.18285</span></span>
<span><span class="co">## 6 2001-01-06 T1_148 Pinus halepensis 0.8487477 0.8487477 92.18285</span></span>
<span><span class="co">##   AbsorbedSWRFraction Transpiration GrossPhotosynthesis    PlantPsi     LeafPLC</span></span>
<span><span class="co">## 1            35.07634    0.09247256           0.8934407 -0.03300000 0.003069557</span></span>
<span><span class="co">## 2            35.07634    0.17167226           1.5611765 -0.02951758 0.002512174</span></span>
<span><span class="co">## 3            35.07634    0.13648547           1.3089514 -0.02890922 0.002417711</span></span>
<span><span class="co">## 4            35.07634    0.05965898           0.5972837 -0.02957884 0.002521734</span></span>
<span><span class="co">## 5            35.07634    0.17590438           1.6200910 -0.02487192 0.001873895</span></span>
<span><span class="co">## 6            35.07634    0.12675398           1.3121531 -0.02473400 0.001794059</span></span>
<span><span class="co">##   StemPLC PlantWaterBalance   LeafRWC   StemRWC     LFMC PlantStress</span></span>
<span><span class="co">## 1       0      0.000000e+00 0.9979679 0.9998350 125.8900 0.005808769</span></span>
<span><span class="co">## 2       0      1.908389e-04 0.9981823 0.9998524 125.9049 0.004932295</span></span>
<span><span class="co">## 3       0      3.334063e-05 0.9982197 0.9998554 125.9075 0.004783882</span></span>
<span><span class="co">## 4       0     -3.669746e-05 0.9981785 0.9998521 125.9046 0.004947317</span></span>
<span><span class="co">## 5       0      2.579668e-04 0.9984682 0.9998756 125.9247 0.003836334</span></span>
<span><span class="co">## 6       0      7.558992e-06 0.9984767 0.9998763 125.9252 0.003805150</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="temporal-summaries">Temporal summaries<a class="anchor" aria-label="anchor" href="#temporal-summaries"></a>
</h3>
<p>While the simulation model uses daily steps, users will normally be
interested in outputs at larger time scales. The package provides a
<code>summary</code> for objects of class <code>spwb</code>. This
function can be used to summarize the model’s output at different
temporal steps (i.e. weekly, annual, …). For example, to obtain the
average soil moisture and water potentials by months one can use:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"Soil"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  W.1      W.2      W.3      W.4     ML.1     ML.2     ML.3</span></span>
<span><span class="co">## 2001-01-01 1.1832948 1.132263 1.037686 1.013238 80.66972 132.0818 78.60334</span></span>
<span><span class="co">## 2001-02-01 1.0029762 1.214418 1.226702 1.130190 68.37671 141.6655 92.92105</span></span>
<span><span class="co">## 2001-03-01 1.1218518 1.207655 1.298821 1.369937 76.48091 140.8765 98.38398</span></span>
<span><span class="co">## 2001-04-01 0.9714427 1.121488 1.248299 1.359250 66.22695 130.8249 94.55701</span></span>
<span><span class="co">## 2001-05-01 1.0322684 1.090530 1.197692 1.314739 70.37368 127.2135 90.72356</span></span>
<span><span class="co">## 2001-06-01 0.8389875 0.988646 1.139449 1.238293 57.19698 115.3285 86.31179</span></span>
<span><span class="co">## 2001-07-01 1.0847195 1.033553 1.095341 1.154467 73.94947 120.5670 82.97062</span></span>
<span><span class="co">## 2001-08-01 1.0853454 1.128277 1.137350 1.144378 73.99213 131.6169 86.15280</span></span>
<span><span class="co">## 2001-09-01 1.0542639 1.163151 1.215791 1.227809 71.87319 135.6850 92.09455</span></span>
<span><span class="co">## 2001-10-01 1.0613549 1.137133 1.240113 1.333936 72.35661 132.6499 93.93690</span></span>
<span><span class="co">## 2001-11-01 1.1249313 1.179790 1.240338 1.346123 76.69086 137.6260 93.95394</span></span>
<span><span class="co">## 2001-12-01 0.9474179 1.178870 1.285001 1.380952 64.58909 137.5187 97.33710</span></span>
<span><span class="co">##                ML.4    MLTot       WTD        SWE PlantExt.1 PlantExt.2</span></span>
<span><span class="co">## 2001-01-01 30.70058 322.0555 3435.1893 1.65619239 0.14602130 0.04159703</span></span>
<span><span class="co">## 2001-02-01 34.24415 337.2074 2326.4824 0.27608905 0.13239223 0.21487108</span></span>
<span><span class="co">## 2001-03-01 41.50838 357.2498  911.6781 0.01762496 0.21214792 0.12314557</span></span>
<span><span class="co">## 2001-04-01 41.18455 332.7934 1374.3155 0.58072652 0.19814837 0.20494711</span></span>
<span><span class="co">## 2001-05-01 39.83589 328.1467 1738.5183 0.00000000 0.31948918 0.18020538</span></span>
<span><span class="co">## 2001-06-01 37.51964 296.3569 2464.7900 0.00000000 0.24387255 0.36234605</span></span>
<span><span class="co">## 2001-07-01 34.97975 312.4668 2812.8362 0.00000000 0.57273666 0.10870511</span></span>
<span><span class="co">## 2001-08-01 34.67406 326.4359 2626.4794 0.00000000 0.46365614 0.23477201</span></span>
<span><span class="co">## 2001-09-01 37.20197 336.8548 1958.8639 0.00000000 0.28395785 0.21833333</span></span>
<span><span class="co">## 2001-10-01 40.41756 339.3610 1426.5425 0.00000000 0.21510582 0.11982186</span></span>
<span><span class="co">## 2001-11-01 40.78680 349.0576 1226.3862 2.60802857 0.16778824 0.08287584</span></span>
<span><span class="co">## 2001-12-01 41.84212 341.2870 1070.9767 0.00000000 0.06998114 0.13751595</span></span>
<span><span class="co">##              PlantExt.3    PlantExt.4 HydraulicInput.1 HydraulicInput.2</span></span>
<span><span class="co">## 2001-01-01 -0.004883586 -0.0087003956     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-02-01  0.044500183 -0.0008872063     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-03-01  0.035528683  0.0365968873     0.000000e+00      0.000362775</span></span>
<span><span class="co">## 2001-04-01  0.066177937  0.0596396712     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-05-01  0.060574705  0.0679023696     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-06-01  0.163287158  0.1238589680     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-07-01  0.025776968  0.0548342874     0.000000e+00      0.004686296</span></span>
<span><span class="co">## 2001-08-01  0.036881900  0.0318747391     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-09-01  0.057129886  0.0341171638     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-10-01  0.038252396  0.0401360856     0.000000e+00      0.000000000</span></span>
<span><span class="co">## 2001-11-01  0.016620692  0.0279494607     0.000000e+00      0.000102615</span></span>
<span><span class="co">## 2001-12-01  0.037152544  0.0306972723     2.749531e-06      0.000000000</span></span>
<span><span class="co">##            HydraulicInput.3 HydraulicInput.4       psi.1       psi.2</span></span>
<span><span class="co">## 2001-01-01     0.0050102738     0.0087305835 -0.01369548 -0.01776348</span></span>
<span><span class="co">## 2001-02-01     0.0000273933     0.0077677542 -0.03584120 -0.01128791</span></span>
<span><span class="co">## 2001-03-01     0.0000000000     0.0000000000 -0.01924505 -0.01137393</span></span>
<span><span class="co">## 2001-04-01     0.0000000000     0.0000000000 -0.03898937 -0.01887460</span></span>
<span><span class="co">## 2001-05-01     0.0000000000     0.0000000000 -0.03081532 -0.02154554</span></span>
<span><span class="co">## 2001-06-01     0.0000000000     0.0000000000 -0.07424054 -0.03586248</span></span>
<span><span class="co">## 2001-07-01     0.0098675510     0.0000000000 -0.02497344 -0.02859795</span></span>
<span><span class="co">## 2001-08-01     0.0048904217     0.0058282338 -0.02274888 -0.01764117</span></span>
<span><span class="co">## 2001-09-01     0.0000000000     0.0002652793 -0.02644398 -0.01477779</span></span>
<span><span class="co">## 2001-10-01     0.0000000000     0.0000000000 -0.02558056 -0.01694436</span></span>
<span><span class="co">## 2001-11-01     0.0022885547     0.0000000000 -0.02013385 -0.01359735</span></span>
<span><span class="co">## 2001-12-01     0.0000000000     0.0000000000 -0.04598328 -0.01416425</span></span>
<span><span class="co">##                   psi.3        psi.4</span></span>
<span><span class="co">## 2001-01-01 -0.027426636 -0.030851092</span></span>
<span><span class="co">## 2001-02-01 -0.009939852 -0.017598240</span></span>
<span><span class="co">## 2001-03-01 -0.005789310 -0.001730668</span></span>
<span><span class="co">## 2001-04-01 -0.008935663 -0.002622830</span></span>
<span><span class="co">## 2001-05-01 -0.012173367 -0.005018704</span></span>
<span><span class="co">## 2001-06-01 -0.016989777 -0.009668968</span></span>
<span><span class="co">## 2001-07-01 -0.020805616 -0.015495418</span></span>
<span><span class="co">## 2001-08-01 -0.016738051 -0.016181295</span></span>
<span><span class="co">## 2001-09-01 -0.010707582 -0.009876602</span></span>
<span><span class="co">## 2001-10-01 -0.009259632 -0.003822782</span></span>
<span><span class="co">## 2001-11-01 -0.009113008 -0.003170981</span></span>
<span><span class="co">## 2001-12-01 -0.006745345 -0.001340681</span></span></code></pre>
<p>Parameter <code>output</code> is used to indicate the element of the
<code>spwb</code> object for which we desire summaries. Similarly, it is
possible to calculate the average stress of plant cohorts by months:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 T1_148      T2_168      S1_165</span></span>
<span><span class="co">## 2001-01-01 0.001985462 0.005232916 0.001268496</span></span>
<span><span class="co">## 2001-02-01 0.005715021 0.007259694 0.002520776</span></span>
<span><span class="co">## 2001-03-01 0.002806560 0.004803863 0.001391760</span></span>
<span><span class="co">## 2001-04-01 0.006774315 0.009031853 0.003043899</span></span>
<span><span class="co">## 2001-05-01 0.004971766 0.008042035 0.002434006</span></span>
<span><span class="co">## 2001-06-01 0.016997242 0.017716655 0.006913838</span></span>
<span><span class="co">## 2001-07-01 0.005042894 0.008893714 0.002588027</span></span>
<span><span class="co">## 2001-08-01 0.003331616 0.006343846 0.001765602</span></span>
<span><span class="co">## 2001-09-01 0.003913303 0.006381814 0.001918654</span></span>
<span><span class="co">## 2001-10-01 0.003793325 0.006530277 0.001904921</span></span>
<span><span class="co">## 2001-11-01 0.002904384 0.005236764 0.001483781</span></span>
<span><span class="co">## 2001-12-01 0.008205662 0.009305483 0.003446380</span></span></code></pre>
<p>The <code>summary</code> function can be also used to aggregate the
output by species. In this case, the values of plant cohorts belonging
to the same species will be averaged using LAI values as weights. For
example, we may average the daily drought stress across cohorts of the
same species (here there is only one cohort by species, so this does not
modify the output):</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"day"</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Pinus halepensis Quercus coccifera Quercus ilex</span></span>
<span><span class="co">## 2001-01-01      0.005808769       0.003088161  0.010612890</span></span>
<span><span class="co">## 2001-01-02      0.004932295       0.002732516  0.009765614</span></span>
<span><span class="co">## 2001-01-03      0.004783882       0.002667853  0.009596770</span></span>
<span><span class="co">## 2001-01-04      0.004947317       0.002729240  0.009725823</span></span>
<span><span class="co">## 2001-01-05      0.003836334       0.002268566  0.008598340</span></span>
<span><span class="co">## 2001-01-06      0.003805150       0.002249521  0.008530598</span></span></code></pre>
<p>Or we can combine the aggregation by species with a temporal
aggregation (here monthly averages):</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"month"</span>, FUN <span class="op">=</span> <span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Pinus halepensis Quercus coccifera Quercus ilex</span></span>
<span><span class="co">## 2001-01-01      0.001985462       0.001268496  0.005232916</span></span>
<span><span class="co">## 2001-02-01      0.005715021       0.002520776  0.007259694</span></span>
<span><span class="co">## 2001-03-01      0.002806560       0.001391760  0.004803863</span></span>
<span><span class="co">## 2001-04-01      0.006774315       0.003043899  0.009031853</span></span>
<span><span class="co">## 2001-05-01      0.004971766       0.002434006  0.008042035</span></span>
<span><span class="co">## 2001-06-01      0.016997242       0.006913838  0.017716655</span></span>
<span><span class="co">## 2001-07-01      0.005042894       0.002588027  0.008893714</span></span>
<span><span class="co">## 2001-08-01      0.003331616       0.001765602  0.006343846</span></span>
<span><span class="co">## 2001-09-01      0.003913303       0.001918654  0.006381814</span></span>
<span><span class="co">## 2001-10-01      0.003793325       0.001904921  0.006530277</span></span>
<span><span class="co">## 2001-11-01      0.002904384       0.001483781  0.005236764</span></span>
<span><span class="co">## 2001-12-01      0.008205662       0.003446380  0.009305483</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="specific-output-functions">Specific output functions<a class="anchor" aria-label="anchor" href="#specific-output-functions"></a>
</h3>
<p>The package provides some functions to extract or transform specific
outputs from soil plant water balance simulations. In particular,
function <code><a href="../../reference/droughtStress.html">droughtStress()</a></code> allows calculating several plant
stress indices, such as the number of days with drought stress &gt; 0.5
or the maximum drought stress:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/droughtStress.html">droughtStress</a></span><span class="op">(</span><span class="va">S</span>, index <span class="op">=</span> <span class="st">"NDD"</span>, freq <span class="op">=</span> <span class="st">"years"</span>, draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            T1_148 T2_168 S1_165</span></span>
<span><span class="co">## 2001-01-01      0      0      0</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/droughtStress.html">droughtStress</a></span><span class="op">(</span><span class="va">S</span>, index <span class="op">=</span> <span class="st">"MDS"</span>, freq <span class="op">=</span> <span class="st">"years"</span>, draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                T1_148     T2_168      S1_165</span></span>
<span><span class="co">## 2001-01-01 0.02483919 0.02314682 0.009659831</span></span></code></pre>
<p>As the general summary function, <code><a href="../../reference/droughtStress.html">droughtStress()</a></code> allows
calculating stress indices at several temporal scales. For example the
water stress index (integral of water potential values) can be
calculated and drawn for every month:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/droughtStress.html">droughtStress</a></span><span class="op">(</span><span class="va">S</span>, index <span class="op">=</span> <span class="st">"WSI"</span>, freq <span class="op">=</span> <span class="st">"months"</span>, draw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Another specific summary function is
<code><a href="../../reference/waterUseEfficiency.html">waterUseEfficiency()</a></code>. This is most useful with advanced
water and energy balance modeling, but for simple water balance it
calculates the ratio between photosynthesis and transpiration at the
desired scale. In this case it is equal to the value of the input
species parameter <code>WUE</code>:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/waterUseEfficiency.html">waterUseEfficiency</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Stand Ag/E"</span>, freq <span class="op">=</span> <span class="st">"months"</span>, draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Stand Ag/E</span></span>
<span><span class="co">## 2001-01-01  10.040875</span></span>
<span><span class="co">## 2001-02-01   8.178847</span></span>
<span><span class="co">## 2001-03-01   8.976320</span></span>
<span><span class="co">## 2001-04-01   8.807687</span></span>
<span><span class="co">## 2001-05-01   8.207741</span></span>
<span><span class="co">## 2001-06-01   6.285326</span></span>
<span><span class="co">## 2001-07-01   6.966234</span></span>
<span><span class="co">## 2001-08-01   6.219062</span></span>
<span><span class="co">## 2001-09-01   7.434114</span></span>
<span><span class="co">## 2001-10-01   7.642937</span></span>
<span><span class="co">## 2001-11-01   8.710472</span></span>
<span><span class="co">## 2001-12-01   8.406079</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>De Cáceres M, Martínez-Vilalta J, Coll L, Llorens P, Casals P,
Poyatos R, Pausas JG, Brotons L. (2015) Coupling a water balance model
with forest inventory data to predict drought stress: the role of forest
structural changes vs. climate changes. Agricultural and Forest
Meteorology 213: 77-90 (<a href="https://doi.org/10.1016/j.agrformet.2015.06.012" class="external-link uri">https://doi.org/10.1016/j.agrformet.2015.06.012</a>).</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

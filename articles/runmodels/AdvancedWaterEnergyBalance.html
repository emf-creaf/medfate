<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced water and energy balance • medfate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Advanced water and energy balance">
<meta name="description" content="Learn how to conduct soil plant water balance model simulations using a more detailed approach for energy balance, plant hydraulics, stomatal regulation and photosynthesis
">
<meta property="og:description" content="Learn how to conduct soil plant water balance model simulations using a more detailed approach for energy balance, plant hydraulics, stomatal regulation and photosynthesis
">
<meta property="og:image" content="https://emf-creaf.github.io/medfate/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">medfate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../../articles/intro/PackageOverview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/UnderstandingInputs.html">Understanding model inputs</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/PreparingInputs.html">Preparing model inputs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Running simulations</h6></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/BasicWaterBalance.html">Basic water balance</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/AdvancedWaterEnergyBalance.html">Advanced water and energy balance</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ForestGrowth.html">Forest growth</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ForestDynamics.html">Forest dynamics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/medfate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Advanced water and energy balance</h1>
                        <h4 data-toc-skip class="author">Miquel De
Caceres</h4>
            
            <h4 data-toc-skip class="date">2024-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/vignettes/runmodels/AdvancedWaterEnergyBalance.Rmd" class="external-link"><code>vignettes/runmodels/AdvancedWaterEnergyBalance.Rmd</code></a></small>
      <div class="d-none name"><code>AdvancedWaterEnergyBalance.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="about-this-vignette">About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h2>
<p>This document describes how to run a water and energy balance model
that uses a more detailed approach for hydraulics and stomatal
regulation described in De Cáceres et al. (2021) and Ruffault et
al. (2022). We recommend reading vignette <a href="https://emf-creaf.github.io/medfate/articles/runmodels/BasicWaterBalance.html"><em>Basic
water balance</em></a> before this one for a more accessible
introduction to soil water balance modelling. This vignette is meant to
teach users to run the simulation model within R. All the details of the
model design and formulation can be found at the <a href="https://emf-creaf.github.io/medfatebook/index.html">medfatebook</a>.</p>
</div>
<div class="section level2">
<h2 id="preparing-model-inputs">Preparing model inputs<a class="anchor" aria-label="anchor" href="#preparing-model-inputs"></a>
</h2>
<p>Model inputs are explained in greater detail in vignettes <a href="https://emf-creaf.github.io/medfate/articles/intro/UnderstandingInputs.html"><em>Understanding
model inputs</em></a> and <a href="https://emf-creaf.github.io/medfate/articles/intro/PreparingInputs.html"><em>Preparing
model inputs</em></a>. Here we only review the different steps required
to run function <code><a href="../../reference/spwb.html">spwb()</a></code>.</p>
<div class="section level3">
<h3 id="soil-vegetation-meteorology-and-species-data">Soil, vegetation, meteorology and species data<a class="anchor" aria-label="anchor" href="#soil-vegetation-meteorology-and-species-data"></a>
</h3>
<p>Soil information needs to be entered as a <code>data frame</code>
with soil layers in rows and physical attributes in columns. Soil
physical attributes can be initialized to default values, for a given
number of layers, using function <code><a href="../../reference/defaultSoilParams.html">defaultSoilParams()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examplesoil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">examplesoil</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths clay sand om nitrogen  bd rfc</span></span>
<span><span class="co">## 1    300   25   25 NA       NA 1.5  25</span></span>
<span><span class="co">## 2    700   25   25 NA       NA 1.5  45</span></span>
<span><span class="co">## 3   1000   25   25 NA       NA 1.5  75</span></span>
<span><span class="co">## 4   2000   25   25 NA       NA 1.5  95</span></span></code></pre>
<p>As explained in the package overview, models included in
<code>medfate</code> were primarily designed to be ran on <strong>forest
inventory plots</strong>. Here we use the example object provided with
the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleforest</span><span class="op">)</span></span>
<span><span class="va">exampleforest</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##            Species   N   DBH Height Z50  Z95</span></span>
<span><span class="co">## 1 Pinus halepensis 168 37.55    800 100  600</span></span>
<span><span class="co">## 2     Quercus ilex 384 14.60    660 300 1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##             Species Cover Height Z50  Z95</span></span>
<span><span class="co">## 1 Quercus coccifera  3.75     80 200 1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 20</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $seedBank</span></span>
<span><span class="co">## [1] Species Percent</span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>Importantly, a data frame with daily weather for the period to be
simulated is required. Here we use the default data frame included with
the package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        dates MinTemperature MaxTemperature Precipitation MinRelativeHumidity</span></span>
<span><span class="co">## 1 2001-01-01     -0.5934215       6.287950      4.869109            65.15411</span></span>
<span><span class="co">## 2 2001-01-02     -2.3662458       4.569737      2.498292            57.43761</span></span>
<span><span class="co">## 3 2001-01-03     -3.8541036       2.661951      0.000000            58.77432</span></span>
<span><span class="co">## 4 2001-01-04     -1.8744860       3.097705      5.796973            66.84256</span></span>
<span><span class="co">## 5 2001-01-05      0.3288287       7.551532      1.884401            62.97656</span></span>
<span><span class="co">## 6 2001-01-06      0.5461322       7.186784     13.359801            74.25754</span></span>
<span><span class="co">##   MaxRelativeHumidity Radiation WindSpeed</span></span>
<span><span class="co">## 1           100.00000  12.89251  2.000000</span></span>
<span><span class="co">## 2            94.71780  13.03079  7.662544</span></span>
<span><span class="co">## 3            94.66823  16.90722  2.000000</span></span>
<span><span class="co">## 4            95.80950  11.07275  2.000000</span></span>
<span><span class="co">## 5           100.00000  13.45205  7.581347</span></span>
<span><span class="co">## 6           100.00000  12.84841  6.570501</span></span></code></pre>
<p>Finally, simulations in <code>medfate</code> require a data frame
with species parameter values, which we load using defaults for
Catalonia (NE Spain):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-control">Simulation control<a class="anchor" aria-label="anchor" href="#simulation-control"></a>
</h3>
<p>Apart from data inputs, the behaviour of simulation models is
controlled using a set of global parameters. The default
parameterization is obtained using function
<code><a href="../../reference/defaultControl.html">defaultControl()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="st">"Sperry"</span><span class="op">)</span></span></code></pre></div>
<p>To use the advanced water balance model we must change the values of
<code>transpirationMode</code> to switch from <code>"Granier"</code> to
either <code>"Sperry"</code> or <code>"Sureau"</code>.</p>
</div>
<div class="section level3">
<h3 id="water-balance-input-object">Water balance input object<a class="anchor" aria-label="anchor" href="#water-balance-input-object"></a>
</h3>
<p>A last object is needed before calling simulation functions, called
<code>spwbInput</code>. It consists in the compilation of aboveground,
belowground parameters and the specification of additional parameter
values for each plant cohort. This is done by calling function
<code><a href="../../reference/modelInput.html">spwbInput()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modelInput.html">spwbInput</a></span><span class="op">(</span><span class="va">exampleforest</span>, <span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, <span class="va">control</span><span class="op">)</span></span></code></pre></div>
<p>The <code>spwbInput</code> object for advanced water and energy
balance is similar to that of simple water balance simulations, but
contains more elements. Information about the cohort species is found in
element <code>cohorts</code>, i.e. the cohort code, the species index
and species name:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">cohorts</span></span></code></pre></div>
<pre><code><span><span class="co">##         SP              Name</span></span>
<span><span class="co">## T1_148 148  Pinus halepensis</span></span>
<span><span class="co">## T2_168 168      Quercus ilex</span></span>
<span><span class="co">## S1_165 165 Quercus coccifera</span></span></code></pre>
<p>Element <code>soil</code> contains soil layer parameters and state
variables (moisture and temperature):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">soil</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths sand clay      usda om nitrogen  bd rfc  macro     Ksat VG_alpha</span></span>
<span><span class="co">## 1    300   25   25 Silt loam NA       NA 1.5  25 0.0485 5401.471 89.16112</span></span>
<span><span class="co">## 2    700   25   25 Silt loam NA       NA 1.5  45 0.0485 5401.471 89.16112</span></span>
<span><span class="co">## 3   1000   25   25 Silt loam NA       NA 1.5  75 0.0485 5401.471 89.16112</span></span>
<span><span class="co">## 4   2000   25   25 Silt loam NA       NA 1.5  95 0.0485 5401.471 89.16112</span></span>
<span><span class="co">##       VG_n VG_theta_res VG_theta_sat W Temp</span></span>
<span><span class="co">## 1 1.303861        0.041     0.423715 1   NA</span></span>
<span><span class="co">## 2 1.303861        0.041     0.423715 1   NA</span></span>
<span><span class="co">## 3 1.303861        0.041     0.423715 1   NA</span></span>
<span><span class="co">## 4 1.303861        0.041     0.423715 1   NA</span></span></code></pre>
<p>As an aside, the columns in <code>x$soil</code> that were not present
in the input data frame <code>examplesoil</code> are created by an
internal call to a soil initialization function called
<code><a href="../../reference/soil.html">soil()</a></code>.</p>
<p>Element <code>canopy</code> contains state variables within the
canopy:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">canopy</span></span></code></pre></div>
<pre><code><span><span class="co">##    zlow zmid  zup LAIlive LAIexpanded LAIdead Tair Cair VPair</span></span>
<span><span class="co">## 1     0   50  100      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 2   100  150  200      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 3   200  250  300      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 4   300  350  400      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 5   400  450  500      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 6   500  550  600      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 7   600  650  700      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 8   700  750  800      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 9   800  850  900      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 10  900  950 1000      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 11 1000 1050 1100      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 12 1100 1150 1200      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 13 1200 1250 1300      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 14 1300 1350 1400      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 15 1400 1450 1500      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 16 1500 1550 1600      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 17 1600 1650 1700      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 18 1700 1750 1800      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 19 1800 1850 1900      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 20 1900 1950 2000      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 21 2000 2050 2100      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 22 2100 2150 2200      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 23 2200 2250 2300      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 24 2300 2350 2400      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 25 2400 2450 2500      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 26 2500 2550 2600      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 27 2600 2650 2700      NA          NA      NA   NA   NA    NA</span></span>
<span><span class="co">## 28 2700 2750 2800      NA          NA      NA   NA   NA    NA</span></span></code></pre>
<p>Canopy temperature, water vapour pressure and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>O</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CO_2</annotation></semantics></math>
concentration are state variables needed for canopy energy balance. If
the canopy energy balance assumes a single canopy layer, the same values
will be assumed through the canopy. Variation of within-canopy state
variables is modelled if a multi-canopy energy balance is used (see
control parameter <code>multiLayerBalance</code>).</p>
<p>As you may already known, element <code>above</code> contains the
aboveground structure data that we already know:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">above</span></span></code></pre></div>
<pre><code><span><span class="co">##          H        CR   LAI_live LAI_expanded LAI_dead ObsID</span></span>
<span><span class="co">## T1_148 800 0.6605196 0.84874773   0.84874773        0  &lt;NA&gt;</span></span>
<span><span class="co">## T2_168 660 0.6055642 0.70557382   0.70557382        0  &lt;NA&gt;</span></span>
<span><span class="co">## S1_165  80 0.8032817 0.03062604   0.03062604        0  &lt;NA&gt;</span></span></code></pre>
<p>Belowground parameters can be seen in <code>below</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">below</span></span></code></pre></div>
<pre><code><span><span class="co">##        Z50  Z95 Z100</span></span>
<span><span class="co">## T1_148 100  600   NA</span></span>
<span><span class="co">## T2_168 300 1000   NA</span></span>
<span><span class="co">## S1_165 200 1000   NA</span></span></code></pre>
<p>and in <code>belowLayers</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">belowLayers</span></span></code></pre></div>
<pre><code><span><span class="co">## $V</span></span>
<span><span class="co">##                1         2          3           4</span></span>
<span><span class="co">## T1_148 0.8604899 0.1194556 0.01511005 0.004944476</span></span>
<span><span class="co">## T2_168 0.5008953 0.4505941 0.04064831 0.007862284</span></span>
<span><span class="co">## S1_165 0.6799879 0.2737911 0.03567632 0.010544678</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $L</span></span>
<span><span class="co">##               1        2        3        4</span></span>
<span><span class="co">## T1_148 2289.062 1566.552 2250.052 4226.166</span></span>
<span><span class="co">## T2_168 1817.571 2100.346 2410.127 4285.194</span></span>
<span><span class="co">## S1_165 1085.030 1380.808 2170.587 4146.637</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VGrhizo_kmax</span></span>
<span><span class="co">##               1        2         3         4</span></span>
<span><span class="co">## T1_148 11478618  1593494  201562.5  65957.49</span></span>
<span><span class="co">## T2_168 36121247 32493859 2931286.8 566975.78</span></span>
<span><span class="co">## S1_165 10941459  4405482  574055.7 169670.90</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VCroot_kmax</span></span>
<span><span class="co">##               1         2          3           4</span></span>
<span><span class="co">## T1_148 2.382795 0.4833484 0.04256689 0.007416044</span></span>
<span><span class="co">## T2_168 1.568929 1.2213562 0.09601747 0.010445417</span></span>
<span><span class="co">## S1_165 2.407779 0.7618041 0.06314806 0.009770000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Wpool</span></span>
<span><span class="co">##        1 2 3 4</span></span>
<span><span class="co">## T1_148 1 1 1 1</span></span>
<span><span class="co">## T2_168 1 1 1 1</span></span>
<span><span class="co">## S1_165 1 1 1 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $RhizoPsi</span></span>
<span><span class="co">##             1      2      3      4</span></span>
<span><span class="co">## T1_148 -0.033 -0.033 -0.033 -0.033</span></span>
<span><span class="co">## T2_168 -0.033 -0.033 -0.033 -0.033</span></span>
<span><span class="co">## S1_165 -0.033 -0.033 -0.033 -0.033</span></span></code></pre>
<p>The <code>spwbInput</code>object also includes cohort parameter
values for several kinds of traits. For example, plant anatomy
parameters are described in <code>paramsAnatomy</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">paramsAnatomy</span></span></code></pre></div>
<pre><code><span><span class="co">##        Hmed    Al2As      SLA LeafWidth LeafDensity WoodDensity FineRootDensity</span></span>
<span><span class="co">## T1_148  850 1317.523 5.140523 0.1384772   0.2982842   0.6077016       0.2982842</span></span>
<span><span class="co">## T2_168  500 3908.823 6.340000 1.7674359   0.4893392   0.9008264       0.4893392</span></span>
<span><span class="co">## S1_165   80 4189.325 4.980084 1.3761085   0.3709679   0.4389106       0.3709679</span></span>
<span><span class="co">##        conduit2sapwood      SRL RLD     r635</span></span>
<span><span class="co">## T1_148       0.9236406 3172.572  10 1.964226</span></span>
<span><span class="co">## T2_168       0.6238125 4398.812  10 1.805872</span></span>
<span><span class="co">## S1_165       0.6238125 4398.812  10 2.289452</span></span></code></pre>
<p>Parameters related to plant transpiration and photosynthesis can be
seen in <code>paramsTranspiration</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">paramsTranspiration</span></span></code></pre></div>
<pre><code><span><span class="co">##             Gswmin    Gswmax  Vmax298  Jmax298 Kmax_stemxylem Kmax_rootxylem</span></span>
<span><span class="co">## T1_148 0.003086667 0.2850000 72.19617 124.1687           0.15           0.60</span></span>
<span><span class="co">## T2_168 0.004473333 0.2007222 68.51600 118.7863           0.40           1.60</span></span>
<span><span class="co">## S1_165 0.010455247 0.2830167 62.78100 118.4486           0.29           1.16</span></span>
<span><span class="co">##        VCleaf_kmax VCleafapo_kmax  VCleaf_c  VCleaf_d kleaf_symp VCstem_kmax</span></span>
<span><span class="co">## T1_148    4.000000        8.00000 11.137050 -2.380849    8.00000    1.339563</span></span>
<span><span class="co">## T2_168    4.000000        8.00000  1.339370 -2.582279    8.00000    1.620936</span></span>
<span><span class="co">## S1_165    9.579077       19.15815  2.254991 -3.133381   19.15815    4.599269</span></span>
<span><span class="co">##         VCstem_c  VCstem_d VCroot_kmax  VCroot_c  VCroot_d VGrhizo_kmax</span></span>
<span><span class="co">## T1_148 12.709999 -5.290000    2.916127 11.137050 -3.065569     13339632</span></span>
<span><span class="co">## T2_168  3.560000 -7.720000    2.896748  1.339370 -2.214081     72113368</span></span>
<span><span class="co">## S1_165  3.095442 -7.857378    3.242501  1.402489 -1.523324     16090667</span></span>
<span><span class="co">##        Plant_kmax   FR_leaf   FR_stem   FR_root</span></span>
<span><span class="co">## T1_148  0.7465846 0.1866462 0.5573346 0.2560193</span></span>
<span><span class="co">## T2_168  0.8249857 0.2062464 0.5089563 0.2847972</span></span>
<span><span class="co">## S1_165  1.5867376 0.1656462 0.3449978 0.4893561</span></span></code></pre>
<p>Parameters related to pressure-volume curves and water storage
capacity of leaf and stem organs are in
<code>paramsWaterStorage</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">paramsWaterStorage</span></span></code></pre></div>
<pre><code><span><span class="co">##           maxFMC   LeafPI0   LeafEPS LeafAF     Vleaf   StemPI0   StemEPS</span></span>
<span><span class="co">## T1_148 126.03063 -1.591429  8.918571 0.3525 0.5258525 -2.008039 13.256355</span></span>
<span><span class="co">## T2_168  93.15304 -1.483333 19.260000 0.1700 0.2199087 -3.227438 46.420610</span></span>
<span><span class="co">## S1_165  96.53441 -2.370000 17.230000 0.2400 0.4108968 -1.305868  6.297155</span></span>
<span><span class="co">##           StemAF Vsapwood</span></span>
<span><span class="co">## T1_148 0.9236406 6.174277</span></span>
<span><span class="co">## T2_168 0.6238125 1.278142</span></span>
<span><span class="co">## S1_165 0.6238125 1.064511</span></span></code></pre>
<p>Finally, remember that one can play with plant-specific parameters
for soil water balance (instead of using species-level values) by
modifying manually the parameter values in this object.</p>
</div>
</div>
<div class="section level2">
<h2 id="static-analysis-of-sub-models">Static analysis of sub-models<a class="anchor" aria-label="anchor" href="#static-analysis-of-sub-models"></a>
</h2>
<p>Before using the advanced water and energy balance model, is
important to understand the parameters that influence the different
sub-models. Package <code>medfate</code> provides low-level functions
corresponding to sub-models (light extinction, hydraulics,
transpiration, photosynthesis…). In addition, there are several
high-level plotting functions that allow examining several aspects of
these processes.</p>
<div class="section level3">
<h3 id="vulnerability-curves">Vulnerability curves<a class="anchor" aria-label="anchor" href="#vulnerability-curves"></a>
</h3>
<p>Given a <code>spwbInput</code> object, we can use function
<code><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_vulnerabilityCurvePlot()</a></code> to inspect
<strong>vulnerability curves</strong> (i.e. how hydraulic conductance of
a given segment changes with the water potential) for each plant cohort
and each of the different segments of the soil-plant hydraulic network:
rhizosphere, roots, stems and leaves:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"leaf"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"stem"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"root"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplesoil</span>, type<span class="op">=</span><span class="st">"rhizo"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-4.png" width="480" style="display: block; margin: auto;"></p>
<p>The maximum values and shape of vulnerability curves for leaves and
stems are regulated by parameters in <code>paramsTranspiration</code>.
Roots have vulnerability curve parameters in the same data frame, but
maximum conductance values need to be specified for each soil layer and
are given in <code>belowLayers$VCroot_kmax</code>. Note that the last
call to <code><a href="../../reference/hydraulics_conductancefunctions.html">hydraulics_vulnerabilityCurvePlot()</a></code> includes a
<code>soil</code> object. This is because the van Genuchten parameters
that define the shape of the vulnerability curve for the rhizosphere are
stored in this object. Maximum conductance values in the rhizosphere are
given in <code>belowLayers$VGrhizo_kmax</code>.</p>
</div>
<div class="section level3">
<h3 id="supply-functions">Supply functions<a class="anchor" aria-label="anchor" href="#supply-functions"></a>
</h3>
<p>The vulnerability curves conforming the hydraulic network are used in
the model to build the <strong>supply function</strong>, which relates
water flow (i.e. transpiration) with the drop of water potential along
the whole hydraulic pathway. The supply function contains not only these
two variables, but also the water potential of intermediate nodes in the
the hydraulic network. Function
<code><a href="../../reference/hydraulics_supplyfunctions.html">hydraulics_supplyFunctionPlot()</a></code> can be used to inspect any
of this variables:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"E"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"ERhizo"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"dEdP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hydraulics_supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"StemPsi"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-4.png" width="480" style="display: block; margin: auto;"></p>
<p>Calls to <code><a href="../../reference/hydraulics_supplyfunctions.html">hydraulics_supplyFunctionPlot()</a></code> always need
both a <code>spwbInput</code> object and a <code>soil</code> object. The
soil moisture state (i.e. its water potential) is the starting point for
the calculation of the supply function, so different curves will be
obtained for different values of soil moisture.</p>
</div>
<div class="section level3">
<h3 id="stomatal-regulation-and-photosynthesis">Stomatal regulation and photosynthesis<a class="anchor" aria-label="anchor" href="#stomatal-regulation-and-photosynthesis"></a>
</h3>
<p>The soil water balance model determines stomatal conductance and
transpiration separately for sunlit and shade leaves. Stomatal
conductance is determined after building a photosynthesis function
corresponding to the supply function and finding the value of stomatal
conductance that maximizes carbon revenue while avoiding hydraulic
damage (a profit-maximization approach). Given a meteorological and soil
inputs and a chosen day and timestep, function
<code><a href="../../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot()</a></code> allows displaying the
supply and photosynthesis curves for sunlit and shade leaves, along with
an indication of the values corresponding to the chosen stomatal
aperture:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="fu"><a href="../../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,</span>
<span>                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"E"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package 'meteoland' [ver. 2.2.2]</span></span></code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,</span>
<span>                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"An"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,</span>
<span>                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"Gsw"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,</span>
<span>                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"T"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-4.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,</span>
<span>                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"VPD"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-5.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="pressure-volume-curves">Pressure volume curves<a class="anchor" aria-label="anchor" href="#pressure-volume-curves"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/moisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"leaf"</span>, fraction<span class="op">=</span><span class="st">"symplastic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/moisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"leaf"</span>, fraction<span class="op">=</span><span class="st">"apoplastic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/moisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"stem"</span>, fraction<span class="op">=</span><span class="st">"symplastic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/moisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"stem"</span>, fraction<span class="op">=</span><span class="st">"apoplastic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-4.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="water-balance-for-a-single-day">Water balance for a single day<a class="anchor" aria-label="anchor" href="#water-balance-for-a-single-day"></a>
</h2>
<div class="section level3">
<h3 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h3>
<p>Soil water balance simulations will normally span periods of several
months or years, but since the model operates at a daily and subdaily
temporal scales, it is possible to perform soil water balance for one
day only. This is done using function <code><a href="../../reference/spwb_day.html">spwb_day()</a></code>. In the
following code we select the same day as before from the meteorological
input data and perform soil water balance for that day only:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date</span> <span class="op">&lt;-</span> <span class="va">examplemeteo</span><span class="op">$</span><span class="va">dates</span><span class="op">[</span><span class="va">d</span><span class="op">]</span></span>
<span><span class="va">meteovec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">[</span><span class="va">d</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sd1</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/spwb_day.html">spwb_day</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">date</span>, <span class="va">meteovec</span>, </span>
<span>             latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, slope<span class="op">=</span> <span class="fl">0</span>, aspect <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>The output of <code><a href="../../reference/spwb_day.html">spwb_day()</a></code> is a list with several
elements:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "cohorts"            "topography"         "weather"           </span></span>
<span><span class="co">##  [4] "WaterBalance"       "EnergyBalance"      "Soil"              </span></span>
<span><span class="co">##  [7] "Stand"              "Plants"             "RhizoPsi"          </span></span>
<span><span class="co">## [10] "SunlitLeaves"       "ShadeLeaves"        "ExtractionInst"    </span></span>
<span><span class="co">## [13] "PlantsInst"         "RadiationInputInst" "SunlitLeavesInst"  </span></span>
<span><span class="co">## [16] "ShadeLeavesInst"    "LightExtinction"    "LWRExtinction"     </span></span>
<span><span class="co">## [19] "CanopyTurbulence"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="water-balance-output">Water balance output<a class="anchor" aria-label="anchor" href="#water-balance-output"></a>
</h3>
<p>Element <code>WaterBalance</code> contains the soil water balance
flows of the day (precipitation, infiltration, transpiration, …)</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd1</span><span class="op">$</span><span class="va">WaterBalance</span></span></code></pre></div>
<pre><code><span><span class="co">##                     PET                    Rain                    Snow </span></span>
<span><span class="co">##              3.90233421              0.00000000              0.00000000 </span></span>
<span><span class="co">##                 NetRain                Snowmelt                   Runon </span></span>
<span><span class="co">##              0.00000000              0.00000000              0.00000000 </span></span>
<span><span class="co">##            Infiltration      InfiltrationExcess        SaturationExcess </span></span>
<span><span class="co">##              0.00000000              0.00000000              0.00000000 </span></span>
<span><span class="co">##                  Runoff            DeepDrainage         CapillarityRise </span></span>
<span><span class="co">##              0.00000000              0.00000000              0.00000000 </span></span>
<span><span class="co">##         SoilEvaporation       HerbTranspiration         PlantExtraction </span></span>
<span><span class="co">##              0.50000000              0.04872542              0.68193813 </span></span>
<span><span class="co">##           Transpiration HydraulicRedistribution </span></span>
<span><span class="co">##              0.68193813              0.00000000</span></span></code></pre>
<p>And <code>Soil</code> contains water evaporated from each soil layer,
water transpired from each soil layer and the final soil water
potential:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd1</span><span class="op">$</span><span class="va">Soil</span></span></code></pre></div>
<pre><code><span><span class="co">##           Psi HerbTranspiration HydraulicInput HydraulicOutput PlantExtraction</span></span>
<span><span class="co">## 1 -0.03546638      0.0444001775              0     0.492903481     0.492903481</span></span>
<span><span class="co">## 2 -0.03323704      0.0034620610              0     0.172765576     0.172765576</span></span>
<span><span class="co">## 3 -0.03303075      0.0006078123              0     0.014283119     0.014283119</span></span>
<span><span class="co">## 4 -0.03301157      0.0002553696              0     0.001985958     0.001985958</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="soil-and-canopy-energy-balance">Soil and canopy energy balance<a class="anchor" aria-label="anchor" href="#soil-and-canopy-energy-balance"></a>
</h3>
<p>Element <code>EnergyBalance</code> contains subdaily variation in
atmosphere, canopy and soil temperatures, as well as canopy and soil
energy balance components.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">$</span><span class="va">EnergyBalance</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Temperature"         "SoilTemperature"     "CanopyEnergyBalance"</span></span>
<span><span class="co">## [4] "SoilEnergyBalance"   "TemperatureLayers"   "VaporPressureLayers"</span></span></code></pre>
<p>Package <code>medfate</code> provides a <code>plot</code> function
for objects of class <code>spwb_day</code> that can be used to inspect
the results of the simulation. We use this function to display subdaily
dynamics in plant, soil and canopy variables. For example, we can use it
to display temperature variations (only the temperature of the topmost
soil layer is drawn):</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"Temperature"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-25-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"CanopyEnergyBalance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-25-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"SoilEnergyBalance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-25-3.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="plant-output">Plant output<a class="anchor" aria-label="anchor" href="#plant-output"></a>
</h3>
<p>Element <code>Plants</code> contains output values by plant cohort.
Several output variables can be inspected in this element.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd1</span><span class="op">$</span><span class="va">Plants</span></span></code></pre></div>
<pre><code><span><span class="co">##               LAI    LAIlive     FPAR Extraction Transpiration</span></span>
<span><span class="co">## T1_148 0.84874773 0.84874773 92.18285 0.43956224    0.43956224</span></span>
<span><span class="co">## T2_168 0.70557382 0.70557382 72.36365 0.23014830    0.23014830</span></span>
<span><span class="co">## S1_165 0.03062604 0.03062604 44.32407 0.01222759    0.01222759</span></span>
<span><span class="co">##        GrossPhotosynthesis NetPhotosynthesis    RootPsi    StemPsi LeafPLC</span></span>
<span><span class="co">## T1_148          2.13022158        2.01874641 -0.4190276 -1.2593181       0</span></span>
<span><span class="co">## T2_168          1.74699792        1.64058614 -0.3353606 -0.8559196       0</span></span>
<span><span class="co">## S1_165          0.06680025        0.06294932 -0.3759137 -0.6029081       0</span></span>
<span><span class="co">##             StemPLC LeafPsiMin  LeafPsiMax      dEdP        DDS   StemRWC</span></span>
<span><span class="co">## T1_148 5.822231e-09 -1.5416393 -0.03994108 0.5034372 0.00162010 0.9971787</span></span>
<span><span class="co">## T2_168 2.190611e-04 -1.1346709 -0.04019180 0.5267180 0.05471817 0.9973301</span></span>
<span><span class="co">## S1_165 1.941646e-04 -0.7151737 -0.04188680 1.0421555 0.02757310 0.9882134</span></span>
<span><span class="co">##          LeafRWC      LFMC WaterBalance</span></span>
<span><span class="co">## T1_148 0.9582043 123.17434 4.884331e-17</span></span>
<span><span class="co">## T2_168 0.9828404  92.15690 1.059808e-17</span></span>
<span><span class="co">## S1_165 0.9892339  95.43963 1.162129e-18</span></span></code></pre>
<p>While <code>Plants</code> contains one value per cohort and variable
that summarizes the whole simulated day, information by disaggregated by
time step can be accessed in <code>PlantsInst</code>. Moreover, we can
use function <code><a href="../../reference/plot.spwb_day.html">plot.spwb_day()</a></code> to draw plots of sub-daily
variation per species of plant transpiration per ground area
(L·m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mi>−</mi><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>),
transpiration per leaf area (also in
L·m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mi>−</mi><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>),
plant net photosynthesis (in g
C·m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mi>−</mi><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>),
and plant water potential (in MPa):</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"PlantTranspiration"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"TranspirationPerLeaf"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"NetPhotosynthesis"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafPsiAverage"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-4.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="output-for-sunlit-and-shade-leaves">Output for sunlit and shade leaves<a class="anchor" aria-label="anchor" href="#output-for-sunlit-and-shade-leaves"></a>
</h3>
<p>The model distinguishes between sunlit and shade leaves for stomatal
regulation. Static properties of sunlit and shade leaves, for each
cohort, can be accessed via:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd1</span><span class="op">$</span><span class="va">SunlitLeaves</span></span></code></pre></div>
<pre><code><span><span class="co">##        LeafPsiMin  LeafPsiMax      GSWMin     GSWMax  TempMin  TempMax</span></span>
<span><span class="co">## T1_148  -1.642069 -0.03994108 0.002241953 0.27360581 1.279208 12.06469</span></span>
<span><span class="co">## T2_168  -1.593485 -0.04199022 0.003269167 0.07335742 1.277051 17.39678</span></span>
<span><span class="co">## S1_165  -1.122060 -0.04703362 0.007561899 0.09592298 1.272441 17.10881</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd1</span><span class="op">$</span><span class="va">ShadeLeaves</span></span></code></pre></div>
<pre><code><span><span class="co">##        LeafPsiMin  LeafPsiMax      GSWMin     GSWMax   TempMin   TempMax</span></span>
<span><span class="co">## T1_148 -1.4414211 -0.03994108 0.002250180 0.27766981 0.9522202 10.193861</span></span>
<span><span class="co">## T2_168 -0.7791464 -0.04019180 0.003263123 0.08185659 0.5410246 10.246696</span></span>
<span><span class="co">## S1_165 -0.5152537 -0.04188680 0.007596296 0.10627887 0.6878264  9.975201</span></span></code></pre>
<p>Instantaneous values are also stored for sunlit and shade leaves. We
can also use the <code>plot</code> function for objects of class
<code>spwb_day</code> to draw instantaneous variations in temperature
for sunlit and shade leaves:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafTemperature"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Note that sunlit leaves of some species reach temperatures higher
than the canopy. We can also plot variations in instantaneous gross and
net photosynthesis rates:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafGrossPhotosynthesis"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafNetPhotosynthesis"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or variations in stomatal conductance:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafStomatalConductance"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or variations in vapour pressure deficit:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafVPD"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or variations in leaf water potential:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafPsi"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafCi"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-35-1.png" width="720" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafIntrinsicWUE"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-36-1.png" width="720" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="water-balance-for-multiple-days">Water balance for multiple days<a class="anchor" aria-label="anchor" href="#water-balance-for-multiple-days"></a>
</h2>
<div class="section level3">
<h3 id="running-the-model-1">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model-1"></a>
</h3>
<p>Users will often use function <code><a href="../../reference/spwb.html">spwb()</a></code> to run the soil
water balance model for several days. This function requires the
<code>spwbInput</code> object, the <code>soil</code> object and the
meteorological data frame. However, running <code><a href="../../reference/spwb_day.html">spwb_day()</a></code>
modified the input objects. In particular, the soil moisture at the end
of the simulation was:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.9847844 0.9984893 0.9998034 0.9999260</span></span></code></pre>
<p>And the temperature of soil layers:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">Temp</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6.188220 2.974857 2.379783 2.363290</span></span></code></pre>
<p>We can also see the current state of canopy variables:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">canopy</span></span></code></pre></div>
<pre><code><span><span class="co">##    zlow zmid  zup    LAIlive LAIexpanded LAIdead     Tair Cair     VPair</span></span>
<span><span class="co">## 1     0   50  100 0.03062604  0.03062604       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 2   100  150  200 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 3   200  250  300 0.06200693  0.06200693       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 4   300  350  400 0.29933459  0.29933459       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 5   400  450  500 0.43266592  0.43266592       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 6   500  550  600 0.41005056  0.41005056       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 7   600  650  700 0.24368578  0.24368578       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 8   700  750  800 0.10657777  0.10657777       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 9   800  850  900 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 10  900  950 1000 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 11 1000 1050 1100 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 12 1100 1150 1200 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 13 1200 1250 1300 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 14 1300 1350 1400 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 15 1400 1450 1500 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 16 1500 1550 1600 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 17 1600 1650 1700 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 18 1700 1750 1800 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 19 1800 1850 1900 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 20 1900 1950 2000 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 21 2000 2050 2100 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 22 2100 2150 2200 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 23 2200 2250 2300 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 24 2300 2350 2400 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 25 2400 2450 2500 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 26 2500 2550 2600 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 27 2600 2650 2700 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span>
<span><span class="co">## 28 2700 2750 2800 0.00000000  0.00000000       0 5.351165  386 0.5170718</span></span></code></pre>
<p>We simply use function <code><a href="../../reference/resetInputs.html">resetInputs()</a></code> to reset state
variables to their default values, so that the new simulation is not
affected by the end state of the previous simulation:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/resetInputs.html">resetInputs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 1 1 1</span></span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">Temp</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA NA</span></span></code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">canopy</span></span></code></pre></div>
<pre><code><span><span class="co">##    zlow zmid  zup    LAIlive LAIexpanded LAIdead Tair Cair VPair</span></span>
<span><span class="co">## 1     0   50  100 0.03062604  0.03062604       0   NA   NA    NA</span></span>
<span><span class="co">## 2   100  150  200 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 3   200  250  300 0.06200693  0.06200693       0   NA   NA    NA</span></span>
<span><span class="co">## 4   300  350  400 0.29933459  0.29933459       0   NA   NA    NA</span></span>
<span><span class="co">## 5   400  450  500 0.43266592  0.43266592       0   NA   NA    NA</span></span>
<span><span class="co">## 6   500  550  600 0.41005056  0.41005056       0   NA   NA    NA</span></span>
<span><span class="co">## 7   600  650  700 0.24368578  0.24368578       0   NA   NA    NA</span></span>
<span><span class="co">## 8   700  750  800 0.10657777  0.10657777       0   NA   NA    NA</span></span>
<span><span class="co">## 9   800  850  900 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 10  900  950 1000 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 11 1000 1050 1100 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 12 1100 1150 1200 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 13 1200 1250 1300 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 14 1300 1350 1400 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 15 1400 1450 1500 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 16 1500 1550 1600 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 17 1600 1650 1700 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 18 1700 1750 1800 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 19 1800 1850 1900 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 20 1900 1950 2000 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 21 2000 2050 2100 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 22 2100 2150 2200 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 23 2200 2250 2300 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 24 2300 2350 2400 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 25 2400 2450 2500 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 26 2500 2550 2600 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 27 2600 2650 2700 0.00000000  0.00000000       0   NA   NA    NA</span></span>
<span><span class="co">## 28 2700 2750 2800 0.00000000  0.00000000       0   NA   NA    NA</span></span></code></pre>
<p>Now we are ready to call function <code><a href="../../reference/spwb.html">spwb()</a></code>:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Initial plant water content (mm): 6.78662</span></span>
<span><span class="co">## Initial soil water content (mm): 290.875</span></span>
<span><span class="co">## Initial snowpack content (mm): 0</span></span>
<span><span class="co">## Performing daily simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  [Year 2001]:............</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Final plant water content (mm): 6.78126</span></span>
<span><span class="co">## Final soil water content (mm): 273.215</span></span>
<span><span class="co">## Final snowpack content (mm): 0</span></span>
<span><span class="co">## Change in plant water content (mm): -0.00536274</span></span>
<span><span class="co">## Plant water balance result (mm): 5.86534e-16</span></span>
<span><span class="co">## Change in soil water content (mm): -17.6601</span></span>
<span><span class="co">## Soil water balance result (mm): -17.6601</span></span>
<span><span class="co">## Change in snowpack water content (mm): 0</span></span>
<span><span class="co">## Snowpack water balance result (mm): -7.10543e-15</span></span>
<span><span class="co">## Water balance components:</span></span>
<span><span class="co">##   Precipitation (mm) 513 Rain (mm) 462 Snow (mm) 51</span></span>
<span><span class="co">##   Interception (mm) 92 Net rainfall (mm) 370</span></span>
<span><span class="co">##   Infiltration (mm) 402 Infiltration excess (mm) 19 Saturation excess (mm) 0 Capillarity rise (mm) 0</span></span>
<span><span class="co">##   Soil evaporation (mm) 22  Herbaceous transpiration (mm) 13 Woody plant transpiration (mm) 245</span></span>
<span><span class="co">##   Plant extraction from soil (mm) 245  Plant water balance (mm) 0 Hydraulic redistribution (mm) 4</span></span>
<span><span class="co">##   Runoff (mm) 19 Deep drainage (mm) 139</span></span></code></pre>
<p>Function <code><a href="../../reference/spwb.html">spwb()</a></code> returns an object of class
<em>spwb</em>. If we inspect its elements, we realize that the output is
arranged differently than in <code><a href="../../reference/spwb_day.html">spwb_day()</a></code>:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "latitude"      "topography"    "weather"       "spwbInput"    </span></span>
<span><span class="co">##  [5] "spwbOutput"    "WaterBalance"  "EnergyBalance" "Temperature"  </span></span>
<span><span class="co">##  [9] "Soil"          "Snow"          "Stand"         "Plants"       </span></span>
<span><span class="co">## [13] "SunlitLeaves"  "ShadeLeaves"</span></span></code></pre>
<p>In particular, element <code>spwbInput</code> contains a copy of the
input parameters that were used to run the model:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">spwbInput</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "control"               "soil"                  "snowpack"             </span></span>
<span><span class="co">##  [4] "canopy"                "herbLAI"               "herbLAImax"           </span></span>
<span><span class="co">##  [7] "cohorts"               "above"                 "below"                </span></span>
<span><span class="co">## [10] "belowLayers"           "paramsPhenology"       "paramsAnatomy"        </span></span>
<span><span class="co">## [13] "paramsInterception"    "paramsTranspiration"   "paramsWaterStorage"   </span></span>
<span><span class="co">## [16] "internalPhenology"     "internalWater"         "internalFCCS"         </span></span>
<span><span class="co">## [19] "internalCommunication"</span></span></code></pre>
<p>As before, <code>WaterBalance</code> contains water balance
components, but in this case in form of a data frame with days in
rows:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  PET Precipitation      Rain Snow    NetRain Snowmelt</span></span>
<span><span class="co">## 2001-01-01 0.8828475      4.869109  4.869109    0  3.4241795        0</span></span>
<span><span class="co">## 2001-01-02 1.6375337      2.498292  2.498292    0  1.0717469        0</span></span>
<span><span class="co">## 2001-01-03 1.3017026      0.000000  0.000000    0  0.0000000        0</span></span>
<span><span class="co">## 2001-01-04 0.5690790      5.796973  5.796973    0  4.3625616        0</span></span>
<span><span class="co">## 2001-01-05 1.6760567      1.884401  1.884401    0  0.7539027        0</span></span>
<span><span class="co">## 2001-01-06 1.2077028     13.359801 13.359801    0 11.7240275        0</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess Runoff DeepDrainage</span></span>
<span><span class="co">## 2001-01-01    3.4241795                  0                0      0    2.9581744</span></span>
<span><span class="co">## 2001-01-02    1.0717469                  0                0      0    0.4957692</span></span>
<span><span class="co">## 2001-01-03    0.0000000                  0                0      0    0.0000000</span></span>
<span><span class="co">## 2001-01-04    4.3625616                  0                0      0    3.2777341</span></span>
<span><span class="co">## 2001-01-05    0.7539027                  0                0      0    0.1724660</span></span>
<span><span class="co">## 2001-01-06   11.7240275                  0                0      0    4.1214138</span></span>
<span><span class="co">##            CapillarityRise Evapotranspiration Interception SoilEvaporation</span></span>
<span><span class="co">## 2001-01-01               0          1.9109345     1.444929       0.4478948</span></span>
<span><span class="co">## 2001-01-02               0          2.0025224     1.426545       0.5000000</span></span>
<span><span class="co">## 2001-01-03               0          0.9260078     0.000000       0.5000000</span></span>
<span><span class="co">## 2001-01-04               0          1.5932311     1.434411       0.1409187</span></span>
<span><span class="co">## 2001-01-05               0          1.7756506     1.130499       0.5000000</span></span>
<span><span class="co">## 2001-01-06               0          2.0976173     1.635773       0.4403282</span></span>
<span><span class="co">##            HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01       0.011023432     0.007086957   0.007086957</span></span>
<span><span class="co">## 2001-01-02       0.020446613     0.055531102   0.055531102</span></span>
<span><span class="co">## 2001-01-03       0.016253351     0.409754406   0.409754406</span></span>
<span><span class="co">## 2001-01-04       0.007105361     0.010795695   0.010795695</span></span>
<span><span class="co">## 2001-01-05       0.020927620     0.124224159   0.124224159</span></span>
<span><span class="co">## 2001-01-06       0.015079604     0.006436340   0.006436340</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01                       0</span></span>
<span><span class="co">## 2001-01-02                       0</span></span>
<span><span class="co">## 2001-01-03                       0</span></span>
<span><span class="co">## 2001-01-04                       0</span></span>
<span><span class="co">## 2001-01-05                       0</span></span>
<span><span class="co">## 2001-01-06                       0</span></span></code></pre>
<p>Elements <code>Plants</code> is itself a list with several elements
that contain daily output results by plant cohorts, for example leaf
minimum (midday) water potentials are:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">Plants</span><span class="op">$</span><span class="va">LeafPsiMin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               T1_148     T2_168     S1_165</span></span>
<span><span class="co">## 2001-01-01 -1.306428 -0.7425001 -0.4407465</span></span>
<span><span class="co">## 2001-01-02 -1.368721 -0.7032108 -0.4465898</span></span>
<span><span class="co">## 2001-01-03 -1.431679 -0.9180906 -0.5538224</span></span>
<span><span class="co">## 2001-01-04 -1.323903 -0.7583975 -0.4498131</span></span>
<span><span class="co">## 2001-01-05 -1.399305 -0.7865288 -0.4831331</span></span>
<span><span class="co">## 2001-01-06 -1.349854 -0.6856836 -0.4336429</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plotting-and-summarizing-results">Plotting and summarizing results<a class="anchor" aria-label="anchor" href="#plotting-and-summarizing-results"></a>
</h3>
<p>Package <code>medfate</code> also provides a <code>plot</code>
function for objects of class <code>spwb</code>. It can be used to show
the meteorological input. Additionally, it can also be used to draw soil
and plant variables. In the code below we draw water fluxes, soil water
potentials, plant transpiration and plant (mid-day) water potential:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"Evapotranspiration"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilPsi"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"PlantTranspiration"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"LeafPsiMin"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-4.png" width="672" style="display: block; margin: auto;"></p>
<p>Alternatively, one can interactively create plots using function
<code>shinyplot</code>, e.g.:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/shinyplot.html">shinyplot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<p>While the simulation model uses daily steps, users may be interested
in outputs at larger time scales. The package provides a
<code>summary</code> for objects of class <code>spwb</code>. This
function can be used to summarize the model’s output at different
temporal steps (i.e. weekly, annual, …). For example, to obtain the
water balance by months one can use:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation       Rain      Snow    NetRain   Snowmelt</span></span>
<span><span class="co">## 2001-01-01 1.011397    2.41127383 1.87415609 0.5371177 1.34613589 0.42235503</span></span>
<span><span class="co">## 2001-02-01 2.278646    0.17855109 0.08778069 0.0907704 0.03511889 0.19831578</span></span>
<span><span class="co">## 2001-03-01 2.368035    2.41917349 2.41917349 0.0000000 1.93933438 0.01762496</span></span>
<span><span class="co">## 2001-04-01 3.086567    0.63056064 0.29195973 0.3386009 0.13472156 0.33860091</span></span>
<span><span class="co">## 2001-05-01 3.662604    0.76337345 0.76337345 0.0000000 0.57881566 0.00000000</span></span>
<span><span class="co">## 2001-06-01 5.265359    0.21959509 0.21959509 0.0000000 0.15746695 0.00000000</span></span>
<span><span class="co">## 2001-07-01 4.443053    3.27810591 3.27810591 0.0000000 2.81775241 0.00000000</span></span>
<span><span class="co">## 2001-08-01 4.463242    1.92222891 1.92222891 0.0000000 1.55188110 0.00000000</span></span>
<span><span class="co">## 2001-09-01 3.453891    1.30651303 1.30651303 0.0000000 1.04946567 0.00000000</span></span>
<span><span class="co">## 2001-10-01 2.405506    1.33598175 1.33598175 0.0000000 1.05395924 0.00000000</span></span>
<span><span class="co">## 2001-11-01 1.716591    2.20566281 1.47764599 0.7280168 1.33350571 0.72801682</span></span>
<span><span class="co">## 2001-12-01 1.608082    0.05046181 0.05046181 0.0000000 0.02018853 0.00000000</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess     Runoff</span></span>
<span><span class="co">## 2001-01-01   1.76849092         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-02-01   0.23343467         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-03-01   1.95695933         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-04-01   0.47332247         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-05-01   0.57881566         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-06-01   0.15746695         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-07-01   2.57526260         0.24248981                0 0.24248981</span></span>
<span><span class="co">## 2001-08-01   1.51482668         0.03705442                0 0.03705442</span></span>
<span><span class="co">## 2001-09-01   1.04946567         0.00000000                0 0.00000000</span></span>
<span><span class="co">## 2001-10-01   0.95504041         0.09891883                0 0.09891883</span></span>
<span><span class="co">## 2001-11-01   1.82913875         0.23238379                0 0.23238379</span></span>
<span><span class="co">## 2001-12-01   0.02018853         0.00000000                0 0.00000000</span></span>
<span><span class="co">##            DeepDrainage CapillarityRise Evapotranspiration Interception</span></span>
<span><span class="co">## 2001-01-01  1.439919095               0          0.9442094   0.52802019</span></span>
<span><span class="co">## 2001-02-01  0.009716925               0          0.5858616   0.05266179</span></span>
<span><span class="co">## 2001-03-01  1.248790806               0          1.1070409   0.47983911</span></span>
<span><span class="co">## 2001-04-01  0.000000000               0          0.8296689   0.15723817</span></span>
<span><span class="co">## 2001-05-01  0.036591726               0          1.1341803   0.18455779</span></span>
<span><span class="co">## 2001-06-01  0.000000000               0          1.2172941   0.06212814</span></span>
<span><span class="co">## 2001-07-01  0.000000000               0          1.5978136   0.46035350</span></span>
<span><span class="co">## 2001-08-01  0.109968675               0          1.5871097   0.37034782</span></span>
<span><span class="co">## 2001-09-01  0.053696964               0          1.1035610   0.25704736</span></span>
<span><span class="co">## 2001-10-01  0.425489281               0          1.0069361   0.28202252</span></span>
<span><span class="co">## 2001-11-01  1.201899331               0          0.6491544   0.14414028</span></span>
<span><span class="co">## 2001-12-01  0.000000000               0          0.4616189   0.03027328</span></span>
<span><span class="co">##            SoilEvaporation HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01     0.168704677        0.01262818       0.2348563     0.2348563</span></span>
<span><span class="co">## 2001-02-01     0.037088688        0.02844248       0.4676686     0.4676686</span></span>
<span><span class="co">## 2001-03-01     0.118570775        0.02955958       0.4790714     0.4790714</span></span>
<span><span class="co">## 2001-04-01     0.011576088        0.03849097       0.6223637     0.6223637</span></span>
<span><span class="co">## 2001-05-01     0.073102542        0.04566393       0.8308561     0.8308561</span></span>
<span><span class="co">## 2001-06-01     0.004688331        0.06306639       1.0874113     1.0874113</span></span>
<span><span class="co">## 2001-07-01     0.090097373        0.05492393       0.9924388     0.9924388</span></span>
<span><span class="co">## 2001-08-01     0.046227677        0.05567944       1.1148548     1.1148548</span></span>
<span><span class="co">## 2001-09-01     0.043254762        0.04310225       0.7601566     0.7601566</span></span>
<span><span class="co">## 2001-10-01     0.050253113        0.03002530       0.6446352     0.6446352</span></span>
<span><span class="co">## 2001-11-01     0.057492866        0.02142439       0.4260969     0.4260969</span></span>
<span><span class="co">## 2001-12-01     0.015451542        0.02006049       0.3958336     0.3958336</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01            0.0000000000</span></span>
<span><span class="co">## 2001-02-01            0.0002757639</span></span>
<span><span class="co">## 2001-03-01            0.0009720247</span></span>
<span><span class="co">## 2001-04-01            0.0058396894</span></span>
<span><span class="co">## 2001-05-01            0.0050069106</span></span>
<span><span class="co">## 2001-06-01            0.0999141095</span></span>
<span><span class="co">## 2001-07-01            0.0233238740</span></span>
<span><span class="co">## 2001-08-01            0.0021889022</span></span>
<span><span class="co">## 2001-09-01            0.0015733942</span></span>
<span><span class="co">## 2001-10-01            0.0004213351</span></span>
<span><span class="co">## 2001-11-01            0.0014033592</span></span>
<span><span class="co">## 2001-12-01            0.0024719344</span></span></code></pre>
<p>Parameter <code>output</code> is used to indicate the element of the
<code>spwb</code> object for which we desire summaries. Similarly, it is
possible to calculate the average stress of plant cohorts by months:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  T1_148     T2_168     S1_165</span></span>
<span><span class="co">## 2001-01-01 0.0003233088 0.02326715 0.01261040</span></span>
<span><span class="co">## 2001-02-01 0.0009806118 0.03907225 0.02156879</span></span>
<span><span class="co">## 2001-03-01 0.0011771228 0.04380079 0.02401883</span></span>
<span><span class="co">## 2001-04-01 0.0015560247 0.05281908 0.03204720</span></span>
<span><span class="co">## 2001-05-01 0.0030247630 0.07030071 0.04222407</span></span>
<span><span class="co">## 2001-06-01 0.0207439387 0.12110469 0.12710447</span></span>
<span><span class="co">## 2001-07-01 0.0082648633 0.09459065 0.06727640</span></span>
<span><span class="co">## 2001-08-01 0.0060184003 0.09157359 0.05564207</span></span>
<span><span class="co">## 2001-09-01 0.0030447027 0.06813319 0.03958779</span></span>
<span><span class="co">## 2001-10-01 0.0022488072 0.05621859 0.03159258</span></span>
<span><span class="co">## 2001-11-01 0.0008207234 0.03581156 0.02063519</span></span>
<span><span class="co">## 2001-12-01 0.0008078205 0.03571290 0.02177873</span></span></code></pre>
<p>The <code>summary</code> function can be also used to aggregate the
output by species. In this case, the values of plant cohorts belonging
to the same species will be averaged using LAI values as weights. For
example, we may average the daily drought stress across cohorts of the
same species (here there is only one cohort by species, so this does not
modify the output):</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"day"</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Pinus halepensis Quercus coccifera Quercus ilex</span></span>
<span><span class="co">## 2001-01-01     0.0001572947        0.01089430   0.02302024</span></span>
<span><span class="co">## 2001-01-02     0.0003634093        0.01118814   0.02032109</span></span>
<span><span class="co">## 2001-01-03     0.0005394378        0.01517852   0.03164365</span></span>
<span><span class="co">## 2001-01-04     0.0002816252        0.01231689   0.02423851</span></span>
<span><span class="co">## 2001-01-05     0.0004010766        0.01190415   0.02290329</span></span>
<span><span class="co">## 2001-01-06     0.0002418675        0.01039450   0.01930857</span></span></code></pre>
<p>Or we can combine the aggregation by species with a temporal
aggregation (here monthly averages):</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"month"</span>, FUN <span class="op">=</span> <span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Pinus halepensis Quercus coccifera Quercus ilex</span></span>
<span><span class="co">## 2001-01-01     0.0003233088        0.01261040   0.02326715</span></span>
<span><span class="co">## 2001-02-01     0.0009806118        0.02156879   0.03907225</span></span>
<span><span class="co">## 2001-03-01     0.0011771228        0.02401883   0.04380079</span></span>
<span><span class="co">## 2001-04-01     0.0015560247        0.03204720   0.05281908</span></span>
<span><span class="co">## 2001-05-01     0.0030247630        0.04222407   0.07030071</span></span>
<span><span class="co">## 2001-06-01     0.0207439387        0.12710447   0.12110469</span></span>
<span><span class="co">## 2001-07-01     0.0082648633        0.06727640   0.09459065</span></span>
<span><span class="co">## 2001-08-01     0.0060184003        0.05564207   0.09157359</span></span>
<span><span class="co">## 2001-09-01     0.0030447027        0.03958779   0.06813319</span></span>
<span><span class="co">## 2001-10-01     0.0022488072        0.03159258   0.05621859</span></span>
<span><span class="co">## 2001-11-01     0.0008207234        0.02063519   0.03581156</span></span>
<span><span class="co">## 2001-12-01     0.0008078205        0.02177873   0.03571290</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>De Cáceres M, Mencuccini M, Martin-StPaul N, Limousin JM, Coll L,
Poyatos R, Cabon A, Granda V, Forner A, Valladares F, Martínez-Vilalta J
(2021) Unravelling the effect of species mixing on water use and drought
stress in holm oak forests: a modelling approach. Agricultural and
Forest Meteorology 296 (<a href="https://doi.org/10.1016/j.agrformet.2020.108233" class="external-link uri">https://doi.org/10.1016/j.agrformet.2020.108233</a>).</p></li>
<li><p>Ruffault J, Pimont F, Cochard H, Dupuy JL, Martin-StPaul N (2022)
SurEau-Ecos v2.0: a trait-based plant hydraulics model for simulations
of plant water status and drought-induced mortality at the ecosystem
level. Geoscientific Model Development 15, 5593-5626 (<a href="https://doi.org/10.5194/gmd-15-5593-2022" class="external-link uri">https://doi.org/10.5194/gmd-15-5593-2022</a>).</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Soil and plant water balances at Font-Blanche • medfate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Soil and plant water balances at Font-Blanche">
<meta name="description" content="Soil and plant water balance at the forest plot of Font-Blanche (France)
">
<meta property="og:description" content="Soil and plant water balance at the forest plot of Font-Blanche (France)
">
<meta property="og:image" content="https://emf-creaf.github.io/medfate/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">medfate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../../articles/intro/PackageOverview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/UnderstandingInputs.html">Understanding model inputs</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/PreparingInputs.html">Preparing model inputs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Running simulations</h6></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/BasicWaterBalance.html">Basic water balance</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/AdvancedWaterEnergyBalance.html">Advanced water and energy balance</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ForestGrowth.html">Forest growth</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ForestDynamics.html">Forest dynamics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/medfate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Soil and plant water balances at Font-Blanche</h1>
                        <h4 data-toc-skip class="author">Miquel De
Caceres (CREAF), Nicolas Martin-StPaul (INRA)</h4>
            
            <h4 data-toc-skip class="date">2025-12-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/vignettes/workedexamples/FontBlanche.Rmd" class="external-link"><code>vignettes/workedexamples/FontBlanche.Rmd</code></a></small>
      <div class="d-none name"><code>FontBlanche.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="about-this-vignette">About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h3>
<p>This document describes how to run the water balance model on a
forest plot at Font-Blanche (France), using the R function
<code><a href="../../reference/spwb.html">spwb()</a></code> included in package <code>medfate</code>. The
document indicates how to prepare the model inputs, use the model
simulation function, evaluate the predictions against available
observations and inspect the outputs.</p>
</div>
<div class="section level3">
<h3 id="about-the-font-blanche-research-forest">About the Font-Blanche research forest<a class="anchor" aria-label="anchor" href="#about-the-font-blanche-research-forest"></a>
</h3>
<p>The Font-Blanche research forest, located in southeastern France
(43º14′27″ N 5°40′45″ E, 420 m elevation), is composed of a top strata
of <em>Pinus halepensis</em> (Aleppo pine) reaching about 12 m, a lower
strata of <em>Quercus ilex</em> (holm oak), reaching about 6 m, and an
understorey strata dominated by <em>Quercus coccifera</em> but including
other species such as <em>Phillyrea latifolia</em>. It is spatially
heterogeneous: not all trees in each strata are contiguous, so trees
from the lower stratas are partially exposed to direct light. The forest
grows on rocky and shallow soils that have a low retention capacity and
are of Jurassic limestone origin. The climate is Mediterranean, with a
water stress period in summer, cold or mild winters and most
precipitation occurring between September and May. The experimental
site, which is dedicated to study forest carbon and water cycles, has an
enclosed area of 80×80 m (Simioni et al. 2013) but our specific plot is
a quadrat of dimensions 25x25 m.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h2>
<p>Any forest water balance model needs information on
<strong>climate</strong>, <strong>vegetation</strong> and
<strong>soils</strong> of the forest stand to be simulated. Moreover,
since the soil water balance in <code>medfate</code> differentiates
between species, <strong>species-specific parameters</strong> are also
needed. Since FontBlanche is one of the sites used for evaluating the
model, and much of the data can be found in Moreno et al. (2021). We can
use a data list <code>fb</code> with all the necessary inputs:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb</span> <span class="op">&lt;-</span> <span class="fu">medfatereports</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/medfatereports/man/load_forest.html" class="external-link">load_list</a></span><span class="op">(</span><span class="st">"FONBLA"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"fb_data.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "siteData"       "treeData"       "shrubData"      "customParams"  </span></span>
<span><span class="co">##  [5] "measuredData"   "meteoData"      "miscData"       "soilData"      </span></span>
<span><span class="co">##  [9] "terrainData"    "remarks"        "sp_params"      "forest_object1"</span></span></code></pre>
<div class="section level3">
<h3 id="soil">Soil<a class="anchor" aria-label="anchor" href="#soil"></a>
</h3>
<p>We require information on the physical attributes of soil in
Font-Blanche, namely <em>soil depth</em>, <em>texture</em>, <em>bulk
density</em> and <em>rock fragment content</em>. Soil information needs
to be entered as a <code>data frame</code> with soil layers in rows and
physical attributes in columns. The model accepts one to five soil
layers with arbitrary widths. Because soil properties vary strongly at
fine spatial scales, ideally soil physical attributes should be measured
on samples taken at the forest stand to be simulated. For those users
lacking such data, soil properties modelled at larger scales are
available via soilgrids.org (see function
<code>soilgridsParams()</code>). In our case soil physical attributes
are already defined in the data bundled for FontBlanche:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spar</span> <span class="op">&lt;-</span> <span class="va">fb</span><span class="op">$</span><span class="va">soilData</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths clay sand om   bd rfc</span></span>
<span><span class="co">## 1    300   39   26  6 1.45  50</span></span>
<span><span class="co">## 2    700   39   26  3 1.45  65</span></span>
<span><span class="co">## 3   1000   39   26  1 1.45  90</span></span>
<span><span class="co">## 4   2500   39   26  1 1.45  95</span></span></code></pre>
<p>The soil input for function <code><a href="../../reference/spwb.html">spwb()</a></code> is actually an object
of class <code>soil</code> that is created using a function with the
same name:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function for objects <code>soil</code>
provides a lot of information on soil physical properties and water
capacity:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fb_soil</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths sand clay      usda om nitrogen   bd rfc   macro     Ksat VG_alpha</span></span>
<span><span class="co">## 1    300   26   39 Clay loam  6       NA 1.45  50 0.07387 7232.425 44.14586</span></span>
<span><span class="co">## 2    700   26   39 Clay loam  3       NA 1.45  65 0.07387 3481.917 61.34088</span></span>
<span><span class="co">## 3   1000   26   39 Clay loam  1       NA 1.45  90 0.07387 1879.187 76.38182</span></span>
<span><span class="co">## 4   2500   26   39 Clay loam  1       NA 1.45  95 0.07387 1879.187 76.38182</span></span>
<span><span class="co">##       VG_n VG_theta_res VG_theta_sat W Temp</span></span>
<span><span class="co">## 1 1.254346        0.041    0.4388377 1   NA</span></span>
<span><span class="co">## 2 1.273896        0.041    0.4388377 1   NA</span></span>
<span><span class="co">## 3 1.287757        0.041    0.4388377 1   NA</span></span>
<span><span class="co">## 4 1.287757        0.041    0.4388377 1   NA</span></span></code></pre>
<p>The soil object is also used to store the moisture degree of each
soil layer. In particular, <code>W</code> contains the state variable
that represents moisture content - the proportion of moisture
<strong>relative to field capacity</strong> - which is by default
initialized to 1 for each layer:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_soil</span><span class="op">$</span><span class="va">W</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 1 1 1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="species-parameters">Species parameters<a class="anchor" aria-label="anchor" href="#species-parameters"></a>
</h3>
<p>Simulation models in <code>medfate</code> require a data frame with
species parameter values. The package provides a default data set of
parameter values for a number of Mediterranean species occurring in
Spain (rows), resulting from bibliographic search, fit to empirical data
or expert-based guesses:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></span></code></pre></div>
<p>However, sometimes one may wish to override species defaults with
custom values. In the case of FontBlanche there is a table of preferred
parameters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb</span><span class="op">$</span><span class="va">customParams</span></span></code></pre></div>
<pre><code><span><span class="co">##               Species VCleaf_P12 VCleaf_P50 VCleaf_P88 VCleaf_slope VCstem_P12</span></span>
<span><span class="co">## 1 Phillyrea latifolia         NA         NA         NA           NA  -1.971750</span></span>
<span><span class="co">## 2    Pinus halepensis         NA         NA         NA           NA  -3.707158</span></span>
<span><span class="co">## 3        Quercus ilex         NA         NA         NA           NA  -4.739642</span></span>
<span><span class="co">##   VCstem_P50 VCstem_P88 VCstem_slope VCroot_P12 VCroot_P50 VCroot_P88</span></span>
<span><span class="co">## 1      -6.50 -11.028250           11         NA         NA         NA</span></span>
<span><span class="co">## 2      -4.79  -5.872842           46         -1  -1.741565  -2.301482</span></span>
<span><span class="co">## 3      -6.40  -8.060358           30         NA         NA         NA</span></span>
<span><span class="co">##   VCroot_slope VCleaf_kmax LeafEPS LeafPI0 LeafAF StemEPS StemPI0 StemAF Gswmin</span></span>
<span><span class="co">## 1           NA        3.00   12.38   -2.13    0.5   12.38   -2.13    0.4  0.002</span></span>
<span><span class="co">## 2           NA        4.00    5.31   -1.50    0.6    5.00   -1.65    0.4  0.001</span></span>
<span><span class="co">## 3           NA        2.63   15.00   -2.50    0.4   15.00   -2.50    0.4  0.002</span></span>
<span><span class="co">##   Gswmax    Gs_P50 Gs_slope    Al2As</span></span>
<span><span class="co">## 1 0.2200 -2.207094 89.41176       NA</span></span>
<span><span class="co">## 2 0.2175 -1.871216 97.43590  631.000</span></span>
<span><span class="co">## 3 0.2200 -2.114188 44.70588 1540.671</span></span></code></pre>
<p>We can use function <code><a href="../../reference/modifyParams.html">modifySpParams()</a></code> to replace the
values of parameters for the desired traits, leaving the rest
unaltered:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SpParamsFB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modifyParams.html">modifySpParams</a></span><span class="op">(</span><span class="va">SpParamsMED</span>, <span class="va">fb</span><span class="op">$</span><span class="va">customParams</span><span class="op">)</span></span>
<span><span class="va">SpParamsFB</span></span></code></pre></div>
<pre><code><span><span class="co">##                    Name IFNcodes SpIndex        AcceptedName</span></span>
<span><span class="co">## 143 Phillyrea latifolia        8     142 Phillyrea latifolia</span></span>
<span><span class="co">## 149    Pinus halepensis       24     148    Pinus halepensis</span></span>
<span><span class="co">## 169        Quercus ilex   45/245     168        Quercus ilex</span></span>
<span><span class="co">##                 Species     Genus   Family    Order      Group GrowthForm</span></span>
<span><span class="co">## 143 Phillyrea latifolia Phillyrea Oleaceae Lamiales Angiosperm       Tree</span></span>
<span><span class="co">## 149    Pinus halepensis     Pinus Pinaceae  Pinales Gymnosperm       Tree</span></span>
<span><span class="co">## 169        Quercus ilex   Quercus Fagaceae  Fagales Angiosperm Tree/Shrub</span></span>
<span><span class="co">##         LifeForm LeafShape LeafSize      PhenologyType DispersalType Hmed Hmax</span></span>
<span><span class="co">## 143 Phanerophyte     Broad   Medium oneflush-evergreen    vertebrate  150  900</span></span>
<span><span class="co">## 149 Phanerophyte    Needle    Small oneflush-evergreen          wind  850 1900</span></span>
<span><span class="co">## 169 Phanerophyte     Broad   Medium oneflush-evergreen    vertebrate  500 1300</span></span>
<span><span class="co">##     Dmax Z50  Z95 fHDmin fHDmax    a_ash    b_ash    a_bsh     b_bsh    a_btsh</span></span>
<span><span class="co">## 143   NA  NA 2353     45    109       NA       NA       NA        NA        NA</span></span>
<span><span class="co">## 149   NA  NA 7500     80    160       NA       NA       NA        NA        NA</span></span>
<span><span class="co">## 169   NA  NA 5020     40    100 1.857486 1.885548 0.523883 0.7337293 0.7327147</span></span>
<span><span class="co">##       b_btsh cr BTsh      a_fbt    b_fbt       c_fbt    a_cr  b_1cr    b_2cr</span></span>
<span><span class="co">## 143       NA NA   NA         NA       NA          NA      NA     NA       NA</span></span>
<span><span class="co">## 149       NA NA   NA 0.07607828 1.462411 -0.02280106      NA     NA       NA</span></span>
<span><span class="co">## 169 0.737577 NA   NA 0.07848713 1.497670 -0.00309341 1.98539 -0.552 -0.01386</span></span>
<span><span class="co">##            b_3cr    c_1cr    c_2cr      a_cw   b_cw      a_bt      b_bt</span></span>
<span><span class="co">## 143           NA       NA       NA        NA     NA        NA        NA</span></span>
<span><span class="co">## 149           NA       NA       NA 0.6415296 0.7310 0.5535741 1.1848613</span></span>
<span><span class="co">## 169 -0.000110736 -0.00685 -0.20101 0.5681897 0.7974 0.5622245 0.9626839</span></span>
<span><span class="co">##     LeafDuration t0gdd  Sgdd Tbgdd  Ssen Phsen Tbsen xsen ysen      SLA</span></span>
<span><span class="co">## 143     2.556345    NA    NA    NA    NA    NA    NA   NA   NA 6.881886</span></span>
<span><span class="co">## 149     2.536875    NA    NA    NA    NA    NA    NA   NA   NA 5.140523</span></span>
<span><span class="co">## 169     2.183837  54.5 240.7  4.34 10178  12.5  28.5    2    2 6.340000</span></span>
<span><span class="co">##     LeafDensity WoodDensity FineRootDensity conduit2sapwood     r635    pDead</span></span>
<span><span class="co">## 143   0.5327417   0.7050000              NA              NA 1.917579 0.119768</span></span>
<span><span class="co">## 149   0.2982842   0.6077016              NA       0.9236406 1.964226 0.000500</span></span>
<span><span class="co">## 169   0.4893392   0.9008264              NA       0.6238125 1.805872 0.000260</span></span>
<span><span class="co">##        Al2As Ar2Al LeafWidth      SRL RLD    maxFMC   minFMC LeafPI0 LeafEPS</span></span>
<span><span class="co">## 143 1698.950    NA 1.2000000       NA  NA 108.24724 56.53442   -2.13   12.38</span></span>
<span><span class="co">## 149  631.000    NA 0.1384772 3172.572  NA 126.03063 86.22550   -1.50    5.31</span></span>
<span><span class="co">## 169 1540.671    NA 1.7674359 4398.812  NA  93.15304 57.44192   -2.50   15.00</span></span>
<span><span class="co">##     LeafAF StemPI0 StemEPS StemAF  SAV HeatContent LigninPercent LeafAngle</span></span>
<span><span class="co">## 143    0.5   -2.13   12.38    0.4 9630       21400            NA        NA</span></span>
<span><span class="co">## 149    0.6   -1.65    5.00    0.4 6050       22150      24.52473        NA</span></span>
<span><span class="co">## 169    0.4   -2.50   15.00    0.4 4050       19300      28.97492        NA</span></span>
<span><span class="co">##     LeafAngleSD ClumpingIndex gammaSWR alphaSWR kPAR  g  Tmax_LAI   Tmax_LAIsq</span></span>
<span><span class="co">## 143          NA            NA       NA       NA   NA NA        NA           NA</span></span>
<span><span class="co">## 149          NA            NA       NA       NA   NA NA 0.1869849 -0.008372458</span></span>
<span><span class="co">## 169          NA            NA       NA       NA   NA NA 0.1251027 -0.005601615</span></span>
<span><span class="co">##     Psi_Extract Exp_Extract      WUE   WUE_par     WUE_co2    WUE_vpd Gswmin</span></span>
<span><span class="co">## 143  -1.8969940          NA       NA        NA          NA         NA  0.002</span></span>
<span><span class="co">## 149  -0.9218219    1.504542 8.525550 0.5239136 0.002586327 -0.2647169  0.001</span></span>
<span><span class="co">## 169  -1.9726871    1.149052 8.968208 0.1412266 0.002413091 -0.5664879  0.002</span></span>
<span><span class="co">##     Gswmax Gsw_AC_slope Gs_Toptim Gs_Tsens    Gs_P50 Gs_slope VCleaf_kmax</span></span>
<span><span class="co">## 143 0.2200           NA        NA       NA -2.207094 89.41176        3.00</span></span>
<span><span class="co">## 149 0.2175           NA        NA       NA -1.871216 97.43590        4.00</span></span>
<span><span class="co">## 169 0.2200           NA        NA       NA -2.114188 44.70588        2.63</span></span>
<span><span class="co">##     VCleaf_P12 VCleaf_P50 VCleaf_P88 VCleaf_slope Kmax_stemxylem VCstem_P12</span></span>
<span><span class="co">## 143         NA         NA         NA           NA      0.4083769  -1.971750</span></span>
<span><span class="co">## 149 -1.9793246  -2.303772  -2.547056    133.86620      0.1500000  -3.707158</span></span>
<span><span class="co">## 169 -0.5559123  -1.964085  -4.525766     19.14428      0.4000000  -4.739642</span></span>
<span><span class="co">##     VCstem_P50 VCstem_P88 VCstem_slope Kmax_rootxylem VCroot_P12 VCroot_P50</span></span>
<span><span class="co">## 143      -6.50 -11.028250           11             NA -3.1224807  -5.300000</span></span>
<span><span class="co">## 149      -4.79  -5.872842           46             NA -1.0000000  -1.741565</span></span>
<span><span class="co">## 169      -6.40  -8.060358           30             NA -0.4766469  -1.684034</span></span>
<span><span class="co">##     VCroot_P88 VCroot_slope  Vmax298  Jmax298    Nleaf Nsapwood Nfineroot</span></span>
<span><span class="co">## 143  -7.477519     17.45105 65.23250 146.2701 16.09170  2.78000        NA</span></span>
<span><span class="co">## 149  -2.301482    103.96607 72.19617 124.1687 11.91507  1.26556  9.187476</span></span>
<span><span class="co">## 169  -3.880455     22.32794 68.51600 118.7863 14.11983  5.66150 12.166747</span></span>
<span><span class="co">##         WoodC    RERleaf RERsapwood RERfineroot CCleaf CCsapwood CCfineroot</span></span>
<span><span class="co">## 143        NA         NA         NA          NA 1.6300        NA         NA</span></span>
<span><span class="co">## 149 0.4979943 0.01210607         NA          NA 1.5905      1.47        1.3</span></span>
<span><span class="co">## 169 0.4740096 0.01757808         NA          NA 1.4300        NA         NA</span></span>
<span><span class="co">##     RGRleafmax RGRsapwoodmax RGRcambiummax RGRfinerootmax SRsapwood SRfineroot</span></span>
<span><span class="co">## 143         NA            NA  0.0006653797             NA        NA         NA</span></span>
<span><span class="co">## 149         NA            NA  0.0026280949             NA        NA         NA</span></span>
<span><span class="co">## 169         NA            NA            NA             NA        NA         NA</span></span>
<span><span class="co">##       RSSG MortalityBaselineRate SurvivalModelStep SurvivalB0 SurvivalB1</span></span>
<span><span class="co">## 143     NA           0.001622378                NA         NA         NA</span></span>
<span><span class="co">## 149 0.3725           0.005000000                10   7.311515 -0.6532989</span></span>
<span><span class="co">## 169 0.9500           0.001000000                10   7.484348 -0.5420550</span></span>
<span><span class="co">##     SeedProductionHeight SeedProductionDiameter SeedMass SeedLongevity</span></span>
<span><span class="co">## 143                   NA                     NA       NA            NA</span></span>
<span><span class="co">## 149                   NA                     NA       NA            NA</span></span>
<span><span class="co">## 169                   NA               10.64702       NA            NA</span></span>
<span><span class="co">##     DispersalDistance DispersalShape   ProbRecr MinTempRecr MinMoistureRecr</span></span>
<span><span class="co">## 143                NA             NA 0.04459023   -2.570181      0.05070956</span></span>
<span><span class="co">## 149                NA             NA 0.02473379    1.083300      0.10154153</span></span>
<span><span class="co">## 169                NA             NA 0.03005748   -3.744526      0.09657161</span></span>
<span><span class="co">##     MinFPARRecr RecrAge RecrTreeDBH RecrTreeHeight RecrShrubHeight</span></span>
<span><span class="co">## 143   0.4943654      NA          NA       52.54367              NA</span></span>
<span><span class="co">## 149   4.5625766      NA          NA       56.93647              NA</span></span>
<span><span class="co">## 169   0.1307250      NA          NA       47.23629              NA</span></span>
<span><span class="co">##     RecrTreeDensity RecrShrubCover RespFire RespDist RespClip</span></span>
<span><span class="co">## 143              NA             NA      0.9     0.95     0.96</span></span>
<span><span class="co">## 149              NA             NA       NA       NA       NA</span></span>
<span><span class="co">## 169              NA             NA      0.9     0.95     0.96</span></span>
<span><span class="co">##     IngrowthTreeDensity IngrowthTreeDBH</span></span>
<span><span class="co">## 143            235.1347              NA</span></span>
<span><span class="co">## 149            246.2793              NA</span></span>
<span><span class="co">## 169            352.2668              NA</span></span></code></pre>
<p>Note that the function returns a subset of rows for the species
mentioned in <code>customParams</code>. Not all parameters are needed
for the soil water balance model. The user can find parameter
definitions in the help page of this data set. However, to fully
understand the role of parameters in the model, the user should read the
details of model design and formulation (<a href="http://emf-creaf.github.io/medfate" class="external-link uri">http://emf-creaf.github.io/medfate</a>).</p>
</div>
<div class="section level3">
<h3 id="vegetation">Vegetation<a class="anchor" aria-label="anchor" href="#vegetation"></a>
</h3>
<p>Models included in <code>medfate</code> were primarily designed to be
ran on <strong>forest inventory plots</strong>. In this kind of data,
the vegetation of a sampled area is described in terms of woody plants
(trees and shrubs) along with their size and species identity. Forest
plots in <code>medfate</code> are assumed to be in a format that follows
closely the Spanish forest inventory. Each forest plot is represented in
an object of class <code>forest</code>, a list that contains several
elements. Among them, the most important items are two data frames,
<code>treeData</code> (for trees) and <code>shrubData</code> for
shrubs:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/emptyforest.html">emptyforest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fb_forest</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">## [1] Species DBH     Height  N       Z50     Z95    </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">## [1] Species Height  Cover   Z50     Z95    </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>Trees are expected to be primarily described in terms of species,
diameter (DBH) and height, whereas shrubs are described in terms of
species, percent cover and mean height. In our case, we will for
simplicity avoid shrubs and concentrate on the main three tree species
in the Font-Blanche forest plot: <em>Phillyrea latifolia</em> (code
142), <em>Pinus halepensis</em> (Alepo pine, code 148), and <em>Quercus
ilex</em> (holm oak; code 168). In order to run the model, one has to
prepare a data table like this one, already prepared for
Font-Blanche:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb</span><span class="op">$</span><span class="va">treeData</span></span></code></pre></div>
<pre><code><span><span class="co">##               Species       DBH    Height    N Z50  Z95       LAI</span></span>
<span><span class="co">## 1 Phillyrea latifolia  2.587859  323.0000 1248 390 1470 0.2581029</span></span>
<span><span class="co">## 2    Pinus halepensis 26.759914 1195.7667  256 300 1200 1.0035486</span></span>
<span><span class="co">## 3        Quercus ilex  6.220031  495.5532 3104 500 2287 1.4383485</span></span></code></pre>
<p>Trees have been grouped by species, so DBH and height values are
means (in cm), and <code>N</code> indicates the number of trees in each
category. Package <code>medfate</code> allows separating trees by size,
but for simplicity we do not distinguish here between tree sizes within
each species. Columns <code>Z50</code> and <code>Z95</code> indicate the
depths (in mm) corresponding to cumulative 50% and 95% of fine roots,
respectively.</p>
<p>In order to use this data, we need to replace the part corresponding
to trees into the forest object that we created before:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_forest</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="va">fb</span><span class="op">$</span><span class="va">treeData</span></span>
<span><span class="va">fb_forest</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##               Species       DBH    Height    N Z50  Z95       LAI</span></span>
<span><span class="co">## 1 Phillyrea latifolia  2.587859  323.0000 1248 390 1470 0.2581029</span></span>
<span><span class="co">## 2    Pinus halepensis 26.759914 1195.7667  256 300 1200 1.0035486</span></span>
<span><span class="co">## 3        Quercus ilex  6.220031  495.5532 3104 500 2287 1.4383485</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">## [1] Species Height  Cover   Z50     Z95    </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>Because the forest plot format is rather specific,
<code>medfate</code> also allows starting in an alternative way using
two data frames, one with <strong>aboveground</strong> information
(i.e. the leave area and size of plants) and the other with
<strong>belowground</strong> information (i.e. root distribution). The
aboveground data frame does not distinguish between trees and shrubs. It
includes, for each plant cohort to be considered in rows, its
<em>species identity</em>, <em>height</em>, <em>leaf area index</em>
(LAI) and <em>crown ratio</em>. While users can build their input data
themselves, we use internal function <code><a href="../../reference/forest2aboveground.html">forest2aboveground()</a></code>
on the object <code>fb_forest</code> to show how should the data look
like:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_above</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest2aboveground.html">forest2aboveground</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">SpParamsFB</span><span class="op">)</span></span>
<span><span class="va">fb_above</span></span></code></pre></div>
<pre><code><span><span class="co">##         SP    N       DBH Cover         H        CR  LAI_live LAI_expanded</span></span>
<span><span class="co">## T1_142 142 1248  2.587859    NA  323.0000 0.5510653 0.2581029    0.2581029</span></span>
<span><span class="co">## T2_148 148  256 26.759914    NA 1195.7667 0.6126601 1.0035486    1.0035486</span></span>
<span><span class="co">## T3_168 168 3104  6.220031    NA  495.5532 0.5531152 1.4383485    1.4383485</span></span>
<span><span class="co">##        LAI_dead LAI_nocomp Age ObsID</span></span>
<span><span class="co">## T1_142        0  0.2581029  NA  &lt;NA&gt;</span></span>
<span><span class="co">## T2_148        0  1.0035486  NA  &lt;NA&gt;</span></span>
<span><span class="co">## T3_168        0  1.4383485  NA  &lt;NA&gt;</span></span></code></pre>
<p>Note that the call to <code><a href="../../reference/forest2aboveground.html">forest2aboveground()</a></code> included
species parameters, because species-specific parameter values are needed
to calculate leaf area from tree diameters or shrub cover using
allometric relationships. Columns <code>N</code>, <code>DBH</code> and
<code>Cover</code> are required for simulating growth, but not for soil
water balance, which only requires columns <code>SP</code>,
<code>H</code> (in cm), <code>CR</code> (i.e. the crown ratio),
<code>LAI_live</code>, <code>LAI_expanded</code> and
<code>LAI_dead</code>. Here plant cohorts are given unique codes that
tell us whether they correspond to trees or shrubs. In practice, the
user only needs to worry to calculate the values for
<code>LAI_live</code>. <code>LAI_live</code> and
<code>LAI_expanded</code> can contain the same LAI values, and
<code>LAI_dead</code> is normally zero.</p>
<p>We see that at Font-Blanche holm oaks (code 68) represent most of the
total leaf area. On the other hand, pines are taller than oaks.
<code>medfate</code> assumes that leaf distribution follows a truncated
normal curve between the crown base height and the total height. This
can be easily inspected using function
<code><a href="../../reference/vprofile_leafAreaDensity.html">vprofile_leafAreaDensity()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/vprofile_leafAreaDensity.html">vprofile_leafAreaDensity</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">SpParamsFB</span>, byCohorts <span class="op">=</span> <span class="cn">T</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" width="480" style="display: block; margin: auto;"></p>
<p>Regarding <strong>belowground</strong> information, the usuer should
supply a matrix describing for each plant cohort, the proportion of fine
roots in each soil layer. As before, we use internal function
<code><a href="../../reference/forest2aboveground.html">forest2belowground()</a></code> on the object <code>fb_forest</code>
to show how should the data look like:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_below</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest2aboveground.html">forest2belowground</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">fb_soil</span>, <span class="va">SpParamsFB</span><span class="op">)</span></span>
<span><span class="va">fb_below</span></span></code></pre></div>
<pre><code><span><span class="co">##                1         2          3          4</span></span>
<span><span class="co">## T1_142 0.3602157 0.5332967 0.08477533 0.02171222</span></span>
<span><span class="co">## T2_148 0.5016024 0.4291685 0.05479894 0.01443019</span></span>
<span><span class="co">## T3_168 0.2752236 0.5286425 0.14537757 0.05075634</span></span></code></pre>
<p>In our case, these proportions were implicitly specified in
parameters <code>Z50</code> and <code>Z95</code>. In fact, these values
describe a continuous distribution of fine roots along depth, which can
be displayed using function
<code><a href="../../reference/vprofile_leafAreaDensity.html">vprofile_rootDistribution()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/vprofile_leafAreaDensity.html">vprofile_rootDistribution</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">SpParamsFB</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" width="480" style="display: block; margin: auto;"></p>
<p>Note that in Font-Blanche we set that the root system of Aleppo pines
(<em>Pinus halepensis</em>) would be more superficial than that of the
other two species. Moreover, holm oak trees are the ones who extend
their roots down to deepest soil layers.</p>
</div>
<div class="section level3">
<h3 id="meteorology">Meteorology<a class="anchor" aria-label="anchor" href="#meteorology"></a>
</h3>
<p>Water balance simulations of function <code><a href="../../reference/spwb.html">spwb()</a></code> require
<strong>daily weather</strong> inputs. The weather variables that are
required depend on the complexity of the soil water balance model we are
using. In the simplest case, only <strong>mean temperature</strong>,
<strong>precipitation</strong> and <strong>potential evapo-transpiration
(PET)</strong> is required, but the more complex simulation model also
requires radiation, wind speed, min/max temparature and relative
humitidy. Here we already have a data frame with the daily meteorology
measured at Font-Blanche for year 2014:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_meteo</span> <span class="op">&lt;-</span> <span class="va">fb</span><span class="op">$</span><span class="va">meteoData</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fb_meteo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        dates MeanTemperature MinTemperature MaxTemperature MeanRelativeHumidity</span></span>
<span><span class="co">## 1 2014-01-01        7.661856       5.988889       8.960000             87.78224</span></span>
<span><span class="co">## 2 2014-01-02        9.525431       7.958333      11.550000             96.40669</span></span>
<span><span class="co">## 3 2014-01-03        9.482417       8.176111      11.762220             93.05705</span></span>
<span><span class="co">## 4 2014-01-04       10.016813       6.313000      11.010000             96.31667</span></span>
<span><span class="co">## 5 2014-01-05        6.619919       4.766000       9.060555             57.77938</span></span>
<span><span class="co">## 6 2014-01-06        8.923008       6.793889      12.329440             64.40477</span></span>
<span><span class="co">##   MinRelativeHumidity MaxRelativeHumidity WindSpeed Precipitation Radiation</span></span>
<span><span class="co">## 1            80.37265            98.48404  2.317495      0.000000 1.5050178</span></span>
<span><span class="co">## 2            84.22588           100.00000  2.407691      0.000000 2.6173102</span></span>
<span><span class="co">## 3            79.93501           100.00000  1.950114      0.000000 3.9089762</span></span>
<span><span class="co">## 4            90.14023           100.00000  3.596797      2.590674 0.4753025</span></span>
<span><span class="co">## 5            48.92043            65.71329  7.310334      0.000000 8.6224570</span></span>
<span><span class="co">## 6            51.31975            74.46718  2.301697      0.000000 6.7835715</span></span></code></pre>
<p>Simulation models in <code>medfate</code> have been designed to work
along with data generated from package <code>meteoland</code> (De
Cáceres et al. 2018), which specifies conventions for variable names and
units. The user is strongly recommended to resort to this package to
obtain suitable weather input for soil water balance simulations (see <a href="http://emf-creaf.github.io/meteoland" class="external-link uri">http://emf-creaf.github.io/meteoland</a>).</p>
</div>
<div class="section level3">
<h3 id="simulation-control">Simulation control<a class="anchor" aria-label="anchor" href="#simulation-control"></a>
</h3>
<p>Apart from data inputs, the behavior of simulation models can be
controlled using a set of <strong>global parameters</strong>. The
default global parameter values are obtained using function
<code><a href="../../reference/defaultControl.html">defaultControl()</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fb_control</span><span class="op">$</span><span class="va">transpirationMode</span> <span class="op">&lt;-</span> <span class="st">"Sperry"</span></span>
<span><span class="va">fb_control</span><span class="op">$</span><span class="va">subdailyResults</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">fb_control</span><span class="op">$</span><span class="va">stemCavitationRecovery</span> <span class="op">&lt;-</span> <span class="st">"rate"</span></span>
<span><span class="va">fb_control</span><span class="op">$</span><span class="va">leafCavitationRecovery</span> <span class="op">&lt;-</span> <span class="st">"total"</span></span>
<span><span class="va">fb_control</span><span class="op">$</span><span class="va">fracRootResistance</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span></code></pre></div>
<p>Where the following changes are set to control parameters:</p>
<ol style="list-style-type: decimal">
<li>Transpiration is set <code>transpirationMode = "Sperry"</code>,
which implies a greater complexity of plant hydraulics and energy
balance calculations.</li>
<li>Soil water retention curves are calculated using Van Genuchten’s
equations.</li>
<li>Subdaily results generated by the model are kept.</li>
<li>Coarse root resistance is assumed to be 40% of total plant
resistance</li>
</ol>
</div>
<div class="section level3">
<h3 id="water-balance-input-object">Water balance input object<a class="anchor" aria-label="anchor" href="#water-balance-input-object"></a>
</h3>
<p>A last step is needed before calling simulation functions. It
consists in the compilation of all aboveground and belowground
parameters and the specification of additional parameter values for each
plant cohort, such as their light extinction coefficient or their
response to drought. If one has a <code>forest</code> object, the
<code>spwbInput</code> object can be generated in directly from it,
avoiding the need to explicitly build <code>fb_above</code> and
<code>fb_below</code> data frames:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modelInput.html">spwbInput</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">fb_soil</span>, <span class="va">SpParamsFB</span>, <span class="va">fb_control</span><span class="op">)</span></span></code></pre></div>
<p>Different species parameter variables will be drawn from
<code>SpParamsMED</code> depending on the value of
<code>transpirationMode</code>. For the simple water balance model,
relatively few parameters are needed. All the input information for
forest data and species parameter values can be inspected by printing
the input object.</p>
<p>Finally, note that one can play with plant-specific parameters for
soil water balance (instead of using species-level values) by using
function <code><a href="../../reference/modifyParams.html">modifyCohortParams()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<p>Function <code><a href="../../reference/spwb.html">spwb()</a></code> requires two main objects as input:</p>
<ul>
<li>A <code>spwbInput</code> object with forest and soil parameters
(<code>fb_x</code> in our case).</li>
<li>A data frame with daily meteorology for the study period
(<code>fb_meteo</code> in our case).</li>
</ul>
<p>Now we are ready to call function <code><a href="../../reference/spwb.html">spwb()</a></code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_SWB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">fb_x</span>, <span class="va">fb_meteo</span>, elevation <span class="op">=</span> <span class="fl">420</span>, latitude <span class="op">=</span> <span class="fl">43.24083</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package 'meteoland' [ver. 2.2.4]</span></span></code></pre>
<pre><code><span><span class="co">## Initial plant water content (mm): 31.8864</span></span>
<span><span class="co">## Initial soil water content (mm): 213.886</span></span>
<span><span class="co">## Initial snowpack content (mm): 0</span></span>
<span><span class="co">## Performing daily simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  [Year 2014]:............</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Final plant water content (mm): 31.8309</span></span>
<span><span class="co">## Final soil water content (mm): 235.07</span></span>
<span><span class="co">## Final snowpack content (mm): 0</span></span>
<span><span class="co">## Change in plant water content (mm): -0.0554502</span></span>
<span><span class="co">## Plant water balance result (mm): -9.83278e-16</span></span>
<span><span class="co">## Change in soil water content (mm): 21.1846</span></span>
<span><span class="co">## Soil water balance result (mm): 21.1846</span></span>
<span><span class="co">## Change in snowpack water content (mm): 0</span></span>
<span><span class="co">## Snowpack water balance result (mm): 0</span></span>
<span><span class="co">## Water balance components:</span></span>
<span><span class="co">##   Precipitation (mm) 1066 Rain (mm) 1066 Snow (mm) 0</span></span>
<span><span class="co">##   Interception (mm) 141 Net rainfall (mm) 925</span></span>
<span><span class="co">##   Infiltration (mm) 833 Infiltration excess (mm) 92 Saturation excess (mm) 272 Capillarity rise (mm) 0</span></span>
<span><span class="co">##   Soil evaporation (mm) 21  Herbaceous transpiration (mm) 0 Woody plant transpiration (mm) 323</span></span>
<span><span class="co">##   Plant extraction from soil (mm) 323  Plant water balance (mm) -0 Hydraulic redistribution (mm) 36</span></span>
<span><span class="co">##   Runoff (mm) 364 Deep drainage (mm) 195</span></span></code></pre>
<p>Console output provides the water balance totals for the period
considered, which may span several years. The output of function
<code><a href="../../reference/spwb.html">spwb()</a></code> is an object of class with the same name, actually a
list:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "spwb" "list"</span></span></code></pre>
<p>If we inspect its elements, we realize that there are several
components:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "latitude"      "topography"    "weather"       "spwbInput"    </span></span>
<span><span class="co">##  [5] "spwbOutput"    "WaterBalance"  "EnergyBalance" "Temperature"  </span></span>
<span><span class="co">##  [9] "Soil"          "Snow"          "Stand"         "Plants"       </span></span>
<span><span class="co">## [13] "SunlitLeaves"  "ShadeLeaves"   "subdaily"</span></span></code></pre>
<p>For example, <code>WaterBalance</code> contains water balance
components in form of a data frame with days in rows:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  PET Precipitation     Rain Snow   NetRain Snowmelt</span></span>
<span><span class="co">## 2014-01-01 0.6209989      0.000000 0.000000    0 0.0000000        0</span></span>
<span><span class="co">## 2014-01-02 0.5671238      0.000000 0.000000    0 0.0000000        0</span></span>
<span><span class="co">## 2014-01-03 0.5418115      0.000000 0.000000    0 0.0000000        0</span></span>
<span><span class="co">## 2014-01-04 0.6072565      2.590674 2.590674    0 0.7213133        0</span></span>
<span><span class="co">## 2014-01-05 2.0447148      0.000000 0.000000    0 0.0000000        0</span></span>
<span><span class="co">## 2014-01-06 0.9330456      0.000000 0.000000    0 0.0000000        0</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess Runoff DeepDrainage</span></span>
<span><span class="co">## 2014-01-01    0.0000000                  0                0      0    0.0000000</span></span>
<span><span class="co">## 2014-01-02    0.0000000                  0                0      0    0.0000000</span></span>
<span><span class="co">## 2014-01-03    0.0000000                  0                0      0    0.0000000</span></span>
<span><span class="co">## 2014-01-04    0.7213133                  0                0      0    0.1891113</span></span>
<span><span class="co">## 2014-01-05    0.0000000                  0                0      0    0.0000000</span></span>
<span><span class="co">## 2014-01-06    0.0000000                  0                0      0    0.0000000</span></span>
<span><span class="co">##            CapillarityRise Evapotranspiration Interception SoilEvaporation</span></span>
<span><span class="co">## 2014-01-01               0          0.2369034      0.00000       0.2145403</span></span>
<span><span class="co">## 2014-01-02               0          0.1959278      0.00000       0.1959278</span></span>
<span><span class="co">## 2014-01-03               0          0.1971447      0.00000       0.1871830</span></span>
<span><span class="co">## 2014-01-04               0          2.0494022      1.86936       0.1800420</span></span>
<span><span class="co">## 2014-01-05               0          0.9200973      0.00000       0.2941821</span></span>
<span><span class="co">## 2014-01-06               0          0.6256207      0.00000       0.1367511</span></span>
<span><span class="co">##            HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2014-01-01                 0    2.236303e-02    0.02236303</span></span>
<span><span class="co">## 2014-01-02                 0   -1.409463e-18    0.00000000</span></span>
<span><span class="co">## 2014-01-03                 0    9.961750e-03    0.00996175</span></span>
<span><span class="co">## 2014-01-04                 0    9.486769e-19    0.00000000</span></span>
<span><span class="co">## 2014-01-05                 0    6.259152e-01    0.62591524</span></span>
<span><span class="co">## 2014-01-06                 0    4.888697e-01    0.48886969</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2014-01-01             0.000000000</span></span>
<span><span class="co">## 2014-01-02             0.002400632</span></span>
<span><span class="co">## 2014-01-03             0.003379188</span></span>
<span><span class="co">## 2014-01-04             0.004276351</span></span>
<span><span class="co">## 2014-01-05             0.000000000</span></span>
<span><span class="co">## 2014-01-06             0.001303872</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="comparing-results-with-observations">Comparing results with observations<a class="anchor" aria-label="anchor" href="#comparing-results-with-observations"></a>
</h2>
<p>Before examining the results of the model, it is important to compare
its predictions against observed data, if available. The following
observations are available from the experimental forest plot for year
2014:</p>
<ul>
<li>Stand total evapotranspiration estimated using an Eddy-covariance
flux tower.</li>
<li>Soil moisture content of the first 0-30 cm layer.</li>
<li>Cohort transpiration estimates derived from sapflow measurements for
Q. ilex and P. halepensis.</li>
<li>Pre-dawn and midday leaf water potentials for Q. ilex and P.
halepensis.</li>
</ul>
<p>We first load the measured data into the workspace and filter for the
dates used in the simulation:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fb_observed</span> <span class="op">&lt;-</span> <span class="va">fb</span><span class="op">$</span><span class="va">measuredData</span></span>
<span><span class="va">fb_observed</span> <span class="op">&lt;-</span> <span class="va">fb_observed</span><span class="op">[</span><span class="va">fb_observed</span><span class="op">$</span><span class="va">dates</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">fb_meteo</span><span class="op">$</span><span class="va">dates</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fb_observed</span><span class="op">$</span><span class="va">dates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 dates       SWC SWC.err       ETR E_T2_148 E_T2_148_err</span></span>
<span><span class="co">## 2014-01-01 2014-01-01 0.5813407      NA 0.2259528       NA           NA</span></span>
<span><span class="co">## 2014-01-02 2014-01-02 0.6507478      NA 0.2337668       NA           NA</span></span>
<span><span class="co">## 2014-01-03 2014-01-03 0.6224243      NA 0.5229000       NA           NA</span></span>
<span><span class="co">## 2014-01-04 2014-01-04        NA      NA 0.1117191       NA           NA</span></span>
<span><span class="co">## 2014-01-05 2014-01-05 0.6285134      NA 0.8132403       NA           NA</span></span>
<span><span class="co">## 2014-01-06 2014-01-06 0.6035415      NA 0.6012234       NA           NA</span></span>
<span><span class="co">##            E_T3_168 E_T3_168_err PD_T2_148 PD_T2_148_err PD_T3_168</span></span>
<span><span class="co">## 2014-01-01       NA           NA        NA            NA        NA</span></span>
<span><span class="co">## 2014-01-02       NA           NA        NA            NA        NA</span></span>
<span><span class="co">## 2014-01-03       NA           NA        NA            NA        NA</span></span>
<span><span class="co">## 2014-01-04       NA           NA        NA            NA        NA</span></span>
<span><span class="co">## 2014-01-05       NA           NA        NA            NA        NA</span></span>
<span><span class="co">## 2014-01-06       NA           NA        NA            NA        NA</span></span>
<span><span class="co">##            PD_T3_168_err MD_T2_148 MD_T2_148_err MD_T3_168 MD_T3_168_err</span></span>
<span><span class="co">## 2014-01-01            NA        NA            NA        NA            NA</span></span>
<span><span class="co">## 2014-01-02            NA        NA            NA        NA            NA</span></span>
<span><span class="co">## 2014-01-03            NA        NA            NA        NA            NA</span></span>
<span><span class="co">## 2014-01-04            NA        NA            NA        NA            NA</span></span>
<span><span class="co">## 2014-01-05            NA        NA            NA        NA            NA</span></span>
<span><span class="co">## 2014-01-06            NA        NA            NA        NA            NA</span></span></code></pre>
<div class="section level3">
<h3 id="stand-evapotranspiration">Stand evapotranspiration<a class="anchor" aria-label="anchor" href="#stand-evapotranspiration"></a>
</h3>
<p>Package <code>medfate</code> contains several functions to assist the
evaluation of model results. We can first compare the observed vs
modelled total evapotranspiration. We can plot the two time series:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"ETR"</span>, plotType<span class="op">=</span><span class="st">"dynamics"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.85</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-25-1.png" class="r-plt" width="768" style="display: block; margin: auto;"></p>
<p>It is easy to see that in rainy days the predicted evapotranspiration
is much higher than that of the observed data. We repeat the comparison
but excluding the intercepted water from modeled results:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"SE+TR"</span>, plotType<span class="op">=</span><span class="st">"dynamics"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.85</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-26-1.png" class="r-plt" width="768" style="display: block; margin: auto;"></p>
<p>The relationship can be shown in a scatter plot:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"SE+TR"</span>, plotType<span class="op">=</span><span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-27-1.png" class="r-plt" width="480" style="display: block; margin: auto;">
Where we see a reasonably good relationship, but the model tends to
underestimate total evapotranspiration during seasons with low
evaporative demand. Function <code><a href="../../reference/evaluation.html">evaluation_stats()</a></code> allows us
to generate evaluation statistics:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_stats</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"SE+TR"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             n          Bias      Bias.rel           MAE       MAE.rel </span></span>
<span><span class="co">## 365.000000000  -0.389036614 -29.198664329   0.470818543  35.336706323 </span></span>
<span><span class="co">##             r           NSE       NSE.abs </span></span>
<span><span class="co">##   0.691315875  -0.009887544   0.054424469</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="soil-moisture">Soil moisture<a class="anchor" aria-label="anchor" href="#soil-moisture"></a>
</h3>
<p>We can compare observed vs modelled soil moisture content in a
similar way as we did for total evapotranspiration:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, plotType<span class="op">=</span><span class="st">"dynamics"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-29-1.png" class="r-plt" width="700"></p>
<p>As before, we can generate a scatter plot:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"SWC"</span>, plotType<span class="op">=</span><span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-30-1.png" class="r-plt" width="480" style="display: block; margin: auto;"></p>
<p>or examine evaluation statistics:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_stats</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, type <span class="op">=</span> <span class="st">"SWC"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            n         Bias     Bias.rel          MAE      MAE.rel            r </span></span>
<span><span class="co">## 364.00000000  -0.13283708 -30.96872370   0.13283708  30.96872370   0.94976486 </span></span>
<span><span class="co">##          NSE      NSE.abs </span></span>
<span><span class="co">##  -0.09616646  -0.04072213</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plant-transpiration">Plant transpiration<a class="anchor" aria-label="anchor" href="#plant-transpiration"></a>
</h3>
<p>The following plots display the observed and predicted transpiration
dynamics for <em>Pinus halepensis</em> and <em>Quercus ilex</em>:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, </span>
<span>                            cohort <span class="op">=</span> <span class="st">"T2_148"</span>,</span>
<span>                            type<span class="op">=</span><span class="st">"E"</span>, plotType <span class="op">=</span> <span class="st">"dynamics"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>,<span class="fl">0.83</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, </span>
<span>                            cohort <span class="op">=</span> <span class="st">"T3_168"</span>,</span>
<span>                            type<span class="op">=</span><span class="st">"E"</span>, plotType <span class="op">=</span> <span class="st">"dynamics"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>,<span class="fl">0.83</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-32-1.png" class="r-plt" width="768"></p>
<p>In general, the agreement is quite good, but the model seems to
overestimate the transpiration of <em>P. halepensis</em> in early summer
and after the first drought period. The transpiration of <em>Q.
ilex</em> seems also overestimated in spring and autumn. We can also
inspect the evaluation statistics for both species using:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_stats</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, cohort <span class="op">=</span> <span class="st">"T2_148"</span>, type<span class="op">=</span><span class="st">"E"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           n        Bias    Bias.rel         MAE     MAE.rel           r </span></span>
<span><span class="co">## 300.0000000   0.3121143 151.7537015   0.3282208 159.5848671   0.8564806 </span></span>
<span><span class="co">##         NSE     NSE.abs </span></span>
<span><span class="co">## -11.6385648  -2.3168403</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/evaluation.html">evaluation_stats</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, cohort <span class="op">=</span> <span class="st">"T3_168"</span>, type<span class="op">=</span><span class="st">"E"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             n          Bias      Bias.rel           MAE       MAE.rel </span></span>
<span><span class="co">## 309.000000000  -0.006040064  -2.086676013   0.067209664  23.219092424 </span></span>
<span><span class="co">##             r           NSE       NSE.abs </span></span>
<span><span class="co">##   0.887009157   0.762024744   0.542114689</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="leaf-water-potentials">Leaf water potentials<a class="anchor" aria-label="anchor" href="#leaf-water-potentials"></a>
</h3>
<p>Finally, we can compare observed with predicted water potentials. In
this case measurements are available for three dates, but they include
the standard deviation of several measurements.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, </span>
<span>                            cohort <span class="op">=</span> <span class="st">"T2_148"</span>,</span>
<span>                            type<span class="op">=</span><span class="st">"WP"</span>, plotType <span class="op">=</span> <span class="st">"dynamics"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>,<span class="fl">0.23</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/evaluation.html">evaluation_plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="va">fb_observed</span>, </span>
<span>                            cohort <span class="op">=</span> <span class="st">"T3_168"</span>,</span>
<span>                            type<span class="op">=</span><span class="st">"WP"</span>, plotType <span class="op">=</span> <span class="st">"dynamics"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>,<span class="fl">0.23</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-34-1.png" class="r-plt" width="768"></p>
<p>The model seems to underestimate water potentials (i.e. it predicts
more negative values than those observed) during the drought season.</p>
</div>
</div>
<div class="section level2">
<h2 id="drawing-plots">Drawing plots<a class="anchor" aria-label="anchor" href="#drawing-plots"></a>
</h2>
<p>Package <code>medfate</code> provides a simple <code>plot</code>
function for objects of class <code>spwb</code>. Here we will use this
function to display the seasonal variation predicted by the model, as
well as the variation at higher temporal resolution within four
different selected 3-day periods that we define here:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-03-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">d2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-06-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-06-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">d3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-08-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-08-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">d4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-10-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2014-10-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="meteorological-input-and-inputoutput-water-flows">Meteorological input and input/output water flows<a class="anchor" aria-label="anchor" href="#meteorological-input-and-inputoutput-water-flows"></a>
</h3>
<p>Function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> can be used to show the meteorological
input:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type <span class="op">=</span> <span class="st">"PET_Precipitation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-36-1.png" class="r-plt" width="768">
It is apparent the climatic drought period between april and august
2014. This should have an impact on soil moisture and plant stress.</p>
<p>If we are interested in forest hydrology, we can plot the amount of
water that the model predicts to leave the forest via surface runoff or
drainage to lower water compartments.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type <span class="op">=</span> <span class="st">"Export"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-37-1.png" class="r-plt" width="768">
As expected, water exported from the forest plot was only relevant for
the autumn and winter periods. Note also that the model predicts some
runoff during convective storms during autumn, whereas winter events
occur when the soil is already full, so that most exported water is
assumed to be lost via deep drainage. One can also display the
evapotranspiration flows, which we do in the following plot that also
combines the two previous:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"Evapotranspiration"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.13</span>,<span class="fl">0.73</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"Export"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>,<span class="fl">0.60</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>,<span class="va">g2</span>, <span class="va">g3</span>, ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">1</span>,<span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-38-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level3">
<h3 id="soil-moisture-dynamics-and-hydraulic-redistribution">Soil moisture dynamics and hydraulic redistribution<a class="anchor" aria-label="anchor" href="#soil-moisture-dynamics-and-hydraulic-redistribution"></a>
</h3>
<p>It is also useful to plot the dynamics of soil state variables by
layer, such as the percentage of moisture in relation to field
capacity:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"SoilTheta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-39-1.png" class="r-plt" width="768">
Note that the model predicts soil drought to occur earlier in the season
for the first three layers (0-200 cm) whereas the bottom layer dries out
much more slowly. At this point is important to mention that the water
balance model incorporates. We can also display the dynamics of the
corresponding soil layer water potentials:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"SoilPsi"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-40-1.png" class="r-plt" width="768">
or draw a composite plot including absolute soil water volume:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilVol"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.65</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilPsi"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,  <span class="va">g3</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-41-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level3">
<h3 id="root-water-uptake-and-hydraulic-redistribution">Root water uptake and hydraulic redistribution<a class="anchor" aria-label="anchor" href="#root-water-uptake-and-hydraulic-redistribution"></a>
</h3>
<p>The following composite plot shows the daily root water uptake (or
release) from different soil layers, and the daily amount of water
entering soil layers due to hydraulic redistribution:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilPsi"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">"Soil wp (MPa)"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.68</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"HydraulicRedistribution"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,  <span class="va">g3</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-42-1.png" class="r-plt" width="768"></p>
<p>If we create a composite plot including subdaily water uptake/release
patterns, we can further understand the redistribution flows created by
the model during different periods:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.68</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g4</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g0</span>,<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, <span class="va">g4</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-43-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level3">
<h3 id="plant-transpiration-1">Plant transpiration<a class="anchor" aria-label="anchor" href="#plant-transpiration-1"></a>
</h3>
<p>We can use function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to display the seasonal
dynamics of cohort-level variables, such as plant transpiration per leaf
area:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"TranspirationPerLeaf"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-44-1.png" class="r-plt" width="768">
Where we can observe that some species transpire more than others due to
their vertical position within the canopy.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"TranspirationPerLeaf"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g21</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g22</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g23</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g24</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,  </span>
<span>          <span class="fu">plot_grid</span><span class="op">(</span><span class="va">g21</span>,<span class="va">g22</span>,<span class="va">g23</span>,<span class="va">g24</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, </span>
<span>          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-45-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level3">
<h3 id="plant-stress">Plant stress<a class="anchor" aria-label="anchor" href="#plant-stress"></a>
</h3>
<p>In the model, reduction of (whole-plant) plant transpiration is what
used to define drought stress, which depends on the species
identity:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-46-1.png" class="r-plt" width="768"></p>
<p>To examine the impact of drought on plants, one can inspect the
whole-plant conductance (from which the stress index is derived) or the
stem percent loss of conductance derived from embolism, as we do in the
following composite plot:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilPlantConductance"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Soil-plant conductance "</span>,<span class="op">(</span><span class="va">mmol</span><span class="op">%.%</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">2</span><span class="op">}</span><span class="op">%.%</span><span class="va">s</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"StemPLC"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,<span class="va">g3</span>,                          </span>
<span>          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-47-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level3">
<h3 id="leaf-water-potentials-1">Leaf water potentials<a class="anchor" aria-label="anchor" href="#leaf-water-potentials-1"></a>
</h3>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsiRange"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Leaf water potential (MPa)"</span><span class="op">)</span></span>
<span><span class="va">g21</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g22</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g23</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g24</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,                          </span>
<span>          <span class="fu">plot_grid</span><span class="op">(</span><span class="va">g21</span>,<span class="va">g22</span>,<span class="va">g23</span>,<span class="va">g24</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, </span>
<span>          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-48-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level3">
<h3 id="stomatal-conductance">Stomatal conductance<a class="anchor" aria-label="anchor" href="#stomatal-conductance"></a>
</h3>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"GSWMax_SL"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.74</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">"Sunlit leaf stomatal conductance"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g21</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g22</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g23</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g24</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,</span>
<span>          <span class="fu">plot_grid</span><span class="op">(</span><span class="va">g21</span>,<span class="va">g22</span>,<span class="va">g23</span>,<span class="va">g24</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-49-1.png" class="r-plt" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="generating-output-summaries">Generating output summaries<a class="anchor" aria-label="anchor" href="#generating-output-summaries"></a>
</h2>
<p>While the water balance model operates at daily and sub-daily steps,
users will normally be interested in outputs at larger time scales. The
package provides a <code>summary</code> for objects of class
<code>spwb</code>. This function can be used to summarize the model’s
output at different temporal steps (i.e. weekly, monthly or annual). For
example, to obtain the average soil moisture and water potentials by
months one can use:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fb_SWB</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">sum</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  PET Precipitation      Rain Snow     NetRain Snowmelt</span></span>
<span><span class="co">## 2014-01-01  27.03414     205.04814 205.04814    0 182.5767907        0</span></span>
<span><span class="co">## 2014-02-01  37.11592     181.09641 181.09641    0 155.2573002        0</span></span>
<span><span class="co">## 2014-03-01  80.49737      44.61248  44.61248    0  39.8917051        0</span></span>
<span><span class="co">## 2014-04-01 109.24874      15.00000  15.00000    0   7.2713589        0</span></span>
<span><span class="co">## 2014-05-01 147.99639      21.60000  21.60000    0  16.3281633        0</span></span>
<span><span class="co">## 2014-06-01 167.27898      33.60000  33.60000    0  25.8839490        0</span></span>
<span><span class="co">## 2014-07-01 183.99299       0.60000   0.60000    0   0.1428946        0</span></span>
<span><span class="co">## 2014-08-01 159.66330      60.40000  60.40000    0  52.8025568        0</span></span>
<span><span class="co">## 2014-09-01 103.42793     137.60000 137.60000    0 125.8957242        0</span></span>
<span><span class="co">## 2014-10-01  63.53896      50.60000  50.60000    0  41.9066889        0</span></span>
<span><span class="co">## 2014-11-01  30.12083     222.60000 222.60000    0 198.0975096        0</span></span>
<span><span class="co">## 2014-12-01  26.01617      93.00000  93.00000    0  78.7534201        0</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess     Runoff</span></span>
<span><span class="co">## 2014-01-01  182.5767907           0.000000        87.131292  87.131292</span></span>
<span><span class="co">## 2014-02-01  155.2573002           0.000000       122.052322 122.052322</span></span>
<span><span class="co">## 2014-03-01   39.8917051           0.000000         0.000000   0.000000</span></span>
<span><span class="co">## 2014-04-01    7.2713589           0.000000         0.000000   0.000000</span></span>
<span><span class="co">## 2014-05-01   16.3281633           0.000000         0.000000   0.000000</span></span>
<span><span class="co">## 2014-06-01   25.8839490           0.000000         0.000000   0.000000</span></span>
<span><span class="co">## 2014-07-01    0.1428946           0.000000         0.000000   0.000000</span></span>
<span><span class="co">## 2014-08-01   43.9831062           8.819451         0.000000   8.819451</span></span>
<span><span class="co">## 2014-09-01  100.5141047          25.381619         0.000000  25.381619</span></span>
<span><span class="co">## 2014-10-01   32.2966990           9.609990         0.000000   9.609990</span></span>
<span><span class="co">## 2014-11-01  149.6168145          48.480695         8.236761  56.717456</span></span>
<span><span class="co">## 2014-12-01   78.7534201           0.000000        54.503273  54.503273</span></span>
<span><span class="co">##            DeepDrainage CapillarityRise Evapotranspiration Interception</span></span>
<span><span class="co">## 2014-01-01     27.43229               0           33.72460   22.4713498</span></span>
<span><span class="co">## 2014-02-01     40.14785               0           39.97770   25.8391081</span></span>
<span><span class="co">## 2014-03-01     44.44940               0           44.31867    4.7207713</span></span>
<span><span class="co">## 2014-04-01      2.97102               0           51.42681    7.7286411</span></span>
<span><span class="co">## 2014-05-01      0.00000               0           55.90230    5.2718367</span></span>
<span><span class="co">## 2014-06-01      0.00000               0           50.52022    7.7160510</span></span>
<span><span class="co">## 2014-07-01      0.00000               0           23.42626    0.4571054</span></span>
<span><span class="co">## 2014-08-01      0.00000               0           39.94402    7.5974432</span></span>
<span><span class="co">## 2014-09-01      0.00000               0           38.85580   11.7042748</span></span>
<span><span class="co">## 2014-10-01      0.00000               0           40.94474    8.6933111</span></span>
<span><span class="co">## 2014-11-01     35.63848               0           38.86009   24.5024904</span></span>
<span><span class="co">## 2014-12-01     44.44940               0           27.36741   14.2465799</span></span>
<span><span class="co">##            SoilEvaporation HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2014-01-01       4.1371318                 0        7.116121      7.116121</span></span>
<span><span class="co">## 2014-02-01       2.8861399                 0       11.252448     11.252448</span></span>
<span><span class="co">## 2014-03-01       2.8231565                 0       36.774743     36.774743</span></span>
<span><span class="co">## 2014-04-01       0.3572535                 0       43.340913     43.340913</span></span>
<span><span class="co">## 2014-05-01       0.2003021                 0       50.430160     50.430160</span></span>
<span><span class="co">## 2014-06-01       0.1570277                 0       42.647138     42.647138</span></span>
<span><span class="co">## 2014-07-01       0.1053905                 0       22.863761     22.863761</span></span>
<span><span class="co">## 2014-08-01       0.2145482                 0       32.132033     32.132033</span></span>
<span><span class="co">## 2014-09-01       0.8479270                 0       26.303598     26.303598</span></span>
<span><span class="co">## 2014-10-01       2.7214885                 0       29.529940     29.529940</span></span>
<span><span class="co">## 2014-11-01       3.8341497                 0       10.523454     10.523454</span></span>
<span><span class="co">## 2014-12-01       3.1304478                 0        9.990378      9.990378</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2014-01-01               0.3413862</span></span>
<span><span class="co">## 2014-02-01               0.3351108</span></span>
<span><span class="co">## 2014-03-01               0.7914425</span></span>
<span><span class="co">## 2014-04-01               1.5215724</span></span>
<span><span class="co">## 2014-05-01               3.8436734</span></span>
<span><span class="co">## 2014-06-01               4.9136961</span></span>
<span><span class="co">## 2014-07-01               2.0482198</span></span>
<span><span class="co">## 2014-08-01               7.9501235</span></span>
<span><span class="co">## 2014-09-01               9.0616152</span></span>
<span><span class="co">## 2014-10-01               4.5184551</span></span>
<span><span class="co">## 2014-11-01               0.5537272</span></span>
<span><span class="co">## 2014-12-01               0.5609182</span></span></code></pre>
<p>Parameter <code>output</code> is used to indicate the element of the
<code>spwb</code> object for which we desire summaries. Similarly, it is
possible to calculate the average stress of the three tree species by
months:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fb_SWB</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Phillyrea latifolia Pinus halepensis Quercus ilex</span></span>
<span><span class="co">## 2014-01-01         0.001135310     0.0001555995  0.007214914</span></span>
<span><span class="co">## 2014-02-01         0.002700621     0.0002211655  0.013129655</span></span>
<span><span class="co">## 2014-03-01         0.009591910     0.0017087985  0.037889474</span></span>
<span><span class="co">## 2014-04-01         0.019287437     0.0061613082  0.066432415</span></span>
<span><span class="co">## 2014-05-01         0.066296190     0.0784977110  0.148168137</span></span>
<span><span class="co">## 2014-06-01         0.239111429     0.3777808093  0.300404204</span></span>
<span><span class="co">## 2014-07-01         0.554959953     0.7392473424  0.516900103</span></span>
<span><span class="co">## 2014-08-01         0.433248835     0.5375966514  0.435511569</span></span>
<span><span class="co">## 2014-09-01         0.277632275     0.3754657422  0.282362375</span></span>
<span><span class="co">## 2014-10-01         0.027594879     0.0085234976  0.036201343</span></span>
<span><span class="co">## 2014-11-01         0.016473943     0.0029963609  0.011201982</span></span>
<span><span class="co">## 2014-12-01         0.010979466     0.0002299063  0.007583226</span></span></code></pre>
<p>In this case, the <code>summary</code> function aggregates the output
by species using LAI values as weights.</p>
</div>
<div class="section level2">
<h2 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<ul>
<li><p>De Caceres M, Martin-StPaul N, Turco M, et al (2018) Estimating
daily meteorological data and downscaling climate models over
landscapes. Environ Model Softw 108:186–196. <a href="https://doi.org/10.1016/j.envsoft.2018.08.003" class="external-link uri">https://doi.org/10.1016/j.envsoft.2018.08.003</a></p></li>
<li><p>De Caceres M, Martinez-Vilalta J, Coll L, et al (2015) Coupling a
water balance model with forest inventory data to predict drought
stress: the role of forest structural changes vs. climate changes. Agric
For Meteorol 213:77–90. <a href="https://doi.org/10.1016/j.agrformet.2015.06.012" class="external-link uri">https://doi.org/10.1016/j.agrformet.2015.06.012</a></p></li>
<li><p>Simioni G, Durand-gillmann M, Huc R, et al (2013) Asymmetric
competition increases leaf inclination effect on light absorption in
mixed canopies. Ann For Sci 70:123–131. <a href="https://doi.org/10.1007/s13595-012-0246-8" class="external-link uri">https://doi.org/10.1007/s13595-012-0246-8</a></p></li>
<li><p>Moreno, M., Simioni, G., Cailleret, M., Ruffault, J., Badel, E.,
Carrière, S., Davi, H., Gavinet, J., Huc, R., Limousin, J.-M., Marloie,
O., Martin, L., Rodríguez-Calcerrada, J., Vennetier, M., Martin-StPaul,
N., 2021. Consistently lower sap velocity and growth over nine years of
rainfall exclusion in a Mediterranean mixed pine-oak forest. Agric. For.
Meteorol. 308–309, 108472. <a href="https://doi.org/10.1016/j.agrformet.2021.108472" class="external-link uri">https://doi.org/10.1016/j.agrformet.2021.108472</a></p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Víctor Granda, Antoine Cabon, Arsène Druel, Julien Ruffault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preparing model inputs • medfate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Preparing model inputs">
<meta name="description" content="Learn how to prepare vegetation, soil and weather inputs for simulations
">
<meta property="og:description" content="Learn how to prepare vegetation, soil and weather inputs for simulations
">
<meta property="og:image" content="https://emf-creaf.github.io/medfate/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">medfate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.8.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../../articles/intro/PackageOverview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/UnderstandingInputs.html">Understanding model inputs</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/PreparingInputs.html">Preparing model inputs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Running simulations</h6></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/BasicWaterBalance.html">Basic water balance</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/AdvancedWaterEnergyBalance.html">Advanced water and energy balance</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ForestGrowth.html">Forest growth</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ForestDynamics.html">Forest dynamics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/medfate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Preparing model inputs</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres</h4>
            
            <h4 data-toc-skip class="date">2025-10-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/HEAD/vignettes/intro/PreparingInputs.Rmd" class="external-link"><code>vignettes/intro/PreparingInputs.Rmd</code></a></small>
      <div class="d-none name"><code>PreparingInputs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="about-this-article">About this article<a class="anchor" aria-label="anchor" href="#about-this-article"></a>
</h2>
<p>A companion article <a href="https://emf-creaf.github.io/medfate/articles/intro/UnderstandingInputs.html"><em>Understanding
model inputs</em></a> explained the vegetation, soil and weather
structures needed to run the simulation models included in
<strong>medfate</strong>. Preparing inputs for simulations with
<strong>medfate</strong> is not straightforward, because it requires
obtaining and reshaping data for vegetation, soil and weather.
Therefore, this article illustrates some common issues that arise in the
process of preparing inputs, so that the user is aware of them when
processing his/her own data.</p>
<p>We begin by loading packages <strong>medfate</strong> and
<strong>meteoland</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/medfate/">medfate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Package 'medfate' [ver. 4.8.4]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/meteoland/" class="external-link">meteoland</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Package 'meteoland' [ver. 2.2.4]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="buildingmanipulating-forest-objects">Building/manipulating forest objects<a class="anchor" aria-label="anchor" href="#buildingmanipulating-forest-objects"></a>
</h2>
<p>In this section we show how to build and manipulate objects of class
<code>forest</code>, for their use in package medfate, starting from a
table containing forest inventory data.</p>
<div class="section level3">
<h3 id="poblet-tree-data-set">Poblet tree data set<a class="anchor" aria-label="anchor" href="#poblet-tree-data-set"></a>
</h3>
<p>Package <strong>medfate</strong> includes a small dataset of tree
data, corresponding to a dense holm oak forest in Poblet (Catalonia,
Spain). As a result of the abandonment of previous coppicing
exploitation, there is a high density of stems per individual.</p>
<p>We begin by loading the tree data from Poblet:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"poblet_trees"</span><span class="op">)</span></span></code></pre></div>
<p>and we inspect its content, for example using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Plot.Code            Indv.Ref       Species           Diameter.cm   </span></span>
<span><span class="co">#&gt;  Length:717         Min.   :  1.0   Length:717         Min.   : 7.50  </span></span>
<span><span class="co">#&gt;  Class :character   1st Qu.: 45.0   Class :character   1st Qu.: 9.10  </span></span>
<span><span class="co">#&gt;  Mode  :character   Median : 97.0   Mode  :character   Median :11.10  </span></span>
<span><span class="co">#&gt;                     Mean   :103.4                      Mean   :11.62  </span></span>
<span><span class="co">#&gt;                     3rd Qu.:156.0                      3rd Qu.:13.40  </span></span>
<span><span class="co">#&gt;                     Max.   :261.0                      Max.   :26.00</span></span></code></pre></div>
<p>The data frame includes tree data corresponding to three forest
inventories:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     POBL_CTL POBL_THI_AFT POBL_THI_BEF </span></span>
<span><span class="co">#&gt;          267          189          261</span></span></code></pre></div>
<p><code>POBL_CTL</code> corresponds to an oak forest where no treatment
was done (control), whereas <code>POBL_THI_BEF</code> and
<code>POBL_THI_AFT</code> are two forest inventories conducted on the
same forest plot, before and after a thinning intervention to reduce the
number of stems.</p>
</div>
<div class="section level3">
<h3 id="mapping-trees-from-the-control-forest">Mapping trees from the control forest<a class="anchor" aria-label="anchor" href="#mapping-trees-from-the-control-forest"></a>
</h3>
<p>We initialize an empty forest object using function
<code><a href="../../reference/emptyforest.html">emptyforest()</a></code> from package <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_ctl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/emptyforest.html">emptyforest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pobl_ctl</span></span>
<span><span class="co">#&gt; $treeData</span></span>
<span><span class="co">#&gt; [1] Species DBH     Height  N       Z50     Z95    </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $shrubData</span></span>
<span><span class="co">#&gt; [1] Species Height  Cover   Z50     Z95    </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $herbCover</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $herbHeight</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $seedBank</span></span>
<span><span class="co">#&gt; [1] Species Percent</span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "forest" "list"</span></span></code></pre></div>
<p>Now we will fill in data for element <code>treeData</code> in the
<code>forest</code> object. For that, we need to define a mapping from
column names in <code>poblet_trees</code> to variables in
<code>treeData</code>. The mapping can be defined using a <strong>named
string vector</strong>, i.e. a vector where element names are variable
names in <code>treeData</code> and vector elements are strings of the
variable names in <code>poblet_trees</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species.name"</span> <span class="op">=</span> <span class="st">"Species"</span>, <span class="st">"DBH"</span> <span class="op">=</span> <span class="st">"Diameter.cm"</span><span class="op">)</span></span></code></pre></div>
<p>We can now replace the empty <code>treeData</code> in
<code>pobl_ctl</code> using functions <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> and
<code><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_ctl</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">poblet_trees</span>, <span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_CTL"</span><span class="op">)</span>, </span>
<span>                                         mapping_x <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span><span class="op">)</span></span></code></pre></div>
<p>We can inspect the result using:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_ctl</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Species                N      Height             DBH          Z50         </span></span>
<span><span class="co">#&gt;  Length:267         Min.   :1   Mode:logical   Min.   : 7.50   Mode:logical  </span></span>
<span><span class="co">#&gt;  Class :character   1st Qu.:1   NA's:267       1st Qu.: 9.00   NA's:267      </span></span>
<span><span class="co">#&gt;  Mode  :character   Median :1                  Median :10.70                 </span></span>
<span><span class="co">#&gt;                     Mean   :1                  Mean   :11.53                 </span></span>
<span><span class="co">#&gt;                     3rd Qu.:1                  3rd Qu.:13.30                 </span></span>
<span><span class="co">#&gt;                     Max.   :1                  Max.   :26.00                 </span></span>
<span><span class="co">#&gt;    Z95         </span></span>
<span><span class="co">#&gt;  Mode:logical  </span></span>
<span><span class="co">#&gt;  NA's:267      </span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Some data are missing, but we will not worry about it now. One way to
evaluate if the tree data is correctly specified is to display a summary
of the <code>forest</code> object using the <code>summary</code>
function defined in <strong>medfate</strong> for this object class:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_ctl</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tree BA (m2/ha): 3.0179815  adult trees: 3.0179815  saplings: 0 </span></span>
<span><span class="co">#&gt; Density (ind/ha) adult trees: 267  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">#&gt; Cover (%) adult trees: 42.1205627  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; LAI (m2/m2) total: 0.544959  adult trees: 0.544959  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; Fuel loading (kg/m2) total: 0.1421746  adult trees: 0.1421746  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; PAR ground (%): NA  SWR ground (%): NA</span></span></code></pre></div>
<p>The values of stand density and stand basal area are too low for such
a dense forest, which indicates that something needs to be corrected. At
this point, it is important to remember that <code>forest</code> objects
need the density of trees to be specified as <em>stems per hectare</em>.
We conducted our tree data mapping without indicating the area of the
sampled plot. We are told that forest stand sampling was done using a
circular plot whose radius was 15 m. We can calculate the sampled area
using:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled_area</span> <span class="op">&lt;-</span> <span class="va">pi</span><span class="op">*</span><span class="fl">15</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<p>and use this information to map the tree data again, where we specify
parameter <code>plot_size_x</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_ctl</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">poblet_trees</span>, <span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_CTL"</span><span class="op">)</span>,</span>
<span>                                         mapping_x <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, </span>
<span>                                         plot_size_x <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></span></code></pre></div>
<p>We run again the summary:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_ctl</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tree BA (m2/ha): 42.6957047  adult trees: 42.6957047  saplings: 0 </span></span>
<span><span class="co">#&gt; Density (ind/ha) adult trees: 3777.277316  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">#&gt; Cover (%) adult trees: 100  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; LAI (m2/m2) total: 5.6770407  adult trees: 5.6770407  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; Fuel loading (kg/m2) total: 1.493419  adult trees: 1.493419  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; PAR ground (%): NA  SWR ground (%): NA</span></span></code></pre></div>
<p>which results in a much higher basal area and density, as should be
expected for a dense oak forest resulting from an abandoned old
coppice.</p>
<p>Another issue that we see is the percentage of PAR and SWR that
reaches the ground, which have missing values. This indicates that
medfate cannot calculate the light extinction profile, in our case
because tree heights are missing. Thus, we should somehow estimate tree
heights, for example using an allometric relationship:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Height.cm</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1.806</span><span class="op">*</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Diameter.cm</span><span class="op">^</span><span class="fl">0.518</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Height.cm</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   512.9   566.9   628.3   638.0   692.7   976.5</span></span></code></pre></div>
<p>So trees are between 5 and 10 m height. Once tree heights are
defined, we can include them in our mapping:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapping</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species.name"</span> <span class="op">=</span> <span class="st">"Species"</span>, <span class="st">"DBH"</span> <span class="op">=</span> <span class="st">"Diameter.cm"</span>, <span class="st">"Height"</span> <span class="op">=</span> <span class="st">"Height.cm"</span><span class="op">)</span></span></code></pre></div>
<p>and rerun the tree data mapping:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_ctl</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">poblet_trees</span>, <span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_CTL"</span><span class="op">)</span>,</span>
<span>                                         mapping_x <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, </span>
<span>                                         plot_size_x <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></span></code></pre></div>
<p>Now the summary of the control forest stand looks like:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_ctl</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tree BA (m2/ha): 42.6957047  adult trees: 42.6957047  saplings: 0 </span></span>
<span><span class="co">#&gt; Density (ind/ha) adult trees: 3777.277316  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">#&gt; Cover (%) adult trees: 100  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; LAI (m2/m2) total: 5.6770407  adult trees: 5.6770407  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; Fuel loading (kg/m2) total: 1.493419  adult trees: 1.493419  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; PAR ground (%): 4.4052535  SWR ground (%): 9.8976935</span></span></code></pre></div>
<p>The fraction of PAR/SWR reaching the ground is low, as would be
expected for a dense forest.</p>
</div>
<div class="section level3">
<h3 id="mapping-trees-from-the-managed-forest">Mapping trees from the managed forest<a class="anchor" aria-label="anchor" href="#mapping-trees-from-the-managed-forest"></a>
</h3>
<p>Here we can repeat our mapping for the managed forest plot, which has
two codes corresponding to before and after the thinning intervention.
Let us first address the pre-thinning state:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_thi_bef</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/emptyforest.html">emptyforest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pobl_thi_bef</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">poblet_trees</span>, <span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_THI_BEF"</span><span class="op">)</span>,</span>
<span>                                             mapping_x <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, </span>
<span>                                             plot_size_x <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in forest_mapTreeTable(subset(poblet_trees, Plot.Code ==</span></span>
<span><span class="co">#&gt; "POBL_THI_BEF"), : Taxon names that were not matched: Quercus humilis.</span></span></code></pre></div>
<p>A warning is raised that not all species names could be parsed. In
this case, the reason is that the name used for the downy oak
(<em>Quercus humilis</em>) is a synonym and needs to be replaced by its
accepted name (<em>Quercus pubescens</em>), which we can do:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="st">"Quercus humilis"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Quercus pubescens"</span></span></code></pre></div>
<p>Now we repeat our mapping:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_thi_bef</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">poblet_trees</span>, <span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_THI_BEF"</span><span class="op">)</span>,</span>
<span>                                             mapping_x <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, </span>
<span>                                             plot_size_x <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_thi_bef</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tree BA (m2/ha): 40.9224267  adult trees: 40.9224267  saplings: 0 </span></span>
<span><span class="co">#&gt; Density (ind/ha) adult trees: 3692.3946797  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">#&gt; Cover (%) adult trees: 100  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; LAI (m2/m2) total: 5.5833511  adult trees: 5.5833511  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; Fuel loading (kg/m2) total: 1.4629714  adult trees: 1.4629714  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; PAR ground (%): 4.6382035  SWR ground (%): 10.2827898</span></span></code></pre></div>
<p>Like the control plot, these statistics indicate a dense oak forest.
We can repeat the same operations with the forest plot after the
thinning intervention:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_thi_aft</span> <span class="op">=</span> <span class="fu"><a href="../../reference/emptyforest.html">emptyforest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pobl_thi_aft</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">poblet_trees</span>, <span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_THI_AFT"</span><span class="op">)</span>,</span>
<span>                                             mapping_x <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, </span>
<span>                                             plot_size_x <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_thi_aft</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tree BA (m2/ha): 31.6162035  adult trees: 31.6162035  saplings: 0 </span></span>
<span><span class="co">#&gt; Density (ind/ha) adult trees: 2673.8030439  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">#&gt; Cover (%) adult trees: 100  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; LAI (m2/m2) total: 4.5328748  adult trees: 4.5328748  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; Fuel loading (kg/m2) total: 1.1915321  adult trees: 1.1915321  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; PAR ground (%): 8.2654902  SWR ground (%): 15.7752682</span></span></code></pre></div>
<p>Note the decrease in tree density and basal area, and the increase in
light reaching the ground, despite the estimated leaf area index is
still high.</p>
</div>
<div class="section level3">
<h3 id="reducing-the-number-of-woody-cohorts">Reducing the number of woody cohorts<a class="anchor" aria-label="anchor" href="#reducing-the-number-of-woody-cohorts"></a>
</h3>
<p>So far we have considered that each tree record should correspond to
a woody cohort. We can check the number of tree cohorts in each
<code>forest</code> structure using:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pobl_ctl</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 267</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pobl_thi_bef</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 261</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pobl_thi_aft</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 189</span></span></code></pre></div>
<p>This large amount of cohorts can slow done simulations considerably.
Hence, it is advisable to lump them into coarser woody cohorts. One way
of doing this is via function <code><a href="../../reference/forest_simplification.html">forest_mergeTrees()</a></code> from
package <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_ctl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_simplification.html">forest_mergeTrees</a></span><span class="op">(</span><span class="va">pobl_ctl</span><span class="op">)</span></span>
<span><span class="va">pobl_thi_bef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_simplification.html">forest_mergeTrees</a></span><span class="op">(</span><span class="va">pobl_thi_bef</span><span class="op">)</span></span>
<span><span class="va">pobl_thi_aft</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/forest_simplification.html">forest_mergeTrees</a></span><span class="op">(</span><span class="va">pobl_thi_aft</span><span class="op">)</span></span></code></pre></div>
<p>By default, the function will pool tree cohorts of the same species
and diameter class (defined every 5 cm). We can check the new number of
tree cohorts using again:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pobl_ctl</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pobl_thi_bef</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pobl_thi_aft</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>We can check whether stand properties were altered using the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_thi_aft</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tree BA (m2/ha): 31.6162035  adult trees: 31.6162035  saplings: 0 </span></span>
<span><span class="co">#&gt; Density (ind/ha) adult trees: 2673.8030439  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">#&gt; Cover (%) adult trees: 100  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; LAI (m2/m2) total: 4.0969956  adult trees: 4.0969956  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; Fuel loading (kg/m2) total: 1.0724731  adult trees: 1.0724731  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">#&gt; PAR ground (%): 10.5046983  SWR ground (%): 18.8407832</span></span></code></pre></div>
<p>Function <code><a href="../../reference/forest_simplification.html">forest_mergeTrees()</a></code> will preserve the stand
density and basal area that the stand description had before merging
cohorts. Other properties like leaf area index may be slightly
modified.</p>
<p>In general, it is advisable to reduce the number of woody cohorts
before running simulation models in <strong>medfate</strong>.</p>
</div>
</div>
<div class="section level2">
<h2 id="retrieving-soilgrids-data">Retrieving SoilGrids data<a class="anchor" aria-label="anchor" href="#retrieving-soilgrids-data"></a>
</h2>
<p>Because soil properties vary strongly at fine spatial scales, ideally
soil physical attributes should be measured on samples taken at the
forest stand to be simulated. For those users lacking such data, soil
properties modelled at larger scales are available via
SoilGrids.org.</p>
<p>Retrieval of soil properties from SoilGrids can be done using
function <code>add_soilgrids()</code> from package
<strong>medfateland</strong>. Assuming we know the plot coordinates, we
first create an object <code>sf</code> (see package
<strong>sf</strong>):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf_pt</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0219</span>, <span class="fl">41.3443</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>With this function we will obtain, for each location, a data frame of
soil properties:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_soil_props</span></span>
<span><span class="co">#&gt;   widths     clay     sand       om       bd  rfc</span></span>
<span><span class="co">#&gt; 1    300 26.43333 31.06667 4.133333 1.166667 18.0</span></span>
<span><span class="co">#&gt; 2    700 30.40000 29.75000 0.900000 1.440000 19.2</span></span>
<span><span class="co">#&gt; 3   1000 31.60000 29.60000 0.610000 1.500000 20.9</span></span></code></pre></div>
<p>This data frame is a physical description of the soil. Initialization
of additional parameters and state variables is done using function
<code><a href="../../reference/soil.html">soil()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">pobl_soil_props</span><span class="op">)</span></span></code></pre></div>
<p>We can inspect the soil definition using:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_soil</span><span class="op">)</span></span>
<span><span class="co">#&gt; Soil depth (mm): 2000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer  1  [ 0  to  300 mm ] </span></span>
<span><span class="co">#&gt;     clay (%): 26 silt (%): 38 sand (%): 31 organic matter (%): 4 [ Loam ]</span></span>
<span><span class="co">#&gt;     Rock fragment content (%): 18 Macroporosity (%): 22 </span></span>
<span><span class="co">#&gt;     Theta WP (%): 18 Theta FC (%): 34 Theta SAT (%): 51 Theta current (%) 34 </span></span>
<span><span class="co">#&gt;     Vol. WP (mm): 44 Vol. FC (mm): 83 Vol. SAT (mm): 125 Vol. current (mm): 83 </span></span>
<span><span class="co">#&gt;     Temperature (Celsius): NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer  2  [ 300  to  1000 mm ] </span></span>
<span><span class="co">#&gt;     clay (%): 30 silt (%): 39 sand (%): 30 organic matter (%): 1 [ Clay loam ]</span></span>
<span><span class="co">#&gt;     Rock fragment content (%): 19 Macroporosity (%): 9 </span></span>
<span><span class="co">#&gt;     Theta WP (%): 19 Theta FC (%): 33 Theta SAT (%): 44 Theta current (%) 33 </span></span>
<span><span class="co">#&gt;     Vol. WP (mm): 106 Vol. FC (mm): 186 Vol. SAT (mm): 250 Vol. current (mm): 186 </span></span>
<span><span class="co">#&gt;     Temperature (Celsius): NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer  3  [ 1000  to  2000 mm ] </span></span>
<span><span class="co">#&gt;     clay (%): 32 silt (%): 38 sand (%): 30 organic matter (%): 1 [ Clay loam ]</span></span>
<span><span class="co">#&gt;     Rock fragment content (%): 21 Macroporosity (%): 6 </span></span>
<span><span class="co">#&gt;     Theta WP (%): 19 Theta FC (%): 33 Theta SAT (%): 44 Theta current (%) 33 </span></span>
<span><span class="co">#&gt;     Vol. WP (mm): 152 Vol. FC (mm): 263 Vol. SAT (mm): 347 Vol. current (mm): 263 </span></span>
<span><span class="co">#&gt;     Temperature (Celsius): NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total soil saturated capacity (mm): 723 </span></span>
<span><span class="co">#&gt; Total soil water holding capacity (mm): 532 </span></span>
<span><span class="co">#&gt; Total soil extractable water (mm): 280 </span></span>
<span><span class="co">#&gt; Total soil current Volume (mm): 532 </span></span>
<span><span class="co">#&gt; Saturated water depth (mm): NA</span></span></code></pre></div>
<p>It is important to remember that SoilGrids may underestimate the
amount of rocks in the soil. This is because soil samples (which were
used to generate the global database) do not normally contain large
stones or blocks. Hence, realistic simulations should reduce the soil
water holding capacity by increasing the column <code>rfc</code>. For
example, here we will assume that the third layer contains 80% of
rocks:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_soil_props</span><span class="op">$</span><span class="va">rfc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">80</span></span></code></pre></div>
<p>If we rebuild the soil object and inspect its properties we will see
the effect on the soil water holding capacity and soil extractable
water:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">pobl_soil_props</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pobl_soil</span><span class="op">)</span></span>
<span><span class="co">#&gt; Soil depth (mm): 2000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer  1  [ 0  to  300 mm ] </span></span>
<span><span class="co">#&gt;     clay (%): 26 silt (%): 38 sand (%): 31 organic matter (%): 4 [ Loam ]</span></span>
<span><span class="co">#&gt;     Rock fragment content (%): 18 Macroporosity (%): 22 </span></span>
<span><span class="co">#&gt;     Theta WP (%): 18 Theta FC (%): 34 Theta SAT (%): 51 Theta current (%) 34 </span></span>
<span><span class="co">#&gt;     Vol. WP (mm): 44 Vol. FC (mm): 83 Vol. SAT (mm): 125 Vol. current (mm): 83 </span></span>
<span><span class="co">#&gt;     Temperature (Celsius): NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer  2  [ 300  to  1000 mm ] </span></span>
<span><span class="co">#&gt;     clay (%): 30 silt (%): 39 sand (%): 30 organic matter (%): 1 [ Clay loam ]</span></span>
<span><span class="co">#&gt;     Rock fragment content (%): 19 Macroporosity (%): 9 </span></span>
<span><span class="co">#&gt;     Theta WP (%): 19 Theta FC (%): 33 Theta SAT (%): 44 Theta current (%) 33 </span></span>
<span><span class="co">#&gt;     Vol. WP (mm): 106 Vol. FC (mm): 186 Vol. SAT (mm): 250 Vol. current (mm): 186 </span></span>
<span><span class="co">#&gt;     Temperature (Celsius): NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer  3  [ 1000  to  2000 mm ] </span></span>
<span><span class="co">#&gt;     clay (%): 32 silt (%): 38 sand (%): 30 organic matter (%): 1 [ Clay loam ]</span></span>
<span><span class="co">#&gt;     Rock fragment content (%): 80 Macroporosity (%): 6 </span></span>
<span><span class="co">#&gt;     Theta WP (%): 19 Theta FC (%): 33 Theta SAT (%): 44 Theta current (%) 33 </span></span>
<span><span class="co">#&gt;     Vol. WP (mm): 38 Vol. FC (mm): 67 Vol. SAT (mm): 88 Vol. current (mm): 67 </span></span>
<span><span class="co">#&gt;     Temperature (Celsius): NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total soil saturated capacity (mm): 463 </span></span>
<span><span class="co">#&gt; Total soil water holding capacity (mm): 336 </span></span>
<span><span class="co">#&gt; Total soil extractable water (mm): 179 </span></span>
<span><span class="co">#&gt; Total soil current Volume (mm): 336 </span></span>
<span><span class="co">#&gt; Saturated water depth (mm): NA</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interpolating-weather">Interpolating weather<a class="anchor" aria-label="anchor" href="#interpolating-weather"></a>
</h2>
<p>While soil information is often scarce and uncertain, obtaining daily
weather data suitable for simulations is not straightforward either.
Here we illustrate one way of obtaining such data using package
<strong>meteoland</strong>. We begin by adding topographic variables
into a <code>sf</code> object:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_spt</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="va">sf_pt</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>elevation <span class="op">=</span> <span class="fl">850</span>,</span>
<span>                          slope <span class="op">=</span> <span class="fl">15.1</span>, </span>
<span>                          aspect <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pobl_spt</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1.0219 ymin: 41.3443 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;                    sf_pt elevation slope aspect</span></span>
<span><span class="co">#&gt; 1 POINT (1.0219 41.3443)       850  15.1     15</span></span></code></pre></div>
<p>The more difficult part of using package <strong>meteoland</strong>
is to assemble reference weather data from surface weather stations into
the socalled <strong>interpolator</strong> object (of class
<code>stars</code>). Please see the <a href="https://emf-creaf.github.io/meteoland/index.html" class="external-link">meteoland
package documentation</a> to learn how to create interpolator objects.
Here we will assume that such an object is already available, by using
the example object provided in the <strong>meteoland</strong>
package.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"meteoland_interpolator_example"</span><span class="op">)</span></span></code></pre></div>
<p>Once we have this interpolator, obtaining interpolated weather for a
set of target points is rather straightforward using function
<code><a href="https://emf-creaf.github.io/meteoland/reference/interpolate_data.html" class="external-link">interpolate_data()</a></code> from <strong>meteoland</strong>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meteo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emf-creaf.github.io/meteoland/reference/interpolate_data.html" class="external-link">interpolate_data</a></span><span class="op">(</span><span class="va">pobl_spt</span>, <span class="va">meteoland_interpolator_example</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Starting interpolation...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Temperature interpolation is needed also...</span></span>
<span><span class="co">#&gt; • Interpolating temperature...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Precipitation interpolation is needed also...</span></span>
<span><span class="co">#&gt; • Interpolating precipitation...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Relative humidity interpolation is needed also...</span></span>
<span><span class="co">#&gt; • Interpolating relative humidity...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Radiation calculation is needed also...</span></span>
<span><span class="co">#&gt; • Calculating radiation...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Wind interpolation is needed also...</span></span>
<span><span class="co">#&gt; • Interpolating wind...</span></span>
<span><span class="co">#&gt; • Calculating PET...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Interpolation done...</span></span></code></pre></div>
<p>The output of function <code><a href="https://emf-creaf.github.io/meteoland/reference/interpolate_data.html" class="external-link">interpolate_data()</a></code> is an object
of class <code>sf</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meteo</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1.0219 ymin: 41.3443 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;              sf_pt elevation slope aspect interpolated_data </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (1.0219 41.3443)       850  15.1     15 <span style="color: #949494;">&lt;tibble [30 × 13]&gt;</span></span></span></code></pre></div>
<p>We can access the weather data frame by subsetting the appropriate
element of <code>interpolated_data</code>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pobl_weather</span> <span class="op">&lt;-</span> <span class="va">meteo</span><span class="op">$</span><span class="va">interpolated_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pobl_weather</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#&gt;   dates                 DOY MeanTemperature MinTemperature MaxTemperature</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2022-04-01 <span style="color: #949494;">00:00:00</span>    91            3.37         -<span style="color: #BB0000;">2.21</span>            6.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2022-04-02 <span style="color: #949494;">00:00:00</span>    92            3.60         -<span style="color: #BB0000;">4.01</span>            8.54</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2022-04-03 <span style="color: #949494;">00:00:00</span>    93            2.33         -<span style="color: #BB0000;">7.67</span>            8.83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2022-04-04 <span style="color: #949494;">00:00:00</span>    94            4.16         -<span style="color: #BB0000;">4.46</span>            9.76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2022-04-05 <span style="color: #949494;">00:00:00</span>    95            5.86         -<span style="color: #BB0000;">5.21</span>           13.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2022-04-06 <span style="color: #949494;">00:00:00</span>    96            9.16          0.472          14.8 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: Precipitation &lt;dbl&gt;, MeanRelativeHumidity &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   MinRelativeHumidity &lt;dbl&gt;, MaxRelativeHumidity &lt;dbl&gt;, Radiation &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   WindSpeed &lt;dbl&gt;, WindDirection &lt;dbl&gt;, PET &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Martin-StPaul, Víctor Granda, Antoine Cabon, Arsène Druel, Julien Ruffault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
